# B端饮品配置管理用户手册

**功能模块**: 饮品订单管理
**规格标识**: O003-beverage-order (User Story 3)
**适用版本**: v1.0.0
**最后更新**: 2025-12-28

---

## 目录

1. [功能概述](#功能概述)
2. [适用对象与权限](#适用对象与权限)
3. [快速开始](#快速开始)
4. [功能操作指南](#功能操作指南)
   - 4.1 [查看饮品列表](#41-查看饮品列表)
   - 4.2 [新增饮品](#42-新增饮品)
   - 4.3 [编辑饮品](#43-编辑饮品)
   - 4.4 [删除饮品](#44-删除饮品)
   - 4.5 [配置饮品规格](#45-配置饮品规格)
   - 4.6 [配置饮品配方](#46-配置饮品配方)
   - 4.7 [切换饮品状态](#47-切换饮品状态)
5. [高级功能](#高级功能)
6. [常见问题 FAQ](#常见问题-faq)
7. [注意事项](#注意事项)

---

## 功能概述

饮品配置管理模块为影院饮品业务提供完整的 B端管理能力，支持商品管理员对饮品菜单进行全生命周期管理。

**核心功能**:
- ✅ 饮品基础信息管理（名称、分类、价格、图片、描述）
- ✅ 饮品规格配置（大小、温度、甜度、配料等多维度规格）
- ✅ 饮品配方管理（BOM 原料清单，支持库存关联）
- ✅ 饮品状态控制（上架/下架）
- ✅ 图片上传与管理
- ✅ 分页查询与多条件筛选

**业务价值**:
- 集中管理饮品信息，避免数据不一致
- 灵活配置规格组合，满足顾客个性化需求
- 关联库存配方，支持自动扣料和库存预警
- 支持营销策略（推荐标签、排序权重）

---

## 适用对象与权限

### 目标用户
- **主要用户**: 商品管理员、运营人员
- **次要用户**: 门店店长（查看权限）

### 权限要求

| 操作 | 所需权限 | 说明 |
|------|---------|------|
| 查看饮品列表 | `beverage:view` | 所有用户可见 |
| 新增饮品 | `beverage:create` | 商品管理员 |
| 编辑饮品 | `beverage:update` | 商品管理员 |
| 删除饮品 | `beverage:delete` | 商品管理员 + 需确认无关联订单 |
| 配置规格 | `beverage:manage_spec` | 商品管理员 |
| 配置配方 | `beverage:manage_recipe` | 商品管理员 + 需 SKU 管理权限 |
| 切换状态 | `beverage:manage_status` | 商品管理员 |

---

## 快速开始

### 第一次使用

1. **登录系统**: 使用商品管理员账号登录影院管理中台
2. **进入模块**: 左侧导航栏点击 **"饮品管理"** > **"饮品配置"**
3. **浏览现有饮品**: 列表展示所有已配置饮品（默认显示所有状态）
4. **创建第一个饮品**: 点击右上角 **"新增饮品"** 按钮

### 典型操作流程

```
新增饮品 → 上传图片 → 配置规格 → 配置配方 → 上架销售
   ↓
查看订单反馈 → 调整规格/价格 → 优化配方
```

---

## 功能操作指南

### 4.1 查看饮品列表

#### 操作步骤

1. **进入列表页**
   左侧导航栏点击 **"饮品管理"** > **"饮品配置"**

2. **查看列表信息**
   列表显示以下字段：
   - **饮品名称**: 点击可查看详情
   - **分类**: 咖啡/茶饮/果汁/其他
   - **主图**: 缩略图预览
   - **基础价格**: 单位为元（未含规格调价）
   - **规格数**: 已配置规格数量
   - **配方数**: 已配置配方数量
   - **状态**:
     - 🟢 上架 (ACTIVE) - 可在 C端 下单
     - 🔴 下架 (INACTIVE) - 不可下单
   - **操作**: 编辑、删除、配置规格、配置配方、切换状态

#### 筛选与搜索

**按名称搜索**:
- 输入框输入饮品名称关键词（支持模糊匹配）
- 示例: 输入 "拿铁" 可匹配 "美式拿铁"、"香草拿铁"

**按分类筛选**:
- 下拉菜单选择分类
- 可选项: 全部 / 咖啡 / 茶饮 / 果汁 / 其他

**按状态筛选**:
- 下拉菜单选择状态
- 可选项: 全部 / 上架 / 下架

**分页**:
- 默认每页 20 条
- 支持跳转到指定页码

#### 查看饮品详情

点击饮品名称或 **"查看详情"** 按钮，弹窗显示：
- 基础信息（名称、分类、价格、描述、推荐标签）
- 主图和详情图列表
- 已配置规格列表（类型、名称、价格调整）
- 已配置配方列表（配方名称、适用规格、原料清单）

---

### 4.2 新增饮品

#### 操作步骤

1. **点击新增按钮**
   列表页右上角点击 **"新增饮品"** 按钮

2. **填写基础信息**

   | 字段 | 说明 | 是否必填 | 校验规则 |
   |------|------|---------|---------|
   | 饮品名称 | 最多 100 个字符 | ✅ 必填 | 不能为空 |
   | 饮品分类 | 下拉选择 | ✅ 必填 | 咖啡/茶饮/果汁/其他 |
   | 基础价格 | 单位：元 | ✅ 必填 | ≥ 0，支持两位小数 |
   | 饮品描述 | 最多 500 个字符 | ❌ 可选 | 用于 C端 展示 |
   | 主图 | 图片 URL | ✅ 必填 | 点击上传框上传 |
   | 详情图 | 多张图片 | ❌ 可选 | 最多 5 张，顺序可拖拽 |
   | 是否推荐 | 开关 | ❌ 可选 | 默认关闭，开启后在 C端 首页展示 |
   | 初始状态 | 下拉选择 | ❌ 可选 | 默认"下架"，可选"上架" |

3. **上传主图**

   点击 **"上传主图"** 区域：
   - 支持格式: JPG, PNG, WEBP
   - 文件大小: ≤ 5MB
   - 推荐尺寸: 800x800 像素
   - 上传成功后显示预览图

4. **上传详情图（可选）**

   点击 **"上传详情图"** 区域：
   - 支持批量上传，最多 5 张
   - 拖拽调整图片顺序
   - 点击删除图标移除图片

5. **提交保存**

   点击 **"确定"** 按钮：
   - 系统自动校验必填项
   - 价格自动转换为分（1元 = 100分）存储
   - 成功后刷新列表并提示 "创建成功"

#### 示例：创建"美式咖啡"

```
饮品名称: 美式咖啡
饮品分类: 咖啡
基础价格: 18.00 元
饮品描述: 经典美式咖啡，香醇浓郁，适合提神醒脑
主图: [上传 americano.jpg]
详情图: [上传 americano-detail-1.jpg, americano-detail-2.jpg]
是否推荐: 开启
初始状态: 上架
```

---

### 4.3 编辑饮品

#### 操作步骤

1. **进入编辑模式**
   列表页点击某个饮品的 **"编辑"** 按钮

2. **修改信息**
   弹窗显示当前饮品信息，可修改：
   - 饮品名称
   - 饮品分类
   - 基础价格（修改会影响所有规格的最终价格）
   - 饮品描述
   - 主图（点击重新上传）
   - 详情图（增删改）
   - 推荐标签
   - **注意**: 状态字段在此处不可修改（需使用"切换状态"功能）

3. **保存修改**
   点击 **"确定"** 按钮，系统更新饮品信息

#### 注意事项

- 修改基础价格后，所有规格的最终价格 = 基础价格 + 规格调价
- 修改分类不影响已有订单
- 修改后自动记录操作日志（操作人、时间）

---

### 4.4 删除饮品

#### 操作步骤

1. **点击删除按钮**
   列表页点击某个饮品的 **"删除"** 按钮

2. **确认删除**
   弹窗提示：
   > ⚠️ 确认删除该饮品吗？删除后将无法恢复，且关联的规格和配方也会被删除。

   - 点击 **"确认"** 执行删除
   - 点击 **"取消"** 放弃操作

3. **系统校验**
   后端检查是否存在关联订单：
   - **存在关联订单**: 禁止删除，提示 "该饮品存在未完成订单，无法删除"
   - **无关联订单**: 执行软删除（状态标记为 INACTIVE）

#### 删除规则

- **软删除**: 数据不真实删除，仅标记为不可用
- **级联删除**: 饮品删除后，关联的规格和配方同步删除
- **订单保护**: 有未完成订单的饮品无法删除（需等订单完成后手动下架）

#### 批量删除（暂不支持）

当前版本不支持批量删除，需逐个删除。

---

### 4.5 配置饮品规格

#### 什么是饮品规格？

饮品规格是顾客可选的属性组合，例如：
- **大小 (SIZE)**: 小杯、中杯、大杯
- **温度 (TEMPERATURE)**: 热、温、冰
- **甜度 (SWEETNESS)**: 正常糖、半糖、少糖、无糖
- **配料 (TOPPING)**: 珍珠、椰果、芋圆、布丁

每个规格可设置价格调整（加价或减价）。

#### 操作步骤

1. **进入规格配置**
   列表页点击某个饮品的 **"配置规格"** 按钮

2. **查看规格列表**
   弹窗显示当前饮品的所有规格，按规格类型分组：
   - SIZE（大小）
   - TEMPERATURE（温度）
   - SWEETNESS（甜度）
   - TOPPING（配料）

3. **新增规格**

   点击 **"新增规格"** 按钮，填写表单：

   | 字段 | 说明 | 是否必填 | 示例 |
   |------|------|---------|------|
   | 规格类型 | 下拉选择 | ✅ 必填 | SIZE |
   | 规格名称 | 最多 50 个字符 | ✅ 必填 | 中杯 |
   | 价格调整 | 单位：元，可为负数 | ✅ 必填 | +2.00 元 |
   | 是否默认 | 开关 | ❌ 可选 | 开启后成为该类型默认选项 |
   | 排序序号 | 数字，越小越靠前 | ❌ 可选 | 1 |
   | 规格描述 | 最多 200 个字符 | ❌ 可选 | 350ml |

   点击 **"确定"** 保存。

4. **编辑规格**

   点击某个规格的 **"编辑"** 按钮，修改信息后保存。

5. **删除规格**

   点击某个规格的 **"删除"** 按钮，确认后删除。

   **注意**: 删除前需确认该规格未被订单使用。

#### 默认规格规则

- 每个规格类型（SIZE/TEMPERATURE 等）只能有一个默认选项
- 设置新的默认选项时，系统自动取消同类型其他规格的默认标识
- C端 下单时默认选中默认规格

#### 示例：为"美式咖啡"配置规格

**大小规格 (SIZE)**:
- 小杯（-2元，排序1）
- 中杯（+0元，默认，排序2）
- 大杯（+3元，排序3）

**温度规格 (TEMPERATURE)**:
- 热（+0元，默认，排序1）
- 冰（+0元，排序2）

**甜度规格 (SWEETNESS)**:
- 正常糖（+0元，默认，排序1）
- 半糖（+0元，排序2）
- 无糖（+0元，排序3）

**配料规格 (TOPPING)**:
- 无配料（+0元，默认，排序1）
- 珍珠（+3元，排序2）
- 椰果（+3元，排序3）

**顾客下单示例**:
- 基础价格: 18元
- 选择: 中杯 (+0) + 冰 (+0) + 半糖 (+0) + 珍珠 (+3)
- **最终价格**: 18 + 0 + 0 + 0 + 3 = 21 元

---

### 4.6 配置饮品配方

#### 什么是饮品配方？

饮品配方（BOM - Bill of Materials）定义了制作饮品所需的原料清单和用量，用于：
- **库存扣减**: C端 下单后自动扣减原料库存
- **成本核算**: 计算饮品制作成本
- **库存预警**: 原料不足时提醒补货

#### 操作步骤

1. **进入配方配置**
   列表页点击某个饮品的 **"配置配方"** 按钮

2. **查看配方列表**
   弹窗显示当前饮品的所有配方，折叠面板展示：
   - 配方名称
   - 适用规格（JSON 字符串，例如 `{"SIZE":"大杯","TEMPERATURE":"冰"}`）
   - 原料清单（表格展示 SKU ID、原料名称、用量、单位、库存状态）

3. **新增配方**

   点击 **"新增配方"** 按钮，填写表单：

   | 字段 | 说明 | 是否必填 | 示例 |
   |------|------|---------|------|
   | 配方名称 | 最多 100 个字符 | ✅ 必填 | 中杯冰美式配方 |
   | 适用规格 | JSON 格式 | ❌ 可选 | `{"SIZE":"中杯","TEMPERATURE":"冰"}` |
   | 配方描述 | 最多 500 个字符 | ❌ 可选 | 经典冰美式制作配方 |

   **添加原料清单**:

   点击 **"添加原料"** 按钮，填写每个原料：

   | 字段 | 说明 | 是否必填 | 示例 |
   |------|------|---------|------|
   | SKU ID | 原料 SKU 编号 | ✅ 必填 | 1001 |
   | 原料名称 | 最多 100 个字符 | ✅ 必填 | 咖啡豆 |
   | 用量 | 数字 | ✅ 必填 | 20 |
   | 单位 | 最多 20 个字符 | ✅ 必填 | g |
   | 备注 | 最多 200 个字符 | ❌ 可选 | 使用哥伦比亚咖啡豆 |

   点击 **"➕"** 继续添加原料，点击 **"➖"** 删除不需要的原料。

   填写完成后点击 **"确定"** 保存。

4. **编辑配方**

   点击某个配方的 **"编辑"** 按钮：
   - 可修改配方名称、适用规格、描述
   - 可增删改原料清单
   - 保存后更新配方

5. **删除配方**

   点击某个配方的 **"删除"** 按钮，确认后删除。

   **注意**: 删除前需确认该配方未被订单使用。

#### SKU 验证规则（FR-037）

- 添加原料时，系统自动校验 SKU ID 是否存在于库存系统
- 不存在的 SKU ID 无法添加，提示 "SKU 不存在，请检查库存系统"
- 显示库存状态：
  - 🟢 充足: 库存 > 安全库存
  - 🟡 紧张: 库存 ≤ 安全库存
  - 🔴 缺货: 库存 = 0

#### 示例：为"美式咖啡"配置配方

**配方名称**: 中杯冰美式配方
**适用规格**: `{"SIZE":"中杯","TEMPERATURE":"冰"}`
**配方描述**: 经典冰美式制作配方

**原料清单**:

| SKU ID | 原料名称 | 用量 | 单位 | 库存状态 | 备注 |
|--------|---------|------|------|---------|------|
| 1001 | 咖啡豆 | 20 | g | 🟢 充足 | 使用哥伦比亚咖啡豆 |
| 1002 | 纯净水 | 200 | ml | 🟢 充足 | |
| 1003 | 冰块 | 100 | g | 🟡 紧张 | |

---

### 4.7 切换饮品状态

#### 操作步骤

1. **点击状态切换**
   列表页点击某个饮品的 **"切换状态"** 按钮

2. **选择目标状态**
   弹窗选择：
   - **上架 (ACTIVE)**: 允许 C端 顾客下单
   - **下架 (INACTIVE)**: 禁止 C端 顾客下单

3. **确认切换**
   点击 **"确定"** 后，系统更新状态并刷新列表

#### 上架前置条件

饮品必须满足以下条件才能上架：
- ✅ 已配置至少一个规格（每种类型至少一个）
- ✅ 已配置至少一个配方
- ✅ 配方中的原料库存充足（不允许缺货）
- ✅ 主图已上传

不满足条件时，系统提示具体缺失项。

#### 下架影响

- 下架后，C端 应用立即隐藏该饮品
- 已提交但未完成的订单不受影响
- 可随时重新上架

---

## 高级功能

### 5.1 批量上传图片

**功能说明**: 支持一次性上传多个饮品图片，减少重复操作。

**操作步骤**:
1. 列表页点击 **"批量上传图片"** 按钮
2. 选择多个图片文件（最多 20 张）
3. 系统自动上传并返回图片 URL 列表
4. 在新增/编辑饮品时直接选择已上传的图片

### 5.2 复制饮品配置

**功能说明**: 快速复制现有饮品的规格和配方到新饮品，减少重复配置。

**操作步骤**:
1. 列表页选择某个饮品，点击 **"复制"** 按钮
2. 弹窗显示新饮品表单，预填充源饮品信息
3. 修改饮品名称和其他信息
4. 保存后自动复制规格和配方

### 5.3 导出饮品数据

**功能说明**: 导出饮品列表为 Excel 文件，用于离线分析或备份。

**操作步骤**:
1. 列表页点击 **"导出"** 按钮
2. 选择导出范围：
   - 当前页
   - 全部数据
   - 筛选结果
3. 点击 **"确认导出"**，下载 Excel 文件

**导出字段**:
- 饮品名称、分类、基础价格、状态、推荐标签
- 规格数、配方数、创建时间、更新时间

### 5.4 饮品排序权重

**功能说明**: 调整饮品在 C端 应用中的展示顺序。

**操作步骤**:
1. 列表页点击 **"排序管理"** 按钮
2. 拖拽饮品行调整顺序
3. 保存后更新排序权重

**排序规则**:
- 推荐饮品优先展示
- 同为推荐时按排序权重排序
- 非推荐饮品按创建时间倒序

---

## 常见问题 FAQ

### Q1: 为什么无法删除某个饮品？

**A**: 可能原因：
1. 该饮品存在未完成订单（状态为"待制作"、"制作中"）
2. 缺少删除权限（需要 `beverage:delete` 权限）

**解决方法**:
- 等待关联订单全部完成后再删除
- 或使用"下架"功能代替删除

### Q2: 配置配方时提示"SKU 不存在"怎么办？

**A**: SKU ID 在库存系统中不存在，请检查：
1. SKU ID 是否输入正确（是否多输入空格或字符）
2. 该原料是否已在"库存管理"模块中创建
3. 联系库存管理员确认 SKU 状态

### Q3: 修改基础价格后，已有订单的价格会变吗？

**A**: 不会。已提交的订单价格在下单时锁定，后续修改不影响历史订单。

### Q4: 为什么规格价格调整无法设置为负数？

**A**: 可以设置为负数（如"小杯 -2元"），表示相对基础价格减价。请确保最终价格 ≥ 0 即可。

### Q5: 如何批量修改多个饮品的分类？

**A**: 当前版本不支持批量修改，需逐个编辑。未来版本将支持批量操作。

### Q6: 配方中的原料库存不足时会发生什么？

**A**:
- C端 下单时显示"该饮品暂时缺货"
- B端 配方列表显示库存状态为 🔴 缺货
- 建议及时补货或更换配方

### Q7: 删除饮品后可以恢复吗？

**A**: 可以。删除是软删除操作，数据保留在数据库中但标记为不可用。如需恢复，请联系系统管理员手动恢复。

### Q8: 如何设置多个默认规格？

**A**: 每个规格类型（SIZE/TEMPERATURE/SWEETNESS/TOPPING）只能有一个默认选项。设置新的默认项时，系统自动取消同类型其他规格的默认标识。

### Q9: 饮品图片上传失败怎么办？

**A**: 检查：
1. 图片格式是否为 JPG/PNG/WEBP
2. 文件大小是否 ≤ 5MB
3. 网络连接是否正常
4. 浏览器是否允许上传文件

如仍失败，请联系技术支持。

### Q10: 配方中的"适用规格"字段如何填写？

**A**: 使用 JSON 格式指定规格组合，例如：
```json
{
  "SIZE": "中杯",
  "TEMPERATURE": "冰"
}
```

表示该配方仅适用于"中杯+冰"的组合。留空表示适用于所有规格组合。

---

## 注意事项

### 数据一致性
- 修改饮品基础价格会影响所有规格的最终价格（基础价格 + 规格调价）
- 删除饮品会级联删除关联的规格和配方，请谨慎操作
- 配方中的原料 SKU ID 必须在库存系统中存在

### 性能优化
- 饮品主图推荐使用 WebP 格式，文件更小加载更快
- 详情图建议压缩后上传，建议单张 < 1MB
- 列表加载采用分页，避免一次性加载过多数据

### 安全与权限
- 删除操作需要二次确认，防止误删
- 关键操作（创建、编辑、删除）自动记录操作日志
- 敏感操作需要相应权限，无权限时按钮置灰

### 业务规则
- 上架前必须配置完整（规格+配方）
- 配方中的原料库存不足时无法上架
- 有未完成订单的饮品无法删除
- 每个规格类型只能有一个默认选项

### 浏览器兼容性
- 推荐使用 Chrome、Edge、Firefox 最新版本
- Safari 浏览器可能存在图片上传兼容性问题
- IE 浏览器不支持本系统

### 数据备份
- 建议定期导出饮品数据进行备份
- 重要配置修改前建议先备份当前数据
- 删除操作虽为软删除，但建议养成备份习惯

---

## 附录

### A. 饮品分类说明

| 分类 | 英文标识 | 说明 | 示例 |
|------|---------|------|------|
| 咖啡 | COFFEE | 各类咖啡饮品 | 美式、拿铁、卡布奇诺、摩卡 |
| 茶饮 | TEA | 茶类饮品 | 奶茶、水果茶、纯茶 |
| 果汁 | JUICE | 果汁类饮品 | 鲜榨果汁、混合果汁 |
| 其他 | OTHER | 其他饮品 | 可乐、雪碧、矿泉水 |

### B. 规格类型说明

| 规格类型 | 英文标识 | 说明 | 常见选项 |
|---------|---------|------|---------|
| 大小 | SIZE | 饮品容量 | 小杯、中杯、大杯 |
| 温度 | TEMPERATURE | 饮品温度 | 热、温、冰 |
| 甜度 | SWEETNESS | 糖分含量 | 正常糖、半糖、少糖、无糖 |
| 配料 | TOPPING | 额外配料 | 珍珠、椰果、芋圆、布丁、无配料 |

### C. 状态说明

| 状态 | 英文标识 | 说明 | 影响 |
|------|---------|------|------|
| 上架 | ACTIVE | 可销售状态 | C端 可见可下单 |
| 下架 | INACTIVE | 不可销售状态 | C端 不可见不可下单 |

### D. 联系支持

如有问题或建议，请联系：
- **技术支持**: support@cinema.com
- **产品反馈**: product@cinema.com
- **紧急联系**: 400-123-4567

---

**文档版本**: v1.0.0
**生成时间**: 2025-12-28
**生成工具**: doc-writer skill
**规格来源**: specs/O003-beverage-order/spec.md
