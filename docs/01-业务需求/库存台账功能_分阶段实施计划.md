# 库存台账功能 - 分阶段实施计划

> **文档版本**: 1.0  
> **创建日期**: 2025-12-26  
> **关联功能**: 003-inventory-management  
> **表达方式**: 用户故事(User Story)

---

## 概述

库存台账功能分为 **4个阶段** 实施，采用渐进式交付策略，确保每个阶段都能独立交付可用价值。

| 阶段 | 目标 | 预计工时 | 核心Story数 |
|------|------|----------|-------------|
| 阶段一 | 库存基础查看（MVP） | 1.5周 | 4个 |
| 阶段二 | 库存指标与预警 | 1.5周 | 5个 |
| 阶段三 | 库存调整与流水 | 2周 | 5个 |
| 阶段四 | 高级功能与集成 | 2周 | 5个 |

---

## 阶段一：库存基础查看（MVP）

> **目标**：让用户能够查看当前库存状态，完成最基础的库存可见性

### 用户故事

| Story ID | 用户故事 | 验收标准 | 优先级 |
|----------|----------|----------|--------|
| **INV-001** | 作为**店长**，我希望能够查看门店所有SKU的当前库存数量，以便掌握库存状态 | ① 库存列表显示SKU编码、名称、现存数量、单位<br>② 支持分页加载<br>③ 加载时间<2秒 | P0 |
| **INV-002** | 作为**店长**，我希望能够按SKU名称/编码搜索库存，以便快速定位商品 | ① 输入关键词实时筛选<br>② 支持模糊匹配<br>③ 无结果时显示空状态 | P0 |
| **INV-003** | 作为**店长**，我希望能够按门店筛选库存，以便只看本店数据 | ① 门店下拉单选<br>② 默认选中当前登录门店<br>③ 筛选后列表自动刷新 | P0 |
| **INV-004** | 作为**店长**，我希望能够查看单个SKU的库存详情，以便了解完整信息 | ① 点击行展开/抽屉显示详情<br>② 显示库存单位、最后更新时间<br>③ 显示安全库存阈值 | P1 |

### 交付物

- 库存台账列表页面
- 基础筛选功能（关键词搜索 + 门店筛选）
- 库存详情抽屉

### 工时估算

| 角色 | 工时 |
|------|------|
| 前端 | 3天 |
| 后端 | 3天 |
| 测试 | 1.5天 |
| **合计** | **1.5周** |

---

## 阶段二：库存指标与预警

> **目标**：增加多维库存指标，实现库存状态自动预警

### 用户故事

| Story ID | 用户故事 | 验收标准 | 优先级 |
|----------|----------|----------|--------|
| **INV-005** | 作为**店长**，我希望看到可用库存数量，以便判断是否能接单 | ① 列表显示可用库存列<br>② 可用库存=现存-预占<br>③ 预占数量单独显示 | P0 |
| **INV-006** | 作为**店长**，我希望系统自动标识库存状态（缺货/低库存/正常），以便快速发现异常 | ① 缺货(红)：可用≤0<br>② 低库存(橙)：可用<安全库存<br>③ 正常(绿)：可用≥安全库存 | P0 |
| **INV-007** | 作为**店长**，我希望能够按库存状态筛选，以便只看异常库存 | ① 状态多选筛选器<br>② 可同时选择多个状态<br>③ 选中状态显示标签 | P0 |
| **INV-008** | 作为**店长**，我希望能够按类目/品牌筛选库存，以便分类查看 | ① 类目树形下拉<br>② 品牌下拉单选<br>③ 支持组合筛选 | P1 |
| **INV-009** | 作为**仓管**，我希望看到在途库存数量，以便了解即将到货情况 | ① 列表显示在途库存列<br>② 详情显示在途明细（来源单号、预计到货） | P1 |

### 交付物

- 多维库存指标展示（现存/可用/预占/在途）
- 库存状态自动计算与颜色标识
- 多条件组合筛选

### 工时估算

| 角色 | 工时 |
|------|------|
| 前端 | 3天 |
| 后端 | 3天 |
| 测试 | 1.5天 |
| **合计** | **1.5周** |

---

## 阶段三：库存调整与流水

> **目标**：支持库存盘点调整，记录完整的库存变动流水

### 用户故事

| Story ID | 用户故事 | 验收标准 | 优先级 |
|----------|----------|----------|--------|
| **INV-010** | 作为**店长**，我希望能够录入库存调整（盘盈/盘亏），以便处理盘点差异 | ① 选择调整类型：盘盈/盘亏/报损<br>② 输入调整数量、原因<br>③ 提交后库存立即更新 | P0 |
| **INV-011** | 作为**店长**，我希望能够查看库存流水记录，以便追溯库存变动 | ① 按SKU查看流水列表<br>② 显示变动类型、数量、时间、操作人<br>③ 显示变动前后库存 | P0 |
| **INV-012** | 作为**店长**，我希望库存调整需填写原因，以便后续分析 | ① 原因必填<br>② 提供原因字典选择<br>③ 支持填写备注 | P0 |
| **INV-013** | 作为**运营总监**，我希望大额库存调整需审批，以便控制风险 | ① 调整金额>阈值时进入审批<br>② 审批通过后才更新库存<br>③ 审批记录可追溯 | P1 |
| **INV-014** | 作为**店长**，我希望能够设置SKU的安全库存阈值，以便自定义预警标准 | ① 在详情中编辑安全库存<br>② 保存后立即生效<br>③ 状态标识随之更新 | P1 |

### 交付物

- 库存调整功能（盘盈/盘亏/报损）
- 库存流水查询
- 调整原因字典
- 安全库存阈值设置

### 工时估算

| 角色 | 工时 |
|------|------|
| 前端 | 4天 |
| 后端 | 5天 |
| 测试 | 2天 |
| **合计** | **2周** |

---

## 阶段四：高级功能与集成

> **目标**：完善导出功能，与订单系统实现联动

### 用户故事

| Story ID | 用户故事 | 验收标准 | 优先级 |
|----------|----------|----------|--------|
| **INV-015** | 作为**店长**，我希望能够导出库存报表，以便线下分析或存档 | ① 支持导出当前筛选结果<br>② Excel格式<br>③ 包含所有展示列 | P1 |
| **INV-016** | 作为**系统**，当订单确认时自动预占库存，以便防止超卖 | ① 订单确认触发预占<br>② 预占数量增加<br>③ 可用库存减少 | P0 |
| **INV-017** | 作为**系统**，当出品确认时自动扣减库存，以便保持库存准确 | ① 出品确认触发扣减<br>② 现存库存减少<br>③ 预占库存释放 | P0 |
| **INV-018** | 作为**店长**，我希望订单取消时自动释放预占，以便库存可用 | ① 订单取消触发释放<br>② 预占库存减少<br>③ 可用库存恢复 | P0 |
| **INV-019** | 作为**运营总监**，我希望看到库存统计概览，以便快速了解整体状况 | ① 显示总SKU数、缺货数、低库存数<br>② 显示库存总金额<br>③ 支持按门店切换 | P2 |

### 交付物

- Excel导出功能
- 订单预占/扣减/释放联动
- 库存概览看板

### 工时估算

| 角色 | 工时 |
|------|------|
| 前端 | 4天 |
| 后端 | 5天 |
| 测试 | 2天 |
| **合计** | **2周** |

---

## 阶段依赖关系图

```
阶段一                阶段二               阶段三              阶段四
基础查看(MVP)   ──→   指标与预警    ──→    调整与流水   ──→   高级功能与集成
                                                              
INV-001~004          INV-005~009         INV-010~014        INV-015~019
                                                              
[1.5周]              [1.5周]              [2周]              [2周]
                                                              
前端列表页            状态计算              调整API            订单联动
基础筛选              预警标识              流水记录           导出功能
详情抽屉              组合筛选              审批流程           统计看板
```

---

## 工时汇总

| 阶段 | 前端 | 后端 | 测试 | 合计 |
|------|------|------|------|------|
| 阶段一：基础查看 | 3天 | 3天 | 1.5天 | **1.5周** |
| 阶段二：指标预警 | 3天 | 3天 | 1.5天 | **1.5周** |
| 阶段三：调整流水 | 4天 | 5天 | 2天 | **2周** |
| 阶段四：高级集成 | 4天 | 5天 | 2天 | **2周** |
| **总计** | **14天** | **16天** | **7天** | **7周** |

---

## 优先级说明

| 优先级 | 含义 | Story数量 |
|--------|------|-----------|
| **P0** | 必须实现，阶段核心功能 | 12个 |
| **P1** | 应该实现，提升体验 | 6个 |
| **P2** | 可以实现，锦上添花 | 1个 |

---

## 相关文档

| 文档 | 路径 | 说明 |
|------|------|------|
| 库存台账专项说明 | `/docs/业务需求/需求专项说明/库存台账功能专项说明.md` | 功能详细说明 |
| 库存管理规格 | `/specs/003-inventory-management/spec.md` | 技术规格 |
| BOM MVP需求书 | `/docs/业务需求/BOM_MVP_业务需求书_敏捷故事卡片.md` | 整体业务需求 |
