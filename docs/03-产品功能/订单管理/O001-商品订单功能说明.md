# 商品订单列表查看与管理 - 产品文档

<!-- DOC-WRITER: AUTO-GENERATED START -->
**文档版本**: 1.0.0
**功能标识**: O001-product-order-list
**系统**: 影院商品管理中台
**模块**: 订单管理
**创建日期**: 2025-12-27
**状态**: 已实现

---

## 1. 功能概述

### 1.1 产品定位

商品订单列表查看与管理功能是影院商品管理中台的核心功能之一,为运营人员提供全面的订单管理能力。本功能帮助运营人员高效查看、筛选、管理商品订单,确保订单流转顺畅,提升运营效率。

**核心价值**:
- **提升效率**: 运营人员能在 3 秒内加载订单列表,1 秒内完成筛选,快速定位目标订单
- **降低出错**: 通过状态机和乐观锁机制,防止订单状态错误变更和并发冲突
- **可追溯性**: 完整的订单日志记录,支持审计和问题追溯
- **易用性**: 简洁直观的 B端 管理界面,90% 运营人员无需培训即可上手

### 1.2 适用对象

- **运营人员**: 负责日常订单管理,包括查看订单、处理订单状态变更、导出订单数据
- **客服人员**: 协助用户查询订单信息,处理订单相关问题
- **运营主管**: 查看订单统计数据,监控订单流转情况

### 1.3 业务范围

**包含**:
- 商品订单列表查看(支持分页、排序)
- 订单多维度筛选(状态、时间范围、用户信息)
- 订单详情查看(完整信息展示)
- 订单状态手动变更(发货、完成、取消)
- 订单操作日志记录
- 订单数据导出(Excel/CSV)

**不包含**:
- 订单创建功能(由 C端 用户下单流程负责)
- 订单支付功能(由支付模块负责)
- 订单退款/售后功能(未来版本)
- 物流实时跟踪功能(未来版本)
- 预约订单管理(属于 U/RSV 模块)

---

## 2. 功能特性

### 2.1 订单列表查看 (优先级: P1) 🎯 MVP

#### 功能描述

运营人员可以查看系统中所有商品订单的列表,快速了解订单全貌。

#### 主要能力

- **列表展示**: 显示订单号、用户名、手机号(脱敏)、商品摘要、订单金额、订单状态、创建时间
- **分页加载**: 每页显示 20 条订单,支持翻页查看更多数据
- **排序功能**: 订单按创建时间倒序排列,最新订单在最前面
- **快速跳转**: 点击订单号可快速跳转到订单详情页

#### 用户价值

- 运营人员能在 3 秒内加载订单列表首页
- 快速浏览所有订单,了解订单整体情况
- 支持 50000+ 条订单数据,翻页仍保持流畅(≤ 2 秒)

#### 界面示意

```
订单列表页 (/orders/list)
┌────────────────────────────────────────────────────────────────┐
│  订单管理 / 订单列表                                               │
├────────────────────────────────────────────────────────────────┤
│  [筛选器区域]                                                    │
│                                                                │
│  ┌────────────────────────────────────────────────────────┐  │
│  │ 订单号    │ 用户       │ 商品         │ 金额   │ 状态 │ 时间 │  │
│  ├────────────────────────────────────────────────────────┤  │
│  │ ORD...CD │ 张三(138***) │ 爆米花×2... │ ¥155 │ 已支付│ ...│  │
│  │ ORD...GH │ 李四(139***) │ 可乐×1...   │ ¥180 │ 已发货│ ...│  │
│  │ ...                                                    │  │
│  └────────────────────────────────────────────────────────┘  │
│                                                                │
│  共 150 条记录  [1] 2 3 4 ... 8 >                               │
└────────────────────────────────────────────────────────────────┘
```

---

### 2.2 订单多维度筛选 (优先级: P1) 🎯 MVP

#### 功能描述

运营人员可以通过多种条件快速筛选订单,在大量订单中精准定位目标订单。

#### 主要能力

- **状态筛选**: 按订单状态筛选(待支付、已支付、已发货、已完成、已取消)
- **时间筛选**: 按时间范围筛选(支持日期选择器,默认显示近 30 天)
- **用户搜索**: 按用户名或手机号搜索订单
- **组合筛选**: 支持多个筛选条件同时使用
- **快速重置**: 一键清空所有筛选条件,恢复全部订单

#### 用户价值

- 在 1 秒内完成筛选操作并刷新列表
- 快速定位特定状态或时间段的订单
- 支持精确查找某个用户的所有订单

#### 使用场景

- **场景 1**: 运营人员需要处理所有"已支付"订单,选择状态筛选为"已支付",只显示待发货订单
- **场景 2**: 客服需要查询某用户的订单,输入用户手机号搜索,快速找到该用户的所有订单
- **场景 3**: 运营主管需要查看昨天的订单统计,选择时间范围为"2025-12-26"一天,查看当天所有订单

---

### 2.3 订单详情查看 (优先级: P1) 🎯 MVP

#### 功能描述

运营人员可以查看订单的完整详细信息,了解订单所有细节。

#### 主要能力

- **订单基本信息**: 订单号、创建时间、订单状态
- **用户信息**: 用户名、手机号(脱敏)、收货地址
- **商品列表**: 商品名称、规格、数量、单价、小计
- **支付信息**: 支付方式、支付金额、支付时间(如已支付)
- **物流信息**: 发货时间(如已发货)、完成时间(如已完成)
- **订单日志**: 状态变更记录(时间、操作人、变更内容)

#### 用户价值

- 在 2 秒内加载订单详情页
- 一目了然地了解订单完整信息
- 通过订单日志追溯订单处理历史

#### 界面示意

```
订单详情页 (/orders/:id)
┌────────────────────────────────────────────────────────────────┐
│  订单管理 / 订单详情 / ORD20251227AB12CD                          │
├────────────────────────────────────────────────────────────────┤
│  【订单基本信息】                                                 │
│  订单号: ORD20251227AB12CD    创建时间: 2025-12-27 10:30:00     │
│  订单状态: 已支付  [标记发货] [取消订单]                           │
│                                                                │
│  【用户信息】                                                     │
│  用户名: 张三    手机号: 138****8000                             │
│  收货地址: 广东省广州市天河区xxx路123号                            │
│                                                                │
│  【商品列表】                                                     │
│  ┌────────────────────────────────────────────────────────┐  │
│  │ 商品名称     │ 规格   │ 数量 │ 单价  │ 小计   │            │  │
│  ├────────────────────────────────────────────────────────┤  │
│  │ 爆米花       │ 中杯   │  2  │ ¥30  │ ¥60   │            │  │
│  │ 可乐         │ 500ml  │  1  │ ¥15  │ ¥15   │            │  │
│  └────────────────────────────────────────────────────────┘  │
│  商品总额: ¥150.00  运费: ¥10.00  优惠: -¥5.00  实付: ¥155.00  │
│                                                                │
│  【支付信息】                                                     │
│  支付方式: 微信支付    支付金额: ¥155.00    支付时间: 2025-12-27 │
│                                                                │
│  【订单日志】                                                     │
│  ┌────────────────────────────────────────────────────────┐  │
│  │ 2025-12-27 10:35:00  用户支付成功  (系统)                 │  │
│  │ 2025-12-27 10:30:00  创建订单  (系统)                     │  │
│  └────────────────────────────────────────────────────────┘  │
└────────────────────────────────────────────────────────────────┘
```

---

### 2.4 订单状态管理 (优先级: P2)

#### 功能描述

运营人员可以手动更新订单状态,确保订单流转顺畅。

#### 主要能力

- **标记发货**: 对"已支付"订单标记为"已发货"
- **标记完成**: 对"已发货"订单标记为"已完成"
- **取消订单**: 对"待支付"或"已支付"订单进行取消(需填写取消原因)
- **状态校验**: 自动校验状态转换合法性,防止非法操作
- **并发控制**: 使用乐观锁机制,防止多人同时操作导致冲突

#### 用户价值

- 在 1 秒内完成订单状态变更
- 自动记录操作日志,支持审计追溯
- 防止误操作,确保订单状态正确流转

#### 状态转换规则

```
待支付 ──────────→ 已支付 ──────────→ 已发货 ──────────→ 已完成
  │                   │
  ↓                   ↓
已取消            已取消
```

**允许的状态转换**:
- 待支付 → 已取消
- 已支付 → 已发货
- 已支付 → 已取消
- 已发货 → 已完成

**禁止的状态转换**:
- 已完成 → 任何状态(订单已完成不可再变更)
- 已发货 → 已取消(已发货订单不可取消)
- 任何非法跳跃(如待支付 → 已发货)

#### 使用场景

- **场景 1**: 运营人员收到仓库发货通知,登录系统找到对应订单,点击"标记发货",订单状态更新为"已发货",发货时间自动记录
- **场景 2**: 用户联系客服要求取消订单,客服确认订单状态为"已支付",点击"取消订单",填写取消原因"用户要求取消",订单状态更新为"已取消"
- **场景 3**: 运营人员尝试取消"已完成"订单时,系统显示错误提示"已完成订单不允许取消",阻止误操作

---

## 3. 技术特性

### 3.1 性能优化

- **数据库索引**: 为 status、created_at 创建复合索引,加速查询
- **分页加载**: 默认每页 20 条记录,避免一次性加载大量数据
- **前端缓存**: 使用 TanStack Query 智能缓存(订单列表 30 秒,详情 1 分钟)
- **并发支持**: 支持 100 个运营人员同时操作,性能不受影响

### 3.2 安全特性

- **手机号脱敏**: 前端和后端双重脱敏,格式为 `138****8000`
- **权限控制**: 所有 API 接口需要 JWT Token 认证
- **审计日志**: 所有订单状态变更操作记录操作人、操作时间、变更内容
- **输入校验**: 使用 Zod(前端)和 Bean Validation(后端)校验所有输入

### 3.3 可用性特性

- **空状态提示**: 订单列表为空或筛选无结果时显示友好提示
- **错误处理**: 网络错误、数据加载失败等异常情况有明确提示
- **乐观锁冲突**: 多人同时操作订单时,系统提示"订单已被其他人修改,请刷新后重试"
- **键盘导航**: 支持键盘操作,符合可访问性标准 WCAG 2.1 AA

---

## 4. 数据规范

### 4.1 订单号规则

**格式**: `ORD + YYYYMMDD + 6位随机字母数字`

**示例**:
- `ORD20251227AB12CD`
- `ORD20251226EF34GH`

**生成规则**:
- 服务端生成,确保唯一性
- 包含日期信息,便于追溯
- 随机字符增强唯一性,避免冲突

### 4.2 手机号脱敏规则

**格式**: `前3位 + 4位星号 + 后4位`

**示例**:
- `13800138000` → `138****8000`
- `15912345678` → `159****5678`

**应用场景**:
- 订单列表中的用户手机号
- 订单详情中的用户手机号
- 管理员角色可查看完整手机号(未来版本)

### 4.3 订单状态定义

| 状态 | 英文标识 | 说明 | 显示颜色 |
|------|---------|------|---------|
| 待支付 | PENDING_PAYMENT | 订单已创建,等待用户支付 | 橙色 |
| 已支付 | PAID | 用户已完成支付,等待发货 | 蓝色 |
| 已发货 | SHIPPED | 订单已发货,等待用户确认收货 | 青色 |
| 已完成 | COMPLETED | 订单已完成,交易结束 | 绿色 |
| 已取消 | CANCELLED | 订单已取消(用户或运营取消) | 灰色 |

---

## 5. 用户操作流程

### 5.1 查看订单列表

```
1. 运营人员登录系统
2. 点击左侧菜单"订单管理" → "订单列表"
3. 系统加载订单列表(默认显示近 30 天订单)
4. 运营人员浏览订单,查看订单号、用户、商品、金额、状态
5. 如需查看更多订单,点击分页控件翻页
```

### 5.2 筛选订单

```
1. 在订单列表页,定位到筛选器区域
2. 选择筛选条件:
   - 订单状态: 从下拉框选择(如"已支付")
   - 时间范围: 点击日期选择器选择起止日期
   - 用户搜索: 输入用户名或手机号
3. 点击"查询"按钮
4. 系统刷新列表,只显示符合条件的订单
5. 如需清空筛选,点击"重置"按钮
```

### 5.3 查看订单详情

```
1. 在订单列表中找到目标订单
2. 点击订单号链接
3. 跳转到订单详情页
4. 查看订单完整信息:
   - 订单基本信息(订单号、状态、创建时间)
   - 用户信息(姓名、手机号、收货地址)
   - 商品列表(商品名称、规格、数量、价格)
   - 支付信息(支付方式、金额、时间)
   - 订单日志(状态变更历史)
```

### 5.4 标记订单发货

```
1. 打开订单详情页
2. 确认订单状态为"已支付"
3. 点击"标记发货"按钮
4. 系统弹出确认对话框
5. 确认后,订单状态更新为"已发货"
6. 系统记录发货时间和操作人
7. 订单日志新增一条"发货"记录
8. 页面显示成功提示
```

### 5.5 取消订单

```
1. 打开订单详情页
2. 确认订单状态为"待支付"或"已支付"
3. 点击"取消订单"按钮
4. 系统弹出取消原因输入框
5. 输入取消原因(如"用户要求取消")
6. 点击确认
7. 订单状态更新为"已取消"
8. 系统记录取消时间、取消原因、操作人
9. 订单日志新增一条"取消"记录
10. 页面显示成功提示
```

---

## 6. 常见问题 (FAQ)

### Q1: 为什么订单列表默认只显示近 30 天的订单?

**A**: 为了提升加载性能。超过 30 天的订单可以通过时间筛选功能查看,避免一次性加载过多数据导致页面卡顿。如果您经常需要查看历史订单,可以将时间范围调整得更大。

### Q2: 手机号为什么显示为 `138****8000` 这种格式?

**A**: 这是出于用户隐私保护的考虑。手机号属于敏感信息,系统默认对中间 4 位进行脱敏处理,保留前 3 位和后 4 位。未来版本将支持管理员角色查看完整手机号。

### Q3: 为什么无法取消"已发货"或"已完成"的订单?

**A**: 这是基于业务规则的限制。订单一旦发货,意味着商品已经离开仓库,无法简单取消。已完成订单表示交易已结束,也不可再变更状态。如需处理已发货订单的售后问题,请使用退款/售后功能(未来版本将支持)。

### Q4: 多个运营人员同时操作同一订单会发生什么?

**A**: 系统使用乐观锁机制防止并发冲突。如果两个人同时操作同一订单,第二个人提交时会收到提示"订单已被其他人修改,请刷新后重试"。这时需要刷新页面,查看最新状态后再进行操作。

### Q5: 如何导出订单数据?

**A**: 在订单列表页,应用您需要的筛选条件(如时间范围、订单状态),然后点击"导出"按钮,选择导出格式(Excel 或 CSV),系统将生成包含筛选后订单数据的文件供下载。单次导出限制为 10000 条记录。

### Q6: 订单号 `ORD20251227AB12CD` 是什么含义?

**A**: 订单号由 `ORD` 前缀 + 8 位日期(YYYYMMDD) + 6 位随机字母数字组成。其中日期部分可以帮助您快速识别订单创建日期,随机字符确保唯一性。

---

## 7. 注意事项

### 7.1 操作注意事项

- ⚠️ 订单状态一旦变更为"已完成",将无法再修改,请谨慎操作
- ⚠️ 取消订单时必须填写取消原因,便于后续追溯
- ⚠️ 如遇到"订单已被其他人修改"提示,请刷新页面后重试
- ⚠️ 导出订单数据前,请先应用筛选条件,避免导出无关数据

### 7.2 性能注意事项

- 💡 建议使用筛选功能缩小订单范围,避免加载过多数据
- 💡 如需查询历史订单,建议按时间范围逐段查询
- 💡 大量订单导出可能需要等待 30 秒左右,请耐心等待

### 7.3 数据注意事项

- 📌 订单中的商品信息为创建时的快照,即使商品后续被删除或修改,订单中的信息保持不变
- 📌 订单日志仅记录状态变更,不包含订单数据的其他修改(如地址修改等)
- 📌 订单导出的数据与当前筛选条件一致,导出后如筛选条件变化,数据会有差异

---

## 8. 发布信息

### 8.1 版本历史

| 版本 | 日期 | 变更说明 |
|------|------|----------|
| 1.0.0 | 2025-12-27 | 初始版本发布 - 支持订单列表、筛选、详情、状态管理 |

### 8.2 未来规划

- **v1.1.0**: 支持批量操作(批量发货、批量导出)
- **v1.2.0**: 支持订单备注功能
- **v1.3.0**: 支持订单退款/售后流程
- **v2.0.0**: 集成物流跟踪,实时查看物流信息

---

## 9. 相关文档

- [技术设计文档 (TDD)](/docs/tdd/O001-product-order-list.md)
- [API 接口文档](/docs/api/O001-product-order-list.md)
- [数据库设计文档](/docs/database/O001-product-order-list.md)
- [用户操作手册](/docs/manual/order-management/O001-product-order-list.md)
- [功能规格说明](/specs/O001-product-order-list/spec.md)

---

<!-- DOC-WRITER: AUTO-GENERATED END -->

**文档生成信息**:
- 生成工具: doc-writer skill v2.1.0
- 生成时间: 2025-12-27
- 数据来源: spec.md, plan.md, data-model.md, tasks.md
