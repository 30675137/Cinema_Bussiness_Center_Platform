# Vector Configuration for Supabase Logs
# 收集 Docker 容器日志并发送到 Logflare

api:
  enabled: true
  address: 0.0.0.0:9001

sources:
  # 收集 Docker 容器日志
  docker_host:
    type: docker_logs
    docker_host: unix:///var/run/docker.sock
    exclude_containers:
      - vector
      - supabase-vector

transforms:
  # 解析项目相关的日志
  project_logs:
    type: remap
    inputs:
      - docker_host
    source: |-
      .project = "default"
      .event_message = del(.message)
      .timestamp = del(.timestamp)
      .container_name = del(.container_name)

sinks:
  # 发送到 Logflare
  logflare:
    type: http
    method: post
    batch:
      max_bytes: 1049000
      max_events: 2048
      timeout_secs: 1
    compression: gzip
    encoding:
      codec: json
    inputs:
      - project_logs
    uri: "http://supabase-analytics:4000/api/logs?source_name=docker_logs&api_key=${LOGFLARE_API_KEY}"
    request:
      headers:
        Content-Type: application/json
