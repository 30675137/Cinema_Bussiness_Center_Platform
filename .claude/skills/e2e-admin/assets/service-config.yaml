# Service Configuration for E2E Test Orchestration
# @spec T007-e2e-test-management
#
# This file defines the service configurations for automatic service management
# during E2E test execution.

services:
  c-end:
    name: "C端 (Taro H5)"
    port: 10086
    directory: "./hall-reserve-taro"
    start_command: "npm run dev:h5"
    health_check_url: "http://localhost:10086"
    startup_timeout: 60000
    shutdown_signal: SIGTERM

  b-end:
    name: "B端 (React Admin)"
    port: 3000
    directory: "./frontend"
    start_command: "npm run dev"
    health_check_url: "http://localhost:3000"
    startup_timeout: 60000
    shutdown_signal: SIGTERM

  backend:
    name: "后端 (Spring Boot)"
    port: 8080
    directory: "./backend"
    start_command: "./mvnw spring-boot:run"
    health_check_url: "http://localhost:8080/actuator/health"
    startup_timeout: 120000
    shutdown_signal: SIGTERM

# Port Conflict Strategy
# Controls behavior when a required port is already in use
port_conflict_strategy:
  # Default strategy: prompt | auto-kill | fail
  default: prompt
  options:
    prompt: "询问用户是否 kill 进程"
    auto-kill: "自动 kill 占用进程"
    fail: "直接报错退出"

# Health Check Configuration
health_check:
  # Retry interval in milliseconds
  retry_interval: 2000
  # Maximum retry attempts
  max_retries: 30
  # HTTP timeout for health check requests (ms)
  request_timeout: 5000

# Process Management
process_management:
  # Grace period before force kill (ms)
  shutdown_grace_period: 5000
  # Track spawned processes for cleanup
  track_pids: true
  # PID file location
  pid_file: ".e2e-services.pid"
