# Source Parser Configuration for Doc-Writer Skill
# Defines how different file formats are parsed for document generation

version: "1.1.0"

# Parser definitions for different file formats
parsers:
  # Markdown parser (primary format for specs)
  markdown:
    extensions: [".md"]
    metadata_pattern: "^\\*\\*(.+?)\\*\\*:\\s*(.+)$"
    frontmatter_pattern: "^---([\\s\\S]*?)---"
    content_sections:
      - "## Summary"
      - "## User Scenarios"
      - "## Requirements"
      - "## Success Criteria"
      - "## Assumptions"
      - "## Out of Scope"
    metadata_fields:
      - "Feature Branch"
      - "System"
      - "Module"
      - "SubModule"
      - "Created"
      - "Status"

  # YAML parser (for structured data definitions)
  yaml:
    extensions: [".yaml", ".yml"]
    root_key: "spec"
    required_fields:
      - "name"
      - "description"
    optional_fields:
      - "version"
      - "system"
      - "module"
      - "submodule"
      - "requirements"
      - "entities"

  # JSON parser (for structured data definitions)
  json:
    extensions: [".json"]
    root_key: "spec"
    required_fields:
      - "name"
      - "description"
    optional_fields:
      - "version"
      - "system"
      - "module"
      - "submodule"
      - "requirements"
      - "entities"

  # SQL parser (for database schema and migrations)
  sql:
    extensions: [".sql"]
    # 解析 CREATE TABLE 语句
    table_pattern: "CREATE\\s+TABLE\\s+(?:IF\\s+NOT\\s+EXISTS\\s+)?(\\w+)"
    # 解析列定义
    column_pattern: "^\\s*(\\w+)\\s+(\\w+(?:\\([^)]+\\))?)"
    # 解析外键约束
    foreign_key_pattern: "REFERENCES\\s+(\\w+)\\s*\\((\\w+)\\)"
    # 解析索引
    index_pattern: "CREATE\\s+(?:UNIQUE\\s+)?INDEX\\s+(?:IF\\s+NOT\\s+EXISTS\\s+)?(\\w+)\\s+ON\\s+(\\w+)"
    # 解析注释
    comment_pattern: "--\\s*(.+)$"
    # 解析检查约束
    check_pattern: "CHECK\\s*\\(([^)]+)\\)"
    # 支持的数据库方言
    dialects:
      - postgresql
      - mysql
      - sqlite

# Default source paths for scanning
default_source_paths:
  - "specs/"

# Database source paths for scanning (用于数据库设计文档)
database_source_paths:
  # 主 schema 文件
  schema_files:
    - "backend/src/main/resources/db/schema.sql"
    - "src/main/resources/db/schema.sql"
    - "database/schema.sql"
    - "db/schema.sql"
  # 迁移脚本目录
  migration_dirs:
    - "backend/src/main/resources/db/migration/"
    - "src/main/resources/db/migration/"
    - "database/migrations/"
    - "db/migrations/"
  # 种子数据目录
  seed_dirs:
    - "backend/src/main/resources/db/seed/"
    - "src/main/resources/db/seed/"
    - "database/seeds/"
    - "db/seeds/"

# Output configuration
output:
  base_dir: "docs/"

  # Document type to directory mapping
  directories:
    tdd: "tdd/"
    arch: "architecture/"
    detail: "detail-design/"
    api: "api/"
    db: "database/"
    manual: "manual/"
    guide: "guide/"
    product: "product/"
    readme: "readme/"
    release-notes: "release-notes/"
    matrix: "matrix/"

  # Document types that use module subdirectories
  module_based_types:
    - "detail"
    - "manual"
    - "guide"
    - "product"

# File naming patterns
naming:
  # Standard pattern for spec-based documents
  standard: "{specId}-{name}.md"

  # Pattern for release notes (by version)
  release_notes: "v{version}.md"

  # Pattern for feature matrix (single file)
  matrix: "feature-matrix.md"

# Metadata defaults (used when spec doesn't provide values)
defaults:
  system: "默认系统"
  module: "未分类"
  submodule: ""
  status: "Draft"

# Content markers for incremental updates
markers:
  auto_generated_start: "<!-- DOC-WRITER: AUTO-GENERATED START -->"
  auto_generated_end: "<!-- DOC-WRITER: AUTO-GENERATED END -->"
  user_section_start: "<!-- DOC-WRITER: USER-SECTION START -->"
  user_section_end: "<!-- DOC-WRITER: USER-SECTION END -->"
  conflict_start: "<!-- DOC-WRITER: CONFLICT START -->"
  conflict_end: "<!-- DOC-WRITER: CONFLICT END -->"

# State tracking file for incremental updates
state_file: ".doc-writer-state.json"
