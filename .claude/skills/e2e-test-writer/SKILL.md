---
name: e2e-test-writer
description: 端到端测试用例编写专家。当用户需要以下内容时使用此 skill：(1) 根据业务流程生成端到端测试用例；(2) 编写手动测试场景（如小程序下单流程、商品配置到订单流转）；(3) 整理完整业务链路的测试步骤；(4) 生成包含前置条件、测试步骤、预期结果的测试文档。触发词：测试用例、测试场景、端到端测试、E2E测试、手动测试、业务流程测试、测试步骤、测试文档。
---

# 端到端测试用例编写专家

基于业务流程和项目代码，生成完整的端到端（E2E）手动测试用例。

## 核心能力

### 1. 业务流程理解
通过阅读项目文档和代码，深入理解业务流程：
- 规格文档（specs/）- 理解业务需求和流程
- 前端代码 - 了解页面交互和用户操作
- 后端代码 - 了解API接口和数据流转
- 数据模型 - 了解状态流转和数据变化

### 2. 测试场景识别
识别关键业务场景和测试节点：
- 正向流程（Happy Path）
- 异常流程（Error Cases）
- 边界条件（Boundary Cases）
- 状态流转（State Transitions）
- 数据验证（Data Validation）

### 3. 测试用例生成
输出结构化的手动测试用例文档：
- 前置条件清单
- 详细操作步骤
- 每步预期结果
- 测试数据准备
- 后置检查项

## 测试用例编写流程

### 步骤 1: 理解业务流程

向用户确认测试范围：
- 完整端到端流程（如"小程序下单完整流程"）
- 特定子流程（如"库存扣减和回退"）
- 多系统协作流程（如"B端配置 → C端展示 → 订单处理"）

### 步骤 2: 扫描项目文档和代码

收集业务信息。使用 Glob 和 Read 工具：

```
# 读取规格文档
Read specs/<specId>/spec.md

# 读取设计文档
Read docs/*.md

# 扫描前端页面
Glob frontend/src/pages/**/*.tsx
Glob hall-reserve-taro/src/pages/**/*.tsx

# 扫描后端接口
Glob backend/src/**/controller/*.java
Glob backend/src/**/service/*.java

# 查看数据模型
Glob backend/src/**/entity/*.java
Glob backend/src/**/dto/*.java
```

### 步骤 3: 加载测试场景参考

根据业务类型，加载常见场景模板：

- **常见业务场景**: 见 [common-scenarios.md](references/common-scenarios.md)
  - 商品管理场景
  - 库存管理场景
  - 订单管理场景（包含小程序下单完整流程）
  - 会员系统场景
  - 促销系统场景
  - BOM原料管理场景
  - 多渠道发布场景
  - 数据同步场景

### 步骤 4: 识别关键业务节点

分析业务流程，识别关键节点。

**示例：小程序下单流程**
```
1. 商品配置（B端）→ 检查点：商品信息完整、SKU配置正确
2. 渠道发布（B端）→ 检查点：发布成功、渠道同步
3. 小程序获取商品（C端）→ 检查点：商品列表展示、详情正确
4. 加入购物车（C端）→ 检查点：购物车数量、价格计算
5. 提交订单（C端）→ 检查点：订单创建、库存锁定
6. 支付（C端）→ 检查点：支付成功、库存扣减
7. 订单查询（B端）→ 检查点：订单可见、信息准确
8. 订单流转（B/C端）→ 检查点：状态流转正确
9. 完成/取消（C端）→ 检查点：库存回退、订单状态更新
```

### 步骤 5: 生成测试用例

使用测试用例模板: [e2e-test-case-template.md](assets/e2e-test-case-template.md)

生成包含以下内容的测试文档：
1. **测试概述** - 测试目标、业务流程图、涉及系统
2. **关键业务节点** - 节点清单、操作端、检查点
3. **测试用例清单** - 正向/异常/边界用例
4. **状态流转测试** - 状态机验证
5. **数据验证检查** - 库存、订单等数据检查
6. **缺陷记录模板** - 便于记录发现的问题
7. **测试总结** - 统计和结论

### 步骤 6: 输出测试文档

向用户提供完整的 Markdown 格式测试文档。

## 测试用例结构

### 基本要素
1. **用例ID**: 唯一标识符
2. **用例标题**: 简明扼要
3. **优先级**: 🔴 高 / 🟡 中 / 🟢 低
4. **前置条件**: 测试前的准备工作
5. **测试步骤**: 详细操作步骤（含操作端标识）
6. **预期结果**: 每步的预期输出
7. **测试数据**: 使用的测试数据
8. **后置检查**: 数据库、库存、日志检查

### 测试类型
- **正向流程**: 正常业务流程测试
- **异常流程**: 错误处理和边界条件
- **边界条件**: 极限值测试
- **状态流转**: 状态机验证
- **数据验证**: 数据一致性检查

## 常见业务场景

### 小程序下单完整流程

见 [common-scenarios.md](references/common-scenarios.md) 第 3.1 节，包含：
- 商品配置 → 渠道发布 → 小程序获取 → 加入购物车 → 提交订单 → 库存锁定 → 支付 → 库存扣减 → 订单查询 → 订单流转 → 完成/取消

### BOM原料管理流程

见 [common-scenarios.md](references/common-scenarios.md) 第 6.1 节，包含：
- 创建成品 → 配置BOM → 绑定原料 → 设置消耗比例 → 订单生产 → 原料扣减 → 成品入库

### 库存扣减与回退

见 [common-scenarios.md](references/common-scenarios.md) 第 2.2 节，包含：
- 下单锁定库存 → 支付扣减库存 → 取消订单释放库存

## 注意事项

1. **操作端标识**: 明确标注每步操作在哪个端（B端/C端/系统）
2. **数据准备**: 提供具体的测试数据示例
3. **检查点**: 每个关键节点都要有明确的检查项
4. **异常场景**: 覆盖常见异常情况（库存不足、支付失败等）
5. **数据验证**: 包含数据库、库存、日志等后置检查
6. **可执行性**: 步骤足够详细，测试人员可直接执行

## 输出格式

测试用例文档必须包含：
1. 测试概述和业务流程图
2. 关键业务节点清单
3. 正向/异常/边界测试用例
4. 状态流转验证表
5. 数据验证检查清单
6. 缺陷记录模板
7. 测试总结模板
