# 测试驱动开发规则

## 核心原则
测试先行的开发策略是**强制性的**。

## 规则

### R2.1 Red-Green-Refactor 循环
1. **Red**: 先写测试，确保测试失败
2. **Green**: 实现最小可行代码使测试通过
3. **Refactor**: 重构优化代码

### R2.2 测试框架
| 测试类型 | 框架 | 强制性 | 用途 |
|---------|------|--------|------|
| 单元测试 | Vitest (前端), JUnit (后端) | ✅ 强制 | 组件、工具函数、业务逻辑 |
| 集成测试 | MSW, Supertest | ✅ 强制 | API Mock、模块间交互 |
| 端到端测试 | Playwright | ⚠️ 可选 | 用户流程、页面交互 |

**注意**: E2E 测试(Playwright)为**可选策略**,不强制要求每个 spec 都编写。建议在以下场景编写 E2E 测试:
- 关键业务流程(如支付流程、订单创建)
- 复杂用户交互(如多步骤表单)
- 跨模块集成场景

### R2.3 覆盖率要求
- 关键业务逻辑的单元测试覆盖率：**100%** (强制)
- 工具函数测试覆盖率：≥ 80%
- 组件测试覆盖率：≥ 70%
- E2E 测试覆盖率：无强制要求,由团队根据功能重要性决定

### R2.4 测试命名规范
```typescript
// 单元测试
describe('功能模块名', () => {
  it('应该实现某个具体行为', () => {})
})

// E2E 测试
test('用户场景 - 具体操作步骤', async ({ page }) => {})
```

### R2.5 禁止行为
- ❌ 禁止先写实现代码再补测试
- ❌ 禁止提交未通过测试的代码
- ❌ 禁止跳过失败的测试

## 测试命令
```bash
# 运行单元测试
npm run test

# 运行 E2E 测试
npm run test:e2e

# 查看覆盖率
npm run test:coverage
```
