# E2E Test Reports

**@spec T006-e2e-report-configurator**

This directory contains E2E test reports generated by Playwright.

## Directory Structure

```
reports/
├── README.md                    # This file
├── e2e/                        # E2E test reports
│   ├── html/                   # HTML interactive reports (latest)
│   ├── json/                   # JSON machine-readable reports
│   ├── junit/                  # JUnit XML reports (CI/CD)
│   ├── artifacts/              # Test artifacts (screenshots, videos, traces)
│   └── history/                # Archived historical reports ✅ Committed to Git
│       ├── index.md            # Index of all archived reports
│       ├── test-run-20251230-223000/  # Example archive
│       ├── test-run-20251230-224500/
│       └── ...
```

## Report Formats

### 1. HTML Reports (Interactive)

**Location**: `reports/e2e/html/index.html`

**Features**:
- ✅ Interactive test results viewer
- ✅ Embedded screenshots and videos
- ✅ Trace viewer integration
- ✅ Filter by test status (passed/failed/skipped)

**View**:
```bash
# Open latest HTML report
open reports/e2e/html/index.html

# Or use Playwright command
npx playwright show-report reports/e2e/html
```

### 2. JSON Reports (Machine-Readable)

**Location**: `reports/e2e/json/results.json`

**Features**:
- ✅ Programmatic test result analysis
- ✅ Custom dashboard integration
- ✅ Historical trending data
- ✅ CI/CD metrics collection

**Usage**:
```javascript
const results = require('./reports/e2e/json/results.json');
console.log(`Total: ${results.stats.expected + results.stats.unexpected}`);
console.log(`Passed: ${results.stats.expected}`);
console.log(`Failed: ${results.stats.unexpected}`);
```

### 3. JUnit Reports (CI/CD)

**Location**: `reports/e2e/junit/results.xml`

**Features**:
- ✅ Standard XML format for CI/CD platforms
- ✅ Native GitHub Actions test reporter
- ✅ GitLab CI test reports
- ✅ Jenkins JUnit plugin integration

**CI/CD Integration**:
```yaml
# GitHub Actions
- name: Publish Test Results
  uses: EnricoMi/publish-unit-test-result-action@v2
  with:
    files: reports/e2e/junit/results.xml

# GitLab CI
artifacts:
  reports:
    junit: reports/e2e/junit/results.xml
```

## Test Artifacts

### Screenshots

**Captured**: On test failure only (default)

**Location**: `reports/e2e/artifacts/screenshots/`

**Configuration**:
```typescript
// playwright.config.ts
use: {
  screenshot: 'only-on-failure',  // 'on' | 'off' | 'only-on-failure'
}
```

### Videos

**Captured**: Retained on failure only (default)

**Location**: `reports/e2e/artifacts/videos/`

**Configuration**:
```typescript
// playwright.config.ts
use: {
  video: 'retain-on-failure',  // 'on' | 'off' | 'retain-on-failure'
}
```

### Traces

**Captured**: On first retry (default)

**Location**: `reports/e2e/artifacts/traces/`

**View Trace**:
```bash
npx playwright show-trace reports/e2e/artifacts/traces/trace.zip
```

**Configuration**:
```typescript
// playwright.config.ts
use: {
  trace: 'on-first-retry',  // 'on' | 'off' | 'on-first-retry' | 'retain-on-failure'
}
```

## Historical Reports (Git Tracked) ✅

**Location**: `reports/e2e/history/`

Historical reports are **committed to Git** for tracking test trends over time.

### Archiving Reports

#### Automatic Archiving (After Each Test Run)

```bash
# Run tests and archive results
npm run test:e2e
npm run test:e2e:archive
```

#### Manual Archiving

```bash
# Archive current reports
bash scripts/archive-test-reports.sh
```

### Archive Structure

Each archive contains:

```
reports/e2e/history/test-run-20251230-223000/
├── metadata.json           # Archive metadata (timestamp, git info)
├── html/                   # Full HTML report
├── json/                   # JSON results
├── junit/                  # JUnit XML
└── artifacts/              # Screenshots, videos, traces
```

### Viewing Historical Reports

1. **Browse History Index**:
   ```bash
   cat reports/e2e/history/index.md
   ```

2. **Open Specific Historical Report**:
   ```bash
   open reports/e2e/history/test-run-20251230-223000/html/index.html
   ```

3. **Compare with Latest**:
   ```bash
   # Latest report
   open reports/e2e/html/index.html

   # Historical report
   open reports/e2e/history/test-run-20251230-223000/html/index.html
   ```

### Archive Retention Policy

**Default**: Keep last **10 test runs**

Older archives are automatically deleted when new archives are created.

**Customize Retention**:
```bash
# Edit scripts/archive-test-reports.sh
KEEP_LAST=20  # Change this value
```

### Archive Metadata

Each archive includes Git context:

```json
{
  "timestamp": "20251230-223000",
  "git_branch": "dev",
  "git_commit": "a3f8b92",
  "archived_at": "2025-12-30T22:30:00Z",
  "reports": {
    "html": true,
    "json": true,
    "junit": true,
    "artifacts": true
  }
}
```

## Git Configuration

### What's Committed to Git

✅ **Committed**:
- `reports/e2e/history/` - Historical archives (with retention policy)
- `reports/e2e/history/index.md` - Archive index
- Archive metadata files

❌ **Ignored** (`.gitignore`):
- `reports/e2e/html/` - Latest HTML reports
- `reports/e2e/json/results.json` - Latest JSON results
- `reports/e2e/junit/results.xml` - Latest JUnit XML
- `reports/e2e/artifacts/` - Latest test artifacts

### Why This Approach?

1. **Minimize Git Bloat**: Latest reports change frequently and are large
2. **Track Trends**: Historical archives show test quality over time
3. **Reproduce Issues**: Can go back to specific test runs with full context
4. **CI/CD Friendly**: Historical data survives pipeline cleanup

## Workflow Examples

### Example 1: Run Tests and Archive

```bash
# Run all inventory tests
cd frontend
npx playwright test ../scenarios/inventory/ --project=chromium

# Archive the results
cd ..
npm run test:e2e:archive
```

### Example 2: Compare Test Results Over Time

```bash
# View today's test results
open reports/e2e/html/index.html

# View yesterday's test results
open reports/e2e/history/test-run-20251229-153000/html/index.html

# Extract pass rates
jq '.stats' reports/e2e/json/results.json
jq '.stats' reports/e2e/history/test-run-20251229-153000/json/results.json
```

### Example 3: CI/CD Integration

```yaml
# .github/workflows/e2e-tests.yml
name: E2E Tests
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Install dependencies
        run: npm ci

      - name: Run E2E tests
        run: npm run test:e2e

      - name: Archive test results
        if: always()
        run: npm run test:e2e:archive

      - name: Commit archived reports
        if: always()
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add reports/e2e/history/
          git commit -m "chore: archive E2E test results [skip ci]" || true
          git push
```

## Troubleshooting

### Problem 1: Archive Script Not Found

**Error**: `bash: scripts/archive-test-reports.sh: No such file or directory`

**Solution**:
```bash
# Ensure script exists and is executable
ls -la scripts/archive-test-reports.sh
chmod +x scripts/archive-test-reports.sh
```

### Problem 2: No Reports to Archive

**Error**: `❌ Error: Reports directory not found: reports/e2e`

**Solution**: Run tests first to generate reports:
```bash
cd frontend
npx playwright test ../scenarios/inventory/ --project=chromium
cd ..
npm run test:e2e:archive
```

### Problem 3: Archive Size Too Large

**Warning**: Archive directory exceeds 50MB

**Solutions**:
1. **Reduce artifact retention**:
   ```typescript
   // playwright.config.ts
   use: {
     video: 'off',  // Disable video recording
     screenshot: 'only-on-failure',
   }
   ```

2. **Reduce retention period**:
   ```bash
   # Edit scripts/archive-test-reports.sh
   KEEP_LAST=5  # Keep fewer archives
   ```

3. **Exclude artifacts from archives**:
   ```bash
   # Edit scripts/archive-test-reports.sh
   # Comment out artifact archiving section
   ```

## Related Documentation

- **Report Configuration**: `.claude/skills/e2e-report-configurator/skill.md`
- **Playwright Config**: `frontend/playwright.config.ts`
- **Test Scenarios**: `scenarios/README.md`
- **Archive Script**: `scripts/archive-test-reports.sh`

---

**Last Updated**: 2025-12-30
**Maintained By**: e2e-report-configurator skill (T006)
