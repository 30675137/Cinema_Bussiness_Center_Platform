-- Migration: Insert test data for "求婚惊喜专场" scenario package
-- Feature: 001-scenario-package-tabs
-- Date: 2025-12-23
-- Description: Inserts package tiers, add-on items, time slot templates for 求婚惊喜专场

-- 求婚惊喜专场 ID
-- '00000000-0003-0000-0000-000000000003'::uuid

-- =============================================
-- 1. 插入加购项 (Add-on Items)
-- =============================================
INSERT INTO addon_items (id, name, price, category, image_url, inventory, is_active) VALUES
(
    '00000000-0003-0001-0000-000000000001'::uuid,
    '精美茶歇',
    299.00,
    'CATERING',
    'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=200',
    50,
    true
),
(
    '00000000-0003-0001-0000-000000000002'::uuid,
    '红酒拼盘',
    599.00,
    'BEVERAGE',
    'https://images.unsplash.com/photo-1510812431401-41d2bd2722f3?w=200',
    20,
    true
),
(
    '00000000-0003-0001-0000-000000000003'::uuid,
    '气球布置',
    199.00,
    'DECORATION',
    'https://images.unsplash.com/photo-1530103862676-de8c9debad1d?w=200',
    NULL,  -- 不限库存
    true
),
(
    '00000000-0003-0001-0000-000000000004'::uuid,
    '专属摄影',
    999.00,
    'SERVICE',
    'https://images.unsplash.com/photo-1542038784456-1ea8e935640e?w=200',
    5,
    true
),
(
    '00000000-0003-0001-0000-000000000005'::uuid,
    '鲜花装饰',
    388.00,
    'DECORATION',
    'https://images.unsplash.com/photo-1490750967868-88aa4486c946?w=200',
    30,
    true
),
(
    '00000000-0003-0001-0000-000000000006'::uuid,
    '求婚灯牌',
    158.00,
    'DECORATION',
    'https://images.unsplash.com/photo-1518531933037-91b2f5f229cc?w=200',
    10,
    true
);

-- =============================================
-- 2. 插入套餐档位 (Package Tiers) - 求婚惊喜专场
-- =============================================
INSERT INTO package_tiers (id, package_id, name, price, original_price, tags, service_description, sort_order) VALUES
(
    '00000000-0003-0002-0000-000000000001'::uuid,
    '00000000-0003-0000-0000-000000000003'::uuid,
    '浪漫套餐',
    2999.00,
    3888.00,
    '["人气推荐"]'::jsonb,
    '包含：
- 3小时VIP影厅包场
- 基础鲜花布置
- 浪漫灯光效果
- 求婚背景LED屏
- 专业音响设备',
    0
),
(
    '00000000-0003-0002-0000-000000000002'::uuid,
    '00000000-0003-0000-0000-000000000003'::uuid,
    '豪华套餐',
    4999.00,
    5999.00,
    '["VIP专享", "含摄影"]'::jsonb,
    '包含：
- 4小时VIP影厅包场
- 精美鲜花布置
- 浪漫灯光效果
- 求婚背景LED屏
- 专业音响设备
- 专属摄影师跟拍
- 香槟气球布置',
    1
),
(
    '00000000-0003-0002-0000-000000000003'::uuid,
    '00000000-0003-0000-0000-000000000003'::uuid,
    '至尊套餐',
    8888.00,
    10888.00,
    '["限量特惠", "全程定制", "含婚礼策划"]'::jsonb,
    '包含：
- 5小时VIP影厅包场
- 奢华定制鲜花布置
- 浪漫灯光+烟雾效果
- 求婚背景LED屏+定制视频
- 专业音响设备
- 专属摄影师+摄像师全程跟拍
- 香槟+红酒+精美茶歇
- 专业求婚策划师全程跟踪
- 精美求婚道具租赁',
    2
);

-- =============================================
-- 3. 插入场景包-加购项关联 (Package-AddOn) - 求婚惊喜专场
-- =============================================
INSERT INTO package_addons (id, package_id, addon_item_id, sort_order, is_required) VALUES
(
    '00000000-0003-0003-0000-000000000001'::uuid,
    '00000000-0003-0000-0000-000000000003'::uuid,
    '00000000-0003-0001-0000-000000000005'::uuid,  -- 鲜花装饰
    0,
    false
),
(
    '00000000-0003-0003-0000-000000000002'::uuid,
    '00000000-0003-0000-0000-000000000003'::uuid,
    '00000000-0003-0001-0000-000000000006'::uuid,  -- 求婚灯牌
    1,
    false
),
(
    '00000000-0003-0003-0000-000000000003'::uuid,
    '00000000-0003-0000-0000-000000000003'::uuid,
    '00000000-0003-0001-0000-000000000004'::uuid,  -- 专属摄影
    2,
    false
),
(
    '00000000-0003-0003-0000-000000000004'::uuid,
    '00000000-0003-0000-0000-000000000003'::uuid,
    '00000000-0003-0001-0000-000000000002'::uuid,  -- 红酒拼盘
    3,
    false
);

-- =============================================
-- 4. 插入时段模板 (Time Slot Templates) - 求婚惊喜专场
-- =============================================
-- 周一至周五
INSERT INTO time_slot_templates (id, package_id, day_of_week, start_time, end_time, capacity, price_adjustment, is_enabled) VALUES
(
    '00000000-0003-0004-0000-000000000001'::uuid,
    '00000000-0003-0000-0000-000000000003'::uuid,
    1,  -- 周一
    '10:00',
    '14:00',
    2,
    NULL,
    true
),
(
    '00000000-0003-0004-0000-000000000002'::uuid,
    '00000000-0003-0000-0000-000000000003'::uuid,
    1,  -- 周一
    '15:00',
    '19:00',
    2,
    NULL,
    true
),
(
    '00000000-0003-0004-0000-000000000003'::uuid,
    '00000000-0003-0000-0000-000000000003'::uuid,
    1,  -- 周一
    '19:30',
    '23:00',
    2,
    '{"type": "PERCENTAGE", "value": 10}'::jsonb,  -- 晚场加价10%
    true
),
-- 周六（加价20%）
(
    '00000000-0003-0004-0000-000000000010'::uuid,
    '00000000-0003-0000-0000-000000000003'::uuid,
    6,  -- 周六
    '10:00',
    '14:00',
    3,
    '{"type": "PERCENTAGE", "value": 20}'::jsonb,
    true
),
(
    '00000000-0003-0004-0000-000000000011'::uuid,
    '00000000-0003-0000-0000-000000000003'::uuid,
    6,  -- 周六
    '15:00',
    '19:00',
    3,
    '{"type": "PERCENTAGE", "value": 20}'::jsonb,
    true
),
(
    '00000000-0003-0004-0000-000000000012'::uuid,
    '00000000-0003-0000-0000-000000000003'::uuid,
    6,  -- 周六
    '19:30',
    '23:30',
    3,
    '{"type": "PERCENTAGE", "value": 30}'::jsonb,  -- 周六晚场加价30%
    true
),
-- 周日
(
    '00000000-0003-0004-0000-000000000020'::uuid,
    '00000000-0003-0000-0000-000000000003'::uuid,
    0,  -- 周日
    '10:00',
    '14:00',
    2,
    '{"type": "PERCENTAGE", "value": 15}'::jsonb,
    true
),
(
    '00000000-0003-0004-0000-000000000021'::uuid,
    '00000000-0003-0000-0000-000000000003'::uuid,
    0,  -- 周日
    '15:00',
    '19:00',
    2,
    '{"type": "PERCENTAGE", "value": 15}'::jsonb,
    true
);

-- =============================================
-- 5. 插入时段覆盖 (Time Slot Overrides) - 求婚惊喜专场
-- =============================================
INSERT INTO time_slot_overrides (id, package_id, override_date, override_type, start_time, end_time, capacity, reason) VALUES
(
    '00000000-0003-0005-0000-000000000001'::uuid,
    '00000000-0003-0000-0000-000000000003'::uuid,
    '2025-02-14',  -- 情人节
    'MODIFY',
    '10:00',
    '23:30',
    5,  -- 扩大容量
    '情人节特别场次，容量扩大'
),
(
    '00000000-0003-0005-0000-000000000002'::uuid,
    '00000000-0003-0000-0000-000000000003'::uuid,
    '2025-01-28',  -- 春节期间
    'CANCEL',
    NULL,
    NULL,
    NULL,
    '春节假期休息'
),
(
    '00000000-0003-0005-0000-000000000003'::uuid,
    '00000000-0003-0000-0000-000000000003'::uuid,
    '2025-05-20',  -- 520
    'MODIFY',
    '10:00',
    '23:30',
    6,
    '520特别活动日，容量扩大'
);

-- =============================================
-- 验证查询
-- =============================================
SELECT '套餐档位' as type, pt.name, pt.price, pt.original_price, pt.tags
FROM package_tiers pt
WHERE pt.package_id = '00000000-0003-0000-0000-000000000003'::uuid
ORDER BY pt.sort_order;

SELECT '关联加购项' as type, ai.name, ai.price, ai.category
FROM package_addons pa
JOIN addon_items ai ON pa.addon_item_id = ai.id
WHERE pa.package_id = '00000000-0003-0000-0000-000000000003'::uuid
ORDER BY pa.sort_order;

SELECT '时段模板' as type, tst.day_of_week, tst.start_time, tst.end_time, tst.capacity, tst.price_adjustment
FROM time_slot_templates tst
WHERE tst.package_id = '00000000-0003-0000-0000-000000000003'::uuid
ORDER BY tst.day_of_week, tst.start_time;
