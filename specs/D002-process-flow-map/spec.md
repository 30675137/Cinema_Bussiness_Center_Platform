# Feature Specification: Business Process Flow Map

**Feature Branch**: `D002-process-flow-map`  
**Created**: 2026-01-14  
**Status**: Draft  
**Input**: User description: "基于 D001 继续开发一个业务流程地图，也就是在业务全景中台服务地图之外再开发一个panel，按照业务的前后顺序进行功能的流程排序，可以通过按钮实现业务全景中台服务地图与业务流程地图的切换"

## Clarifications

### Session 2026-01-14

- Q: 业务流程应该分为多少个阶段，以及每个阶段的标准名称？ → A: 5个阶段（参考网站）- 基础建设 → 供应生产 → 营销发布 → 交易履约 → 经营洞察
- Q: 视图切换按钮应该采用什么样式？ → A: 标签页式按钮组（参考网站风格），两个并列按钮，激活状态高亮显示
- Q: 流程节点之间应该如何视觉化连接关系？ → A: 每个模块卡片之间都用箭头连接，形成完整的流程链
- Q: 流程视图的主标题应该使用什么文案？ → A: 业务端到端流程地图（参考网站）
- Q: 每个流程阶段是否需要副标题？ → A: 添加副标题：基础建设-数据初始化、供应生产-物料与成本、营销发布-定价与档期、交易履约-订单处理、经营洞察-分析与结算

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 查看业务流程地图 (Priority: P1)

作为影院业务中台的用户，我希望能够查看按业务执行顺序排列的流程地图，以便快速理解业务操作的先后顺序和依赖关系。

**Why this priority**: 这是核心功能，用户需要通过流程视角理解业务全貌，这与现有的泳道架构视图形成互补，提供了不同维度的信息组织方式。

**Independent Test**: 用户访问 Dashboard 页面后，可以看到业务流程地图展示所有业务模块按照执行顺序排列（如：基础设置 → 主数据配置 → 商品上架 → 订单处理 → 库存管理 → 报表分析），并能清晰看到各步骤之间的流程箭头指示。

**Acceptance Scenarios**:

1. **Given** 用户已登录系统并访问 Dashboard 页面，**When** 业务流程地图加载完成，**Then** 页面显示按业务执行顺序排列的所有业务模块卡片，每个卡片之间有流程箭头连接
2. **Given** 用户查看业务流程地图，**When** 流程地图展示多个业务步骤，**Then** 用户可以清晰识别业务的起点（如基础设置）、中间环节（如订单处理）和终点（如报表分析）
3. **Given** 用户查看某个业务模块卡片，**When** 卡片显示在流程中，**Then** 卡片展示模块名称、图标、简短描述和快速功能入口

---

### User Story 2 - 在两种视图间切换 (Priority: P1)

作为影院业务中台的用户，我希望能够通过标签页式按钮组快速切换业务全景中台服务地图（泳道架构）和业务端到端流程地图（流程顺序），以便根据不同使用场景选择最合适的视图。

**Why this priority**: 两种视图提供不同维度的信息，切换功能是连接 D001 和 D002 功能的关键桥梁，必须在早期实现以验证整体设计的可行性。

**Independent Test**: 用户在 Dashboard 页面顶部看到标签页式视图切换按钮组（"全景视图" | "流程视图"），点击后可以在两种视图之间无缝切换，激活的标签页高亮显示，切换时页面状态保持（如折叠状态、滚动位置）。

**Acceptance Scenarios**:

1. **Given** 用户正在查看业务全景中台服务地图（泳道视图，"全景视图"标签激活），**When** 用户点击"流程视图"标签，**Then** 页面平滑过渡到业务端到端流程地图，"流程视图"标签变为激活状态
2. **Given** 用户正在查看业务端到端流程地图（"流程视图"标签激活），**When** 用户点击"全景视图"标签，**Then** 页面返回业务全景中台服务地图，"全景视图"标签变为激活状态
3. **Given** 用户在任一视图中折叠或展开了某些区域，**When** 切换视图后再切换回来，**Then** 系统记住用户之前的折叠/展开状态
4. **Given** 用户切换视图，**When** 切换动画完成，**Then** 新视图完全可交互，所有卡片点击和链接跳转功能正常

---

### User Story 3 - 点击流程节点快速进入功能 (Priority: P2)

作为影院业务中台的用户，我希望能够点击业务流程地图中的任意节点（模块卡片）快速跳转到对应的功能页面，以便提高操作效率。

**Why this priority**: 这是流程地图的重要增值功能，但不影响用户查看和理解业务流程，可以在核心展示功能完成后再实现。

**Independent Test**: 用户在业务流程地图中点击任意业务模块卡片或卡片内的功能链接，系统立即跳转到对应页面（与 D001 中的导航行为保持一致）。

**Acceptance Scenarios**:

1. **Given** 用户正在查看业务流程地图，**When** 用户点击某个业务模块卡片，**Then** 系统跳转到该模块的默认页面
2. **Given** 用户悬停在业务模块卡片上，**When** 卡片展示功能快捷链接，**Then** 用户点击链接可直接进入对应功能页面
3. **Given** 用户从功能页面返回，**When** 用户使用浏览器后退按钮，**Then** 系统返回到之前的视图（流程地图或泳道地图）并保持原来的状态

---

### User Story 4 - 响应式布局支持 (Priority: P3)

作为影院业务中台的用户，我希望业务流程地图能够在不同屏幕尺寸下自适应显示，以便在不同设备上都能获得良好的使用体验。

**Why this priority**: 响应式设计是良好用户体验的基础，但可以在核心功能完成后通过样式优化实现，不阻塞核心功能开发。

**Independent Test**: 用户在不同屏幕尺寸（桌面、平板、手机）下访问业务流程地图，布局自动调整为最适合当前屏幕的排列方式（如桌面横向流程图、移动端纵向瀑布流）。

**Acceptance Scenarios**:

1. **Given** 用户在桌面浏览器访问，**When** 业务流程地图加载，**Then** 流程节点横向排列，流程箭头清晰指示方向
2. **Given** 用户在移动设备访问，**When** 业务流程地图加载，**Then** 流程节点纵向排列，适应窄屏幕显示
3. **Given** 用户调整浏览器窗口大小，**When** 窗口宽度变化，**Then** 流程地图布局平滑过渡到新的排列方式

---

### Edge Cases

- **空数据场景**: 如果没有任何业务模块数据（permissions 过滤后为空），流程地图应显示友好的空状态提示
- **单个模块场景**: 如果只有一个业务模块可见，流程地图应正常显示该模块，不显示流程箭头
- **视图切换中断**: 如果用户在视图切换动画进行中快速点击切换按钮，系统应防止重复触发，确保动画完整播放
- **权限变更**: 如果用户权限发生变化导致可见模块数量改变，两种视图都应实时更新显示的模块列表
- **浏览器兼容性**: 流程地图和切换动画应在主流浏览器（Chrome, Firefox, Safari, Edge）中一致工作

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须提供业务流程地图视图，按照业务执行的前后顺序展示所有业务模块
- **FR-002**: 系统必须在 Dashboard 页面顶部提供标签页式视图切换按钮组（"全景视图" | "流程视图"），允许用户在"业务全景中台服务地图"和"业务端到端流程地图"之间切换，激活的标签页必须高亮显示
- **FR-003**: 系统必须在业务端到端流程地图中展示流程箭头连接每个业务模块卡片，形成完整的流程链，清晰指示业务执行的先后顺序
- **FR-004**: 系统必须在流程地图的每个业务模块卡片中展示：模块名称、图标、简短描述、快速功能入口
- **FR-005**: 系统必须支持点击流程节点（模块卡片）跳转到对应的功能页面
- **FR-006**: 系统必须支持点击卡片内的功能链接直接跳转到具体功能页面
- **FR-007**: 系统必须在用户切换视图时保持用户的交互状态（如折叠/展开状态、滚动位置）
- **FR-008**: 系统必须根据用户权限过滤业务流程地图中显示的模块（与 D001 权限逻辑保持一致）
- **FR-009**: 系统必须为视图切换提供平滑的过渡动画，提升用户体验
- **FR-010**: 系统必须在空数据情况下显示友好的提示信息
- **FR-011**: 系统必须支持响应式布局，在不同屏幕尺寸下自适应调整流程地图的排列方式
- **FR-012**: 系统必须防止用户在切换动画进行中重复触发切换操作

### Key Entities

- **业务流程步骤 (Process Step)**: 代表业务流程中的一个执行阶段，包含多个相关业务模块，按照执行顺序排列。共5个阶段：阶段1-基础建设（数据初始化）、阶段2-供应生产（物料与成本）、阶段3-营销发布（定价与档期）、阶段4-交易履约（订单处理）、阶段5-经营洞察（分析与结算）
- **业务模块 (Business Module)**: 复用 D001 中定义的 ModuleCard 数据结构，代表一个可导航的业务功能模块，包含名称、图标、描述、功能链接等属性
- **视图状态 (View State)**: 记录当前激活的视图类型（泳道视图/流程视图）、用户交互状态（折叠状态、滚动位置）等信息

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用户能够在 2 秒内完成视图切换（从点击按钮到新视图完全渲染）
- **SC-002**: 业务流程地图能够清晰展示 12 个业务模块的执行顺序，用户在首次查看时能理解业务全貌
- **SC-003**: 90% 的用户能够在 30 秒内找到并理解如何使用视图切换功能
- **SC-004**: 视图切换功能在所有主流浏览器（Chrome, Firefox, Safari, Edge 最新版本）中无兼容性问题
- **SC-005**: 用户在两种视图之间切换时，状态保持准确率达到 100%（折叠状态、滚动位置不丢失）
- **SC-006**: 业务流程地图在桌面端（1920x1080）和移动端（375x667）都能正常显示和交互

### Assumptions

- 假设业务流程顺序可以通过静态配置定义（与 D001 中的 order 字段类似，但流程顺序可能与泳道顺序不同）
- 假设流程地图采用横向流程图布局（桌面端），移动端采用纵向瀑布流
- 假设视图切换状态可以存储在组件内部 state（不需要持久化到后端或 localStorage）
- 假设流程箭头使用 CSS 或 SVG 实现，不需要复杂的图形库
- 假设权限过滤逻辑与 D001 完全一致，使用相同的 `filterModulesByPermission` 工具函数
- 视图切换按钮采用标签页式设计，放置在页面顶部 Header 区域，与标题在同一行，两个标签并列显示："全景视图" | "流程视图"
- 业务流程分为 5 个主要阶段：基础建设（数据初始化）→ 供应生产（物料与成本）→ 营销发布（定价与档期）→ 交易履约（订单处理）→ 经营洞察（分析与结算）
- 流程地图的主标题为"业务端到端流程地图"，副标题为"SEQUENTIAL VALUE CHAIN WORKFLOW"（顺序价值链工作流）
- 每个流程阶段包含标题（序号 + 阶段名称）和副标题（核心业务描述），格式如："1. 基础建设" + "数据初始化"
- 流程箭头连接所有业务模块卡片，形成从起点到终点的完整流程链，最后以"END OF BUSINESS LOOP"标识结束

### Constraints

- 必须复用 D001 中的 ModuleCard 组件和数据结构，避免重复代码
- 必须保持与 D001 一致的视觉风格（颜色、字体、间距、圆角等）
- 必须确保 TypeScript 编译无错误，所有类型定义完整
- 必须在不修改 D001 核心代码的前提下实现功能（通过新增组件和配置扩展）
- 性能要求：页面首次渲染时间不超过 1 秒，视图切换动画流畅（60fps）
