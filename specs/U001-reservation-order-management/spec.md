# Feature Specification: 预约单管理系统

**Feature Branch**: `U001-reservation-order-management`
**Created**: 2025-12-23
**Status**: Draft
**Input**: User description: "理解 http://localhost:10086/#/pages/detail/index?id=00000000-0003-0000-0000-000000000003 将立即支付 修改为 立即预约，然后设计与开发预约单的功能 在后台运营平台"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - C端用户创建预约单 (Priority: P1)

作为影院场景包的潜在客户,我希望在查看场景包详情后点击"立即预约"按钮来创建预约单,而不是直接支付,这样我可以先锁定我想要的时段和套餐,稍后再确认支付,给我更多时间考虑和准备。

**Why this priority**: 这是整个预约流程的起点,是最核心的用户价值。没有预约单创建功能,后续的所有管理和确认流程都无法进行。这是最小可行产品(MVP)的基础。

**Independent Test**: 可以通过在C端场景包详情页点击"立即预约"按钮,填写预约信息(时段、套餐、加购项),提交后生成预约单来独立测试。测试人员能够完成从浏览到预约单创建的完整流程,并验证预约单数据正确保存。

**Acceptance Scenarios**:

1. **Given** 用户在场景包详情页(`/pages/detail/index?id=xxx`),**When** 点击"立即预约"按钮,**Then** 应跳转到预约信息填写页面,显示场景包名称、可选时段、套餐选项、加购项列表
2. **Given** 用户在预约信息页面,**When** 选择了预订日期、时段、套餐,填写了联系人姓名和手机号,**Then** "提交预约"按钮应变为可点击状态
3. **Given** 用户填写完整预约信息,**When** 点击"提交预约"按钮,**Then** 系统应创建预约单,显示预约单号,并跳转到"预约成功"页面
4. **Given** 用户提交预约后,**When** 在"预约成功"页面查看,**Then** 应显示预约单详情(预约单号、场景包名称、预订时段、套餐、总金额、待确认状态)
5. **Given** 用户选择的时段库存不足,**When** 提交预约时,**Then** 系统应阻止提交并提示"该时段预约已满,请选择其他时段"
6. **Given** 用户未填写必填字段(如联系人手机号),**When** 尝试提交预约,**Then** 系统应高亮显示缺失字段并提示"请完善必填信息"

---

### User Story 2 - B端运营人员查看预约单列表 (Priority: P1)

作为影院运营人员,我希望在后台管理平台能够查看所有预约单的列表,包括预约单号、客户姓名、场景包名称、预订时段、套餐、状态、创建时间等信息,并能按状态(待确认/已确认/已取消/已完成)、日期范围、场景包进行筛选,这样我可以快速了解当前的预约情况并进行管理。

**Why this priority**: 运营人员需要看到所有预约单才能进行后续的确认、修改和取消操作。列表是管理的入口,是P1优先级的必需功能。

**Independent Test**: 可以通过登录后台管理平台,进入"预约管理"模块,查看预约单列表并使用筛选功能来独立测试。测试人员能够验证列表展示的完整性、分页功能、筛选条件的准确性。

**Acceptance Scenarios**:

1. **Given** 运营人员登录后台管理平台,**When** 进入"预约管理"菜单,**Then** 应显示预约单列表页面,默认按创建时间倒序排列,显示最新的预约单
2. **Given** 预约单列表页面,**When** 列表中有超过20条预约单,**Then** 应显示分页控件,每页默认显示20条记录
3. **Given** 预约单列表页面,**When** 运营人员在状态筛选器中选择"待确认",**Then** 列表应仅显示状态为"待确认"的预约单
4. **Given** 预约单列表页面,**When** 运营人员选择日期范围(如2025-12-01至2025-12-31),**Then** 列表应仅显示该时间范围内创建的预约单
5. **Given** 预约单列表页面,**When** 运营人员在搜索框输入预约单号或客户手机号,**Then** 列表应实时过滤并显示匹配的预约单
6. **Given** 预约单列表为空(无任何预约),**When** 页面加载,**Then** 应显示友好的空状态提示"暂无预约单"

---

### User Story 3 - B端运营人员确认预约单 (Priority: P1)

作为影院运营人员,我希望能够在后台管理平台查看预约单详情,并点击"确认预约"按钮将预约单状态从"待确认"变更为"已确认",同时可以选择是否要求客户支付,这样我可以根据不同客户类型(企业团建/普通客户)灵活处理预约,确保预约单的有效性和资源的真实占用。

**Why this priority**: 确认预约是从意向到实际订单的关键步骤,没有确认功能,预约单无法转化为有效订单。支付可选功能提供了业务灵活性,适应不同客户场景。这是核心业务流程的一部分,必须在MVP中实现。

**Independent Test**: 可以通过在后台管理平台打开一个"待确认"状态的预约单详情页,点击"确认预约"按钮,选择是否要求支付,验证状态变更和通知发送来独立测试。

**Acceptance Scenarios**:

1. **Given** 运营人员在预约单列表中,**When** 点击某个"待确认"状态的预约单,**Then** 应跳转到预约单详情页面,显示完整的预约信息(场景包、时段、套餐、加购项、客户信息、总金额)
2. **Given** 运营人员在预约单详情页面(状态为"待确认"),**When** 点击"确认预约"按钮,**Then** 应弹出确认对话框询问"是否确认该预约?",并提供选项:"要求客户支付"或"直接完成(无需支付)"
3. **Given** 运营人员在确认对话框中选择"要求客户支付",**When** 点击"确定",**Then** 预约单状态应变更为"已确认",页面应刷新显示新状态,并显示成功提示"预约单已确认,客户需完成支付"
4. **Given** 运营人员在确认对话框中选择"直接完成(无需支付)",**When** 点击"确定",**Then** 预约单状态应直接变更为"已完成",跳过支付环节,并显示成功提示"预约单已完成"
5. **Given** 预约单已确认且要求支付,**When** 客户在C端查看"我的预约",**Then** 该预约单应显示为"已确认"状态,并出现"立即支付"按钮
6. **Given** 预约单已确认但无需支付(直接完成),**When** 客户在C端查看"我的预约",**Then** 该预约单应显示为"已完成"状态,无支付按钮
7. **Given** 运营人员确认预约后,**When** 系统发送确认通知,**Then** 客户应收到相应通知:若要求支付则通知"您的预约已确认,请尽快完成支付";若直接完成则通知"您的预约已确认并完成"
8. **Given** 预约单已被其他运营人员确认或取消,**When** 当前运营人员尝试确认,**Then** 系统应提示"预约单状态已变更,请刷新页面"

---

### User Story 4 - B端运营人员取消预约单 (Priority: P2)

作为影院运营人员,我希望能够在后台管理平台取消预约单,并填写取消原因,这样可以释放被占用的时段库存,同时向客户说明取消的原因,处理资源冲突或客户主动要求取消的情况。

**Why this priority**: 取消功能对于处理异常情况和资源调配很重要,但不影响正常的预约-确认-支付流程。可以作为P2优先级在MVP完成后添加。

**Independent Test**: 可以通过在后台管理平台打开一个"待确认"或"已确认"状态的预约单,点击"取消预约"按钮,填写取消原因,验证状态变更和库存释放来独立测试。

**Acceptance Scenarios**:

1. **Given** 运营人员在预约单详情页面,**When** 点击"取消预约"按钮,**Then** 应弹出取消原因填写对话框,包含常见原因选项(资源冲突/客户要求/其他)和自定义文本框
2. **Given** 运营人员在取消原因对话框中,**When** 选择或填写取消原因并点击"确定",**Then** 预约单状态应变更为"已取消",取消原因应记录到预约单中
3. **Given** 预约单被取消,**When** 状态变更完成,**Then** 该预约单占用的时段库存应释放,其他用户可以预订该时段
4. **Given** 预约单被取消,**When** 客户在C端查看"我的预约",**Then** 该预约单应显示为"已取消"状态,并显示取消原因
5. **Given** 预约单已支付(状态为"已完成"),**When** 运营人员尝试取消,**Then** 系统应阻止操作并提示"已支付的预约单无法直接取消,请使用退款功能"
6. **Given** 预约单已被取消,**When** 运营人员再次尝试取消,**Then** 系统应提示"该预约单已取消,无法重复操作"

---

### User Story 5 - B端运营人员修改预约单信息 (Priority: P2)

作为影院运营人员,我希望能够在后台管理平台修改预约单的部分信息(如联系人姓名、手机号、备注),这样可以纠正客户填写错误或根据客户要求进行调整,提供更灵活的服务。

**Why this priority**: 修改功能提升了服务的灵活性,但不是核心流程的必需功能。大部分预约单信息在创建时已正确,修改是辅助功能,可以作为P2优先级。

**Independent Test**: 可以通过在后台管理平台打开一个预约单详情页,点击"编辑"按钮,修改联系人信息,保存后验证修改结果来独立测试。

**Acceptance Scenarios**:

1. **Given** 运营人员在预约单详情页面,**When** 点击"编辑"按钮,**Then** 联系人姓名、手机号、备注字段应变为可编辑状态
2. **Given** 运营人员在编辑模式下,**When** 修改了联系人手机号,**Then** 系统应验证手机号格式(11位数字),不符合时显示错误提示
3. **Given** 运营人员修改了预约单信息,**When** 点击"保存"按钮,**Then** 修改应成功保存,页面应退出编辑模式并显示成功提示"信息已更新"
4. **Given** 运营人员在编辑模式下,**When** 点击"取消"按钮,**Then** 所有未保存的修改应被丢弃,字段恢复到修改前的值
5. **Given** 预约单的核心字段(场景包、时段、套餐),**When** 运营人员查看编辑页面,**Then** 这些字段应为只读状态,不可修改,显示提示"核心预订信息不可修改"
6. **Given** 运营人员修改预约单后,**When** 保存成功,**Then** 系统应记录修改日志(操作人、操作时间、修改内容),可在"操作记录"标签页查看

---

### User Story 6 - C端用户查看预约单历史 (Priority: P2)

作为影院场景包的客户,我希望能够在C端"我的预约"页面查看我所有的预约单历史,包括待确认、已确认、已取消、已完成等各种状态的预约单,这样我可以追踪我的预约进度,查看历史记录,了解取消原因。

**Why this priority**: 用户查看历史记录对于透明度和用户体验很重要,但不影响预约单的创建和管理核心流程。可以作为P2优先级在基础功能完成后添加。

**Independent Test**: 可以通过在C端登录用户账号,进入"我的预约"页面,查看预约单列表并验证各种状态的预约单显示来独立测试。

**Acceptance Scenarios**:

1. **Given** 用户登录C端应用,**When** 进入"我的预约"页面,**Then** 应显示该用户的所有预约单列表,按创建时间倒序排列
2. **Given** 用户在"我的预约"页面,**When** 查看列表,**Then** 每个预约单应显示场景包名称、预订时段、状态、总金额、创建时间
3. **Given** 用户在"我的预约"页面,**When** 点击某个预约单,**Then** 应跳转到预约单详情页,显示完整信息(套餐、加购项、联系人信息、状态变更历史)
4. **Given** 用户查看"已确认"状态的预约单,**When** 在详情页,**Then** 应显示"立即支付"按钮,点击后跳转到支付页面
5. **Given** 用户查看"已取消"状态的预约单,**When** 在详情页,**Then** 应显示取消原因和取消时间
6. **Given** 用户在"我的预约"页面,**When** 使用状态筛选器选择"已完成",**Then** 列表应仅显示已支付完成的预约单

---

### User Story 7 - C端"我的"页面集成预约订单入口 (Priority: P1)

作为影院场景包的客户,我希望在小程序底部导航栏的"我的"(profile)页面中能够快速找到"我的预约"入口,这样我可以方便地从个人中心管理我的所有预约订单,符合常见App的用户习惯。

**Why this priority**: 这是用户体验的关键路径,用户习惯在"我的"页面找到订单入口。基于F001-miniapp-tab-bar功能已实现的profile页面,需要将预约订单功能入口集成进去,形成完整的用户旅程闭环。这是MVP的必要组成部分。

**Independent Test**: 可以通过在小程序中点击底部"我的"Tab,验证页面中显示"我的预约"菜单项,点击后能够正确跳转到预约列表页来独立测试。

**Acceptance Scenarios**:

1. **Given** 用户在小程序底部导航栏,**When** 点击"我的"Tab,**Then** 应显示个人中心页面,页面中包含"我的预约"菜单入口
2. **Given** 用户在"我的"页面,**When** 点击"我的预约"菜单,**Then** 应跳转到预约订单列表页面(`/pages/my-reservations/index`)
3. **Given** 用户已有预约订单,**When** 在"我的"页面查看"我的预约"菜单,**Then** 应显示待处理订单数量角标(如有待确认或待支付的订单)
4. **Given** 用户未登录,**When** 在"我的"页面点击"我的预约",**Then** 应提示用户登录或跳转到登录页面
5. **Given** 用户在"我的"页面,**When** 查看页面布局,**Then** "我的预约"应显示在显眼位置(建议在用户头像区域下方的第一个菜单项)

---

### Edge Cases

- **时段库存实时同步**: 用户A正在填写预约信息,用户B同时预订了同一时段的最后一个名额,用户A提交时应实时检测库存并提示"该时段已被预订,请选择其他时段"
- **预约单超时处理**: 用户创建预约单后长时间未确认支付,系统应在24小时后自动取消预约单并释放时段库存,同时发送取消通知给客户
- **并发确认冲突**: 两个运营人员同时打开同一预约单并点击"确认",系统应检测并发操作,只允许第一个确认成功,第二个提示"预约单已被其他人确认"
- **支付后修改限制**: 用户已完成支付的预约单,运营人员尝试修改或取消时,系统应阻止操作并提示"已支付订单请通过退款流程处理"
- **时段被临时取消**: 运营人员在场景包时段管理中取消了某个时段,系统应自动取消所有预订该时段的预约单,释放库存,并向相关客户发送取消通知说明原因(建议提供补偿或替代方案)
- **预约单批量导出**: 运营人员需要导出某个时间段的所有预约单进行统计分析,系统应支持Excel或CSV格式导出,包含所有必要字段
- **手机号验证**: 用户填写的联系人手机号应在提交前进行格式验证(11位数字),仅验证格式合法性,不发送短信验证码,以保证用户体验流畅
- **预约单通知机制**: 预约单状态变更(确认/取消)时,客户应通过什么方式接收通知?短信、站内消息、微信模板消息还是多种方式并行?
- **重复预约检测**: 同一用户在短时间内重复提交相同场景包和时段的预约,系统应检测并提示"您已有相同的预约单,请勿重复提交"或直接阻止
- **客户自主取消**: 用户在C端"我的预约"中能否自行取消"待确认"状态的预约单?如果可以,是否需要运营人员审核?

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: C端场景包详情页必须将原"立即支付"按钮文案修改为"立即预约",点击后跳转到预约信息填写页面
- **FR-002**: 预约信息填写页面必须包含以下字段:场景包名称(只读展示)、预订日期(日历选择器)、预订时段(下拉选择,仅显示可用时段)、套餐选择(单选)、加购项选择(多选,显示价格)、联系人姓名(必填)、联系人手机号(必填,11位数字验证)、备注(可选,最多200字符)
- **FR-003**: 预约信息页面必须实时计算并显示预约总金额(套餐价格+已选加购项价格总和),金额变化时立即更新
- **FR-004**: 系统必须在用户提交预约前检查所选时段的当前库存,库存不足时阻止提交并提示"该时段预约已满,请选择其他时段"
- **FR-005**: 系统必须在用户成功提交预约后生成唯一的预约单号(格式:R+时间戳+随机4位数字,如R202512230001),并将预约单状态设置为"待确认"
- **FR-006**: 预约单必须包含以下核心信息:预约单号、客户用户ID、场景包ID及名称、预订日期、预订时段、所选套餐ID及名称、所选加购项列表(ID、名称、数量、单价)、联系人姓名、联系人手机号、备注、总金额、预约单状态(待确认/已确认/已取消/已完成)、创建时间、更新时间
- **FR-007**: 系统必须在用户成功创建预约单后,将对应时段的可用库存减1(临时锁定),防止超售
- **FR-008**: B端预约管理模块必须提供预约单列表页面,默认按创建时间倒序排列,每页显示20条记录,支持分页导航
- **FR-009**: 预约单列表页面必须支持以下筛选条件:预约单状态(待确认/已确认/已取消/已完成,支持多选)、创建日期范围(起始日期-结束日期)、场景包名称(下拉选择)、预订日期范围、搜索框(支持预约单号、客户手机号模糊搜索)
- **FR-010**: 预约单列表中每条记录必须显示:预约单号、客户姓名、客户手机号、场景包名称、预订日期和时段、套餐名称、总金额、预约单状态、创建时间、操作按钮(查看详情/确认/取消)
- **FR-011**: 运营人员必须能够点击预约单列表中的"查看详情"按钮,跳转到预约单详情页,显示所有预约单信息(包括加购项明细、备注、状态变更历史)
- **FR-012**: 预约单详情页面必须在预约单状态为"待确认"时显示"确认预约"按钮,点击后弹出确认对话框,提供两个选项:"要求客户支付"(状态变更为"已确认")或"直接完成(无需支付)"(状态直接变更为"已完成"),运营人员根据客户类型选择
- **FR-013**: 系统必须在运营人员确认预约单后,向客户发送确认通知(短信或站内消息),通知内容根据支付选项不同而变化:若要求支付则通知"您的预约已确认,请尽快完成支付(预约单号、场景包名称、预订时段、总金额)";若直接完成则通知"您的预约已确认并完成(预约单号、场景包名称、预订时段)"
- **FR-014**: 预约单详情页面必须在预约单状态为"待确认"或"已确认"时显示"取消预约"按钮,点击后弹出取消原因对话框
- **FR-015**: 取消原因对话框必须包含常见原因选项(资源冲突、客户要求取消、时段调整、其他)和自定义文本框(必填,最多200字符),确认后将状态变更为"已取消"并记录取消原因
- **FR-016**: 系统必须在预约单被取消后,将对应时段的可用库存加1(释放锁定),允许其他用户预订
- **FR-017**: 系统必须在预约单被取消后,向客户发送取消通知,通知内容包含:预约单号、取消原因、取消时间
- **FR-018**: 预约单详情页面必须提供"编辑"按钮,点击后允许运营人员修改联系人姓名、联系人手机号、备注字段,核心字段(场景包、时段、套餐、加购项)不可修改
- **FR-019**: 系统必须在运营人员修改预约单信息后,记录操作日志(操作人ID、操作时间、修改前内容、修改后内容),可在预约单详情页的"操作记录"标签页查看
- **FR-020**: 系统必须阻止运营人员对状态为"已完成"的预约单执行取消或修改操作,若预约单已支付则提示"已支付订单请通过退款流程处理",若预约单直接完成(无支付)则提示"已完成的预约单无法修改或取消"
- **FR-021**: C端"我的预约"页面必须显示当前登录用户的所有预约单列表,按创建时间倒序排列,支持按状态筛选(全部/待确认/已确认/已取消/已完成)
- **FR-022**: C端预约单详情页面必须显示完整的预约单信息,包括场景包名称、预订时段、套餐、加购项明细、联系人信息、总金额、当前状态、状态变更历史
- **FR-023**: C端预约单详情页面必须在预约单状态为"已确认"且要求支付时显示"立即支付"按钮,点击后跳转到支付页面(集成现有支付功能);若预约单已直接完成(无需支付),则不显示支付按钮
- **FR-024**: 系统必须在预约单支付成功后,将预约单状态从"已确认"变更为"已完成",并记录支付时间、支付方式、支付流水号;对于直接完成的预约单,无需支付流水号
- **FR-025**: 系统必须对所有预约单操作(创建、确认、取消、修改、支付)进行并发控制,通过乐观锁或版本号机制防止数据冲突
- **FR-026**: 系统必须在用户提交预约表单时,对所有必填字段进行前端验证(非空、格式、长度),验证失败时高亮显示错误字段并提示具体错误信息
- **FR-027**: B端预约单列表页面必须支持批量导出功能,导出格式为Excel或CSV,包含筛选条件范围内的所有预约单数据(预约单号、客户信息、场景包、时段、套餐、金额、状态、时间等)
- **FR-028**: 系统必须在检测到预约单状态变更(确认/取消)时,实时更新预约单详情页面和列表页面,无需手动刷新
- **FR-029**: 系统必须在运营人员确认预约单时记录"是否要求支付"标志(requiresPayment: boolean),若选择"要求客户支付"则设为true,若选择"直接完成(无需支付)"则设为false,该标志决定预约单后续是否显示支付按钮和是否需要支付流程
- **FR-030**: C端"我的"(profile)页面必须包含"我的预约"菜单入口,菜单应显示图标和文字,点击后跳转到预约订单列表页面(`/pages/my-reservations/index`)
- **FR-031**: "我的预约"菜单入口必须显示待处理订单数量角标,待处理订单定义为状态为"待确认"或"已确认且要求支付"的预约单数量;若无待处理订单则不显示角标
- **FR-032**: C端"我的"页面在用户未登录状态下,点击"我的预约"菜单必须跳转到登录页面,登录成功后自动返回"我的预约"页面
- **FR-033**: C端"我的"页面布局必须遵循常见App设计规范,包含用户头像区域(支持未登录展示)和功能菜单区域,"我的预约"作为第一个功能菜单项显示
- **FR-034**: C端"我的"页面必须与F001-miniapp-tab-bar功能的profile页面(`/pages/profile/index`)完全集成,在现有占位页面基础上实现完整的个人中心功能

### Key Entities

- **预约单(Reservation Order)**: 表示一次客户的场景包预订意向,包含预约单号、客户信息、场景包选择、时段选择、套餐和加购项、联系人信息、总金额、状态、是否要求支付标志(requiresPayment)、时间戳等核心属性。与客户、场景包、套餐、加购项、时段库存等实体关联。
- **预约单状态(Reservation Status)**: 预约单的生命周期状态,包括待确认(Pending)、已确认(Confirmed)、已取消(Cancelled)、已完成(Completed)四种核心状态。状态转换规则为:待确认→已确认→已完成(若要求支付则需支付后转为已完成),或待确认→已完成(若不要求支付则直接完成),或任意状态→已取消。
- **预约单明细(Reservation Item)**: 预约单中的加购项明细,记录每个加购项的ID、名称、数量、单价、小计金额。支持多个明细项。
- **操作日志(Operation Log)**: 记录预约单的所有操作历史,包括操作类型(创建/确认/取消/修改/支付)、操作人、操作时间、操作前后的数据快照、操作原因(如取消原因)、支付选项(要求支付/直接完成)。用于审计和追溯。
- **客户(Customer)**: 创建预约单的用户,包含用户ID、姓名、手机号、注册时间等属性。一个客户可以创建多个预约单。
- **时段库存快照(Slot Inventory Snapshot)**: 预约单创建时的时段库存状态快照,记录预订时的总容量、已预订数量、剩余数量,用于库存核对和异常处理。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: C端用户能够在3分钟内完成从点击"立即预约"到提交预约单的完整流程,包括选择时段、套餐、填写联系人信息
- **SC-002**: B端运营人员能够在10秒内完成预约单的确认或取消操作(包括填写取消原因),系统响应时间不超过2秒
- **SC-003**: 预约单列表页面在加载100条记录时,首屏渲染时间不超过1.5秒,筛选操作响应时间不超过500毫秒
- **SC-004**: 系统在高并发场景下(同时50个用户预订同一时段),时段库存准确性达到100%,无超售或库存负数情况
- **SC-005**: 预约单状态变更通知的送达率达到95%以上(短信通道正常情况下),客户在状态变更后5分钟内收到通知
- **SC-006**: 95%的预约单创建操作能够在首次提交时成功,失败时有明确的错误提示(如时段已满、信息填写错误等)
- **SC-007**: 运营人员能够在30秒内通过筛选条件或搜索框找到目标预约单,搜索准确率达到100%
- **SC-008**: 批量导出功能能够在30秒内导出1000条预约单记录,导出文件包含所有必要字段且格式正确
- **SC-009**: 预约单管理功能上线后,客户的预订转化率(从浏览场景包详情到创建预约单)提升至少20%,相比原"立即支付"按钮

## Assumptions

- 假设C端用户在创建预约单时已登录,无需在预约流程中处理登录逻辑
- 假设场景包、套餐、加购项、时段库存等基础数据已由其他功能模块管理并提供查询接口
- 假设支付功能已存在且可集成,预约单确认后用户可通过现有支付流程完成付款
- 假设短信或站内消息通知功能已由平台统一提供,预约单模块仅需调用通知接口
- 假设运营人员已具备后台管理平台的访问权限,无需在预约单模块中实现权限控制逻辑
- 假设预约单号的唯一性由系统生成机制保证,无需人工干预
- 假设预约单的总金额计算逻辑与场景包套餐和加购项的定价规则一致,无额外折扣或优惠券逻辑
- 假设预约单创建后的默认有效期为24小时,超时未确认支付则自动取消并释放库存
- 假设时段库存的扣减和释放操作具有事务性,确保库存数据的准确性
- 假设预约单被取消后不可恢复,需重新创建新的预约单

## Dependencies

- **依赖场景包管理模块**: 预约单需要引用场景包ID、名称、套餐、加购项等数据,依赖场景包详情查询API
- **依赖时段库存管理模块**: 预约单创建和取消时需要实时查询和更新时段库存,依赖库存查询和扣减/释放API
- **依赖用户管理模块**: 预约单需要关联客户用户ID,依赖用户信息查询API和登录态验证
- **依赖支付模块**: 预约单确认后的支付流程依赖现有支付功能,需要支付状态回调接口
- **依赖通知模块**: 预约单状态变更时需要发送短信或站内消息通知,依赖平台统一通知服务API
- **依赖权限管理模块**: B端预约单管理页面的访问权限依赖运营人员的角色和权限配置
- **依赖F001-miniapp-tab-bar**: "我的预约"入口需要集成在F001功能实现的profile页面(`hall-reserve-taro/src/pages/profile/index.tsx`)中,依赖该页面的基础框架和TabBar导航

## Related Features

- **场景包管理**: 预约单引用场景包、套餐、加购项等数据,预约单的创建入口在场景包详情页
- **时段库存管理**: 预约单的创建和取消直接影响时段库存的占用和释放,需要实时同步
- **支付模块**: 预约单确认后的支付流程是预约转化为订单的最后一步,需要集成现有支付功能
- **订单管理**: 预约单支付完成后可能转化为正式订单,需要与订单管理模块对接
- **客户管理**: 预约单关联客户信息,客户可在"我的预约"中查看历史记录
- **F001-miniapp-tab-bar**: 本功能依赖F001功能实现的"我的"(profile)Tab页面,需要在该页面上集成预约订单入口,将占位页面升级为完整的个人中心

## Clarifications

### Session 2025-12-23

- **Q: 预约单的完整生命周期是否需要支付环节?** → **A: 支付可选,由运营人员决定。** 运营人员确认预约单后,可以选择是否要求客户支付。对于某些场景(如企业团建、内部预订),可能直接标记为"已完成"而无需支付;对于普通客户预约,可要求支付后才转为"已完成"状态。这为业务提供了更高的灵活性。
