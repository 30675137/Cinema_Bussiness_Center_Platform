# 饮品商家配置手册

**文档版本**: 1.0  
**适用模块**: O003-beverage-order  
**更新日期**: 2025-12-28

---

## 目录

1. [快速开始](#快速开始)
2. [饮品分类说明](#饮品分类说明)
3. [通过 SQL 配置饮品](#通过-sql-配置饮品)
4. [饮品规格配置](#饮品规格配置)
5. [常见操作示例](#常见操作示例)
6. [数据验证](#数据验证)

---

## 快速开始

### 方式一：执行种子数据脚本（推荐首次使用）

```bash
# 连接 Supabase 数据库并执行种子数据
cd backend
psql "postgresql://postgres:[密码]@db.fxhgyxceqrmnpezluaht.supabase.co:5432/postgres" \
  -f src/main/resources/db/seed/beverages.sql
```

### 方式二：通过 Supabase SQL Editor

1. 登录 [Supabase Dashboard](https://supabase.com/dashboard)
2. 选择项目 → SQL Editor
3. 复制并执行下方 SQL 语句

---

## 饮品分类说明

| 分类代码 | 中文名称 | 适用饮品 |
|---------|---------|---------|
| COFFEE | 咖啡 | 美式、拿铁、卡布奇诺、摩卡等 |
| TEA | 茶饮 | 绿茶、红茶、乌龙茶、茉莉花茶等 |
| JUICE | 果汁 | 鲜橙汁、西瓜汁、苹果汁等 |
| SMOOTHIE | 奶昔 | 草莓奶昔、芒果奶昔、香蕉奶昔等 |
| MILK_TEA | 奶茶 | 珍珠奶茶、布蕾奶茶、芋泥奶茶等 |
| OTHER | 其他 | 特调饮品、季节限定等 |

---

## 通过 SQL 配置饮品

### 添加单个饮品

```sql
-- 添加一款饮品
INSERT INTO beverages (
  id,
  name,
  description,
  category,
  image_url,
  base_price,
  status,
  is_recommended,
  sort_order,
  created_at,
  updated_at
) VALUES (
  gen_random_uuid(),
  '抹茶拿铁',                                    -- 饮品名称
  '日式抹茶与鲜奶的完美融合',                      -- 描述
  'COFFEE',                                     -- 分类
  'https://example.com/matcha-latte.jpg',       -- 主图URL
  24.00,                                        -- 基础价格
  'ACTIVE',                                     -- 状态: ACTIVE/INACTIVE/OUT_OF_STOCK
  true,                                         -- 是否推荐
  95,                                           -- 排序（越大越靠前）
  NOW(),
  NOW()
);
```

### 字段说明

| 字段 | 必填 | 类型 | 说明 |
|-----|------|------|------|
| name | 是 | VARCHAR(100) | 饮品名称（菜单显示） |
| description | 否 | TEXT | 饮品描述（详情页显示） |
| category | 是 | VARCHAR(50) | 分类代码（见上表） |
| image_url | 否 | TEXT | 主图URL（Supabase Storage） |
| base_price | 是 | DECIMAL(10,2) | 基础价格（小杯/标准规格） |
| status | 是 | VARCHAR(20) | ACTIVE-上架 / INACTIVE-下架 / OUT_OF_STOCK-缺货 |
| is_recommended | 否 | BOOLEAN | 是否显示推荐标签 |
| sort_order | 否 | INTEGER | 排序权重（越大越靠前） |

---

## 饮品规格配置

### 规格类型说明

| 规格类型 | 说明 | 常用选项 |
|---------|------|---------|
| SIZE | 容量大小 | 小杯、中杯、大杯、超大杯 |
| TEMPERATURE | 温度 | 冷、热、常温、少冰、去冰 |
| SWEETNESS | 甜度 | 无糖、三分糖、五分糖、七分糖、全糖 |
| TOPPING | 配料/加料 | 珍珠、椰果、布丁、芝士奶盖 |

### 为饮品添加规格

```sql
-- 先获取饮品ID
SELECT id, name FROM beverages WHERE name = '抹茶拿铁';

-- 添加容量规格（将 :beverage_id 替换为实际ID）
INSERT INTO beverage_specs (id, beverage_id, spec_type, spec_name, price_adjustment, sort_order, is_default)
VALUES
  (gen_random_uuid(), ':beverage_id', 'SIZE', '中杯', 0.00, 1, true),   -- 默认选项
  (gen_random_uuid(), ':beverage_id', 'SIZE', '大杯', 3.00, 2, false),
  (gen_random_uuid(), ':beverage_id', 'SIZE', '超大杯', 6.00, 3, false);

-- 添加温度规格
INSERT INTO beverage_specs (id, beverage_id, spec_type, spec_name, price_adjustment, sort_order, is_default)
VALUES
  (gen_random_uuid(), ':beverage_id', 'TEMPERATURE', '冷', 0.00, 1, true),
  (gen_random_uuid(), ':beverage_id', 'TEMPERATURE', '热', 0.00, 2, false);
```

### 规格字段说明

| 字段 | 必填 | 说明 |
|-----|------|------|
| beverage_id | 是 | 关联的饮品ID |
| spec_type | 是 | 规格类型（SIZE/TEMPERATURE/SWEETNESS/TOPPING） |
| spec_name | 是 | 规格名称（用户看到的文字） |
| price_adjustment | 否 | 价格调整（可正可负，默认0） |
| sort_order | 否 | 排序（越小越靠前） |
| is_default | 否 | 是否为默认选项（每个类型仅一个） |

---

## 常见操作示例

### 1. 上架/下架饮品

```sql
-- 下架饮品
UPDATE beverages SET status = 'INACTIVE', updated_at = NOW() WHERE name = '抹茶拿铁';

-- 重新上架
UPDATE beverages SET status = 'ACTIVE', updated_at = NOW() WHERE name = '抹茶拿铁';

-- 标记缺货（前端显示"暂时缺货"）
UPDATE beverages SET status = 'OUT_OF_STOCK', updated_at = NOW() WHERE name = '抹茶拿铁';
```

### 2. 修改价格

```sql
-- 修改基础价格
UPDATE beverages SET base_price = 26.00, updated_at = NOW() WHERE name = '抹茶拿铁';

-- 修改大杯加价
UPDATE beverage_specs 
SET price_adjustment = 4.00 
WHERE beverage_id = (SELECT id FROM beverages WHERE name = '抹茶拿铁')
  AND spec_type = 'SIZE' 
  AND spec_name = '大杯';
```

### 3. 批量添加分类饮品

```sql
-- 批量添加咖啡类饮品
INSERT INTO beverages (id, name, description, category, base_price, status, sort_order, created_at, updated_at)
VALUES
  (gen_random_uuid(), '摩卡咖啡', '浓缩咖啡与巧克力的完美结合', 'COFFEE', 25.00, 'ACTIVE', 97, NOW(), NOW()),
  (gen_random_uuid(), '香草拿铁', '香草风味拿铁，甜蜜丝滑', 'COFFEE', 24.00, 'ACTIVE', 96, NOW(), NOW()),
  (gen_random_uuid(), '焦糖玛奇朵', '焦糖与浓缩咖啡的层次体验', 'COFFEE', 26.00, 'ACTIVE', 95, NOW(), NOW());
```

### 4. 删除饮品

```sql
-- 删除饮品（会级联删除关联的规格）
DELETE FROM beverages WHERE name = '抹茶拿铁';
```

### 5. 为所有饮品添加统一规格

```sql
-- 为所有饮品添加"中杯"规格
INSERT INTO beverage_specs (id, beverage_id, spec_type, spec_name, price_adjustment, sort_order, is_default)
SELECT 
  gen_random_uuid(),
  b.id,
  'SIZE',
  '中杯',
  0.00,
  1,
  true
FROM beverages b
WHERE NOT EXISTS (
  SELECT 1 FROM beverage_specs s 
  WHERE s.beverage_id = b.id AND s.spec_type = 'SIZE' AND s.spec_name = '中杯'
);
```

---

## 数据验证

### 检查饮品是否有规格

```sql
-- 查找没有规格的饮品（应该为空）
SELECT b.id, b.name, b.category
FROM beverages b
LEFT JOIN beverage_specs bs ON b.id = bs.beverage_id
WHERE b.status = 'ACTIVE'
GROUP BY b.id, b.name, b.category
HAVING COUNT(bs.id) = 0;
```

### 查看当前饮品列表

```sql
-- 查看所有上架饮品
SELECT 
  name,
  category,
  base_price,
  status,
  is_recommended,
  sort_order
FROM beverages
WHERE status = 'ACTIVE'
ORDER BY sort_order DESC;
```

### 查看饮品及其规格

```sql
-- 查看某饮品的所有规格
SELECT 
  b.name AS beverage_name,
  bs.spec_type,
  bs.spec_name,
  bs.price_adjustment,
  bs.is_default
FROM beverages b
JOIN beverage_specs bs ON b.id = bs.beverage_id
WHERE b.name = '珍珠奶茶'
ORDER BY bs.spec_type, bs.sort_order;
```

### 统计各分类饮品数量

```sql
SELECT 
  category,
  COUNT(*) AS count,
  SUM(CASE WHEN status = 'ACTIVE' THEN 1 ELSE 0 END) AS active_count
FROM beverages
GROUP BY category
ORDER BY category;
```

---

## 图片上传说明

### 使用 Supabase Storage

1. 登录 Supabase Dashboard → Storage
2. 创建 bucket: `beverage-images`（如已存在则跳过）
3. 上传图片文件
4. 获取公开 URL:
   ```
   https://fxhgyxceqrmnpezluaht.supabase.co/storage/v1/object/public/beverage-images/[文件名]
   ```

### 推荐图片规格

| 用途 | 尺寸 | 格式 |
|-----|------|------|
| 主图 (image_url) | 800x800 px | JPG/PNG |
| 详情图 (detail_images) | 1200x800 px | JPG/PNG |

---

## 注意事项

1. **价格单位**: 所有价格单位为人民币元，支持两位小数
2. **状态管理**: 修改 status 不会影响已创建的订单
3. **规格唯一性**: 同一饮品的同一规格类型下，spec_name 不能重复
4. **排序权重**: sort_order 越大越靠前，相同时按创建时间排序
5. **图片URL**: 确保图片URL可公开访问，否则前端无法显示

---

## 联系支持

如遇问题，请联系技术支持或查阅：
- 数据模型文档: `specs/O003-beverage-order/data-model.md`
- API 文档: `specs/O003-beverage-order/contracts/api.yaml`
