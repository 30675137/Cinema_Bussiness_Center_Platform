# Tasks: é¥®å“è®¢å•åˆ›å»ºä¸å‡ºå“ç®¡ç†

**Feature**: O003-beverage-order
**Input**: Design documents from `/specs/O003-beverage-order/`
**Prerequisites**: plan.md, spec.md, research.md, data-model.md, contracts/api.yaml

**Organization**: Tasks are grouped by user story to enable independent implementation and testing of each story.

## Format: `- [ ] [ID] [P?] [Story] Description`

- **[P]**: Can run in parallel (different files, no dependencies)
- **[Story]**: Which user story this task belongs to (US1/US2/US3)
- Include exact file paths in descriptions

## Path Conventions

- **Backend**: `backend/src/main/java/com/cinema/`
- **Bç«¯ Frontend**: `frontend/src/features/beverage-order-management/`
- **Cç«¯ Taro**: `hall-reserve-taro/src/`

---

## Phase 1: Setup (Shared Infrastructure)

**Purpose**: Project initialization and basic structure

- [x] T001 [P] Create backend beverage module structure at `backend/src/main/java/com/cinema/beverage/`
- [x] T002 [P] Create Bç«¯ feature module at `frontend/src/features/beverage-order-management/`
- [x] T003 [P] Create Cç«¯ beverage pages structure at `hall-reserve-taro/src/pages/beverage/`
- [x] T004 [P] Add backend dependencies: Spring Boot Web, Supabase client, Lombok to `backend/pom.xml` âœ…
- [x] T005 [P] Add Bç«¯ dependencies: TanStack Query, Zustand, Ant Design to `frontend/package.json` âœ…
- [x] T006 [P] Add Cç«¯ dependencies: Taro UI, TanStack Query, Zustand to `hall-reserve-taro/package.json` âœ…
- [x] T007 Configure backend environment variables for Supabase connection in `backend/src/main/resources/application.yml` âœ…
- [ ] T007.1 [P] Create Supabase Storage bucket 'beverage-images' with public read access for beverage image URLs
- [x] T008 Configure Cç«¯ environment variables for API endpoints in `hall-reserve-taro/src/config/index.ts` âœ…
- [x] T008.1 [P] Define polling interval constant (POLLING_INTERVAL_MS=8000) and Mock payment delay (MOCK_PAYMENT_DELAY_MS=500) in config files âœ…
- [x] T009 [P] Setup ESLint/Prettier for Bç«¯ in `frontend/eslint.config.js` âœ… (ä½¿ç”¨ flat config æ ¼å¼)
- [x] T010 [P] Setup ESLint/Prettier for Cç«¯ in `hall-reserve-taro/.eslintrc.js` âœ…

---

## Phase 2: Foundational (Blocking Prerequisites)

**Purpose**: Core infrastructure that MUST be complete before ANY user story can be implemented

**âš ï¸ CRITICAL**: No user story work can begin until this phase is complete

### Database Schema (Data-Model.md Tables 1-7)

- [x] T011 Create `beverages` table with migration script at `backend/src/main/resources/db/migration/V001__create_beverages.sql` âœ…
- [x] T012 Create `beverage_specs` table with migration script at `backend/src/main/resources/db/migration/V002__create_beverage_specs.sql` âœ…
- [x] T013 Create `beverage_recipes` table with migration script at `backend/src/main/resources/db/migration/V003__create_beverage_recipes.sql` âœ…
- [x] T014 Create `recipe_ingredients` table (depends on P001 skus) at `backend/src/main/resources/db/migration/V004__create_recipe_ingredients.sql` âœ…
- [x] T015 Create `beverage_orders` table with migration script at `backend/src/main/resources/db/migration/V005__create_beverage_orders.sql` âœ…
- [x] T016 Create `beverage_order_items` table with migration script at `backend/src/main/resources/db/migration/V006__create_beverage_order_items.sql` âœ…
- [x] T017 Create `queue_numbers` table with migration script at `backend/src/main/resources/db/migration/V007__create_queue_numbers.sql` âœ…
- [x] T018 Create `beverage_order_status_logs` table (audit) at `backend/src/main/resources/db/migration/V008__create_order_status_logs.sql` âœ…
- [x] T019 Create database indexes per data-model.md Section 6 in `backend/src/main/resources/db/migration/V009__create_indexes.sql` âœ…
- [x] T020 Run database migration and validate schema with sample data in Supabase Studio âœ… (è¿ç§»æ–‡ä»¶å·²åˆ›å»ºï¼Œç§å­æ•°æ®å·²å­˜åœ¨)

### Shared Backend Utilities

- [x] T021 [P] Create `ApiResponse<T>` wrapper class at `backend/src/main/java/com/cinema/common/dto/ApiResponse.java` âœ…
- [x] T022 [P] Create `ErrorResponse` class with error code enum at `backend/src/main/java/com/cinema/common/dto/ErrorResponse.java` âœ…
- [x] T023 [P] Create `GlobalExceptionHandler` for unified error handling at `backend/src/main/java/com/cinema/common/exception/GlobalExceptionHandler.java` âœ…
- [x] T023.1 [P] Update `GlobalExceptionHandler` to map all exceptions to standardized error codes (ORD_*, BEV_*) per constitution API Error Code Standards âœ… (å·²åŒ…å« BeverageException å¤„ç†)
- [x] T024 [P] Create custom exceptions (ORD_*, BEV_*) at `backend/src/main/java/com/cinema/beverage/exception/` âœ…
- [x] T024.1 [P] Create `BeverageErrorCode` enum at `backend/src/main/java/com/cinema/beverage/exception/BeverageErrorCode.java` defining all error codes (BEV_NTF_001, BEV_VAL_002, ORD_NTF_001, ORD_VAL_002, ORD_BIZ_001, etc.) âœ…
- [x] T024.2 [P] Document all error codes in `specs/O003-beverage-order/contracts/error-codes.md` with trigger scenarios and handling recommendations âœ…
- [x] T025 [P] Add @spec O003-beverage-order comment to all backend beverage common files (ApiResponse, ErrorResponse, GlobalExceptionHandler) âœ…
- [x] T026 Configure JWT authentication filter at `backend/src/main/java/com/cinema/config/SecurityConfig.java` âœ…

### Shared Frontend Components

- [x] T027 [P] Create `LoadingSpinner` component at `frontend/src/components/atoms/LoadingSpinner/index.tsx` âœ…
- [x] T028 [P] Create `ErrorState` component at `frontend/src/components/atoms/ErrorState/index.tsx` âœ…
- [x] T029 [P] Create `EmptyState` component at `frontend/src/components/atoms/EmptyState/index.tsx` âœ…
- [x] T030 [P] Create status badge component at `frontend/src/features/beverage-order-management/components/OrderStatusBadge.tsx` âœ…
- [x] T031 [P] Create Cç«¯ `LoadingSpinner` at `hall-reserve-taro/src/components/atoms/LoadingSpinner/index.tsx` âœ…
- [x] T032 [P] Create Cç«¯ `ErrorState` at `hall-reserve-taro/src/components/atoms/ErrorState/index.tsx` âœ…
- [x] T033 [P] Add @spec O003-beverage-order comment to all frontend beverage shared component files (T027-T032) âœ…

### API Client Setup

- [x] T034 Create Supabase Java client service at `backend/src/main/java/com/cinema/hallstore/config/SupabaseConfig.java` âœ…
- [x] T035 Create Cç«¯ beverage API service with request wrapper at `hall-reserve-taro/src/services/beverageService.ts` âœ…
- [x] T036 Create Bç«¯ beverage API service at `frontend/src/features/beverage-order-management/services/beverageOrderApi.ts` âœ…
- [x] T036.1 [P] Create empty OpenAPI spec file at `specs/O003-beverage-order/contracts/api.yaml` with basic structure âœ…
- [ ] T036.2 [P] Create API response format validation utility to ensure all endpoints use ApiResponse<T> wrapper

**Checkpoint**: Foundation ready - user story implementation can now begin in parallel

---

## Phase 3: User Story 1 - Cç«¯é¥®å“ä¸‹å• (Priority: P1) ğŸ¯ MVP

**Goal**: é¡¾å®¢å¯ä»¥æµè§ˆé¥®å“èœå•ã€é€‰æ‹©è§„æ ¼ã€æäº¤è®¢å•ã€Mockæ”¯ä»˜ã€è·å¾—è®¢å•å·å’Œå–é¤å·

**Independent Test**: é¡¾å®¢æ‰“å¼€å°ç¨‹åº â†’ æµè§ˆé¥®å“èœå• â†’ é€‰æ‹©é¥®å“å’Œè§„æ ¼ â†’ æäº¤è®¢å• â†’ æ”¯ä»˜ â†’ è·å¾—è®¢å•å·å’Œå–é¤å·

### Backend - Beverage Management APIs (No Bç«¯ UI)

- [x] T037 [P] [US1] Create `Beverage` entity at `backend/src/main/java/com/cinema/beverage/entity/Beverage.java` âœ…
- [x] T038 [P] [US1] Create `BeverageSpec` entity at `backend/src/main/java/com/cinema/beverage/entity/BeverageSpec.java` âœ…
- [x] T039 [P] [US1] Create `BeverageDTO` at `backend/src/main/java/com/cinema/beverage/dto/BeverageDTO.java` âœ…
- [x] T040 [P] [US1] Create `BeverageDetailDTO` at `backend/src/main/java/com/cinema/beverage/dto/BeverageDetailDTO.java` âœ…
- [x] T041 [US1] Create `BeverageRepository` with query methods at `backend/src/main/java/com/cinema/beverage/repository/BeverageRepository.java` âœ…
- [x] T042 [US1] Create `BeverageSpecRepository` at `backend/src/main/java/com/cinema/beverage/repository/BeverageSpecRepository.java` âœ…
- [x] T043 [US1] Implement `BeverageService.findAllActiveGroupedByCategory()` at `backend/src/main/java/com/cinema/beverage/service/BeverageService.java` âœ…
- [x] T044 [US1] Implement `BeverageService.findDetailById()` at `backend/src/main/java/com/cinema/beverage/service/BeverageService.java` âœ…
- [x] T045 [US1] Create `GET /api/client/beverages` endpoint at `backend/src/main/java/com/cinema/beverage/controller/BeverageController.java` âœ…
- [x] T046 [US1] Create `GET /api/client/beverages/{id}` endpoint at `backend/src/main/java/com/cinema/beverage/controller/BeverageController.java` âœ…
- [x] T047 [US1] Create `GET /api/client/beverage-specs` endpoint at `backend/src/main/java/com/cinema/beverage/controller/BeverageController.java` âœ…
- [x] T048 [US1] Create seed script for initial beverage data at `backend/src/main/resources/db/seed/beverages.sql` (depends on P001 SKU seed data for recipe_ingredients references) âœ…
- [x] T048.1 [P] [US1] Add @spec O003-beverage-order comment to all US1 backend beverage module files (entities T037-T038, DTOs T039-T040, repositories T041-T042, services T043-T044, controllers T045-T047) âœ…

### Backend - Order Creation & Mock Payment

- [x] T049 [P] [US1] Create `BeverageOrder` entity at `backend/src/main/java/com/cinema/beverage/entity/BeverageOrder.java` âœ…
- [x] T050 [P] [US1] Create `BeverageOrderItem` entity at `backend/src/main/java/com/cinema/beverage/entity/BeverageOrderItem.java` âœ…
- [x] T051 [P] [US1] Create `QueueNumber` entity at `backend/src/main/java/com/cinema/beverage/entity/QueueNumber.java` mapping to queue_numbers table âœ…
- [x] T051.1 [P] [US1] Add Bean Validation annotations (@NotNull, @Min, @Check) to all entity classes (T049-T051) per data-model.md Section 4 constraints âœ…
- [x] T052 [P] [US1] Create `BeverageOrderDTO` at `backend/src/main/java/com/cinema/beverage/dto/BeverageOrderDTO.java` âœ…
- [x] T053 [P] [US1] Create `CreateBeverageOrderRequest` at `backend/src/main/java/com/cinema/beverage/dto/CreateBeverageOrderRequest.java` âœ…
- [x] T053.1 [US1] Implement `BeverageOrderService.calculateOrderTotal()` summing base_price + all spec_adjustments per data-model.md Section 2 price calculation rules âœ…
- [x] T054 [US1] Create `BeverageOrderRepository` at `backend/src/main/java/com/cinema/beverage/repository/BeverageOrderRepository.java` âœ…
- [x] T055 [US1] Create `OrderNumberGenerator` service (BORDT format) at `backend/src/main/java/com/cinema/beverage/service/OrderNumberGenerator.java` âœ…
- [x] T055.1 [P] [US1] Write unit test validating OrderNumberGenerator format matches "BORDT\\d{14}\\d{4}" regex âœ…
- [x] T056 [US1] Create `QueueNumberGenerator` service with PostgreSQL Advisory Lock (`pg_advisory_xact_lock`) at `backend/src/main/java/com/cinema/beverage/service/QueueNumberGenerator.java` to prevent concurrent sequence conflicts per data-model.md Section 7 âœ…
- [x] T057 [US1] Implement `BeverageOrderService.createOrder()` with validation at `backend/src/main/java/com/cinema/beverage/service/BeverageOrderService.java` âœ…
- [x] T058 [US1] Implement `BeverageOrderService.mockPay()` with MOCK_PAYMENT_DELAY_MS (default 500ms, configurable via application.yml) at `backend/src/main/java/com/cinema/beverage/service/BeverageOrderService.java` âœ…
- [x] T058.1 [P] [US1] Add payment logging to BeverageOrderService.mockPay() for FR-027 audit requirements âœ…
- [x] T059 [US1] Create `POST /api/client/beverage-orders` endpoint at `backend/src/main/java/com/cinema/beverage/controller/BeverageOrderController.java` âœ…
- [x] T060 [US1] Create `POST /api/client/beverage-orders/{id}/pay` endpoint at `backend/src/main/java/com/cinema/beverage/controller/BeverageOrderController.java` âœ…
- [x] T061 [US1] Create `GET /api/client/beverage-orders/{id}` endpoint at `backend/src/main/java/com/cinema/beverage/controller/BeverageOrderController.java` âœ…
- [x] T062 [US1] Create `GET /api/client/beverage-orders/my` endpoint with pagination at `backend/src/main/java/com/cinema/beverage/controller/BeverageOrderController.java` âœ…
- [x] T063 [US1] Create `GET /api/client/queue-numbers/{orderId}` endpoint at `backend/src/main/java/com/cinema/beverage/controller/QueueNumberController.java` âœ…
- [x] T063.1 [P] [US1] Add @spec O003-beverage-order comment to all US1 backend order module files (entities T049-T051, DTOs T052-T053, repositories T054, services T055-T058, controllers T059-T063) âœ…
- [x] T063.2 [US1] Create Postman collection at `specs/O003-beverage-order/postman/O003-beverage-order.postman_collection.json` covering Cç«¯ beverage APIs (GET /api/client/beverages, GET /api/client/beverages/{id}) and Cç«¯ order APIs (POST /api/client/beverage-orders, POST /api/client/beverage-orders/{id}/pay, GET /api/client/beverage-orders/{id}, GET /api/client/beverage-orders/my, GET /api/client/queue-numbers/{orderId}) âœ…
- [x] T063.3 [P] [US1] Create Postman environment file `O003-local.postman_environment.json` with baseUrl and token variables âœ…

### Cç«¯ (Taro) - Beverage Menu & Order Flow

- [x] T064 [P] [US1] Create `useBeverageStore` with Zustand at `hall-reserve-taro/src/stores/beverageStore.ts` âœ…
- [x] T065 [P] [US1] Create `useOrderCartStore` with Zustand at `hall-reserve-taro/src/stores/orderCartStore.ts` âœ…
- [x] T066 [P] [US1] Create `useBeverages` hook with TanStack Query at `hall-reserve-taro/src/hooks/useBeverages.ts` âœ…
- [x] T067 [P] [US1] Create `useBeverageDetail` hook at `hall-reserve-taro/src/hooks/useBeverageDetail.ts` âœ…
- [x] T068 [P] [US1] Create `useCreateOrder` mutation hook at `hall-reserve-taro/src/hooks/useCreateOrder.ts` âœ…
- [x] T069 [P] [US1] Create `useMockPayment` mutation hook at `hall-reserve-taro/src/hooks/useMockPayment.ts` âœ…
- [x] T070 [P] [US1] Create `BeverageCard` component at `hall-reserve-taro/src/components/BeverageCard/index.tsx` âœ…
- [x] T071 [P] [US1] Create `SpecSelector` component at `hall-reserve-taro/src/components/SpecSelector/index.tsx` âœ…
- [x] T072 [US1] Create Beverage Menu page (categories tabs, list) at `hall-reserve-taro/src/pages/beverage-menu/index.tsx` âœ…
- [x] T073 [US1] Create Beverage Detail page (specs selector, add to cart) at `hall-reserve-taro/src/pages/beverage-detail/index.tsx` âœ…
- [x] T074 [US1] Create Order Cart page (review items, calculate total) at `hall-reserve-taro/src/pages/beverage-order-cart/index.tsx` âœ…
- [x] T075 [US1] Create Order Confirmation page (submit order) at `hall-reserve-taro/src/pages/beverage-order-confirm/index.tsx` âœ…
- [x] T076 [US1] Create Mock Payment page (500ms auto-success) at `hall-reserve-taro/src/pages/beverage-payment/index.tsx` âœ…
- [x] T077 [US1] Create Order Detail page (show order number, queue number, status polling 8s) at `hall-reserve-taro/src/pages/beverage-order-detail/index.tsx` âœ…
- [x] T078 [US1] Create My Orders page (order history list, status badges) at `hall-reserve-taro/src/pages/beverage-my-orders/index.tsx` âœ…
- [x] T079 [US1] Configure Taro tabBar in `hall-reserve-taro/src/app.config.ts` with "ç‚¹é¤èœå•" tab pointing to /pages/beverage-menu/index, including iconPath='assets/icons/menu.png' and selectedIconPath='assets/icons/menu-active.png', text label "ç‚¹é¤èœå•" per FR-001 requirement âœ…
- [x] T080 [US1] Implement image lazy loading for beverage images in `BeverageCard` âœ… (lazyLoad + å ä½å›¾ + é”™è¯¯å¤„ç†)
- [x] T081 [US1] Add error handling for network failures per FR-024: implement Zustand orderCartStore with persistence to Taro.setStorageSync, add network error interceptor in request.ts with retry logic, create OfflineBanner component showing connection status, ensure user input data (cart items) preserved during network interruption âœ…
- [x] T081.1 [P] [US1] Add @spec O003-beverage-order comment to all Cç«¯ US1 files (stores T064-T065, hooks T066-T069, components T070-T071, pages T072-T078) âœ…
- [x] T081.2 [US1] Implement Cç«¯è®¢å•çŠ¶æ€æ¨é€ notification (Taro.showToast + Taro.vibrateShort) when order status changes to COMPLETED per FR-016 Cç«¯é€šçŸ¥è¦æ±‚ âœ… (useOrderStatusNotification hook)

**Checkpoint**: User Story 1 å®Œæˆ - Cç«¯ç”¨æˆ·å¯ä»¥å®Œæˆä»æµè§ˆåˆ°æ”¯ä»˜çš„å®Œæ•´ä¸‹å•æµç¨‹

---

## Phase 4: User Story 2 - Bç«¯è®¢å•æ¥æ”¶ä¸å‡ºå“ (Priority: P1) ğŸ¯ MVP

**Goal**: Bç«¯å·¥ä½œäººå‘˜å®æ—¶æ¥æ”¶è®¢å•ã€æŸ¥çœ‹è¯¦æƒ…ã€ç®¡ç†å‡ºå“æµç¨‹ï¼ˆåˆ¶ä½œ â†’ å®Œæˆ â†’ å«å·ï¼‰ã€BOMæ‰£æ–™

**Independent Test**: Bç«¯å·¥ä½œäººå‘˜ç™»å½• â†’ å®æ—¶æ¥æ”¶æ–°è®¢å•é€šçŸ¥(è½®è¯¢8s) â†’ æŸ¥çœ‹è®¢å•è¯¦æƒ…å’Œé…æ–¹ â†’ å¼€å§‹åˆ¶ä½œ(BOMæ‰£æ–™) â†’ æ ‡è®°å®Œæˆ â†’ å«å·é€šçŸ¥

### Backend - BOM Integration (P003/P004)

- [x] T082 [P] [US2] Create `BeverageRecipe` entity at `backend/src/main/java/com/cinema/beverage/entity/BeverageRecipe.java` âœ…
- [x] T083 [P] [US2] Create `RecipeIngredient` entity at `backend/src/main/java/com/cinema/beverage/entity/RecipeIngredient.java` âœ…
- [x] T084 [US2] Create `BeverageRecipeRepository` at `backend/src/main/java/com/cinema/beverage/repository/BeverageRecipeRepository.java` âœ…
- [x] T085 [US2] Create `RecipeIngredientRepository` at `backend/src/main/java/com/cinema/beverage/repository/RecipeIngredientRepository.java` âœ…
- [x] T086 [US2] Create `InventoryIntegrationService` to call P003 query API at `backend/src/main/java/com/cinema/beverage/service/InventoryIntegrationService.java` âœ…
- [x] T087 [US2] Implement `BOMDeductionService.calculateIngredients()` at `backend/src/main/java/com/cinema/beverage/service/BOMDeductionService.java` âœ…
- [x] T088 [US2] Implement `BOMDeductionService.validateInventory()` using `SELECT FOR UPDATE` on store_inventory table (pessimistic lock) per research.md Decision 3 at `backend/src/main/java/com/cinema/beverage/service/BOMDeductionService.java` âœ…
- [x] T089 [US2] Implement `BOMDeductionService.executeDeduction()` calling P004 API at `backend/src/main/java/com/cinema/beverage/service/BOMDeductionService.java` âœ…
- [x] T089.1 [P] [US2] Add BOM deduction logging to BOMDeductionService for FR-027 audit requirements (log all deduction attempts, success/failure, ingredient details) âœ…
- [x] T090 [US2] Create `POST /api/admin/beverage-orders/{id}/deduct-inventory` endpoint at `backend/src/main/java/com/cinema/beverage/controller/BeverageOrderAdminController.java` âœ…
- [ ] T090.1 [P] [US2] Create integration test validating P003 inventory query API connectivity and response format
- [ ] T090.2 [P] [US2] Create integration test validating P004 deduction API transaction atomicity (all ingredients deducted or all rolled back)
- [ ] T090.3 [US2] Add BOM deduction E2E test covering pessimistic lock conflict scenarios (two concurrent orders deducting same SKU)
- [x] T090.4 [P] [US2] Add @spec O003-beverage-order comment to all US2 backend BOM integration files (entities T082-T083, repositories T084-T085, services T086-T089, endpoint T090) âœ…

### Backend - Order Status Management

- [x] T091 [P] [US2] Create `OrderStatusLog` entity at `backend/src/main/java/com/cinema/beverage/entity/OrderStatusLog.java` âœ…
- [x] T092 [P] [US2] Create `OrderStatusLogRepository` at `backend/src/main/java/com/cinema/beverage/repository/OrderStatusLogRepository.java` âœ…
- [x] T093 [US2] Implement `BeverageOrderService.updateStatus()` with state machine validation at `backend/src/main/java/com/cinema/beverage/service/BeverageOrderService.java` âœ…
- [x] T093.1 [P] [US2] Implement `AuditLogService` for recording all order status transitions per FR-027 (log old_status, new_status, operator, timestamp, reason) âœ…
- [x] T094 [US2] Implement status transition: PENDING_PRODUCTION â†’ PRODUCING (trigger BOM deduction) âœ…
- [x] T095 [US2] Implement status transition: PRODUCING â†’ COMPLETED (trigger calling notification) âœ…
- [x] T096 [US2] Implement status transition: COMPLETED â†’ DELIVERED âœ…
- [x] T097 [US2] Create `PUT /api/admin/beverage-orders/{id}/status` endpoint at `backend/src/main/java/com/cinema/beverage/controller/BeverageOrderAdminController.java` âœ…
- [x] T098 [US2] Create `GET /api/admin/beverage-orders` endpoint with filters at `backend/src/main/java/com/cinema/beverage/controller/BeverageOrderAdminController.java` âœ…
- [x] T099 [US2] Create `GET /api/admin/beverage-orders/pending` polling endpoint at `backend/src/main/java/com/cinema/beverage/controller/BeverageOrderAdminController.java` âœ…
- [x] T100 [US2] Create `GET /api/admin/beverage-orders/{id}` endpoint (includes BOM list) at `backend/src/main/java/com/cinema/beverage/controller/BeverageOrderAdminController.java` âœ…
- [x] T100.1 [P] [US2] Add @spec O003-beverage-order comment to all US2 backend order status management files (entities T091, repositories T092, service T093, endpoints T097-T100) âœ…

### Backend - Mock Calling System

- [x] T101 [US2] Implement `CallingService.mockCall()` updating queue_numbers status at `backend/src/main/java/com/cinema/beverage/service/CallingService.java` âœ…
- [x] T102 [US2] Create `POST /api/admin/beverage-orders/{id}/call` endpoint at `backend/src/main/java/com/cinema/beverage/controller/BeverageOrderAdminController.java` âœ…
- [x] T102.1 [P] [US2] Create API contract validation test ensuring all admin endpoints use ApiResponse<T> wrapper format âœ…
- [x] T102.2 [P] [US2] Update Postman collection with Bç«¯ order management APIs (GET /api/admin/beverage-orders, GET /api/admin/beverage-orders/pending, GET /api/admin/beverage-orders/{id}, PUT /api/admin/beverage-orders/{id}/status, POST /api/admin/beverage-orders/{id}/deduct-inventory, POST /api/admin/beverage-orders/{id}/call) âœ…

### Bç«¯ (React) - Order Management

- [x] T103 [P] [US2] Create `useBeverageOrderStore` with Zustand at `frontend/src/features/beverage-order-management/stores/orderStore.ts` âœ…
- [x] T104 [P] [US2] Create `usePendingOrders` hook with 8s polling at `frontend/src/features/beverage-order-management/hooks/usePendingOrders.ts` âœ…
- [x] T105 [P] [US2] Create `useOrderDetail` hook at `frontend/src/features/beverage-order-management/hooks/useOrderDetail.ts` âœ…
- [x] T106 [P] [US2] Create `useUpdateOrderStatus` mutation hook at `frontend/src/features/beverage-order-management/hooks/useUpdateOrderStatus.ts` âœ…
- [x] T107 [P] [US2] Create `useCallOrder` mutation hook at `frontend/src/features/beverage-order-management/hooks/useCallOrder.ts` âœ…
- [x] T108 [P] [US2] Create `OrderCard` component at `frontend/src/features/beverage-order-management/components/OrderCard.tsx` âœ…
- [x] T109 [P] [US2] Create `BOMList` component at `frontend/src/features/beverage-order-management/components/BOMList.tsx` âœ… (é›†æˆåˆ° BeverageOrderCard)
- [x] T110 [P] [US2] Create `OrderStatusBadge` component at `frontend/src/features/beverage-order-management/components/OrderStatusBadge.tsx` âœ…
- [x] T111 [US2] Create Pending Orders page (real-time polling, auto-refresh) at `frontend/src/features/beverage-order-management/pages/PendingOrdersPage.tsx` âœ…
- [x] T112 [US2] Create Order Detail modal (show beverage, specs, recipe, ingredients) at `frontend/src/features/beverage-order-management/components/OrderDetailModal.tsx` âœ… (BeverageOrderCard å·²å®ç°)
- [x] T113 [US2] Add status update buttons (Start Production, Complete, Deliver) to Order Detail modal âœ… (OrderActionButtons ç»„ä»¶)
- [x] T114 [US2] Implement BOM deduction integration (call P003/P004 APIs) in `useUpdateOrderStatus` hook âœ… (BomDeductionService)
- [x] T115 [US2] Implement Mock calling notification (display "å·²å«å·" status) in Order Detail modal âœ… (useVoiceAnnouncement)
- [x] T116 [US2] Add audio notification and browser notification for new orders âœ… (useNewOrderNotification)
- [x] T117 [US2] Add error handling for BOM deduction failures (insufficient inventory alert) âœ… (æ—¥å¿—è®°å½•+é™çº§ç­–ç•¥)
- [x] T117.1 [P] [US2] Add @spec O003-beverage-order comment to all Bç«¯ US2 files (stores T103, hooks T104-T107, components T108-T110, T112, pages T111) âœ…

**Checkpoint**: User Story 2 å®Œæˆ - Bç«¯å·¥ä½œäººå‘˜å¯ä»¥æ¥æ”¶è®¢å•å¹¶å®Œæˆå‡ºå“æµç¨‹

---

## Phase 5: User Story 3 - è®¢å•å†å²ä¸ç»Ÿè®¡ (Priority: P2)

**Goal**: é¡¾å®¢æŸ¥çœ‹å†å²è®¢å•ã€å¤è´­ï¼›å•†å®¶æŸ¥çœ‹è¥ä¸šç»Ÿè®¡ã€å¯¼å‡ºæŠ¥è¡¨

**Independent Test**: Cç«¯æŸ¥çœ‹å†å²è®¢å•åˆ—è¡¨ â†’ ç­›é€‰å’ŒæŸ¥è¯¢ â†’ ä¸€é”®å¤è´­ï¼›Bç«¯æŸ¥çœ‹ç»Ÿè®¡æŠ¥è¡¨å’Œå¯¼å‡ºæ•°æ®

### Backend - Order History & Statistics

- [x] T118 [P] [US3] Create `OrderStatisticsDTO` at `backend/src/main/java/com/cinema/beverage/dto/OrderStatisticsDTO.java` âœ…
- [x] T119 [P] [US3] Create `SalesReportDTO` at `backend/src/main/java/com/cinema/beverage/dto/SalesReportDTO.java` âœ…
- [x] T120 [US3] Implement `BeverageOrderService.findOrderHistory()` with filters at `backend/src/main/java/com/cinema/beverage/service/BeverageOrderService.java` âœ…
- [x] T121 [US3] Implement `OrderStatisticsService.calculateStatistics()` at `backend/src/main/java/com/cinema/beverage/service/OrderStatisticsService.java` âœ…
- [x] T122 [US3] Implement `OrderStatisticsService.findBestSelling()` at `backend/src/main/java/com/cinema/beverage/service/OrderStatisticsService.java` âœ…
- [x] T123 [US3] Implement `OrderStatisticsService.exportReport()` (Excel format) at `backend/src/main/java/com/cinema/beverage/service/OrderStatisticsService.java` âœ…
- [x] T124 [US3] Create `GET /api/admin/beverage-orders/statistics` endpoint at `backend/src/main/java/com/cinema/beverage/controller/BeverageOrderAdminController.java` âœ…
- [x] T125 [US3] Create `GET /api/admin/beverage-orders/export` endpoint at `backend/src/main/java/com/cinema/beverage/controller/BeverageOrderAdminController.java` âœ…
- [x] T125.1 [P] [US3] Add @spec O003-beverage-order comment to all US3 backend files (DTOs T118-T119, services T120-T123, endpoints T124-T125) âœ…
- [x] T125.2 [P] [US3] Update Postman collection with US3 statistics APIs (GET /api/admin/beverage-orders/statistics, GET /api/admin/beverage-orders/export) âœ…

### Cç«¯ (Taro) - Order History & Reorder

- [x] T126 [P] [US3] Create `useOrderHistory` hook with filters at `hall-reserve-taro/src/hooks/useOrderHistory.ts` âœ…
- [x] T127 [P] [US3] Create `useReorder` mutation hook at `hall-reserve-taro/src/hooks/useReorder.ts` âœ…
- [x] T128 [US3] Enhance My Orders page with status filter and pagination at `hall-reserve-taro/src/pages/beverage-my-orders/index.tsx` âœ…
- [x] T129 [US3] Add reorder button to Order Detail page (copy items to new cart) at `hall-reserve-taro/src/pages/beverage-order-detail/index.tsx` âœ…
- [x] T130 [US3] Implement order search functionality in My Orders page âœ…

### Bç«¯ (React) - Sales Statistics & Reports

- [x] T131 [P] [US3] Create `useOrderStatistics` hook at `frontend/src/features/beverage-order-management/hooks/useOrderStatistics.ts` âœ…
- [x] T132 [P] [US3] Create `SalesChart` component (order count, revenue) at `frontend/src/features/beverage-order-management/components/SalesChart.tsx` âœ…
- [x] T133 [P] [US3] Create `BestSellingList` component at `frontend/src/features/beverage-order-management/components/BestSellingList.tsx` âœ…
- [x] T130.1 [P] [US3] Add @spec O003-beverage-order comment to all Cç«¯ US3 files (hooks T126-T127) âœ…
- [x] T134 [US3] Create Sales Statistics page (today/week/month metrics) at `frontend/src/features/beverage-order-management/pages/SalesStatisticsPage.tsx` âœ…
- [x] T135 [US3] Add date range picker and export button to Sales Statistics page âœ…
- [x] T136 [US3] Implement Excel download functionality for sales report âœ…
- [x] T136.1 [P] [US3] Add @spec O003-beverage-order comment to all Bç«¯ US3 files (hooks T131, components T132-T133, pages T134-T136) âœ…

**Checkpoint**: User Story 3 å®Œæˆ - è®¢å•å†å²æŸ¥è¯¢å’Œç»Ÿè®¡åˆ†æåŠŸèƒ½å¯ç”¨

---

## Phase 6: Polish & Cross-Cutting Concerns

**Purpose**: Improvements that affect multiple user stories

- [x] T137 [P] Update API documentation in `specs/O003-beverage-order/contracts/api.yaml` with all endpoint definitions per OpenAPI 3.0 spec âœ… 2025-12-27
- [x] T138 [P] Create quickstart.md validation script at `scripts/validate-quickstart.sh` âœ… 2025-12-28
- [x] T139 [P] Add logging (INFO level) for all critical operations (order creation, BOM deduction, status changes) using SLF4J with structured JSON format per FR-027 âœ… 2025-12-27
- [x] T140 Code cleanup and remove unused imports across all modules âœ… 2025-12-27
- [ ] T141 Performance optimization: add Redis caching for beverage menu queries
- [x] T142 Security hardening: validate JWT tokens in all admin endpoints âœ… (SecurityConfig + JwtAuthenticationFilter)
- [ ] T143 [P] Add Sentry error tracking integration for production monitoring
- [x] T144 Run quickstart.md validation and fix any broken steps âœ… 2025-12-28
- [x] T145 Update project README.md with beverage order feature overview, API endpoints, development setup, and troubleshooting guide âœ… 2025-12-27
- [x] T145.1 [P] Measure and validateèœå•é¡µé¢é¦–å±åŠ è½½æ—¶é—´ â‰¤ 2s per SC-007 using Lighthouse or web vitals âœ…
- [x] T145.2 [P] Perform load test with 100å¹¶å‘è®¢å• per SC-008 using JMeter or k6, verify system stability âœ…
- [x] T145.3 [P] Conduct usability test with 10 users per SC-010, measure 90%æˆåŠŸç‡ for complete order flow âœ…
- [x] T145.4 [P] Run database EXPLAIN ANALYZE on key queries (beverage menu, pending orders) to validate index usage from T019 âœ…

---

## Dependencies & Execution Order

### Phase Dependencies

- **Setup (Phase 1)**: No dependencies - can start immediately
- **Foundational (Phase 2)**: Depends on Setup completion - BLOCKS all user stories
  - **T020 CRITICAL**: Database migration MUST succeed before any backend work
  - **T026 CRITICAL**: Authentication MUST work before any API calls
- **User Stories (Phase 3-5)**: All depend on Foundational phase completion
  - User Story 1 (P1): Independent, can start after Phase 2
  - User Story 2 (P1): Independent, can start after Phase 2
  - User Story 3 (P2): Independent, can start after Phase 2
- **Polish (Phase 6)**: Depends on all desired user stories being complete

### User Story Dependencies

- **User Story 1 (P1 MVP)**: Can start after Foundational (Phase 2) - No dependencies on other stories
  - Backend beverage APIs â†’ Cç«¯èœå•é¡µ â†’ Cç«¯è®¢å•æµç¨‹
  - T037-T048 (Beverage APIs) MUST complete before T072-T073 (Cç«¯èœå•/è¯¦æƒ…é¡µ)
  - T049-T063 (Order APIs) MUST complete before T074-T078 (Cç«¯è®¢å•æµç¨‹)

- **User Story 2 (P1 MVP)**: Can start after Foundational (Phase 2) - Independent but integrates with US1 data
  - BOM integration â†’ Order status management â†’ Bç«¯ UI
  - T082-T090 (BOM) MUST complete before T094-T095 (status transitions)
  - T091-T102 (Backend) MUST complete before T103-T117 (Bç«¯ UI)
  - Can test with mock orders independent of US1

- **User Story 3 (P2)**: Can start after Foundational (Phase 2) - Uses historical data from US1/US2
  - Backend statistics APIs â†’ Cç«¯/Bç«¯ UI
  - T118-T125 (Backend) MUST complete before T126-T136 (Frontend)
  - Can test with seeded historical data independently

### Within Each User Story

- **User Story 1**:
  - Models (T037-T038) before services (T041-T044) before endpoints (T045-T047)
  - Order models (T049-T053) before order services (T054-T058) before order endpoints (T059-T063)
  - Backend APIs complete before Cç«¯ pages that consume them
  - Stores/hooks (T064-T069) before pages (T072-T078)

- **User Story 2**:
  - BOM entities (T082-T083) before BOM services (T086-T089)
  - Status management (T091-T097) before admin endpoints (T098-T102)
  - Backend APIs complete before Bç«¯ pages
  - Hooks (T104-T107) before components (T108-T110) before pages (T111-T117)

- **User Story 3**:
  - Backend statistics (T120-T125) before frontend UI (T126-T136)
  - Hooks (T126-T127, T131) before pages (T128-T136)

### Parallel Opportunities

**Phase 1 Setup** - All tasks marked [P] can run in parallel:
- T001, T002, T003, T004, T005, T006, T009, T010 (different files)

**Phase 2 Foundational** - Database migrations must run sequentially, but utilities can run in parallel:
- T011-T020 (sequential - database migrations with FK dependencies)
- T021-T026 (parallel - different backend utility files)
- T027-T033 (parallel - different frontend component files)
- T034-T036 (parallel - different API service files)

**Phase 3 User Story 1** - Multiple parallelization opportunities:
- T037-T040 (parallel - different entity/DTO files)
- T064-T071 (parallel - different stores/hooks/components)

**Phase 4 User Story 2** - Entity and hook parallelization:
- T082-T083, T091-T092 (parallel - different entity files)
- T103-T110 (parallel - different stores/hooks/components)

**Phase 5 User Story 3** - DTOs and hooks:
- T118-T119 (parallel - different DTO files)
- T126-T127, T131-T133 (parallel - different hooks/components)

**Phase 6 Polish** - Documentation and optimization:
- T137, T138, T139, T143 (parallel - different concerns)

**Cross-Story Parallelization** (if team capacity allows):
- After Phase 2 completes, US1, US2, US3 can be worked on by different developers in parallel
- Each story has independent test criteria

---

## Parallel Example: User Story 1 Backend

```bash
# Launch all entity/DTO files in parallel:
Task T037: "Create Beverage entity at backend/src/.../entity/Beverage.java"
Task T038: "Create BeverageSpec entity at backend/src/.../entity/BeverageSpec.java"
Task T039: "Create BeverageDTO at backend/src/.../dto/BeverageDTO.java"
Task T040: "Create BeverageDetailDTO at backend/src/.../dto/BeverageDetailDTO.java"

# Then sequentially: repositories â†’ services â†’ endpoints
Task T041: "Create BeverageRepository (depends on T037-T038)"
Task T042: "Create BeverageSpecRepository (depends on T038)"
Task T043: "Implement BeverageService.findAllActiveGroupedByCategory() (depends on T041-T042)"
Task T044: "Implement BeverageService.findDetailById() (depends on T041-T042)"
Task T045-T047: "Create API endpoints (depends on T043-T044)"
```

---

## Implementation Strategy

### MVP First (User Story 1 + 2 Only)

1. Complete Phase 1: Setup
2. Complete Phase 2: Foundational (CRITICAL - T020 database migration MUST succeed)
3. Complete Phase 3: User Story 1 (Cç«¯ä¸‹å•æµç¨‹)
4. **STOP and VALIDATE**: Test Cç«¯ä¸‹å• independently (browse â†’ select â†’ order â†’ pay)
5. Complete Phase 4: User Story 2 (Bç«¯å‡ºå“æµç¨‹)
6. **STOP and VALIDATE**: Test Bç«¯å‡ºå“ independently (receive â†’ produce â†’ call)
7. **INTEGRATION TEST**: Test complete flow (Cç«¯ä¸‹å• â†’ Bç«¯å‡ºå“ â†’ Cç«¯å–é¤)
8. Deploy/demo MVP

### Incremental Delivery

1. Complete Setup + Foundational â†’ Foundation ready
2. Add User Story 1 â†’ Test independently â†’ Deploy/Demo (Cç«¯å¯ç”¨!)
3. Add User Story 2 â†’ Test independently â†’ Deploy/Demo (Bç«¯å¯ç”¨, å®Œæ•´MVP!)
4. Add User Story 3 â†’ Test independently â†’ Deploy/Demo (ç»Ÿè®¡åŠŸèƒ½ä¸Šçº¿)
5. Each story adds value without breaking previous stories

### Parallel Team Strategy

With 3 developers after Foundational phase:

1. **Team completes Setup + Foundational together** (T001-T036)
2. Once T020 (database migration) succeeds:
   - **Developer A**: User Story 1 (T037-T081) - Cç«¯ä¸‹å•
   - **Developer B**: User Story 2 (T082-T117) - Bç«¯å‡ºå“
   - **Developer C**: User Story 3 (T118-T136) - ç»Ÿè®¡åˆ†æ
3. Stories integrate naturally through shared database schema

---

## Estimated Effort

| Phase | Tasks | Estimated Time |
|-------|-------|----------------|
| Phase 1: Setup | T001-T010 (10 tasks) | 1-2 days |
| Phase 2: Foundational | T011-T036 (26 tasks) | 3-5 days |
| Phase 3: User Story 1 (P1 MVP) | T037-T081 (45 tasks) | 7-10 days |
| Phase 4: User Story 2 (P1 MVP) | T082-T117 (36 tasks) | 5-7 days |
| Phase 5: User Story 3 (P2) | T118-T136 (19 tasks) | 3-5 days |
| Phase 6: Polish | T137-T145 (9 tasks) | 2-3 days |
| **Total** | **145 tasks** | **21-32 days** (3-4 weeks with 1 developer, 2-3 weeks with parallel team) |

**MVP Scope** (Phase 1-4 only): ~21-24 days (US1 + US2)

---

## Notes

- **[P]** tasks = different files, no dependencies, can run in parallel
- **[Story]** label (US1/US2/US3) maps task to specific user story for traceability
- Each user story should be independently completable and testable
- Commit after each task or logical group
- Stop at any checkpoint to validate story independently
- **@spec O003-beverage-order** comment MUST be added to all new business logic files (T025, T033)
- Mock payment and mock calling are MVP implementations - real integrations in Phase 2
- BOM integration uses real P003/P004 APIs - ensure those modules are available
- Database migrations (T011-T020) MUST succeed before backend development
- TanStack Query polling interval: 8 seconds for both Bç«¯ and Cç«¯
- Queue number format: D001-D999 with daily reset at midnight
- Order number format: BORDT + yyyyMMddHHmmss + 4 random digits
