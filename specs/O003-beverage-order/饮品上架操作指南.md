# 饮品上架操作指南

**示例**: 上架"可口可乐"

---

## 前置条件

- 已有 Supabase 数据库访问权限
- 数据库中已存在 `beverages` 和 `beverage_specs` 表

---

## 步骤一：添加饮品

打开 Supabase SQL Editor，执行：

```sql
INSERT INTO beverages (
  id,
  name,
  description,
  category,
  image_url,
  base_price,
  status,
  is_recommended,
  sort_order,
  created_at,
  updated_at
) VALUES (
  gen_random_uuid(),
  '可口可乐',
  '经典可乐，冰爽畅快',
  'OTHER',
  NULL,
  8.00,
  'ACTIVE',
  false,
  50,
  NOW(),
  NOW()
) RETURNING id, name;
```

**记录返回的 ID**，例如：`a1b2c3d4-xxxx-xxxx-xxxx-xxxxxxxxxxxx`

---

## 步骤二：添加规格

用步骤一返回的 ID 替换下方 `'你的饮品ID'`：

```sql
-- 容量规格
INSERT INTO beverage_specs (id, beverage_id, spec_type, spec_name, price_adjustment, sort_order, is_default)
VALUES
  (gen_random_uuid(), '你的饮品ID', 'SIZE', '330ml罐装', 0.00, 1, true),
  (gen_random_uuid(), '你的饮品ID', 'SIZE', '500ml瓶装', 3.00, 2, false);

-- 温度规格
INSERT INTO beverage_specs (id, beverage_id, spec_type, spec_name, price_adjustment, sort_order, is_default)
VALUES
  (gen_random_uuid(), '你的饮品ID', 'TEMPERATURE', '冰', 0.00, 1, true),
  (gen_random_uuid(), '你的饮品ID', 'TEMPERATURE', '常温', 0.00, 2, false);
```

---

## 步骤三：验证数据

```sql
-- 检查饮品是否上架成功
SELECT id, name, category, base_price, status 
FROM beverages 
WHERE name = '可口可乐';

-- 检查规格是否配置正确
SELECT b.name, s.spec_type, s.spec_name, s.price_adjustment, s.is_default
FROM beverages b
JOIN beverage_specs s ON b.id = s.beverage_id
WHERE b.name = '可口可乐'
ORDER BY s.spec_type, s.sort_order;
```

预期结果：
- 饮品状态为 `ACTIVE`
- 有 2 个容量规格 + 2 个温度规格

---

## 步骤四：刷新小程序

1. 重启后端（如已运行）
2. 微信开发者工具 → 点击"编译"刷新小程序
3. 进入"饮品"页面，应能看到"可口可乐"

---

## 常见问题

### Q: 看不到新上架的饮品？
检查：
```sql
SELECT status FROM beverages WHERE name = '可口可乐';
-- 确保是 'ACTIVE'
```

### Q: 规格没有显示？
检查：
```sql
SELECT COUNT(*) FROM beverage_specs 
WHERE beverage_id = '你的饮品ID';
-- 至少应有 1 条记录
```

### Q: 想要更换图片？
```sql
UPDATE beverages 
SET image_url = 'https://你的图片URL.jpg',
    updated_at = NOW()
WHERE name = '可口可乐';
```

---

## 字段速查

### beverages 表

| 字段 | 说明 | 示例值 |
|-----|------|-------|
| name | 饮品名称 | 可口可乐 |
| description | 描述 | 经典可乐 |
| category | 分类 | COFFEE/TEA/JUICE/SMOOTHIE/MILK_TEA/OTHER |
| image_url | 图片URL | https://xxx.jpg |
| base_price | 基础价格 | 8.00 |
| status | 状态 | ACTIVE/INACTIVE/OUT_OF_STOCK |
| is_recommended | 推荐 | true/false |
| sort_order | 排序 | 数字越大越靠前 |

### beverage_specs 表

| 字段 | 说明 | 示例值 |
|-----|------|-------|
| beverage_id | 饮品ID | UUID |
| spec_type | 规格类型 | SIZE/TEMPERATURE/SWEETNESS/TOPPING |
| spec_name | 规格名称 | 330ml/冰/半糖 |
| price_adjustment | 加价 | 3.00 |
| is_default | 默认选中 | true/false |
| sort_order | 排序 | 数字越小越靠前 |
