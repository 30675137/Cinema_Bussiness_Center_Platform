# Feature Specification: 门店SKU库存查询

**Feature Branch**: `P003-inventory-query`
**Created**: 2025-12-26
**Status**: Draft
**Input**: 店长查看门店SKU库存数量、搜索、筛选、查看详情功能

<!--
  规格编号格式说明 (Spec ID Format):
  P003 - P=商品/库存模块, 002=模块内编号
-->

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 查看门店库存列表 (Priority: P0) [INV-001]

作为店长，我希望能够查看门店所有SKU的当前库存数量，以便掌握库存状态。

**Why this priority**: 这是库存管理的核心功能，店长必须能够看到库存才能进行日常运营决策。没有这个功能，其他功能都没有意义。

**Independent Test**: 店长登录后进入库存页面，能够看到当前门店的SKU库存列表，列表显示SKU编码、名称、现存数量、可用数量、预占数量、库存状态标签、单位，支持分页加载。

**Acceptance Scenarios**:

1. **Given** 店长已登录系统并有门店权限，**When** 进入库存查询页面，**Then** 系统显示当前门店的SKU库存列表，包含SKU编码、名称、现存数量、可用数量、预占数量、库存状态、单位列
2. **Given** 库存列表已加载，**When** 数据超过单页显示量，**Then** 系统提供分页功能，用户可以翻页查看更多数据
3. **Given** 用户请求加载库存列表，**When** 系统处理请求，**Then** 列表在2秒内加载完成
4. **Given** 门店没有任何SKU库存，**When** 进入库存查询页面，**Then** 显示空状态提示"暂无库存数据"

---

### User Story 2 - 搜索库存 (Priority: P0) [INV-002]

作为店长，我希望能够按SKU名称/编码搜索库存，以便快速定位商品。

**Why this priority**: 当SKU数量较多时，搜索是快速定位商品的必要功能，直接影响工作效率。

**Independent Test**: 在库存列表页面输入搜索关键词，列表实时筛选显示匹配的SKU。

**Acceptance Scenarios**:

1. **Given** 库存列表已加载，**When** 用户在搜索框输入关键词，**Then** 列表实时筛选显示名称或编码包含该关键词的SKU
2. **Given** 用户输入搜索关键词"威"，**When** 系统执行搜索，**Then** 显示名称包含"威"的SKU（如"威士忌"、"威化饼干"）
3. **Given** 用户输入搜索关键词，**When** 没有匹配的SKU，**Then** 显示空状态提示"未找到匹配的库存"
4. **Given** 用户已输入搜索关键词，**When** 清空搜索框，**Then** 恢复显示完整库存列表

---

### User Story 3 - 多维度筛选库存 (Priority: P0) [INV-003]

作为店长，我希望能够按门店、库存状态、商品分类筛选库存，以便快速定位需要关注的商品。

**Why this priority**: 多门店场景下，店长需要快速切换查看不同门店的库存情况，并能按状态筛选出需要补货的商品。

**Independent Test**: 选择门店、库存状态、商品分类筛选条件，列表自动刷新显示符合条件的库存。

**Acceptance Scenarios**:

1. **Given** 库存列表页面加载完成，**When** 查看门店筛选器，**Then** 默认选中当前登录用户所属门店
2. **Given** 用户有多门店查看权限，**When** 点击门店下拉筛选，**Then** 显示用户有权限访问的门店列表
3. **Given** 用户选择了不同门店，**When** 确认选择，**Then** 库存列表自动刷新显示所选门店的数据
4. **Given** 用户只有单门店权限，**When** 查看门店筛选器，**Then** 筛选器显示该门店且不可切换
5. **Given** 库存列表已加载，**When** 选择库存状态筛选"不足"和"缺货"，**Then** 列表仅显示状态为不足或缺货的SKU
6. **Given** 库存列表已加载，**When** 选择商品分类"酒水饮料"，**Then** 列表仅显示该分类下的SKU库存
7. **Given** 用户同时设置了门店、状态、分类筛选，**When** 查看列表，**Then** 显示满足所有筛选条件的SKU（交集）
8. **Given** 用户已设置筛选条件，**When** 点击"重置"按钮，**Then** 所有筛选条件恢复默认值

---

### User Story 4 - 查看库存详情 (Priority: P1) [INV-004]

作为店长，我希望能够查看单个SKU的库存详情，以便了解完整信息。

**Why this priority**: 详情查看是补充功能，列表信息足够日常使用，详情提供更全面的信息支持深入分析。

**Independent Test**: 点击库存列表中的某一行，展开或打开抽屉显示该SKU的详细库存信息。

**Acceptance Scenarios**:

1. **Given** 库存列表已加载，**When** 点击某SKU行，**Then** 展开行内详情或打开侧边抽屉显示详细信息
2. **Given** SKU详情已展开，**When** 查看详情内容，**Then** 显示现存数量、可用数量、预占数量、库存单位、最后更新时间、安全库存阈值
3. **Given** SKU详情已展开，**When** 点击关闭或点击其他行，**Then** 详情收起或切换到其他SKU详情
4. **Given** SKU设置了安全库存阈值，**When** 当前库存低于阈值，**Then** 详情中以醒目方式提示库存不足
5. **Given** SKU库存状态为"缺货"，**When** 查看列表，**Then** 库存状态列显示红色"缺货"标签
6. **Given** SKU可用库存充足，**When** 查看列表，**Then** 库存状态列显示绿色"充足"标签

---

### Edge Cases

- **空库存**：门店没有任何SKU库存时，显示友好的空状态提示
- **搜索无结果**：搜索关键词无匹配时，显示"未找到匹配的库存"
- **网络异常**：加载数据失败时，显示错误提示并提供重试按钮
- **权限不足**：用户没有门店查看权限时，显示权限不足提示
- **大数据量**：当SKU数量超过1000条时，分页加载确保性能
- **特殊字符搜索**：搜索关键词包含特殊字符时，正常处理不报错

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须显示库存列表，包含SKU编码、SKU名称、现存数量、可用数量、预占数量、库存状态、库存单位七列
- **FR-002**: 系统必须支持分页加载库存列表，每页默认显示20条记录
- **FR-003**: 系统必须在2秒内完成库存列表加载
- **FR-004**: 系统必须提供搜索功能，支持按SKU名称或编码进行模糊匹配
- **FR-005**: 系统必须在用户输入时实时筛选列表（输入防抖300ms）
- **FR-006**: 系统必须提供门店筛选功能，以下拉单选形式展示
- **FR-007**: 系统必须默认选中当前登录用户所属门店
- **FR-008**: 系统必须在切换筛选条件后自动刷新库存列表
- **FR-014**: 系统必须提供库存状态筛选功能，支持多选（充足/正常/偏低/不足/缺货）
- **FR-015**: 系统必须提供商品分类筛选功能，以下拉单选或树形选择形式展示
- **FR-016**: 系统必须支持多个筛选条件组合使用，筛选结果为各条件的交集
- **FR-009**: 系统必须提供SKU详情查看功能，可通过点击行触发
- **FR-010**: SKU详情必须显示：现存数量、可用数量、预占数量、库存单位、最后更新时间、安全库存阈值
- **FR-011**: 系统必须在无数据时显示友好的空状态提示
- **FR-012**: 系统必须根据用户权限控制可查看的门店范围
- **FR-013**: 系统必须根据库存数量自动计算并显示库存状态标签，包含五级状态：
  - **充足**(绿色): 可用库存 ≥ 安全库存 × 2
  - **正常**(蓝色): 安全库存 ≤ 可用库存 < 安全库存 × 2
  - **偏低**(黄色): 安全库存 × 0.5 ≤ 可用库存 < 安全库存
  - **不足**(橙色): 0 < 可用库存 < 安全库存 × 0.5
  - **缺货**(红色): 可用库存 = 0

### Key Entities

- **SKU（库存单元）**: 商品的最小库存管理单位，包含编码、名称、单位、所属分类等基本信息
- **商品分类**: SKU的归属类目，如"酒水饮料"、"零食小吃"等，用于筛选和分组
- **库存状态**: 根据可用库存与安全库存的比例自动计算的五级状态标签（充足/正常/偏低/不足/缺货）
- **库存记录**: 某门店某SKU的库存数量，关联门店和SKU，包含以下库存指标：
  - **现存数量(onHand)**: 实际在仓库中的库存数量
  - **可用数量(available)**: 可用于销售的库存，计算公式：可用 = 现存 - 预占
  - **预占数量(reserved)**: 已被订单锁定但未出库的数量
  - **安全库存(safetyStock)**: SKU的最低库存警戒线，低于此值需要补货
- **门店**: 经营场所，店长管理的基本单元，每个库存记录归属于一个门店

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 店长能够在2秒内看到门店库存列表
- **SC-002**: 搜索功能在用户停止输入后1秒内返回筛选结果
- **SC-003**: 95%的用户能够在首次使用时成功找到目标SKU的库存信息
- **SC-004**: 系统支持单门店1000+条SKU库存的流畅浏览（无卡顿）
- **SC-005**: 门店切换后列表在2秒内完成刷新
- **SC-006**: 库存详情展开响应时间不超过500ms

## Assumptions

- 用户已通过系统登录认证，具有门店查看权限
- SKU主数据已在系统中维护完成
- 门店数据已在系统中配置完成
- 用户的门店权限已正确配置
- 系统已有库存数据（来自库存管理或进销存模块）

## Out of Scope

- 库存新增/修改/删除操作（属于库存管理功能）
- 库存预警通知推送
- 库存报表导出
- 库存盘点功能
- 批次管理和效期管理

## Clarifications

### Q1: 库存指标显示范围
**问题**: 库存列表应显示哪些库存指标？
**选项**:
- A: 最简模式 - 仅显示现存数量
- B: 核心模式 - 现存 + 可用 + 预占 + 安全库存
- C: 完整模式 - 现存 + 可用 + 预占 + 在途 + 安全库存 + 库存状态标签

**用户选择**: B - 核心模式
**影响**: 列表显示现存、可用、预占三列，详情显示安全库存阈值，可用数量计算公式为：可用 = 现存 - 预占

### Q2: 库存状态标签显示
**问题**: 是否需要显示库存状态标签来直观提示库存健康程度？
**选项**:
- A: 不显示状态标签 - 仅通过数字让用户自行判断
- B: 仅低库存预警 - 当可用库存 < 安全库存时显示红色"库存不足"标签
- C: 完整状态体系 - 显示"充足/正常/偏低/不足/缺货"五级状态标签含颜色标识

**用户选择**: C - 完整状态体系
**影响**: 列表增加库存状态列，根据可用库存与安全库存的比例自动计算五级状态（充足/正常/偏低/不足/缺货），配合颜色标识

### Q3: 筛选条件扩展
**问题**: 除门店筛选外，是否需要支持更多筛选维度？
**选项**:
- A: 仅门店筛选 - 保持原规格，仅支持门店下拉筛选
- B: 门店 + 库存状态筛选 - 增加按库存状态筛选
- C: 门店 + 库存状态 + 商品分类筛选 - 完整筛选体系，支持多维度组合筛选

**用户选择**: C - 完整筛选体系
**影响**: 增加库存状态多选筛选（可选多个状态）、商品分类筛选，支持多条件组合，增加重置按钮
