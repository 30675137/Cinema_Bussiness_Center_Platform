# Feature Specification: SKU 管理

**Feature Branch**: `005-sku-management`  
**Created**: 2025-01-27  
**Status**: Draft  
**Input**: User description: "需求的编号用05，前端的设计要求 ：# 《SKU 管理 · 前端设计要求》（/products/sku）"

## 范围说明

本功能专注于 SKU（Stock Keeping Unit，可计库存/可售的最小商品单元）的管理能力，包括列表查看、检索、新建/编辑、详情查看等核心功能。SKU 作为商品中心的基础数据单元，为采购、库存、销售等业务模块提供数据支撑。

## 实现说明

- **前端实现**：本功能仅考虑前端 UI 设计和交互实现，不考虑后端 API 的具体实现细节
- **数据来源**：所有数据操作通过 Mock 服务实现，不依赖真实后端接口
- **权限控制**：暂不考虑用户角色和登录验证，所有操作通过 Mock 权限标识控制按钮显隐
- **文档语言**：所有文档内容使用中文编写

## Clarifications

### Session 2025-01-27

- Q: 状态设置 商品状态 是否 应该统一放在页面上面？ → A: 是，状态字段应统一放在页面顶部（步骤导航下方、内容区域上方），作为全局设置区域，便于用户快速查看和修改商品状态
- Q: 编辑商品的 基础信息 内容管理 规格属性 等分阶段的信息 是否可以与具体填写的内容 做模块分离，也就是上面为步骤引导与按钮操作区，下方是内容录入区？ → A: 是，采用上下分离布局：页面顶部为步骤导航和操作按钮区（包含步骤指示器、上一步/下一步/保存按钮），页面下方为内容录入区（表单字段），实现清晰的视觉分离和操作流程

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 查看和搜索 SKU 列表 (Priority: P1)

运营人员需要快速浏览和查找系统中的 SKU 信息，以便了解商品库存单元的基本情况，并为后续的采购、库存管理等操作提供数据基础。

**Why this priority**: 列表查看是 SKU 管理的基础功能，用户需要能够快速定位目标 SKU，这是所有后续操作的前提。

**Independent Test**: 可以独立测试通过访问 SKU 列表页面，使用筛选和搜索功能查找特定 SKU，验证列表展示和筛选功能是否正常工作，并能够提供基本的 SKU 信息查看能力。

**Acceptance Scenarios**:

1. **Given** 用户访问 SKU 管理页面，**When** 页面加载完成，**Then** 系统显示 SKU 列表，包含 SKU 编码、名称、所属 SPU、品牌、类目、状态等关键信息
2. **Given** SKU 列表已显示，**When** 用户在关键字搜索框输入 SKU 编码/名称/条码，**Then** 系统返回匹配的 SKU 列表
3. **Given** SKU 列表已显示，**When** 用户选择筛选条件（所属 SPU、品牌、类目、状态、是否管理库存），**Then** 系统根据筛选条件更新列表内容
4. **Given** 用户已设置筛选条件，**When** 用户点击"重置"按钮，**Then** 系统清空所有筛选条件并显示默认列表
5. **Given** SKU 列表包含多页数据，**When** 用户切换分页，**Then** 系统显示对应页面的 SKU 数据，并保持当前筛选条件

---

### User Story 2 - 创建新 SKU (Priority: P1)

运营人员需要为商品创建新的 SKU，以支持不同规格、单位、条码的商品变体管理，确保商品信息完整准确。

**Why this priority**: SKU 创建是商品数据录入的基础功能，没有创建能力就无法建立商品库存单元，直接影响后续的采购和库存管理。

**Independent Test**: 可以独立测试通过点击"新建 SKU"按钮，填写 SKU 表单信息（包括基础信息、单位条码、规格属性、其他配置），提交后验证新 SKU 是否成功创建并在列表中显示。

**Acceptance Scenarios**:

1. **Given** 用户在 SKU 列表页，**When** 点击"新建 SKU"按钮，**Then** 系统打开新建 SKU 表单，采用上下分离布局：顶部显示步骤导航（基础信息、单位条码、规格属性、其他配置）和操作按钮区（上一步/下一步/保存），底部显示内容录入区
2. **Given** 新建 SKU 表单已打开，**When** 页面加载完成，**Then** 系统在页面顶部（步骤导航下方、内容区域上方）显示状态设置区域，包含 SKU 状态字段（草稿/启用/停用），便于用户快速查看和修改
3. **Given** 新建 SKU 表单已打开，**When** 用户选择所属 SPU，**Then** 系统自动带出品牌、类目等关联信息（如适用）
4. **Given** 用户填写 SKU 表单，**When** 必填字段（所属 SPU、SKU 名称、主库存单位）未填写完整，**Then** 系统阻止提交并提示必填字段，自动跳转到第一个失败的字段
5. **Given** 用户填写 SKU 表单，**When** 输入的主条码与其他 SKU 重复，**Then** 系统提示条码重复错误
6. **Given** 用户填写完整的 SKU 表单，**When** 点击顶部操作区的"保存"按钮，**Then** 系统创建新 SKU，关闭表单，刷新列表并显示成功提示
7. **Given** 用户正在编辑 SKU 表单，**When** 表单有未保存的修改且用户尝试关闭，**Then** 系统提示确认是否放弃修改

---

### User Story 3 - 编辑现有 SKU (Priority: P2)

运营人员需要修改已存在的 SKU 信息，以更新商品规格、单位、条码等属性，保持商品信息的准确性和时效性。

**Why this priority**: 商品信息需要根据业务变化进行更新，编辑功能是维护数据准确性的重要手段，但优先级低于创建功能。

**Independent Test**: 可以独立测试通过在 SKU 列表中找到目标 SKU，点击"编辑"按钮，修改表单信息后保存，验证修改是否成功应用。

**Acceptance Scenarios**:

1. **Given** 用户在 SKU 列表页，**When** 点击某个 SKU 的"编辑"按钮，**Then** 系统打开编辑表单并预填充该 SKU 的现有信息，采用上下分离布局：顶部显示步骤导航和操作按钮区，底部显示内容录入区
2. **Given** 编辑表单已打开，**When** 页面加载完成，**Then** 系统在页面顶部（步骤导航下方、内容区域上方）显示状态设置区域，显示当前 SKU 的状态，用户可以直接修改
3. **Given** 编辑表单已打开，**When** 用户修改 SKU 信息（如名称、条码、规格等），**Then** 系统允许修改并实时验证输入格式
4. **Given** 用户修改了 SKU 信息，**When** 点击顶部操作区的"保存"按钮，**Then** 系统更新 SKU 信息，关闭表单，刷新列表并显示成功提示
5. **Given** 用户正在编辑 SKU，**When** 修改了主条码且新条码与其他 SKU 重复，**Then** 系统提示条码重复错误并阻止保存
6. **Given** 用户在编辑表单中，**When** 点击步骤导航中的任意步骤，**Then** 系统切换到对应步骤的内容录入区，实现步骤间的快速跳转

---

### User Story 4 - 查看 SKU 详情 (Priority: P2)

运营人员需要查看 SKU 的完整详细信息，包括基础信息、单位条码、规格属性、配置信息以及关联数据，以便全面了解商品库存单元的情况。

**Why this priority**: 详情查看帮助用户深入了解 SKU 的完整信息，支持决策和问题排查，但优先级低于创建和编辑功能。

**Independent Test**: 可以独立测试通过在 SKU 列表中点击"查看"按钮，验证详情信息是否正确展示，包括所有字段和关联信息入口。

**Acceptance Scenarios**:

1. **Given** 用户在 SKU 列表页，**When** 点击某个 SKU 的"查看"按钮，**Then** 系统打开 SKU 详情视图，显示该 SKU 的所有信息
2. **Given** SKU 详情已打开，**When** 用户浏览详情内容，**Then** 系统展示完整信息，包括基础信息、单位条码、规格属性、其他配置等
3. **Given** SKU 详情已打开，**When** 详情中包含关联信息入口（如关联 BOM、价格规则、库存、场景包），**Then** 系统显示关联数量并提供跳转链接（如适用）
4. **Given** SKU 详情已打开，**When** 用户有编辑权限，**Then** 系统显示"编辑"按钮

---

### User Story 5 - 启用/停用 SKU 状态 (Priority: P3)

运营人员需要控制 SKU 的启用状态，以管理商品的可售性和库存管理状态，支持商品上下架等业务操作。

**Why this priority**: 状态管理是商品生命周期管理的重要功能，但属于辅助性操作，优先级低于核心的查看和编辑功能。

**Independent Test**: 可以独立测试通过在 SKU 列表中点击"停用"或"启用"按钮，验证 SKU 状态是否正确切换，并在列表中正确显示新状态。

**Acceptance Scenarios**:

1. **Given** SKU 处于"启用"状态，**When** 用户点击"停用"按钮，**Then** 系统弹出确认对话框，确认后 SKU 状态变更为"停用"
2. **Given** SKU 处于"停用"或"草稿"状态，**When** 用户点击"启用"按钮，**Then** 系统将 SKU 状态变更为"启用"
3. **Given** SKU 状态已变更，**When** 列表刷新，**Then** 系统在列表中正确显示新的状态标识
4. **Given** SKU 处于特定状态，**When** 用户尝试执行不允许的操作（如停用已停用的 SKU），**Then** 系统不显示或禁用相应操作按钮

---

### User Story 6 - 在其他模块中选择 SKU (Priority: P3)

采购、BOM 配方、场景包配置、库存调整等模块需要选择 SKU，系统应提供统一的 SKU 选择入口，支持快速查找和选择。

**Why this priority**: SKU 选择器是跨模块复用的辅助功能，提升其他模块的使用体验，但优先级低于 SKU 管理本身的核心功能。

**Independent Test**: 可以独立测试通过在其他模块中触发 SKU 选择功能，验证选择器是否正常打开，支持搜索和筛选，并能正确返回选中的 SKU 信息。

**Acceptance Scenarios**:

1. **Given** 用户在需要选择 SKU 的模块（如采购单创建），**When** 点击"选择 SKU"按钮，**Then** 系统打开 SKU 选择弹窗
2. **Given** SKU 选择弹窗已打开，**When** 用户使用关键字搜索或筛选条件，**Then** 系统显示匹配的 SKU 列表
3. **Given** SKU 选择弹窗已打开，**When** 用户选择一个或多个 SKU（根据配置），**Then** 系统返回选中的 SKU 信息给调用模块
4. **Given** SKU 选择弹窗支持多选模式，**When** 用户选择多个 SKU 后确认，**Then** 系统返回所有选中的 SKU 信息列表

---

### Edge Cases

- 当 SKU 列表为空时，系统应显示友好的空状态提示，引导用户创建第一个 SKU
- 当搜索无结果时，系统应提示"未找到匹配的 SKU"，并提供清除筛选的建议
- 当用户尝试创建 SKU 但所属 SPU 不存在时，系统应提示用户先创建 SPU
- 当 SKU 的主条码格式不正确时，系统应在前端进行格式校验并提示错误
- 当销售单位换算关系输入无效值（如负数、零、非数字）时，系统应阻止提交并提示错误
- 当用户尝试停用正在被其他模块（如采购单、库存）使用的 SKU 时，系统应提示关联关系并阻止操作（如适用）
- 当 SKU 选择器在大量数据下打开时，系统应支持分页加载，避免性能问题
- 当用户快速连续点击操作按钮时，系统应防止重复提交，避免创建重复数据

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须支持按关键字搜索 SKU，关键字应匹配 SKU 编码、名称、主条码
- **FR-002**: 系统必须支持按多个条件筛选 SKU，包括所属 SPU、品牌、类目、状态、是否管理库存
- **FR-003**: 系统必须支持 SKU 列表的分页展示，每页显示固定数量的 SKU 记录
- **FR-004**: 系统必须支持 SKU 列表的排序功能，至少支持按创建时间、状态排序
- **FR-005**: 系统必须允许用户创建新 SKU，包括填写基础信息、单位条码、规格属性、其他配置
- **FR-006**: 系统必须验证 SKU 创建表单的必填字段，包括所属 SPU、SKU 名称、主库存单位
- **FR-007**: 系统必须验证 SKU 主条码的唯一性，防止创建重复条码的 SKU
- **FR-008**: 系统必须支持为 SKU 配置多个销售单位，每个销售单位需设置与主库存单位的换算关系
- **FR-009**: 系统必须支持为 SKU 配置多个条码（主条码和其他条码）
- **FR-010**: 系统必须允许用户编辑已存在的 SKU 信息，并保持数据一致性
- **FR-011**: 系统必须支持 SKU 状态的三种状态：草稿、启用、停用
- **FR-012**: 系统必须允许用户切换 SKU 的启用/停用状态，并显示确认提示
- **FR-013**: 系统必须支持查看 SKU 的完整详情信息，包括所有字段和关联信息
- **FR-014**: 系统必须在 SKU 详情中显示关联信息入口，如关联 BOM、价格规则、库存、场景包等（如适用）
- **FR-015**: 系统必须支持 SKU 选择器功能，供其他模块复用，支持单选和多选模式
- **FR-016**: 系统必须在用户关闭未保存的表单时，提示确认是否放弃修改
- **FR-017**: 系统必须根据用户权限控制操作按钮的显隐，如编辑、停用/启用等操作
- **FR-018**: 系统必须支持 SKU 列表的列显隐配置功能（可选，下版本实现）
- **FR-019**: 系统必须支持导出 SKU 数据功能（可选）
- **FR-020**: 系统必须支持"保存并继续新建"功能，允许用户连续创建多个 SKU（可选）
- **FR-021**: 系统必须支持"复制新建"功能，允许用户基于现有 SKU 创建新 SKU（可选）
- **FR-022**: 系统必须在 SKU 表单页面采用上下分离布局：页面顶部为步骤导航和操作按钮区（包含步骤指示器、状态设置、上一步/下一步/保存按钮），页面下方为内容录入区（表单字段），实现清晰的视觉分离和操作流程
- **FR-023**: 系统必须将 SKU 状态字段统一放在页面顶部（步骤导航下方、内容区域上方），作为全局设置区域，便于用户快速查看和修改商品状态

### Key Entities *(include if feature involves data)*

- **SKU (Stock Keeping Unit)**: 代表可计库存/可售的最小商品单元。关键属性包括：SKU 编码（唯一标识符）、SKU 名称、所属 SPU（关联到标准产品单元）、品牌、类目、规格/型号、主库存单位、主条码、其他条码列表、销售单位配置（销售单位及与主库存单位的换算关系）、是否管理库存、是否允许负库存、最小起订量、最小销售量、状态（草稿/启用/停用）、创建元数据（创建人、创建时间）、更新元数据（最近编辑人、最近编辑时间）、以及与库存、采购、价格、BOM、场景包等模块的关联关系

- **SPU (Standard Product Unit)**: 代表标准产品单元，SKU 的父级实体。SKU 必须关联到一个 SPU，选择 SPU 后可以自动继承品牌、类目等信息

- **单位 (Unit)**: 代表商品的计量单位。包括主库存单位（必填）和销售单位（可选，可配置多个）。每个销售单位需要配置与主库存单位的换算关系（如：1 销售单位 = X 主库存单位）

- **条码 (Barcode)**: 代表商品的条码标识。包括主条码（一个）和其他条码（可配置多个，每个条码可包含备注信息）。条码必须唯一，不能与其他 SKU 重复

- **类目属性 (Category Attributes)**: 代表根据商品类目定义的属性字段，如规格/型号、口味、包装形式等。这些属性可以根据类目动态配置，目前可以作为固定字段实现，保留扩展性

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用户可以在 30 秒内通过搜索或筛选找到目标 SKU，搜索响应时间不超过 2 秒
- **SC-002**: 用户可以在 3 分钟内完成一个新 SKU 的创建，包括填写所有必填字段和主要可选字段
- **SC-003**: SKU 列表页面加载时间不超过 2 秒，支持至少 1000 条 SKU 数据的分页展示
- **SC-004**: SKU 创建表单提交成功率大于 95%，表单验证错误率低于 5%
- **SC-005**: 用户可以在 1 分钟内完成对现有 SKU 的编辑和保存操作
- **SC-006**: SKU 详情页面信息展示完整率 100%，所有字段和关联信息正确显示
- **SC-007**: SKU 状态切换操作成功率 100%，状态变更后列表立即反映最新状态
- **SC-008**: SKU 选择器在 2 秒内打开并加载初始数据，支持快速搜索和筛选，选择操作响应时间不超过 1 秒

## Assumptions

- SKU 编码由系统自动生成，用户无需手动输入
- 所属 SPU 必须已存在，用户需要先创建 SPU 才能创建 SKU
- 品牌和类目信息继承自所属 SPU，用户通常无需单独选择
- 主库存单位数据来自基础"单位管理"模块，用户从预定义列表中选择
- 销售单位配置为可选功能，用户可以不配置销售单位，仅使用主库存单位
- 条码格式校验在前端进行基础检查（长度、字符类型），详细校验由后端完成
- SKU 状态默认为"草稿"，用户创建后需要手动启用
- 是否管理库存默认为"是"，虚拟/权益类商品可以设置为"否"
- 是否允许负库存默认为"否"，重要操作需要用户明确选择
- 权限控制通过后端返回的权限标识实现，前端根据标识控制按钮显隐
- SKU 选择器支持单选和多选两种模式，由调用方配置决定
- 关联信息（BOM、价格规则、库存、场景包）的跳转功能在后续版本实现，当前仅显示数量

## Dependencies

- **SPU 管理模块**: SKU 创建需要选择所属 SPU，依赖 SPU 管理模块提供 SPU 列表和选择功能
- **单位管理模块**: SKU 的主库存单位和销售单位需要从单位管理模块获取单位列表
- **权限系统**: SKU 操作按钮的显隐依赖权限系统返回的权限标识（如 `canEditSku`、`canToggleStatus`）
- **其他业务模块**: SKU 选择器供采购单、BOM 配方、场景包配置、库存调整等模块使用，这些模块需要集成 SKU 选择器组件

## Out of Scope

- 后端 API 的具体实现细节
- 用户角色和登录验证的具体实现
- SKU 与库存、价格、BOM、场景包等模块的详细关联页面实现（当前仅显示入口）
- SKU 的批量操作功能（批量导入、批量编辑、批量删除等）
- SKU 的历史版本管理和变更记录查看
- SKU 的审核流程和审批功能
- SKU 的图片上传和管理功能
- SKU 的国际化多语言支持
