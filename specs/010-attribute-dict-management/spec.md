# Feature Specification: 属性模板与数据字典管理

**Feature Branch**: `010-attribute-dict-management`
**Created**: 2025-12-14
**Status**: Draft
**Input**: User description: "属性模板与数据字典管理 · UI 设计文档 - 统一管理商品的基础字典(容量、口味、包装等)与类目属性模板,为 SPU / SKU 提供标准化字段和选项"

## Clarifications

### Session 2025-12-14

- Q: 字典类型的动态创建权限 - 是预定义固定字典类型、允许管理员动态创建、还是需要审批流程? → A: 允许管理员动态创建 - 主数据管理员可以随时创建新的字典类型
- Q: 字典项编码生成策略 → A: 自动生成+可手动覆盖
- Q: 并发编辑冲突处理 → A: 先到先得 - 不检测冲突,最后保存直接覆盖
- Q: 数据审计日志的详细程度 → A: 仅记录创建者和时间 - 最小化日志,只记录创建人、创建时间、最后修改人、最后修改时间
- Q: 字典类型删除的级联影响处理 → A: 禁止删除有关联数据的字典类型 - 如果字典类型下有字典项或被属性模板引用,则不允许删除
- Q: 属性模板复制时的名称冲突策略 → A: 智能重命名(自动添加后缀) - 冲突属性自动重命名为"原名称_copy"或"原名称_2",全部复制
- Q: 数据字典与属性模板的查看权限 → A: 所有角色可查看,仅管理员可编辑 - 运营人员可以查看字典和模板,但不能修改
- Q: 属性类型变更处理策略 → A: 创建新属性版本 - 不允许直接修改已使用属性的类型,建议创建新属性(如"容量_v2"),保留旧属性为只读状态
- Q: 属性值的数据验证规则 → A: 一期不做验证 - 第一期不在属性模板层提供验证配置,仅在SPU表单提交时做基础的必填校验,数据验证（如数字范围、文本长度限制）作为二期优化
- Q: 属性模板的默认值设置 → A: 支持默认值配置 - 属性模板可以配置默认值,创建SPU时该属性自动填充默认值,用户可以修改

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 数据字典项管理 (Priority: P1)

作为主数据管理员,我需要管理全局数据字典(容量单位、口味、包装形式、系列标签等),以便为商品录入提供标准化的可选值,确保数据一致性。

**Why this priority**: 数据字典是属性模板的基础,必须先建立标准字典,后续才能在属性模板中引用。这是整个系统的基础数据层。

**Independent Test**: 可通过访问数据字典管理页面,创建、编辑、启用/停用字典项来独立测试。不依赖类目或商品数据即可验证完整功能。

**Acceptance Scenarios**:

1. **Given** 我在数据字典管理页面, **When** 我切换到"容量单位"标签页, **Then** 我看到所有容量单位字典项列表(ml、L、g、kg等)
2. **Given** 我在容量单位字典页面, **When** 我点击"新增字典项"按钮并填写名称"500ml", **Then** 字典项创建成功并出现在列表中
3. **Given** 我在编辑字典项弹窗中, **When** 我输入已存在的名称"500ml", **Then** 系统显示错误提示"该字典类型下名称已存在"
4. **Given** 某个字典项当前为启用状态, **When** 我点击"停用"按钮并确认, **Then** 该字典项状态变为停用,且不再出现在SPU/SKU的下拉选项中
5. **Given** 我在字典项列表中, **When** 我在搜索框输入"ml", **Then** 只显示名称或编码包含"ml"的字典项

---

### User Story 2 - 类目属性模板配置 (Priority: P2)

作为主数据管理员,我需要为每个类目配置属性模板(定义该类目需要填写哪些属性),以便运营人员在创建SPU/SKU时能够按照标准结构填写商品信息。

**Why this priority**: 属性模板定义了各类目商品的信息结构,是规范商品数据录入的关键。依赖P1的数据字典作为属性值来源,因此优先级为P2。

**Independent Test**: 可通过选择一个类目,为其添加、编辑、删除属性模板来独立测试。测试时需要已有类目数据和字典数据,但不需要实际创建SPU/SKU即可验证功能。

**Acceptance Scenarios**:

1. **Given** 我在类目属性模板管理页面, **When** 我选择"饮料 > 碳酸饮料 > 可乐"类目, **Then** 我看到该类目已配置的属性模板列表
2. **Given** 我为"可乐"类目添加新属性, **When** 我选择属性类型为"单选"并绑定"口味"字典, **Then** 该属性的可选值自动来源于口味字典的启用项
3. **Given** 我在新增属性弹窗中, **When** 我选择属性类型为"单选"但既不绑定字典也不配置自定义值, **Then** 系统显示错误提示"单选/多选类型必须配置来源字典或自定义值"
4. **Given** 某个属性已被SPU使用, **When** 我尝试删除该属性, **Then** 系统显示警告"该属性已在商品中使用,为保证数据一致性,不支持直接删除"
5. **Given** 我在类目属性模板页面, **When** 我点击"复制其他类目模板"并选择"雪碧"类目, **Then** "雪碧"类目的所有属性配置复制到当前类目
6. **Given** 我在配置"包装形式"属性时, **When** 我在默认值字段选择"瓶装", **Then** 后续创建该类目SPU时"包装形式"字段自动填充为"瓶装"

---

### User Story 3 - 字典项排序与显示控制 (Priority: P3)

作为主数据管理员,我需要控制字典项的显示顺序和状态,以便在SPU/SKU录入界面中按照业务优先级展示选项,提升运营效率。

**Why this priority**: 排序和显示优化是用户体验增强功能,不影响核心业务流程,因此优先级最低。

**Independent Test**: 可通过调整字典项的显示顺序字段,验证在下拉列表中的排序效果。

**Acceptance Scenarios**:

1. **Given** 我在容量单位字典列表中, **When** 我将"500ml"的显示顺序设为1,"330ml"设为2, **Then** 在SPU表单的容量选择下拉框中,"500ml"排在"330ml"之前
2. **Given** 某个字典项已被停用, **When** 运营人员在SPU表单中查看该字段下拉选项, **Then** 已停用的字典项不出现在选项列表中
3. **Given** 某个SPU已使用了某个后来被停用的字典项, **When** 编辑该SPU时查看该字段, **Then** 已停用的值以只读或灰色状态显示,可查看但不可修改

---

### User Story 4 - SPU/SKU表单动态生成 (Priority: P2)

作为运营人员,我需要在创建或编辑SPU/SKU时,根据选择的类目自动加载该类目的属性模板并生成对应的输入控件,以便按照标准化流程填写商品信息。

**Why this priority**: 这是属性模板系统的最终应用场景,直接影响运营人员的日常工作效率。与P2的模板配置并列优先级。

**Independent Test**: 可通过创建SPU时选择不同类目,验证表单字段的动态生成和必填校验。

**Acceptance Scenarios**:

1. **Given** 我在新建SPU页面, **When** 我选择"饮料 > 碳酸饮料 > 可乐"类目, **Then** 表单自动显示该类目配置的所有属性字段(容量、口味、包装形式等)
2. **Given** 类目属性模板中"口味"字段配置为必填, **When** 我不填写口味直接提交SPU, **Then** 系统阻止提交并在"口味"字段旁显示"必填项不能为空"
3. **Given** 类目属性模板中"容量"绑定了"容量单位"字典, **When** 我点击"容量"字段下拉框, **Then** 显示所有启用状态的容量单位选项
4. **Given** 我在编辑SPU时, **When** 我切换类目从"可乐"到"果汁", **Then** 表单字段更新为"果汁"类目的属性模板,之前填写的值被清空
5. **Given** 类目属性模板中"口味"字段为"文本"类型, **When** 我在SPU表单中看到"口味"字段, **Then** 显示为文本输入框而非下拉选择
6. **Given** 类目属性模板中"包装形式"字段配置了默认值"瓶装", **When** 我创建新的SPU并选择该类目, **Then** "包装形式"字段自动填充为"瓶装",我可以修改为其他值

---

### Edge Cases

- **并发编辑**: 当多个管理员同时编辑同一字典项或属性模板时,采用最后保存覆盖策略,不进行冲突检测
- **字典类型删除限制**: 当某个字典类型包含字典项或被属性模板引用时,禁止删除该字典类型,提示"该字典类型正在使用中,无法删除"
- **数据字典项删除限制**: 当某个字典项已被属性模板引用或已被SPU/SKU使用时,如何处理删除请求?
  - 建议: 禁止删除,提示"该字典项已被使用,不可删除"
- **属性模板删除限制**: 当某个属性已被SPU/SKU填写数据时,如何处理删除请求?
  - 建议: 禁止删除,提示"该属性已在商品中使用,为保证数据一致性,不支持直接删除"
- **字典项停用后的历史数据**: 停用的字典项如何在已使用该值的SPU/SKU中显示?
  - 建议: 在编辑界面以只读或灰色状态显示,可查看但不可修改为其他值
- **类目切换时的数据丢失**: 用户在SPU表单中已填写数据后切换类目,之前的填写内容是否保留?
  - 建议: 清空并警告用户"切换类目将清空已填写内容,是否继续?"
- **属性类型变更**: 如果属性模板中某个属性的类型从"文本"改为"单选",已有SPU数据如何处理?
  - 策略: 不允许直接修改已使用属性的类型,系统提示"该属性已被使用,不可修改类型。建议创建新属性(如'容量_v2')",原属性保留为只读状态以保护历史数据
- **字典类型数量限制**: 系统支持配置的字典类型数量是否有上限?
  - 默认: 无硬性限制,但建议不超过50个字典类型以保证管理效率
- **单个字典类型下的字典项数量**: 某个字典类型(如"口味")下可以配置多少个字典项?
  - 默认: 建议单个字典类型下不超过200个字典项,超过时给予性能警告
- **属性模板复制冲突**: 从其他类目复制模板时,如果属性名称冲突如何处理?
  - 策略: 智能重命名,冲突的属性自动添加后缀(如"_copy"或"_2"),全部复制成功并提示用户"已重命名X个冲突属性"
- **必填属性后期变更**: 如果将某个非必填属性改为必填,已有未填写该字段的SPU如何处理?
  - 建议: 一期允许变更,但已有SPU不强制补填,仅对新建/编辑时校验

## Requirements *(mandatory)*

### Functional Requirements

**数据字典管理**

- **FR-001**: 系统必须允许主数据管理员动态创建新的字典类型,包括但不限于: 容量单位、口味、包装形式、系列标签
- **FR-001a**: 系统必须为每个字典类型提供以下管理能力: 创建、编辑名称/描述、查看关联的字典项数量
- **FR-001b**: 系统必须在字典类型包含字典项或被属性模板引用时,禁止删除该字典类型并提示"该字典类型正在使用中,无法删除"
- **FR-002**: 系统必须允许主数据管理员为每个字典类型创建、编辑、删除字典项
- **FR-003**: 每个字典项必须包含以下字段: 名称(必填)、编码(系统自动生成,可手动覆盖)、显示顺序、启用状态、备注说明
- **FR-003a**: 系统必须在创建字典项时自动生成唯一编码(基于名称拼音或UUID),管理员可选择性手动修改编码
- **FR-004**: 系统必须在同一字典类型下,阻止创建重复名称的字典项
- **FR-005**: 系统必须支持启用/停用字典项,停用的字典项不出现在SPU/SKU表单的下拉选项中
- **FR-006**: 系统必须支持按名称或编码搜索字典项
- **FR-007**: 系统必须按照显示顺序字段在SPU/SKU表单下拉框中排序字典项

**类目属性模板管理**

- **FR-008**: 系统必须允许主数据管理员为每个三级类目配置属性模板
- **FR-009**: 属性模板必须包含以下配置项: 属性名称(必填)、属性类型(文本/数字/单选/多选/布尔/日期)、是否必填、来源字典、自定义可选值、默认值、显示顺序、适用层级(SPU/SKU)
- **FR-009a**: 系统必须允许属性模板配置默认值,创建SPU时该属性自动填充默认值,运营人员可以修改
- **FR-010**: 系统必须在属性类型为单选/多选时,要求配置来源字典或自定义可选值
- **FR-011**: 系统必须在同一类目下,阻止创建重复名称的属性
- **FR-012**: 系统必须支持从其他类目复制属性模板配置到当前类目,当属性名称冲突时自动添加后缀(如"_copy"或"_2")并提示用户
- **FR-013**: 系统必须在属性已被SPU/SKU使用时,禁止删除该属性并提示用户
- **FR-014**: 系统必须在字典项已被属性模板引用或SPU/SKU使用时,禁止删除该字典项
- **FR-024**: 系统必须在属性已被SPU/SKU使用时,禁止修改该属性的类型,并提示"该属性已被使用,不可修改类型。建议创建新属性(如'属性名_v2')",原属性保留以保护历史数据

**SPU/SKU表单动态生成**

- **FR-015**: 系统必须在用户选择或切换类目时,自动加载该类目的属性模板并生成对应的表单控件
- **FR-016**: 系统必须根据属性类型生成相应的输入控件: 文本→Input、数字→InputNumber、单选/多选→Select/CheckboxGroup、布尔→Switch、日期→DatePicker
- **FR-017**: 系统必须在提交SPU/SKU表单时,校验必填属性是否已填写
- **FR-018**: 系统必须在属性绑定了数据字典时,实时同步字典项的启用/停用状态到下拉选项
- **FR-019**: 系统必须在编辑已使用停用字典项的SPU/SKU时,以只读或灰色状态显示该值
- **FR-020**: 系统必须在用户切换类目时,清空已填写的属性值并警告用户

**权限控制**

- **FR-021**: 系统必须仅允许"主数据管理员"或"商品管理员"角色创建、编辑、删除数据字典和属性模板
- **FR-022**: 系统必须允许所有角色(包括"运营人员")以只读模式查看数据字典和属性模板配置
- **FR-023**: 系统必须在运营人员尝试修改字典或模板时,隐藏或禁用所有编辑操作按钮

### Key Entities

- **字典类型 (DictionaryType)**: 表示一类全局字典,如容量单位、口味、包装形式。包含属性: 类型名称、类型编码、描述
- **字典项 (DictionaryItem)**: 某个字典类型下的具体选项值。包含属性: 所属字典类型、名称、编码、显示顺序、启用状态、备注说明、创建时间、更新时间
- **类目 (Category)**: 三级类目结构(一级类目 > 二级类目 > 三级类目),作为属性模板的关联对象
- **属性模板 (AttributeTemplate)**: 定义某个类目需要填写的属性。包含属性: 所属类目、属性名称、属性类型、是否必填、来源字典、自定义可选值、默认值、显示顺序、适用层级(SPU/SKU)、创建时间、更新时间
- **SPU (Standard Product Unit)**: 标准产品单元,关联类目并填写该类目的属性模板字段
- **SKU (Stock Keeping Unit)**: 库存单位,关联SPU并可能填写SKU层级的属性字段

**关系说明**:
- 一个字典类型包含多个字典项
- 一个属性模板可选择性绑定一个数据字典类型(当属性类型为单选/多选时)
- 一个类目包含多个属性模板
- 一个SPU关联一个类目,并填写该类目所有必填属性

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 主数据管理员能够在5分钟内完成一个新字典类型的初始化(创建类型并添加10个字典项)
- **SC-002**: 主数据管理员能够在3分钟内为一个三级类目配置完整的属性模板(5-10个属性)
- **SC-003**: 运营人员在创建SPU时,类目切换后属性字段能在1秒内完成动态加载和渲染
- **SC-004**: 90%以上的SPU能够通过必填属性校验一次性提交成功(减少因属性缺失导致的重复提交)
- **SC-005**: 字典项和属性模板的搜索、筛选响应时间低于500毫秒(数据量在1000条以内)
- **SC-006**: 系统能够支持至少50种字典类型,每种字典类型下至少200个字典项,不出现性能下降
- **SC-007**: 属性模板复制功能能够在2秒内完成跨类目的模板复制(10个属性)
- **SC-008**: 因属性配置不当导致的SPU数据质量问题减少80%(通过标准化字典和必填校验)

## Assumptions

- 系统已存在三级类目管理功能,本功能依赖类目数据
- 系统已有基本的用户角色和权限管理,能够区分"主数据管理员"、"商品管理员"、"运营人员"等角色
- SPU/SKU的基础数据结构已存在,属性模板作为扩展字段集成
- 数据字典的停用操作为软删除,不物理删除数据
- 属性模板的"适用层级"字段在一期可简化为全部应用到SPU层,SKU层的差异化属性作为二期优化
- 类目切换清空数据的警告提示在一期使用浏览器原生confirm弹窗,二期可优化为更友好的Modal组件
- 字典项和属性的审计日志采用最小化策略,仅记录创建人、创建时间、最后修改人、最后修改时间(不记录完整变更历史)
- 一期不在属性模板层提供数据验证规则配置（如数字范围、文本长度限制），仅在SPU表单提交时做必填校验，高级验证作为二期优化

## Out of Scope (一期不包含的功能)

- 字典项的批量导入/导出功能(可通过二期Excel导入优化)
- 属性模板的版本管理和历史记录查询
- 完整的操作审计日志和变更历史追溯(仅记录最后修改信息)
- 属性模板的跨类目批量应用(一次性为多个类目应用相同模板)
- 基于属性值的高级搜索和筛选(如"查找所有口味为焦糖的SPU")
- 属性模板的可视化配置拖拽界面(一期使用表单填写方式)
- 字典项的多语言支持(中英文切换)
- 属性模板的条件显示逻辑(如"当包装形式为瓶装时,才显示瓶盖类型属性")
- 属性值的高级验证规则配置(如数字范围限制、文本长度限制、正则表达式验证、跨字段验证等,一期仅支持必填校验)
