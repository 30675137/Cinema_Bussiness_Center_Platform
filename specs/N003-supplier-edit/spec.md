# Feature Specification: 供应商编辑功能

**Feature Branch**: `N003-supplier-edit`
**Created**: 2026-01-11
**Status**: Draft
**Input**: "实现 http://localhost:3000/purchase-management/suppliers 的供应商编辑功能"

## 功能概述

在供应商列表页面 `/purchase-management/suppliers` 实现完整的供应商信息编辑功能，包括：
- 编辑现有供应商的基本信息（名称、联系人、联系电话、状态）
- 新建供应商记录
- 数据持久化到后端数据库

当前状态：
- 前端页面已有编辑模态框 UI，但保存功能未实现（显示"保存功能开发中"）
- 后端仅有 `GET /api/suppliers` 接口，缺少创建和更新接口

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 编辑供应商信息 (Priority: P1)

采购管理员在供应商列表页面点击某个供应商的"编辑"按钮，在弹出的模态框中修改供应商信息（如联系人、联系电话、状态），点击"确定"后数据保存到数据库，列表自动刷新显示最新信息。

**Why this priority**: 这是核心功能，采购管理员需要及时更新供应商联系信息以确保业务沟通顺畅。

**Independent Test**: 编辑一个供应商的联系人姓名，保存后刷新页面，验证联系人姓名已更新。

**Acceptance Scenarios**:

1. **Given** 供应商列表显示"华润万家"联系人为"张三", **When** 用户点击编辑按钮并将联系人改为"李四"并保存, **Then** 列表显示该供应商联系人为"李四"
2. **Given** 供应商"百事可乐"状态为"启用", **When** 用户编辑将状态改为"暂停"并保存, **Then** 列表显示该供应商状态标签为"暂停"
3. **Given** 用户正在编辑供应商, **When** 必填字段为空时点击确定, **Then** 显示表单验证错误，不允许提交
4. **Given** 用户正在编辑供应商, **When** 点击取消按钮, **Then** 模态框关闭，数据不保存

---

### User Story 2 - 新建供应商 (Priority: P1)

采购管理员点击"新建供应商"按钮，在弹出的模态框中填写供应商信息（编码、名称、联系人、联系电话、状态），点击"确定"后新供应商记录保存到数据库，列表自动刷新显示新增的供应商。

**Why this priority**: 新建供应商是基础功能，新增供应商后才能进行采购订单操作。

**Independent Test**: 新建一个供应商，保存后验证该供应商出现在列表中。

**Acceptance Scenarios**:

1. **Given** 用户点击"新建供应商"按钮, **When** 模态框打开, **Then** 表单为空，状态默认为"启用"
2. **Given** 用户填写完整的供应商信息, **When** 点击确定, **Then** 新供应商出现在列表中
3. **Given** 用户输入已存在的供应商编码, **When** 点击确定, **Then** 显示"供应商编码已存在"错误提示
4. **Given** 用户填写供应商信息, **When** 联系电话格式不正确, **Then** 显示"请输入正确的手机号"验证错误

---

### User Story 3 - 编辑时数据回显 (Priority: P2)

用户点击编辑按钮后，模态框自动填充当前供应商的所有信息，方便用户进行修改。

**Why this priority**: 良好的用户体验，用户无需重新输入所有信息。

**Independent Test**: 点击编辑按钮，验证模态框中的所有字段值与列表中显示的一致。

**Acceptance Scenarios**:

1. **Given** 供应商"华润万家"编码为"S001", **When** 用户点击编辑按钮, **Then** 模态框中编码字段显示"S001"
2. **Given** 供应商联系人为"张三"，电话为"13800138000", **When** 用户点击编辑按钮, **Then** 模态框中联系人和电话字段显示对应值

---

### Edge Cases

- 网络请求失败时？显示友好的错误提示，不关闭模态框，用户可以重试
- 保存过程中用户再次点击确定？禁用确定按钮，防止重复提交
- 编辑时供应商编码字段？编辑模式下编码字段应为只读（编码创建后不可修改）
- 并发编辑冲突？第一个保存成功，后续保存时显示"数据已被修改，请刷新后重试"

## Requirements *(mandatory)*

### Functional Requirements

**后端 API**
- **FR-001**: 系统必须提供 `PUT /api/suppliers/{id}` 接口用于更新供应商信息
- **FR-002**: 系统必须提供 `POST /api/suppliers` 接口用于新建供应商
- **FR-003**: 更新接口必须验证供应商 ID 存在，不存在返回 404 错误
- **FR-004**: 新建接口必须验证供应商编码唯一，重复返回 409 错误
- **FR-005**: 接口必须验证必填字段（code, name, status），缺失返回 400 错误

**前端交互**
- **FR-006**: 编辑模态框必须在打开时回显当前供应商的所有信息
- **FR-007**: 编辑模式下供应商编码字段必须设为只读
- **FR-008**: 保存成功后必须自动刷新供应商列表
- **FR-009**: 保存过程中必须显示 loading 状态并禁用确定按钮
- **FR-010**: 保存失败时必须显示错误提示，不关闭模态框

**数据验证**
- **FR-011**: 供应商编码必须非空，最大长度 50 字符
- **FR-012**: 供应商名称必须非空，最大长度 200 字符
- **FR-013**: 联系电话如果填写，必须符合中国大陆手机号格式（1开头11位数字）
- **FR-014**: 状态必须为有效值：ACTIVE、SUSPENDED、TERMINATED

### Key Entities

- **Supplier（供应商）**: 供应商主数据，包含编码、名称、联系人、联系电话、状态
  - `id`: UUID，主键
  - `code`: 供应商编码，唯一
  - `name`: 供应商名称
  - `contactName`: 联系人姓名
  - `contactPhone`: 联系电话
  - `status`: 状态（ACTIVE/SUSPENDED/TERMINATED）

### 字段映射表

| 前端字段 | 后端 DTO 字段 | 数据库字段 | 说明 |
|---------|-------------|-----------|------|
| code | code | code | 供应商编码 |
| name | name | name | 供应商名称 |
| contactPerson | contactName | contact_name | 联系人 |
| contactPhone | contactPhone | contact_phone | 联系电话 |
| status | status | status | 状态 |

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用户可以在 5 秒内完成一次供应商信息编辑（从点击编辑到保存成功）
- **SC-002**: 保存操作的响应时间不超过 2 秒
- **SC-003**: 表单验证错误 100% 在提交前被捕获，不发送无效请求到后端
- **SC-004**: 保存成功后列表自动刷新，用户无需手动刷新页面
- **SC-005**: 编辑功能上线后，供应商信息维护效率提升，无需通过其他渠道修改数据

## Assumptions

1. 用户已登录系统并有权限访问供应商管理页面
2. 后端数据库 `suppliers` 表已存在并包含相应字段
3. 供应商编码在创建后不可修改
4. 暂不支持批量编辑功能
5. 编辑时不涉及供应商的银行账户、资质证书等扩展信息

## Out of Scope

- 供应商删除功能
- 供应商详情页面
- 供应商导入/导出功能
- 供应商审批流程
- 供应商扩展信息管理（银行账户、资质证书、评价记录等）
- 批量编辑功能

---

**文档维护人**: Claude Code
**最后更新**: 2026-01-11
