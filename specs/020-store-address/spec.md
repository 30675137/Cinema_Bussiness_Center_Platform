# Feature Specification: 门店地址信息管理

**Feature Branch**: `020-store-address`
**Created**: 2025-12-22
**Status**: Draft
**Input**: User description: "门店管理 (014-hall-store-backend) - 增加地址信息"
**Extends**: 014-hall-store-backend (影厅资源后端建模)

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 配置门店地址信息 (Priority: P1)

作为门店运营人员，我可以在门店管理界面中为每个门店配置完整的地址信息，包括省份、城市、区县、详细地址和联系电话，以便用户能够准确找到门店位置并进行联系。

**Why this priority**: 地址信息是用户到店的基础导航依据，没有准确的地址信息，用户无法定位门店，直接影响到店体验和业务转化。

**Independent Test**: 只实现本故事时，运营可以为指定门店添加/编辑完整的地址信息；前端通过门店详情 API 能获取并展示门店的地址信息。

**Acceptance Scenarios**:

1. **Given** 系统中已存在门店 A 但无地址信息，**When** 运营在后台为门店 A 填写省份、城市、区县、详细地址和联系电话并保存，**Then** 地址信息被保存到门店数据中，前端通过门店详情 API 能获取完整的地址信息。
2. **Given** 门店已配置地址信息，**When** 运营修改详细地址或联系电话并保存，**Then** 门店数据中的地址信息更新为最新值，前端显示更新后的地址。
3. **Given** 运营正在编辑门店地址，**When** 仅填写部分必填字段（如只填省份不填城市），**Then** 系统提示必填字段未完成，不允许保存。

---

### User Story 2 - 门店列表展示地址摘要 (Priority: P2)

作为门店运营人员，我可以在门店列表中看到每个门店的地址摘要信息（如城市+区县），以便快速识别和区分不同区域的门店。

**Why this priority**: 门店列表中展示地址摘要可以提升运营效率，无需逐个点击详情即可区分门店，特别是在多城市多门店场景下非常重要。

**Independent Test**: 只实现本故事时，门店列表 API 返回每个门店的地址摘要字段，前端在门店列表中展示地址摘要列。

**Acceptance Scenarios**:

1. **Given** 系统中存在多个门店且均已配置地址信息，**When** 运营查询门店列表，**Then** 列表中每个门店显示地址摘要（格式如"北京市 朝阳区"）。
2. **Given** 某门店尚未配置地址信息，**When** 运营查询门店列表，**Then** 该门店的地址摘要显示为空或提示"未配置"。

---

### User Story 3 - C端展示门店地址与导航 (Priority: P2)

作为 C端用户，我可以在小程序/H5 的门店详情页看到门店的完整地址信息和联系电话，并能够一键复制地址或拨打电话，以便规划到店路线和咨询。

**Why this priority**: C端用户需要地址信息来规划行程，一键复制和拨打电话功能可以显著提升用户体验，减少用户操作步骤。

**Independent Test**: 只实现本故事时，C端门店详情页展示地址信息，用户可以长按复制地址、点击电话号码直接拨打。

**Acceptance Scenarios**:

1. **Given** 门店已配置完整地址信息，**When** C端用户访问该门店详情页，**Then** 页面显示完整地址（省市区+详细地址）和联系电话。
2. **Given** C端用户正在查看门店详情，**When** 用户长按地址文本，**Then** 系统提供复制地址的选项。
3. **Given** C端用户正在查看门店详情，**When** 用户点击联系电话，**Then** 系统调起拨号界面，号码自动填入。

---

### Edge Cases

- 门店地址信息部分字段为空时，如何展示？（如只有城市无详细地址）
- 联系电话格式不规范（如缺少区号、包含特殊字符）时如何处理？
- 门店被停用后，C端是否仍展示其地址信息？
- 地址信息变更后，已发布的场景包/活动中关联的门店地址如何同步？

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须扩展门店（Store）实体，增加地址相关字段：省份（province）、城市（city）、区县（district）、详细地址（address）、联系电话（phone）。
- **FR-002**: 系统必须在 B端门店编辑页面提供地址信息表单，支持录入和修改上述地址字段。
- **FR-003**: 系统必须对地址信息进行基本校验：省份、城市、区县为必填字段；联系电话如填写则需符合中国大陆手机号或座机格式。
- **FR-004**: 系统必须在门店详情 API 响应中返回完整的地址信息字段。
- **FR-005**: 系统必须在门店列表 API 响应中返回地址摘要字段（addressSummary），格式为"城市+区县"或"省份+城市"。
- **FR-006**: C端门店详情页必须展示门店的完整地址和联系电话，并支持复制地址和拨打电话功能。
- **FR-007**: 当门店被停用时，C端不再展示该门店的详情页，但 B端历史查询仍可查看其地址信息。

### Key Entities *(include if feature involves data)*

- **Store（门店）扩展字段**:
  - province（省份，字符串，必填）
  - city（城市，字符串，必填，注：原 014 规格中 region/city 字段需与此对齐）
  - district（区县，字符串，必填）
  - address（详细地址，字符串，选填）
  - phone（联系电话，字符串，选填，格式校验）
  - addressSummary（地址摘要，派生字段，由 city + district 组合生成，用于列表展示）

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 运营人员可以在 2 分钟内为一个门店完成地址信息的配置，包括省市区、详细地址和联系电话。
- **SC-002**: 门店列表页加载后，100% 的已配置地址门店显示正确的地址摘要信息。
- **SC-003**: C端用户在门店详情页可以成功复制地址和拨打电话，功能可用率 100%。
- **SC-004**: 地址信息校验准确率 100%，不符合格式的电话号码在保存时被拦截并提示用户。

## Clarifications

### Session 2025-12-22

- Q: Postman 测试范围是否需要调整？ → A: 当前 Phase 8 任务已足够（T048-T056 共 9 个任务），无需调整

## Assumptions

- 本功能假设中国大陆地区的省市区三级行政区划，暂不考虑港澳台及海外地址格式。
- 联系电话格式支持：11位手机号（1开头）或区号+座机号（如 010-12345678）。
- 原 014-hall-store-backend 中的 region/city 字段将与本功能的 province/city 字段对齐或合并。
- C端门店详情页复制和拨号功能依赖 Taro 框架提供的系统 API。
