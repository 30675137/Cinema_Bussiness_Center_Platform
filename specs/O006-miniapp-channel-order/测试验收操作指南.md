# O006 小程序渠道商品订单 - 测试验收操作指南

> **文档版本**: v1.0  
> **更新时间**: 2026-01-02  
> **适用范围**: User Story 1 (商品浏览与分类筛选)

---

## 📋 目录

- [1. 测试环境准备](#1-测试环境准备)
- [2. 后端服务准备](#2-后端服务准备)
- [3. 前端项目启动](#3-前端项目启动)
- [4. 功能验收测试](#4-功能验收测试)
- [5. 常见问题排查](#5-常见问题排查)
- [6. 验收通过标准](#6-验收通过标准)

---

## 1. 测试环境准备

### 1.1 环境要求

```bash
# 检查 Node.js 版本 (需要 >= 18.x)
node -v

# 检查 npm 版本
npm -v

# 检查项目路径
pwd
# 应显示: /Users/lining/qoder/Cinema_Bussiness_Center_Platform
```

### 1.2 安装依赖

```bash
# 进入小程序项目目录
cd miniapp-ordering

# 安装依赖(如果尚未安装)
npm install

# 验证依赖安装
npm list --depth=0 | grep -E '(taro|react|tanstack)'
```

**预期输出**:
```
├── @tarojs/cli@4.1.9
├── @tarojs/components@4.1.9
├── @tanstack/react-query@5.90.16
├── react@18.3.1
├── zustand@4.5.5
```

---

## 2. 后端服务准备

### 2.1 启动后端服务

```bash
# 切换到后端目录
cd ../backend

# 启动 Spring Boot 服务
mvn spring-boot:run

# 或使用 IDE 启动 Application.java
```

### 2.2 验证后端 API

打开浏览器或使用 curl 验证以下端点:

```bash
# 1. 测试商品列表 API
curl http://localhost:8080/api/client/channel-products/mini-program

# 2. 测试商品详情 API (替换 {id} 为实际商品ID)
curl http://localhost:8080/api/client/channel-products/mini-program/{id}

# 3. 测试商品规格 API
curl http://localhost:8080/api/client/channel-products/mini-program/{id}/specs
```

**预期响应格式**:
```json
{
  "success": true,
  "data": [
    {
      "id": "product-xxx",
      "displayName": "美式咖啡",
      "basePrice": 2500,
      "mainImage": "https://...",
      "channelCategory": "COFFEE",
      "isRecommended": true,
      "status": "ACTIVE",
      "stockStatus": "IN_STOCK"
    }
  ],
  "total": 10
}
```

### 2.3 准备测试数据

确保数据库中有以下测试数据:

- ✅ 至少 **10 个商品** (包含不同分类)
- ✅ 至少 **2 个推荐商品** (isRecommended=true)
- ✅ 至少包含 **6 种分类**: ALCOHOL/COFFEE/BEVERAGE/SNACK/MEAL/OTHER
- ✅ 部分商品有库存状态变化 (IN_STOCK/LOW_STOCK/OUT_OF_STOCK)

**快速插入测试数据** (可选):
```bash
# 使用已有的测试数据脚本
cd ../backend
./insert-test-data.sh
```

---

## 3. 前端项目启动

### 3.1 配置 API 地址 (可选)

如果后端不是运行在 `localhost:8080`,需要配置环境变量:

```bash
cd ../miniapp-ordering

# 创建 .env 文件
cat > .env << EOF
# 后端 API 地址
API_BASE_URL=http://localhost:8080/api
EOF
```

**注意**: `.env` 文件已在 `.gitignore` 中,不会被提交到 Git。

### 3.2 启动 H5 开发服务器 (推荐)

```bash
# 在 miniapp-ordering 目录下执行
npm run dev:h5
```

**预期输出**:
```
> miniapp-ordering@1.0.0 dev:h5
> taro build --type h5 --watch

✔ Webpack compiled successfully in 5.23s
[Taro] 编译成功 http://localhost:10186
```

### 3.3 访问应用

打开浏览器访问: **http://localhost:10186**

---

## 4. 功能验收测试

### 4.1 页面加载测试

#### ✅ TC001: 首页商品列表加载

**测试步骤**:
1. 打开浏览器,访问 `http://localhost:10186`
2. 观察页面加载状态

**预期结果**:
- ✅ 显示分类标签栏 (全部/酒水/咖啡/饮料/小食/餐品/其他)
- ✅ 显示商品列表 (2列网格布局)
- ✅ 每个商品卡片显示:
  - 商品图片 (340rpx 高度)
  - 商品名称 (最多2行,超出省略)
  - 价格 (橙色,带 ¥ 符号)
  - 推荐标签 (如果 isRecommended=true)
- ✅ 加载时显示 "加载商品中..." 提示
- ✅ 加载完成后提示消失

**验收截图位置**: 
📸 截图保存至 `specs/O006-miniapp-channel-order/screenshots/TC001-商品列表.png`

---

### 4.2 分类筛选测试

#### ✅ TC002: 切换分类筛选

**测试步骤**:
1. 点击 **"咖啡"** 分类标签
2. 观察商品列表变化
3. 点击 **"全部"** 标签
4. 再次观察列表

**预期结果**:
- ✅ 点击 "咖啡" 后:
  - 分类标签高亮显示 (蓝色背景,白色文字)
  - 商品列表仅显示 `channelCategory=COFFEE` 的商品
- ✅ 点击 "全部" 后:
  - "全部" 标签高亮
  - 显示所有分类的商品
- ✅ 分类标签栏支持横向滚动
- ✅ 切换分类时无闪烁,平滑过渡

**验收截图位置**: 
📸 `specs/O006-miniapp-channel-order/screenshots/TC002-分类筛选.png`

#### ✅ TC003: 再次点击已选分类

**测试步骤**:
1. 点击 "饮料" 分类
2. 再次点击 "饮料" 分类

**预期结果**:
- ✅ 第二次点击后,筛选取消
- ✅ 回到 "全部" 状态,显示所有商品

---

### 4.3 下拉刷新测试

#### ✅ TC004: 下拉刷新功能

**测试步骤**:
1. 在商品列表区域下拉
2. 观察刷新指示器
3. 松手,等待刷新完成

**预期结果**:
- ✅ 下拉时显示刷新指示器
- ✅ 松手后触发 API 重新请求
- ✅ 刷新完成后,列表数据更新
- ✅ 刷新指示器消失

**验证方式**:
- 打开浏览器开发者工具 (F12)
- 切换到 Network 标签
- 下拉刷新后,应看到新的 API 请求

---

### 4.4 商品卡片测试

#### ✅ TC005: 商品图片占位符

**测试步骤**:
1. 找到一个图片 URL 无效的商品
2. 或临时修改数据库,将某个商品的 `mainImage` 设为无效 URL
3. 刷新页面

**预期结果**:
- ✅ 图片加载失败时,自动显示灰色占位图
- ✅ 占位图填充整个图片区域
- ✅ 不出现破损图片图标

#### ✅ TC006: 推荐标签显示

**测试步骤**:
1. 查看数据库,找到 `isRecommended=true` 的商品
2. 在列表中找到该商品

**预期结果**:
- ✅ 商品图片左上角显示 "推荐" 标签
- ✅ 标签背景为橙色渐变
- ✅ 文字为白色,字号较小

#### ✅ TC007: 商品卡片交互

**测试步骤**:
1. 鼠标悬停在商品卡片上 (H5 模式)
2. 点击商品卡片

**预期结果**:
- ✅ Hover 时:
  - 卡片阴影增强
  - 卡片轻微上移 (4rpx)
- ✅ 点击时:
  - 卡片透明度降低 (opacity: 0.9)
  - 跳转到商品详情页 (路由: `/pages/detail/index?id={商品ID}`)
  - **注意**: 详情页暂未实现,会显示 404,这是正常的

---

### 4.5 空状态测试

#### ✅ TC008: 无商品时的空状态

**测试步骤**:
1. 选择一个没有商品的分类 (如 "其他")
2. 或临时清空数据库某个分类的商品

**预期结果**:
- ✅ 显示空状态提示
- ✅ 提示文案:
  - 有分类筛选时: "该分类暂无商品"
  - 无筛选时: "暂无商品"
- ✅ 副文案: "换个分类看看吧"

**验收截图位置**: 
📸 `specs/O006-miniapp-orderscreenshots/TC008-空状态.png`

---

### 4.6 加载状态测试

#### ✅ TC009: 初次加载状态

**测试步骤**:
1. 清除浏览器缓存
2. 刷新页面
3. 在 Network 标签中限速到 "Slow 3G"

**预期结果**:
- ✅ 页面中央显示 Loading 组件
- ✅ 文案: "加载商品中..."
- ✅ 显示三个圆点动画

#### ✅ TC010: 加载更多状态

**测试步骤**:
1. 滚动到列表底部 (如果有分页)

**预期结果**:
- ✅ 底部显示小型 Loading 组件
- ✅ 文案: "加载中..."

---

### 4.7 响应式布局测试

#### ✅ TC011: 不同屏幕尺寸适配

**测试步骤**:
1. 打开浏览器开发者工具 (F12)
2. 切换到设备模拟模式
3. 测试以下尺寸:
   - iPhone 12 Pro (390×844)
   - iPad (768×1024)
   - Desktop (1920×1080)

**预期结果**:
- ✅ 手机端 (< 768px):
  - 2列网格布局
  - 间距: 32rpx
- ✅ 平板端 (768-1024px):
  - 3列网格布局
  - 间距: 48rpx
- ✅ 桌面端 (> 1024px):
  - 4列网格布局
  - 间距: 48rpx

---

### 4.8 性能测试

#### ✅ TC012: 缓存策略验证

**测试步骤**:
1. 打开 React DevTools 中的 Query 面板
2. 首次加载商品列表
3. 切换分类后再切换回来
4. 观察缓存时间

**预期结果**:
- ✅ 商品列表缓存时间: 5分钟
- ✅ 5分钟内切换回相同分类,不发起新请求
- ✅ 超过5分钟后,自动重新请求

**验证方式**:
```javascript
// 在浏览器控制台执行
localStorage.getItem('REACT_QUERY_OFFLINE_CACHE')
// 查看缓存内容
```

---

## 5. 常见问题排查

### 5.1 页面无法加载

**症状**: 浏览器显示 "无法访问此网站"

**排查步骤**:
```bash
# 1. 检查开发服务器是否启动
ps aux | grep "taro"

# 2. 检查端口占用
lsof -i :10186

# 3. 重启开发服务器
npm run dev:h5
```

---

### 5.2 商品列表为空

**症状**: 页面显示空状态,但后端有数据

**排查步骤**:
```bash
# 1. 检查后端服务是否运行
curl http://localhost:8080/api/client/channel-products/mini-program

# 2. 检查浏览器 Network 标签
# 观察是否有 API 请求失败 (红色)

# 3. 检查控制台错误日志
# 打开浏览器控制台 (F12 → Console)
```

**常见原因**:
- ❌ 后端服务未启动
- ❌ 后端端口不是 8080
- ❌ CORS 跨域问题
- ❌ 数据库无测试数据

---

### 5.3 图片无法显示

**症状**: 所有商品图片都是占位图

**排查步骤**:
```bash
# 1. 检查数据库商品的 mainImage 字段
# 确保是有效的 URL

# 2. 检查图片 URL 是否可访问
curl -I https://图片URL

# 3. 检查浏览器控制台是否有 CORS 错误
```

**解决方案**:
- 使用 base64 图片 (测试用)
- 使用公共 CDN 图片
- 配置后端允许图片跨域访问

---

### 5.4 分类筛选无效

**症状**: 点击分类标签,商品列表不变化

**排查步骤**:
1. 打开 React DevTools
2. 切换到 Components 标签
3. 找到 `Index` 组件
4. 观察 `activeCategory` 状态

**检查代码**:
```typescript
// miniapp-ordering/src/pages/index/index.tsx
const [activeCategory, setActiveCategory] = useState<ChannelCategory | null>(null)

// 确认 handleCategoryChange 是否触发
const handleCategoryChange = (category: ChannelCategory | null) => {
  console.log('分类切换:', category) // 添加调试日志
  setActiveCategory(category)
}
```

---

### 5.5 下拉刷新无效

**症状**: 下拉时没有刷新指示器

**可能原因**:
- H5 环境 ScrollView 的 refresher 特性支持有限
- 需要在真实小程序环境测试

**验证方式**:
```bash
# 切换到微信小程序环境测试
npm run dev:weapp

# 用微信开发者工具打开 dist 目录
```

---

## 6. 验收通过标准

### 6.1 功能完整性

- ✅ **商品列表加载**: TC001 通过
- ✅ **分类筛选**: TC002, TC003 通过
- ✅ **下拉刷新**: TC004 通过
- ✅ **商品卡片**: TC005, TC006, TC007 通过
- ✅ **空状态**: TC008 通过
- ✅ **加载状态**: TC009, TC010 通过

### 6.2 UI/UX 标准

- ✅ 商品卡片样式与原型一致
- ✅ 分类标签栏固定在顶部
- ✅ 价格颜色为橙色 (#ff6b35)
- ✅ 推荐标签渐变背景
- ✅ Hover 动画流畅自然

### 6.3 性能标准

- ✅ 首屏加载时间 < 2秒
- ✅ 分类切换响应时间 < 300ms
- ✅ 商品列表缓存生效 (5分钟)
- ✅ 图片懒加载生效

### 6.4 兼容性标准

- ✅ Chrome 浏览器正常运行
- ✅ Safari 浏览器正常运行
- ✅ 移动端 H5 正常运行
- ✅ 微信小程序正常运行 (可选)

---

## 7. 验收签字

**测试人员**: _________________  
**测试日期**: _________________  
**验收结果**: ☐ 通过  ☐ 不通过  
**备注**: _______________________________________

---

## 8. 附录

### 8.1 测试数据示例

```json
{
  "id": "coffee-001",
  "displayName": "美式咖啡",
  "basePrice": 2500,
  "mainImage": "https://example.com/coffee.jpg",
  "channelCategory": "COFFEE",
  "isRecommended": true,
  "status": "ACTIVE",
  "stockStatus": "IN_STOCK",
  "description": "经典美式咖啡,浓郁醇香"
}
```

### 8.2 API 响应结构参考

```typescript
// 商品列表响应
interface ChannelProductListResponse {
  data: ChannelProductDTO[]
  total: number
}

// 商品 DTO
interface ChannelProductDTO {
  id: string
  displayName: string
  basePrice: number
  mainImage: string
  channelCategory: ChannelCategory
  isRecommended: boolean
  status: ProductStatus
  stockStatus: StockStatus
  description?: string
}
```

### 8.3 快速测试命令

```bash
# 一键启动测试环境
cd /Users/lining/qoder/Cinema_Bussiness_Center_Platform/miniapp-ordering
npm run dev:h5 &
open http://localhost:10186
```

---

**文档结束** 📄
