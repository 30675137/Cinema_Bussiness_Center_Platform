# Feature Specification: 排期管理甘特图视图

**Feature Branch**: `013-schedule-management`  
**Created**: 2025-01-27  
**Status**: Draft  
**Input**: User description: "/Users/randy/ycj_tools_box/cursor/cineprime-admin /views/ScheduleManagement.tsx 去取这个demo 开发对应功能"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 查看影厅排期甘特图 (Priority: P1)

运营人员需要在一个统一的甘特图视图中查看所有影厅的排期安排，以便快速了解资源占用情况和时间分布。

**Why this priority**: 这是排期管理的核心功能，是所有后续操作（创建、修改、冲突检查）的基础视图。没有这个视图，用户无法有效管理排期。

**Independent Test**: 可以独立测试：打开排期管理页面，系统显示甘特图视图，包含所有影厅资源和对应的时间轴，用户可以看到当天的所有排期事件。这个功能独立提供价值：让用户一目了然地看到资源占用情况。

**Acceptance Scenarios**:

1. **Given** 用户已登录系统并进入排期管理页面, **When** 页面加载完成, **Then** 系统显示甘特图视图，包含左侧影厅资源列表和右侧时间轴（默认显示当天）
2. **Given** 甘特图已显示, **When** 用户查看某个影厅行, **Then** 系统显示该影厅的详细信息（名称、容量、标签、类型）和该影厅的所有排期事件
3. **Given** 时间轴已显示, **When** 用户查看时间轴, **Then** 系统显示可配置的营业时间范围（如10:00-24:00），每个小时有清晰的标记
4. **Given** 排期事件已存在, **When** 用户查看事件块, **Then** 系统根据事件类型和状态显示不同颜色和样式（公映、包场已确认、包场待定、保洁/维护）
5. **Given** 事件块已显示, **When** 用户查看事件详情, **Then** 系统显示事件标题、时间段、客户信息、服务经理（如适用）、上座率（公映类型）等关键信息

---

### User Story 2 - 日期切换和导航 (Priority: P1)

运营人员需要能够切换查看不同日期的排期安排，以便查看历史排期或规划未来排期。

**Why this priority**: 日期切换是排期管理的基本操作，用户需要查看不同日期的排期情况。这是独立可测试的功能，提供明确的业务价值。

**Independent Test**: 可以独立测试：在排期管理页面，用户点击日期导航按钮（前一天、后一天、回到今天），系统更新甘特图显示对应日期的排期数据。这个功能独立提供价值：让用户能够查看任意日期的排期安排。

**Acceptance Scenarios**:

1. **Given** 用户正在查看排期甘特图, **When** 用户点击"前一天"按钮, **Then** 系统显示前一天的排期数据，日期显示更新
2. **Given** 用户正在查看排期甘特图, **When** 用户点击"后一天"按钮, **Then** 系统显示后一天的排期数据，日期显示更新
3. **Given** 用户正在查看非今天的排期, **When** 用户点击"回到今天"按钮, **Then** 系统显示今天的排期数据，日期显示更新为今天
4. **Given** 日期已切换, **When** 系统加载新日期的数据, **Then** 系统显示对应日期的所有排期事件，时间轴保持相同的营业时间范围

---

### User Story 3 - 创建新排期预约 (Priority: P2)

运营人员需要能够在空闲时间段创建新的排期预约，包括公映排片和包场预约。

**Why this priority**: 创建排期是排期管理的核心操作之一，但依赖于前两个用户故事（查看和日期切换）才能有效使用。这是第二优先级的功能。

**Independent Test**: 可以独立测试：用户在甘特图的空闲时间段点击"新增预约"按钮，系统打开创建表单，用户填写必要信息（影厅、时间、类型、客户等）后提交，系统在甘特图中显示新创建的排期事件。这个功能独立提供价值：让用户能够创建新的排期安排。

**Acceptance Scenarios**:

1. **Given** 用户正在查看排期甘特图, **When** 用户点击"新增预约"按钮, **Then** 系统打开创建排期表单对话框
2. **Given** 创建表单已打开, **When** 用户填写必要信息（影厅、开始时间、持续时间、事件类型、标题等）并提交, **Then** 系统创建新的排期事件并在甘特图中显示
3. **Given** 用户正在查看某个影厅的空闲时间段, **When** 用户点击空闲区域, **Then** 系统打开创建表单，并预填充该影厅和对应时间段
4. **Given** 用户正在创建包场预约, **When** 用户填写客户信息和服务经理, **Then** 系统保存这些信息并在事件块中显示

---

### User Story 4 - 查看和编辑排期详情 (Priority: P2)

运营人员需要能够查看排期事件的详细信息，并在需要时进行编辑修改。

**Why this priority**: 查看和编辑排期详情是日常运营的常见需求，但依赖于排期已存在（User Story 3）。这是第二优先级的功能。

**Independent Test**: 可以独立测试：用户点击甘特图中的某个排期事件块，系统显示该事件的详细信息（标题、时间、客户、服务经理、备注等），用户可以选择编辑，修改信息后保存，系统更新事件显示。这个功能独立提供价值：让用户能够查看和修改排期信息。

**Acceptance Scenarios**:

1. **Given** 排期事件已存在于甘特图中, **When** 用户点击事件块, **Then** 系统显示该事件的详细信息（标题、时间段、客户、服务经理、备注、状态等）
2. **Given** 事件详情已显示, **When** 用户点击"编辑"按钮, **Then** 系统打开编辑表单，预填充当前事件的所有信息
3. **Given** 编辑表单已打开, **When** 用户修改信息（如时间、客户、备注等）并保存, **Then** 系统更新事件信息并在甘特图中刷新显示
4. **Given** 用户正在编辑包场预约, **When** 用户修改服务经理, **Then** 系统更新服务经理信息并在事件块中显示

---

### User Story 5 - 锁座和维护时段管理 (Priority: P3)

运营人员需要能够标记影厅的锁座时段和维护时段，以便在排期中预留这些时间。

**Why this priority**: 锁座和维护是排期管理的辅助功能，用于处理特殊情况。这个功能可以独立测试和使用，但优先级低于核心的查看和创建功能。

**Independent Test**: 可以独立测试：用户点击"锁座/维护"按钮，系统打开创建表单，用户选择影厅、时间段和类型（锁座或维护），提交后系统在甘特图中显示对应的维护/锁座事件块。这个功能独立提供价值：让用户能够标记不可用的时间段。

**Acceptance Scenarios**:

1. **Given** 用户正在查看排期甘特图, **When** 用户点击"锁座/维护"按钮, **Then** 系统打开创建锁座/维护时段的表单
2. **Given** 创建表单已打开, **When** 用户选择影厅、时间段和类型（锁座或维护）并提交, **Then** 系统在甘特图中显示对应的维护/锁座事件块，使用特殊样式（如斜纹背景）区分
3. **Given** 维护时段已创建, **When** 用户查看该时段, **Then** 系统显示维护类型和简要说明（如"设备调试"、"保洁"等）

---

### Edge Cases

- 当某个影厅在同一天有大量排期事件时，如何确保事件块不重叠且清晰可读？
- 当排期事件的开始时间或结束时间跨越营业时间边界时，系统如何处理显示？
- 当用户尝试在已有排期的时间段创建新排期时，系统如何提示冲突？
- 当营业时间配置为跨天（如22:00-次日02:00）时，系统如何处理时间轴显示？
- 当某个影厅当天没有任何排期事件时，系统如何显示空状态？
- 当用户快速连续切换日期时，系统如何避免重复加载和显示错误数据？
- 当排期事件的时间段非常短（如15分钟）时，系统如何确保事件块仍然可见和可点击？
- 当多个排期事件在同一时间段但属于不同影厅时，系统如何区分显示？

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须提供甘特图视图，以时间轴和资源行的方式展示排期安排
- **FR-002**: 系统必须支持显示多个影厅资源，每个影厅显示为独立的一行
- **FR-003**: 系统必须支持可配置的营业时间范围（如10:00-24:00），并在时间轴上清晰标记每个小时
- **FR-004**: 系统必须支持显示四种事件类型：公映排片、包场预约、维护时段、保洁时段
- **FR-005**: 系统必须根据事件类型和状态使用不同的颜色和样式区分显示（公映-蓝色、包场已确认-绿色、包场待定-黄色、维护/保洁-灰色斜纹）
- **FR-006**: 系统必须显示影厅的详细信息：名称、容量、标签、类型（VIP、公映、情侣、聚会等）
- **FR-007**: 系统必须在事件块中显示关键信息：标题、时间段、客户信息（包场类型）、服务经理（包场类型）、上座率（公映类型）
- **FR-008**: 系统必须支持日期切换功能：前一天、后一天、回到今天
- **FR-009**: 系统必须在日期显示中包含星期信息（如"2023年10月24日 (周二)"）
- **FR-010**: 系统必须支持在空闲时间段创建新的排期预约
- **FR-011**: 系统必须支持创建公映排片，包含：影厅、开始时间、持续时间、影片名称、上座率信息
- **FR-012**: 系统必须支持创建包场预约，包含：影厅、开始时间、持续时间、客户信息、服务经理、备注
- **FR-013**: 系统必须支持创建维护/保洁时段，包含：影厅、开始时间、持续时间、类型、说明
- **FR-014**: 系统必须支持点击事件块查看详细信息
- **FR-015**: 系统必须支持编辑已存在的排期事件
- **FR-016**: 系统必须支持显示当前时间指示线（如果当前时间在显示的日期范围内）
- **FR-017**: 系统必须支持图例说明，帮助用户理解不同颜色和样式的含义
- **FR-018**: 系统必须支持显示事件状态：已确认、待定、锁定（仅包场类型）
- **FR-019**: 系统必须支持在包场待定状态的事件上显示待确认标识（如闪烁的点）
- **FR-020**: 系统必须支持显示影厅类型标签（VIP、公映等）在影厅信息卡片中
- **FR-021**: 系统必须支持响应式布局，在不同屏幕尺寸下保持可用性
- **FR-022**: 系统必须支持滚动查看，当影厅数量或时间范围超出可视区域时
- **FR-023**: 系统必须在用户悬停影厅行时提供视觉反馈（如背景色变化）
- **FR-024**: 系统必须在用户悬停空闲区域时显示"点击空闲时段添加排期"的提示

### Key Entities *(include if feature involves data)*

- **影厅资源 (Hall)**: 代表一个可被预约的影厅，包含唯一标识、名称、容量、标签列表、类型（VIP、公映、情侣、聚会等）、营业时间配置
- **排期事件 (ScheduleEvent)**: 代表一个排期安排，包含唯一标识、所属影厅、开始时间、持续时间、标题、事件类型（公映、包场、维护、保洁）、状态（已确认、待定、锁定）、客户信息（包场类型）、服务经理（包场类型）、上座率（公映类型）、备注详情
- **时间轴配置 (TimelineConfig)**: 代表营业时间的配置，包含开始小时、结束小时、时间间隔（如30分钟）

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用户可以在3秒内打开排期管理页面并看到完整的甘特图视图
- **SC-002**: 用户可以在2秒内完成日期切换操作并看到新日期的排期数据
- **SC-003**: 用户可以在30秒内完成创建新排期预约的操作（从点击按钮到看到新事件显示）
- **SC-004**: 系统可以同时显示至少20个影厅资源和14小时的营业时间范围而不出现性能问题
- **SC-005**: 用户可以在1秒内点击事件块并看到详细信息
- **SC-006**: 95%的用户能够在不查看帮助文档的情况下理解不同颜色和样式代表的含义（通过图例）
- **SC-007**: 系统支持显示至少100个排期事件在同一天而不出现渲染延迟
- **SC-008**: 用户可以在移动设备（屏幕宽度≥768px）上正常使用核心功能（查看、日期切换）
