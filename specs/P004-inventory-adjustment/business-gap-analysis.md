# 产品上架售卖最小业务闭环功能缺口分析

> **文档版本**: 1.1  
> **创建日期**: 2025-12-27  
> **更新日期**: 2025-12-27  
> **分析依据**: 零售行业解决方案白皮书、当前系统功能现状

---

## 1. 业务闭环定义

### 1.1 完整业务流程路径

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        产品上架售卖最小业务闭环                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ①商品创建        ②库存准备        ③上架售卖        ④订单处理        ⑤履约完成  │
│  ┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐│
│  │ SPU创建  │────▶│ 采购入库 │────▶│ 价格设置 │────▶│ 订单创建 │────▶│ 出品确认 ││
│  │ SKU创建  │     │ 库存初始化│     │ 渠道上架 │     │ 库存预占 │     │ 库存扣减 ││
│  │ BOM配置  │     │ 安全库存 │     │ 可售状态 │     │ 支付完成 │     │ 订单完成 ││
│  └─────────┘     └─────────┘     └─────────┘     └─────────┘     └─────────┘│
│       ✅              🟡              🔴              🔴              🔴      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

图例：✅ 已完成  🟡 部分实现  🔴 缺失/待开发
```

### 1.2 核心业务场景

| 场景 | 流程描述 | 涉及模块 |
|------|---------|---------|
| **即时商品售卖** | 顾客在小程序下单 → 支付 → 吧台出品 → 取餐 | 订单、支付、出品、库存 |
| **场景包预约** | 选择场景包 → 选时段 → 预约支付 → 到店消费 | 场景包、预约、支付、履约 |
| **现调饮品售卖** | 下单饮品 → BOM扣料 → 调制出品 → 交付 | 订单、BOM、库存、出品 |

> **注**: 场景包预约已有「预约订单管理」模块支撑（ReservationOrder），即时商品售卖和现调饮品售卖需要新建「商品订单系统」（ProductOrder）。

---

## 2. 当前系统能力现状

### 2.1 模块完成度统计

| 系统模块 | 完成度 | 关键缺口 |
|---------|:-----:|---------|
| 商品管理 (MDM/PIM) | 77% | SKU价格体系待完善 |
| BOM/配方管理 | 53% | BOM版本管理、成本核算待开发 |
| **库存管理 (IMS)** | **21%** | ⚠️ 严重不足：预占、调拨、盘点待开发 |
| 场景包/套餐管理 | 84% | 基本完成 |
| **采购与供应链** | **31%** | 订单审批、采购计划待开发 |
| **订单与履约** | **31%** | ⚠️ 严重不足：支付、出品待开发 |
| 门店与资源管理 | 58% | 基本可用 |
| **运营报表** | **0%** | ⚠️ 完全缺失 |
| 系统管理 | 39% | 权限管理待完善 |
| C端小程序 | 73% | 微信支付待对接 |

### 2.2 已实现的核心能力

| 能力 | 状态 | 说明 |
|------|:----:|------|
| SPU/SKU 主数据管理 | ✅ | 完整CRUD，支持四类型SKU |
| 类目/品牌/属性管理 | ✅ | 完整的主数据体系 |
| 库存台账查询 | ✅ | 多维筛选、状态预警 |
| 库存调整 | ✅ | 盘盈/盘亏/报损，支持审批 |
| 场景包配置 | ✅ | 完整的场景包管理 |
| 预约订单管理 | ✅ | 基础预约流程 |
| 小程序下单流程 | ✅ | 选购到下单（未支付） |
| 供应商管理 | ✅ | 完整CRUD |

---

## 3. 功能缺口分析

### 3.1 P0 级缺口（阻塞性 - 无法完成交易闭环）

#### 3.1.1 微信支付对接

| 维度 | 说明 |
|------|------|
| **缺失功能** | 微信支付发起、支付回调、支付状态同步 |
| **业务影响** | 🚫 无法完成线上交易，订单无法真正成交 |
| **实现必要性** | C端小程序核心变现能力，无支付=无收入 |
| **依赖关系** | 无前置依赖，但被订单状态流转、出品管理依赖 |
| **预估工作量** | 3-5人天（含微信商户对接） |

#### 3.1.2 库存预占机制

| 维度 | 说明 |
|------|------|
| **缺失功能** | 订单预占、预占释放、超时自动释放、防超卖 |
| **业务影响** | 🚫 可能出现超卖，库存数据不准确 |
| **实现必要性** | 保障库存准确性，避免客户下单后无货的尴尬 |
| **依赖关系** | 依赖库存台账基础，被订单创建依赖 |
| **预估工作量** | 3-4人天 |

#### 3.1.3 订单状态流转

| 维度 | 说明 |
|------|------|
| **缺失功能** | 待支付→已支付→待出品→已完成→已取消的完整状态机 |
| **业务影响** | 🚫 无法追踪订单全生命周期，运营无法管理 |
| **实现必要性** | 订单管理的基础能力，运营必需 |
| **依赖关系** | 依赖支付回调，被出品管理依赖 |
| **预估工作量** | 2-3人天 |

#### 3.1.4 商品订单系统 🆕

| 维度 | 说明 |
|------|------|
| **缺失功能** | 商品订单数据模型、订单创建接口、B端订单列表、订单详情、状态管理 |
| **业务影响** | 🚫 即时商品售卖和现调饮品场景无系统支撑，无法与预约订单分离管理 |
| **实现必要性** | 支撑「即时商品售卖」「现调饮品售卖」两大核心业务场景 |
| **依赖关系** | 依赖 SKU 主数据、库存台账；被支付、出品、库存预占依赖 |
| **预估工作量** | 8-10人天 |

##### 商品订单与预约订单对比

| 维度 | 预约订单 (ReservationOrder) | 商品订单 (ProductOrder) |
|------|----------------------------|------------------------|
| **业务场景** | 场景包预约（包厢/活动） | 商品购买（饮品/零售品） |
| **订单来源** | C端小程序预约 | C端小程序/POS销售 |
| **支付时机** | 确认后支付（可选） | 下单即支付 |
| **状态数** | 4个 (PENDING/CONFIRMED/COMPLETED/CANCELLED) | 8个（见下方状态机） |
| **库存类型** | 时段库存 | SKU库存 |
| **库存操作** | 无 | 预占 + BOM扣料 |
| **履约方式** | 到店消费 | 吧台出品 + 核销 |
| **数据表** | `reservation_orders` | `product_orders` (新建) |

##### 商品订单状态机

```
                        ┌──────────────────────────────────────────┐
                        │                                          │
                        ▼                                          │
              ┌──────────────────┐                                 │
   创建订单   │   PENDING_PAY    │──────┬─────────────────────────▶│
              │   (待支付)        │      │ 支付超时/用户取消        │
              └────────┬─────────┘      │                          │
                       │                │                          │
               支付成功 │                │                          │
                       ▼                ▼                          │
              ┌──────────────────┐  ┌──────────────────┐           │
              │      PAID        │  │    CANCELLED     │           │
              │   (已支付)        │  │    (已取消)       │           │
              └────────┬─────────┘  └──────────────────┘           │
                       │                     ▲                     │
              吧台接单  │                     │                     │
                       ▼                     │                     │
              ┌──────────────────┐           │                     │
              │   PREPARING      │───────────┤ 未出品退款           │
              │   (制作中)        │           │                     │
              └────────┬─────────┘           │                     │
                       │                     │                     │
              出品完成  │                     │                     │
                       ▼                     │                     │
              ┌──────────────────┐           │                     │
              │   COMPLETED      │───────────┤ 已出品退款→赠饮单    │
              │   (已完成)        │           │                     │
              └────────┬─────────┘           │                     │
                       │                     │                     │
               用户核销 │                     │                     │
                       ▼                     │                     │
              ┌──────────────────┐           │                     │
              │    VERIFIED      │───────────┘                     │
              │   (已核销)        │                                 │
              └──────────────────┘                                 │
                                                                   │
              ┌──────────────────┐  ┌──────────────────┐           │
              │   REFUNDING      │─▶│    REFUNDED      │◀──────────┘
              │   (退款中)        │  │   (已退款)        │
              └──────────────────┘  └──────────────────┘
```

##### 商品订单核心数据模型

``sql
-- 商品订单主表
CREATE TABLE product_orders (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    order_number VARCHAR(32) NOT NULL UNIQUE,      -- 订单号 PO202512270001
    user_id UUID NOT NULL,                         -- 用户ID
    store_id UUID NOT NULL REFERENCES stores(id),  -- 门店ID
    
    -- 金额信息
    total_amount DECIMAL(10,2) NOT NULL,           -- 订单总金额
    paid_amount DECIMAL(10,2) DEFAULT 0,           -- 已支付金额
    discount_amount DECIMAL(10,2) DEFAULT 0,       -- 优惠金额
    
    -- 状态
    status VARCHAR(20) NOT NULL DEFAULT 'pending_pay',
    
    -- 支付信息
    payment_method VARCHAR(20),                    -- 支付方式: wechat/alipay/cash
    payment_transaction_id VARCHAR(100),           -- 支付流水号
    paid_at TIMESTAMPTZ,                           -- 支付时间
    
    -- 履约信息
    prepared_at TIMESTAMPTZ,                       -- 出品完成时间
    verified_at TIMESTAMPTZ,                       -- 核销时间
    
    -- 取消/退款
    cancelled_at TIMESTAMPTZ,
    cancel_reason TEXT,
    refunded_at TIMESTAMPTZ,
    refund_amount DECIMAL(10,2),
    
    -- 备注
    customer_remark TEXT,                          -- 客户备注
    merchant_remark TEXT,                          -- 商家备注
    
    -- 乐观锁
    version BIGINT NOT NULL DEFAULT 0,
    
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- 订单商品明细表
CREATE TABLE product_order_items (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    order_id UUID NOT NULL REFERENCES product_orders(id),
    sku_id UUID NOT NULL REFERENCES skus(id),
    sku_name VARCHAR(200) NOT NULL,
    sku_code VARCHAR(50),
    
    quantity INTEGER NOT NULL,
    unit_price DECIMAL(10,2) NOT NULL,
    subtotal DECIMAL(10,2) NOT NULL,
    
    -- 库存预占
    reserved_quantity INTEGER DEFAULT 0,
    deducted_quantity INTEGER DEFAULT 0,
    
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- 状态枚举
-- pending_pay: 待支付
-- paid: 已支付（待出品）
-- preparing: 制作中
-- completed: 已完成（待核销）
-- verified: 已核销
-- cancelled: 已取消
-- refunding: 退款中
-- refunded: 已退款
```

---

### 3.2 P1 级缺口（核心体验 - 影响运营效率）

#### 3.2.1 吧台出品管理

| 维度 | 说明 |
|------|------|
| **缺失功能** | 吧台工作台、出品确认、出品记录、BOM自动扣料 |
| **业务影响** | ⚠️ 吧台无系统支撑，人工对单易出错 |
| **实现必要性** | 提升出品效率，实现自动化库存扣减 |
| **依赖关系** | 依赖订单状态、BOM配方 |
| **预估工作量** | 5-7人天 |

#### 3.2.2 BOM自动扣料

| 维度 | 说明 |
|------|------|
| **缺失功能** | 出品时按BOM配方自动扣减原料/包材库存 |
| **业务影响** | ⚠️ 现调饮品库存不准，原料库存无法联动 |
| **实现必要性** | 现调饮品场景必需，成本核算基础 |
| **依赖关系** | 依赖BOM配方数据、库存更新接口 |
| **预估工作量** | 3-4人天 |

#### 3.2.3 价格体系管理

| 维度 | 说明 |
|------|------|
| **缺失功能** | SKU定价策略、门店差异化定价、价格生效规则 |
| **业务影响** | ⚠️ 价格修改不灵活，无法支持多门店差异定价 |
| **实现必要性** | 连锁经营的基础能力 |
| **依赖关系** | 依赖SKU主数据 |
| **预估工作量** | 4-5人天 |

#### 3.2.4 退款处理

| 维度 | 说明 |
|------|------|
| **缺失功能** | 退款申请、退款审批、微信退款、库存释放 |
| **业务影响** | ⚠️ 无法处理客户退款，售后体验差 |
| **实现必要性** | 交易闭环的逆向流程，客服必需 |
| **依赖关系** | 依赖支付对接、订单状态 |
| **预估工作量** | 3-4人天 |

---

### 3.3 P2 级缺口（运营增强 - 提升管理效率）

#### 3.3.1 采购订单审批

| 维度 | 说明 |
|------|------|
| **缺失功能** | 采购单审批流程、审批权限配置 |
| **业务影响** | 采购无审批管控，风险敞口 |
| **依赖关系** | 依赖权限管理 |
| **预估工作量** | 2-3人天 |

#### 3.3.2 库存调拨

| 维度 | 说明 |
|------|------|
| **缺失功能** | 调拨申请、调拨审批、在途追踪、收货确认 |
| **业务影响** | 多门店间无法灵活调配库存 |
| **依赖关系** | 依赖库存台账、审批流程 |
| **预估工作量** | 5-7人天 |

#### 3.3.3 销售报表

| 维度 | 说明 |
|------|------|
| **缺失功能** | 日销报表、商品销量排行、门店业绩对比 |
| **业务影响** | 运营决策缺乏数据支撑 |
| **依赖关系** | 依赖订单数据 |
| **预估工作量** | 5-7人天 |

#### 3.3.4 权限管理

| 维度 | 说明 |
|------|------|
| **缺失功能** | 角色管理、权限配置、数据权限 |
| **业务影响** | 无法精细控制操作权限 |
| **依赖关系** | 被所有业务模块依赖 |
| **预估工作量** | 5-7人天 |

---

## 4. 功能依赖关系图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              功能依赖关系                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  基础层（已完成 ✅）                                                         │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐          │
│  │SPU/SKU  │  │库存台账  │  │BOM配方  │  │场景包   │  │门店管理  │          │
│  │主数据 ✅ │  │查询 ✅   │  │管理 ✅  │  │管理 ✅  │  │管理 ✅   │          │
│  └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘          │
│       │            │            │            │            │                │
│       └────────────┴────────────┼────────────┴────────────┘                │
│                                 │                                          │
│  ┌──────────────────────────────▼──────────────────────────────┐          │
│  │                    P0: 订单交易核心层                         │          │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐          │          │
│  │  │ 商品订单系统 │  │  微信支付   │  │  库存预占   │          │          │
│  │  │ (P0) 🆕     │  │  (P0)       │  │  (P0)       │          │          │
│  │  │ ·数据模型   │─▶│  ·发起支付  │─▶│  ·下单预占  │          │          │
│  │  │ ·订单创建   │  │  ·支付回调  │  │  ·取消释放  │          │          │
│  │  │ ·状态流转   │  │  ·状态同步  │  │  ·超时释放  │          │          │
│  │  │ ·B端列表    │  │  ·退款接口  │  │  ·防超卖    │          │          │
│  │  └─────────────┘  └──────┬──────┘  └─────────────┘          │          │
│  └──────────────────────────┼──────────────────────────────────┘          │
│                             │                                              │
│  ┌──────────────────────────▼──────────────────────────────────┐          │
│  │                    P1: 履约执行层                            │          │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐          │          │
│  │  │  吧台出品   │  │  BOM扣料    │  │  退款处理   │          │          │
│  │  │  工作台(P1) │─▶│  (P1)       │  │  (P1)       │          │          │
│  │  └─────────────┘  └─────────────┘  └─────────────┘          │          │
│  │  ┌─────────────┐  ┌─────────────┐                           │          │
│  │  │  订单核销   │  │  价格体系   │                           │          │
│  │  │  (P1)       │  │  (P1)       │                           │          │
│  │  └─────────────┘  └─────────────┘                           │          │
│  └─────────────────────────────────────────────────────────────┘          │
│                             │                                              │
│  ┌──────────────────────────▼──────────────────────────────────┐          │
│  │                    P2: 运营支撑层                            │          │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐          │          │
│  │  │  采购审批   │  │  库存调拨   │  │  销售报表   │          │          │
│  │  │  (P2)       │  │  (P2)       │  │  (P2)       │          │          │
│  │  └─────────────┘  └─────────────┘  └─────────────┘          │          │
│  │  ┌─────────────┐                                            │          │
│  │  │  权限管理   │                                            │          │
│  │  │  (P2)       │                                            │          │
│  │  └─────────────┘                                            │          │
│  └─────────────────────────────────────────────────────────────┘          │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 5. 优先级排序与实施建议

### 5.1 MVP 最小可行闭环（商品售卖）

实现**即时商品售卖**和**现调饮品售卖**场景，需要完成以下功能：

| 阶段 | 优先级 | 功能 | 工作量 | 累计天数 | 里程碑 |
|:----:|:------:|------|:------:|:--------:|--------|
| **Phase 0-A** | P0-1 | 商品订单数据模型 | 2天 | 2天 | 订单表结构完成 |
| | P0-2 | 订单创建接口 (C端) | 2天 | 4天 | C端可下单 |
| | P0-3 | 库存预占机制 | 4天 | 8天 | 防超卖能力 |
| | P0-4 | 订单状态流转 | 3天 | 11天 | 状态机完整 |
| **Phase 0-B** | P0-5 | 微信支付对接 | 5天 | 16天 | 支付能力打通 |
| | P0-6 | B端商品订单列表 | 3天 | 19天 | **MVP 达成** ✅ |

**MVP 达成后可支持**：
- ✅ C端顾客下单 → 微信支付 → 订单完成
- ✅ 库存自动预占，防止超卖
- ✅ B端商品订单列表查看、筛选、状态管理
- ✅ 订单详情查看

### 5.2 Phase 1 完整售卖闭环

| 优先级 | 功能 | 工作量 | 累计天数 |
|:------:|------|:------:|:--------:|
| P1-1 | 吧台出品工作台 | 7天 | 26天 |
| P1-2 | BOM自动扣料 | 4天 | 30天 |
| P1-3 | 订单核销 | 3天 | 33天 |
| P1-4 | 退款处理 | 4天 | 37天 |
| P1-5 | 价格体系管理 | 5天 | 42天 |

**Phase 1 达成后可支持**：
- ✅ 完整的现调饮品售卖场景（下单→支付→出品→核销）
- ✅ 吧台系统化出品，待出品订单看板
- ✅ 原料库存自动扣减（BOM联动）
- ✅ 退款售后处理
- ✅ 到店核销码验证

### 5.3 Phase 2 运营能力增强

| 优先级 | 功能 | 工作量 | 累计天数 |
|:------:|------|:------:|:--------:|
| P2-1 | 权限管理 | 7天 | 49天 |
| P2-2 | 销售报表 | 7天 | 56天 |
| P2-3 | 采购审批 | 3天 | 59天 |
| P2-4 | 库存调拨 | 7天 | 66天 |

---

## 6. 总结

### 6.1 核心阻塞点

| 排序 | 功能 | 阻塞原因 | 优先级 |
|:----:|------|---------|:------:|
| 1 | **商品订单系统** | 即时售卖无系统支撑 | P0 |
| 2 | **微信支付** | 无法收款 = 无法变现 | P0 |
| 3 | **库存预占** | 可能超卖 = 客户投诉 | P0 |

### 6.2 实施建议

1. **立即启动** P0 功能开发（商品订单系统 → 库存预占 → 微信支付）
2. 预计 **19人天** 可达成 MVP 最小交易闭环
3. P1 功能可并行准备设计，P0 完成后立即启动
4. 建议按 MVP → Phase 1 → Phase 2 分阶段交付

---

## 7. 分阶段开发提示词 (Speckit Workflow)

以下提示词遵循 speckit 规范，用于驱动商品订单系统的分阶段开发。

### 7.1 Phase 0: Spec & Plan (需求规划)

```
# 提示词: 创建商品订单系统 Spec

## 目标
创建 `/specs/U005-product-order-system/spec.md` 功能规格文档

## 输入
- 参考文档: `specs/P004-inventory-adjustment/business-gap-analysis.md` 第 3.1.4 节
- 参考模板: `.specify/templates/spec-template.md`
- 业务场景: 即时商品售卖、现调饮品售卖

## 用户故事要求

**US1 (P1): 商品订单创建** 🎯 MVP
- 作为 C端用户，我希望在小程序选择商品并下单，以便快速购买
- 验收标准: 选择SKU → 加入购物车 → 提交订单 → 生成订单号

**US2 (P1): 库存预占** 🎯 MVP
- 作为系统，我需要在订单创建时预占库存，以防止超卖
- 验收标准: 下单扣减可用库存 → 取消释放预占 → 支付超时自动释放

**US3 (P1): 微信支付** 🎯 MVP
- 作为 C端用户，我希望通过微信支付订单，以完成交易
- 验收标准: 发起支付 → 支付回调 → 状态同步

**US4 (P1): B端订单列表** 🎯 MVP
- 作为 运营人员，我希望查看和管理商品订单，以跟踪销售情况
- 验收标准: 订单列表 → 多维筛选 → 详情查看 → 状态管理

**US5 (P2): 吧台出品工作台**
- 作为 吧台员工，我希望看到待出品订单，以便按序制作
- 验收标准: 待出品列表 → 接单 → 出品确认 → BOM扣料

**US6 (P2): 订单核销**
- 作为 顾客，我希望到店出示核销码取餐，以完成履约
- 验收标准: 核销码生成 → 扫码核销 → 状态更新

**US7 (P3): 退款处理**
- 作为 客服，我希望处理顾客退款申请，以提供售后服务
- 验收标准: 退款申请 → 审批 → 微信退款 → 库存释放

## 输出
生成符合模板格式的 `spec.md` 文件，包含:
- Summary (功能摘要)
- User Stories (按优先级排序)
- Acceptance Criteria (验收标准)
- Out of Scope (范围外)
- Technical Notes (技术约束)
```

### 7.2 Phase 1: Research & Design (技术设计)

```
# 提示词: 生成商品订单系统设计文档

## 目标
基于 `/specs/U005-product-order-system/spec.md` 生成设计文档

## 输出文档

### 1. research.md (技术调研)
- 现有订单模块分析 (ReservationOrder 复用性评估)
- 支付对接方案选型 (微信支付 SDK)
- 库存预占实现方案 (乐观锁 vs 悲观锁)
- 状态机设计模式选择

### 2. data-model.md (数据模型)
- product_orders 表结构
- product_order_items 表结构
- ProductOrderStatus 枚举
- DTO 定义 (CreateOrderRequest, OrderDetailResponse)

### 3. contracts/api.yaml (API 契约)
- C端接口:
  - POST /api/orders (创建订单)
  - GET /api/orders/my (我的订单)
  - POST /api/orders/{id}/pay (发起支付)
  - POST /api/orders/{id}/cancel (取消订单)
- B端接口:
  - GET /api/admin/orders (订单列表)
  - GET /api/admin/orders/{id} (订单详情)
  - POST /api/admin/orders/{id}/prepare (开始制作)
  - POST /api/admin/orders/{id}/complete (出品完成)
  - POST /api/admin/orders/{id}/verify (核销)

### 4. quickstart.md (开发指南)
- 环境准备 (Java 21, Node.js 20+)
- 数据库迁移步骤
- Mock 数据配置
- 测试命令

## 约束
- 遵循项目宪法 (Constitution Check)
- B端使用 React + Ant Design 6.1.0
- 后端使用 Spring Boot 3.x + Supabase
- 状态管理使用 Zustand + TanStack Query
```

### 7.3 Phase 2: Tasks (任务分解)

```
# 提示词: 生成商品订单系统开发任务

## 目标
基于设计文档生成 `/specs/U005-product-order-system/tasks.md`

## 任务结构要求

### Phase 1: Setup (基础设施)
- T001 创建 product-order 后端模块目录
- T002 创建 product-order 前端 feature 目录
- T003 创建数据库迁移 V030__create_product_orders.sql

### Phase 2: Foundational (核心基础)
- T004 创建 ProductOrderStatus 枚举
- T005 创建 ProductOrder 实体
- T006 创建 ProductOrderItem 实体
- T007 创建 ProductOrderRepository
- T008 创建前端 productOrder types
- T009 创建前端 productOrder API service

### Phase 3: US1 商品订单创建 (P1 MVP)
- T010 [US1] 创建 CreateOrderRequest DTO
- T011 [US1] 创建 ProductOrderService.createOrder()
- T012 [US1] 创建 POST /api/orders 接口
- T013 [US1] 创建 C端下单页面组件

### Phase 4: US2 库存预占 (P1 MVP)
- T014 [US2] 创建 InventoryReservationService
- T015 [US2] 实现下单预占逻辑
- T016 [US2] 实现取消释放逻辑
- T017 [US2] 创建超时释放定时任务

### Phase 5: US3 微信支付 (P1 MVP)
- T018 [US3] 集成微信支付 SDK
- T019 [US3] 实现 POST /api/orders/{id}/pay
- T020 [US3] 实现支付回调处理
- T021 [US3] 实现支付状态同步

### Phase 6: US4 B端订单列表 (P1 MVP)
- T022 [US4] 创建 GET /api/admin/orders 接口
- T023 [US4] 创建 ProductOrderList 组件
- T024 [US4] 创建 ProductOrderDetail 组件
- T025 [US4] 创建订单状态筛选
- T026 [US4] 创建时间范围筛选
- T027 [US4] 添加路由配置

### Phase 7: US5 吧台出品 (P2)
- T028 [US5] 创建吧台工作台页面
- T029 [US5] 实现接单操作
- T030 [US5] 实现出品确认
- T031 [US5] 集成 BOM 扣料

### Phase 8: US6 订单核销 (P2)
- T032 [US6] 实现核销码生成
- T033 [US6] 创建扫码核销接口
- T034 [US6] C端展示核销码

### Phase 9: US7 退款处理 (P3)
- T035 [US7] 创建退款申请接口
- T036 [US7] 实现微信退款
- T037 [US7] 实现库存释放

### Phase 10: Polish
- T038 添加 E2E 测试
- T039 性能优化
- T040 文档更新

## 输出格式
遵循 `.specify/templates/tasks-template.md` 格式
```

### 7.4 Phase 3: Implementation (开发执行)

```
# 提示词: 执行商品订单系统开发任务

## 目标
按 `/specs/U005-product-order-system/tasks.md` 顺序执行开发

## 执行规则

1. **任务执行顺序**
   - 严格按 Phase 顺序执行
   - 每个 Phase 完成后进行 Chrome DevTools 验证
   - 发现问题立即修复再继续

2. **代码规范**
   - 后端: Spring Boot 3.x, Java 21
   - 前端: React 19, Ant Design 6.1.0, TypeScript
   - 状态管理: Zustand + TanStack Query

3. **测试要求**
   - 关键业务逻辑编写单元测试
   - E2E 测试覆盖 MVP 用户故事

4. **验证检查点**
   - Phase 3 完成: 可以创建订单
   - Phase 4 完成: 库存预占生效
   - Phase 5 完成: 支付流程通畅
   - Phase 6 完成: B端列表可用 (MVP ✅)

## 当前任务
执行 T001: 创建 product-order 后端模块目录

## 执行后
更新任务状态为 [x] 完成，继续下一个任务
```

---

## 附录：相关文档

| 文档 | 路径 |
|-----|------|
| 零售行业解决方案白皮书 | `docs/业务需求/零售行业解决方案白皮书.md` |
| 库存台账功能专项说明 | `docs/业务需求/需求专项说明/库存台账功能专项说明.md` |
| 业务需求规约文档 | `docs/业务需求规约文档.md` |
| 订单管理与履约模块现状分析 | `docs/业务需求/需求专项说明/订单管理与履约模块开发现状分析.md` |
| 预约订单管理规格 | `specs/U001-reservation-order-management/spec.md` |
| Speckit 任务模板 | `.specify/templates/tasks-template.md` |
| Speckit 计划模板 | `.specify/templates/plan-template.md` |