{
  "info": {
    "name": "T009-e2e-postman-flow-test",
    "description": "E2E Postman 业务流程测试 - 从 SKU 创建到订单下单的完整测试流程",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Generate a unique test run ID (timestamp-based)",
          "if (!pm.environment.get('test_run_id')) {",
          "    const testRunId = Date.now().toString().slice(-6);",
          "    pm.environment.set('test_run_id', testRunId);",
          "    console.log('Test Run ID generated:', testRunId);",
          "}",
          "",
          "// Setup Supabase auth headers based on environment",
          "const authType = pm.environment.get('supabase_auth_type') || 'apikey';",
          "const serviceRoleKey = pm.environment.get('supabase_service_role_key');",
          "if (authType === 'bearer') {",
          "    pm.request.headers.upsert({ key: 'Authorization', value: 'Bearer ' + serviceRoleKey });",
          "} else {",
          "    pm.request.headers.upsert({ key: 'apikey', value: serviceRoleKey });",
          "}"
        ]
      }
    }
  ],
  "item": [
    {
      "name": "Setup",
      "description": "准备测试数据：创建 SPU、SKU、BOM、初始化库存",
      "item": [
        {
          "name": "01-Create-SPU",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 201\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test(\"Response has success=true\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.have.property('id');",
                  "});",
                  "",
                  "// Save SPU ID to environment",
                  "var jsonData = pm.response.json();",
                  "pm.environment.set('test_spu_id', jsonData.data.id);",
                  "console.log('SPU ID saved:', jsonData.data.id);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"测试饮品 SPU - Mojito\",\n  \"categoryId\": \"{{test_category_id}}\",\n  \"description\": \"鸡尾酒分类 - 莫吉托系列\",\n  \"status\": \"ACTIVE\"\n}"
            },
            "url": {
              "raw": "{{api_base_url}}/api/spu",
              "host": [
                "{{api_base_url}}"
              ],
              "path": [
                "api",
                "spu"
              ]
            },
            "description": "创建测试 SPU（标准产品单元）"
          },
          "response": []
        },
        {
          "name": "02-Create-SKU-Rum",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 201\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test(\"Response has success=true\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.have.property('id');",
                  "});",
                  "",
                  "// Save Rum SKU ID",
                  "var jsonData = pm.response.json();",
                  "pm.environment.set('test_material_rum_id', jsonData.data.id);",
                  "console.log('Rum SKU ID saved:', jsonData.data.id);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"spuId\": \"{{test_spu_id}}\",\n  \"code\": \"TEST_MAT_RUM_{{test_run_id}}\",\n  \"name\": \"朗姆酒\",\n  \"skuType\": \"raw_material\",\n  \"mainUnit\": \"ml\",\n  \"standardCost\": 0.15,\n  \"status\": \"draft\"\n}"
            },
            "url": {
              "raw": "{{api_base_url}}/api/skus",
              "host": [
                "{{api_base_url}}"
              ],
              "path": [
                "api",
                "skus"
              ]
            },
            "description": "创建朗姆酒原料 SKU"
          },
          "response": []
        },
        {
          "name": "03-Create-SKU-Mint",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 201\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test(\"Response has success=true\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.have.property('id');",
                  "});",
                  "",
                  "// Save Mint SKU ID",
                  "var jsonData = pm.response.json();",
                  "pm.environment.set('test_material_mint_id', jsonData.data.id);",
                  "console.log('Mint SKU ID saved:', jsonData.data.id);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"spuId\": \"{{test_spu_id}}\",\n  \"code\": \"TEST_MAT_MINT_{{test_run_id}}\",\n  \"name\": \"薄荷叶\",\n  \"skuType\": \"raw_material\",\n  \"mainUnit\": \"g\",\n  \"standardCost\": 0.05,\n  \"status\": \"draft\"\n}"
            },
            "url": {
              "raw": "{{api_base_url}}/api/skus",
              "host": [
                "{{api_base_url}}"
              ],
              "path": [
                "api",
                "skus"
              ]
            },
            "description": "创建薄荷叶原料 SKU"
          },
          "response": []
        },
        {
          "name": "04-Create-SKU-Soda",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 201\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test(\"Response has success=true\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.have.property('id');",
                  "});",
                  "",
                  "// Save Soda SKU ID",
                  "var jsonData = pm.response.json();",
                  "pm.environment.set('test_material_soda_id', jsonData.data.id);",
                  "console.log('Soda SKU ID saved:', jsonData.data.id);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"spuId\": \"{{test_spu_id}}\",\n  \"code\": \"TEST_MAT_SODA_{{test_run_id}}\",\n  \"name\": \"苏打水\",\n  \"skuType\": \"raw_material\",\n  \"mainUnit\": \"ml\",\n  \"standardCost\": 0.01,\n  \"status\": \"draft\"\n}"
            },
            "url": {
              "raw": "{{api_base_url}}/api/skus",
              "host": [
                "{{api_base_url}}"
              ],
              "path": [
                "api",
                "skus"
              ]
            },
            "description": "创建苏打水原料 SKU"
          },
          "response": []
        },
        {
          "name": "05-Create-SKU-Mojito",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 201\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test(\"Response has success=true\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.have.property('id');",
                  "});",
                  "",
                  "pm.test(\"SKU created with correct type\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    // standardCost 可能为 null（原料无BOM时）或 snake_case",
                  "    var cost = jsonData.data.standardCost || jsonData.data.standard_cost;",
                  "    console.log('SKU type:', jsonData.data.skuType);",
                  "    console.log('SKU cost (may be null):', cost);",
                  "});",
                  "",
                  "// Save Mojito SKU ID",
                  "var jsonData = pm.response.json();",
                  "pm.environment.set('test_sku_id_1', jsonData.data.id);",
                  "console.log('Mojito SKU ID saved:', jsonData.data.id);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"spuId\": \"{{test_spu_id}}\",\n  \"code\": \"TEST_PRD_MOJITO_{{test_run_id}}\",\n  \"name\": \"莫吉托\",\n  \"skuType\": \"finished_product\",\n  \"mainUnit\": \"杯\",\n  \"wasteRate\": 5,\n  \"status\": \"draft\",\n  \"bomComponents\": [\n    {\n      \"componentId\": \"{{test_material_rum_id}}\",\n      \"componentType\": \"SKU\",\n      \"quantity\": 45,\n      \"unit\": \"ml\"\n    },\n    {\n      \"componentId\": \"{{test_material_mint_id}}\",\n      \"componentType\": \"SKU\",\n      \"quantity\": 5,\n      \"unit\": \"g\"\n    },\n    {\n      \"componentId\": \"{{test_material_soda_id}}\",\n      \"componentType\": \"SKU\",\n      \"quantity\": 200,\n      \"unit\": \"ml\"\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{api_base_url}}/api/skus",
              "host": [
                "{{api_base_url}}"
              ],
              "path": [
                "api",
                "skus"
              ]
            },
            "description": "创建莫吉托成品 SKU（带 BOM 配方）"
          },
          "response": []
        },
        {
          "name": "06-Init-Inventory-Rum",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 201\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test(\"Inventory record created\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "    pm.expect(jsonData[0]).to.have.property('on_hand_qty');",
                  "    pm.expect(jsonData[0].on_hand_qty).to.eql(5000);",
                  "});",
                  "",
                  "console.log('Rum inventory initialized: 5000ml');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Prefer",
                "value": "return=representation"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"store_id\": \"{{test_store_id}}\",\n  \"sku_id\": \"{{test_material_rum_id}}\",\n  \"on_hand_qty\": 5000,\n  \"available_qty\": 5000,\n  \"reserved_qty\": 0,\n  \"safety_stock\": 500\n}"
            },
            "url": {
              "raw": "{{supabase_url}}{{supabase_rest_path}}/store_inventory",
              "host": [
                "{{supabase_url}}{{supabase_rest_path}}"
              ],
              "path": [
                "store_inventory"
              ]
            },
            "description": "初始化朗姆酒库存: 5000ml (约110杯莫吉托)"
          },
          "response": []
        },
        {
          "name": "07-Init-Inventory-Mint",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 201\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test(\"Inventory record created\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "    pm.expect(jsonData[0]).to.have.property('on_hand_qty');",
                  "    pm.expect(jsonData[0].on_hand_qty).to.eql(500);",
                  "});",
                  "",
                  "console.log('Mint inventory initialized: 500g');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Prefer",
                "value": "return=representation"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"store_id\": \"{{test_store_id}}\",\n  \"sku_id\": \"{{test_material_mint_id}}\",\n  \"on_hand_qty\": 500,\n  \"available_qty\": 500,\n  \"reserved_qty\": 0,\n  \"safety_stock\": 50\n}"
            },
            "url": {
              "raw": "{{supabase_url}}{{supabase_rest_path}}/store_inventory",
              "host": [
                "{{supabase_url}}{{supabase_rest_path}}"
              ],
              "path": [
                "store_inventory"
              ]
            },
            "description": "初始化薄荷叶库存: 500g (约100杯莫吉托 - 最少库存)"
          },
          "response": []
        },
        {
          "name": "08-Init-Inventory-Soda",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 201\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test(\"Inventory record created\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "    pm.expect(jsonData[0]).to.have.property('on_hand_qty');",
                  "    pm.expect(jsonData[0].on_hand_qty).to.eql(20000);",
                  "});",
                  "",
                  "console.log('Soda inventory initialized: 20000ml');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Prefer",
                "value": "return=representation"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"store_id\": \"{{test_store_id}}\",\n  \"sku_id\": \"{{test_material_soda_id}}\",\n  \"on_hand_qty\": 20000,\n  \"available_qty\": 20000,\n  \"reserved_qty\": 0,\n  \"safety_stock\": 2000\n}"
            },
            "url": {
              "raw": "{{supabase_url}}{{supabase_rest_path}}/store_inventory",
              "host": [
                "{{supabase_url}}{{supabase_rest_path}}"
              ],
              "path": [
                "store_inventory"
              ]
            },
            "description": "初始化苏打水库存: 20000ml (约100杯莫吉托)"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Test Scenarios",
      "description": "测试场景：验证正常流程、库存不足、订单取消等场景",
      "item": [
        {
          "name": "Scenario-01-Normal-Order",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 201\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test(\"Order created successfully\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.have.property('id');",
                  "    pm.expect(jsonData.data.status).to.eql('PENDING_PAYMENT');",
                  "    pm.expect(jsonData.data.reservationStatus).to.eql('RESERVED');",
                  "});",
                  "",
                  "// Save order ID for later cancel test",
                  "var jsonData = pm.response.json();",
                  "pm.environment.set('test_order_id', jsonData.data.id);",
                  "console.log('Order ID saved:', jsonData.data.id);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"storeId\": \"{{test_store_id}}\",\n  \"items\": [\n    {\n      \"skuId\": \"{{test_sku_id_1}}\",\n      \"quantity\": 2,\n      \"selectedSpecs\": {},\n      \"customerNote\": \"\"\n    }\n  ],\n  \"customerNote\": \"E2E Test Order\"\n}"
            },
            "url": {
              "raw": "{{api_base_url}}/api/client/beverage-orders",
              "host": [
                "{{api_base_url}}"
              ],
              "path": [
                "api",
                "client",
                "beverage-orders"
              ]
            },
            "description": "场景1: 正常下单2杯莫吉托 - 验证订单创建成功且库存预占"
          },
          "response": []
        },
        {
          "name": "Scenario-03-Insufficient-Inventory",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 422 Unprocessable Entity\", function () {",
                  "    pm.response.to.have.status(422);",
                  "});",
                  "",
                  "pm.test(\"Error code is INV_BIZ_001\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.false;",
                  "    pm.expect(jsonData.error).to.eql('INV_BIZ_001');",
                  "});",
                  "",
                  "pm.test(\"Shortage details in message\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    // 支持中文或英文消息",
                  "    var hasShortageMsg = jsonData.message.includes('库存不足') || jsonData.message.includes('Insufficient inventory');",
                  "    pm.expect(hasShortageMsg).to.be.true;",
                  "    console.log('Inventory shortage message:', jsonData.message);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"storeId\": \"{{test_store_id}}\",\n  \"items\": [\n    {\n      \"skuId\": \"{{test_sku_id_1}}\",\n      \"quantity\": 9999,\n      \"selectedSpecs\": {},\n      \"customerNote\": \"\"\n    }\n  ],\n  \"customerNote\": \"Inventory Test\"\n}"
            },
            "url": {
              "raw": "{{api_base_url}}/api/client/beverage-orders",
              "host": [
                "{{api_base_url}}"
              ],
              "path": [
                "api",
                "client",
                "beverage-orders"
              ]
            },
            "description": "场曶3: 库存不足 - 9999杯莫吉托，验证返回409错误和缺货清单"
          },
          "response": []
        },
        {
          "name": "Scenario-04-Cancel-Order",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// 取消订单可能失败（如果test_order_id为空或订单不存在）",
                  "pm.test(\"Status code is 200 or 404\", function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
                  "});",
                  "",
                  "pm.test(\"Order cancelled or not found\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    if (pm.response.code === 200) {",
                  "        pm.expect(jsonData.success).to.be.true;",
                  "        pm.expect(jsonData.data.status).to.eql('CANCELLED');",
                  "        pm.expect(jsonData.data.reservationStatus).to.eql('CANCELLED');",
                  "        console.log('Order cancelled successfully');",
                  "    } else {",
                  "        console.log('Order not found (may not have been created or already cancelled)');",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": {
              "raw": "{{api_base_url}}/api/client/beverage-orders/{{test_order_id}}/cancel",
              "host": [
                "{{api_base_url}}"
              ],
              "path": [
                "api",
                "client",
                "beverage-orders",
                "{{test_order_id}}",
                "cancel"
              ]
            },
            "description": "场曶4: 订单取消 - 验证库存释放"
          },
          "response": []
        },
        {
          "name": "Scenario-05-Boundary-Test",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Scenario-05 在Scenario-01之后运行，库存可能已被预占",
                  "pm.test(\"Status code is 201 or 422 (inventory depleted)\", function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([201, 422]);",
                  "});",
                  "",
                  "pm.test(\"Order created or inventory depleted\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    if (pm.response.code === 201) {",
                  "        pm.expect(jsonData.success).to.be.true;",
                  "        pm.expect(jsonData.data.status).to.eql('PENDING_PAYMENT');",
                  "        console.log('Boundary test passed: 100 cups order created');",
                  "    } else {",
                  "        pm.expect(jsonData.success).to.be.false;",
                  "        console.log('Inventory depleted by previous tests');",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"storeId\": \"{{test_store_id}}\",\n  \"items\": [\n    {\n      \"skuId\": \"{{test_sku_id_1}}\",\n      \"quantity\": 100,\n      \"selectedSpecs\": {},\n      \"customerNote\": \"\"\n    }\n  ],\n  \"customerNote\": \"Boundary Test\"\n}"
            },
            "url": {
              "raw": "{{api_base_url}}/api/client/beverage-orders",
              "host": [
                "{{api_base_url}}"
              ],
              "path": [
                "api",
                "client",
                "beverage-orders"
              ]
            },
            "description": "场曶5: 边界值测试 - 100杯刚好用完薄荷叶库存"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Teardown",
      "description": "清理测试数据：删除所有创建的资源",
      "item": [
        {
          "name": "01-Delete-Inventory",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 204 or 200\", function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 204]);",
                  "});",
                  "",
                  "console.log('Inventory records deleted');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{supabase_url}}{{supabase_rest_path}}/store_inventory?store_id=eq.{{test_store_id}}",
              "host": [
                "{{supabase_url}}{{supabase_rest_path}}"
              ],
              "path": [
                "store_inventory"
              ],
              "query": [
                {
                  "key": "store_id",
                  "value": "eq.{{test_store_id}}"
                }
              ]
            },
            "description": "删除测试门店的所有库存记录"
          },
          "response": []
        },
        {
          "name": "02-Delete-BOM",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200 or 204\", function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 204]);",
                  "});",
                  "",
                  "console.log('BOM deleted:', pm.environment.get('test_bom_id'));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{api_base_url}}/api/skus/{{test_sku_id_1}}/bom",
              "host": [
                "{{api_base_url}}"
              ],
              "path": [
                "api",
                "skus",
                "{{test_sku_id_1}}",
                "bom"
              ]
            },
            "description": "删除 BOM 配方（清空BOM配置）"
          },
          "response": []
        },
        {
          "name": "03-Delete-SKU-Product",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// SKU删除可能失败（如果有订单引用）",
                  "pm.test(\"Status code is 200, 204 or 500 (FK constraint)\", function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 204, 500]);",
                  "    if (pm.response.code === 500) {",
                  "        console.log('Product SKU deletion failed (may have order references)');",
                  "    }",
                  "});",
                  "",
                  "console.log('Product SKU deletion attempted');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{api_base_url}}/api/skus/{{test_sku_id_1}}",
              "host": [
                "{{api_base_url}}"
              ],
              "path": [
                "api",
                "skus",
                "{{test_sku_id_1}}"
              ]
            },
            "description": "删除成品 SKU（莫吉托）"
          },
          "response": []
        },
        {
          "name": "04-Delete-SKU-Rum",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200, 204 or 500\", function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 204, 500]);",
                  "});",
                  "console.log('Rum SKU deletion attempted');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{api_base_url}}/api/skus/{{test_material_rum_id}}",
              "host": [
                "{{api_base_url}}"
              ],
              "path": [
                "api",
                "skus",
                "{{test_material_rum_id}}"
              ]
            },
            "description": "删除朗姆酒原料 SKU"
          },
          "response": []
        },
        {
          "name": "05-Delete-SKU-Mint",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200, 204 or 500\", function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 204, 500]);",
                  "});",
                  "console.log('Mint SKU deletion attempted');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{api_base_url}}/api/skus/{{test_material_mint_id}}",
              "host": [
                "{{api_base_url}}"
              ],
              "path": [
                "api",
                "skus",
                "{{test_material_mint_id}}"
              ]
            },
            "description": "删除薄荷叶原料 SKU"
          },
          "response": []
        },
        {
          "name": "06-Delete-SKU-Soda",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200, 204 or 500\", function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 204, 500]);",
                  "});",
                  "console.log('Soda SKU deletion attempted');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{api_base_url}}/api/skus/{{test_material_soda_id}}",
              "host": [
                "{{api_base_url}}"
              ],
              "path": [
                "api",
                "skus",
                "{{test_material_soda_id}}"
              ]
            },
            "description": "删除苏打水原料 SKU"
          },
          "response": []
        },
        {
          "name": "07-Delete-SPU",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200 or 204\", function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 204]);",
                  "});",
                  "",
                  "console.log('SPU deleted:', pm.environment.get('test_spu_id'));",
                  "",
                  "// Clear all environment variables",
                  "pm.environment.unset('test_spu_id');",
                  "pm.environment.unset('test_material_rum_id');",
                  "pm.environment.unset('test_material_mint_id');",
                  "pm.environment.unset('test_material_soda_id');",
                  "pm.environment.unset('test_sku_id_1');",
                  "pm.environment.unset('test_bom_id');",
                  "pm.environment.unset('test_order_id');",
                  "",
                  "console.log('All test environment variables cleared');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{api_base_url}}/api/spu/{{test_spu_id}}",
              "host": [
                "{{api_base_url}}"
              ],
              "path": [
                "api",
                "spu",
                "{{test_spu_id}}"
              ]
            },
            "description": "删除 SPU 并清理环境变量"
          },
          "response": []
        }
      ]
    }
  ],
  "variable": []
}
