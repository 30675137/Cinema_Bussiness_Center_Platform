# T009 E2E Postman ä¸šåŠ¡æµç¨‹æµ‹è¯•

**ç‰ˆæœ¬**: 1.0.0  
**åˆ›å»ºæ—¥æœŸ**: 2026-01-14  
**ç»´æŠ¤è€…**: Cinema Business Center Platform Team

---

## ğŸ“‹ æ¦‚è¿°

æœ¬ Postman Collection ç”¨äºç«¯åˆ°ç«¯æµ‹è¯•ä» SKU ä¸»æ•°æ®åˆ›å»ºã€BOM é…æ–¹é…ç½®åˆ°é”€å”®è®¢å•ä¸‹å•çš„å®Œæ•´ä¸šåŠ¡æµç¨‹ã€‚æµ‹è¯•è¦†ç›–æ­£å¸¸æµç¨‹ã€åº“å­˜ä¸è¶³ã€è®¢å•å–æ¶ˆç­‰å…³é”®åœºæ™¯ï¼Œç¡®ä¿ç³»ç»Ÿå„æ¨¡å—ååŒå·¥ä½œæ­£å¸¸ï¼Œåº“å­˜æ‰£å‡é€»è¾‘æ­£ç¡®ã€‚

### æµ‹è¯•è¦†ç›–èŒƒå›´

- âœ… **SPU/SKU ä¸»æ•°æ®ç®¡ç†** (P001 æ¨¡å—)
- âœ… **BOM é…æ–¹ç®¡ç†** (P005 æ¨¡å—)
- âœ… **é”€å”®è®¢å•åˆ›å»ºä¸åº“å­˜é¢„å ** (O012 æ¨¡å—)
- âœ… **è®¢å•å–æ¶ˆä¸åº“å­˜é‡Šæ”¾**
- âœ… **åº“å­˜ä¸è¶³å¼‚å¸¸å¤„ç†**
- âœ… **è¾¹ç•Œå€¼æµ‹è¯•**

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®æ¡ä»¶

1. **åç«¯æœåŠ¡è¿è¡Œ**
   - Spring Boot åº”ç”¨å·²å¯åŠ¨ï¼Œè¿è¡Œåœ¨ `http://localhost:8080`
   - æ•°æ®åº“ (Supabase PostgreSQL) å·²è¿æ¥å¹¶åˆå§‹åŒ–

2. **Postman ç¯å¢ƒ**
   - Postman Desktop App v10.x+ æˆ– Postman Web
   - æˆ–ä½¿ç”¨ Newman CLI (å‘½ä»¤è¡Œè¿è¡Œ)

3. **æµ‹è¯•é—¨åº—å’Œåˆ†ç±»**
   - æµ‹è¯•é—¨åº— ID: `00000000-0000-0000-0000-000000000099` (å·²å­˜åœ¨äºæ•°æ®åº“)
   - é¥®å“åˆ†ç±» ID: `550e8400-e29b-41d4-a716-446655440003` (å·²å­˜åœ¨äºæ•°æ®åº“)

### å®‰è£…æ­¥éª¤

#### æ–¹æ³• 1: Postman Desktop App

1. **å¯¼å…¥ Collection**
   - æ‰“å¼€ Postman Desktop App
   - ç‚¹å‡» `Import` æŒ‰é’®
   - é€‰æ‹© `T009-e2e-postman-flow-test.postman_collection.json`
   - ç¡®è®¤å¯¼å…¥

2. **å¯¼å…¥ Environment**
   - ç‚¹å‡» `Environments` (å·¦ä¾§è¾¹æ )
   - ç‚¹å‡» `Import` æŒ‰é’®
   - é€‰æ‹© `T009-local.postman_environment.json`
   - åœ¨å³ä¸Šè§’ä¸‹æ‹‰èœå•é€‰æ‹© `T009-local` ç¯å¢ƒ

3. **éªŒè¯ç¯å¢ƒé…ç½®**
   - ç‚¹å‡» `T009-local` ç¯å¢ƒæŸ¥çœ‹å˜é‡
   - ç¡®è®¤ `api_base_url` å’Œ `supabase_url` æ­£ç¡®
   - ç¡®è®¤ `supabase_anon_key` å·²é…ç½®

#### æ–¹æ³• 2: Newman CLI (å‘½ä»¤è¡Œ)

```bash
# å®‰è£… Newman
npm install -g newman

# è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
newman run T009-e2e-postman-flow-test.postman_collection.json \
  -e T009-local.postman_environment.json \
  --reporters cli,json \
  --reporter-json-export results.json

# ä»…è¿è¡Œ Setup é˜¶æ®µ
newman run T009-e2e-postman-flow-test.postman_collection.json \
  -e T009-local.postman_environment.json \
  --folder "Setup"
```

---

## ğŸ“– ä½¿ç”¨æŒ‡å—

### æµ‹è¯•æ‰§è¡Œæµç¨‹

#### å®Œæ•´æµ‹è¯•æµç¨‹ (æ¨è)

```
Setup â†’ Test Scenarios â†’ Teardown
```

1. **Setup é˜¶æ®µ** (å‡†å¤‡æµ‹è¯•æ•°æ®)
   - åˆ›å»º 1 ä¸ªæµ‹è¯• SPU
   - åˆ›å»º 4 ä¸ª SKU (3 ä¸ªåŸæ–™ + 1 ä¸ªæˆå“)
   - åˆ›å»º 1 ä¸ª BOM é…æ–¹
   - åˆå§‹åŒ– 3 ä¸ªåŸæ–™çš„åº“å­˜

2. **Test Scenarios é˜¶æ®µ** (æ‰§è¡Œæµ‹è¯•åœºæ™¯)
   - åœºæ™¯ 1: æ­£å¸¸ä¸‹å• - å•å“è®¢å• (2æ¯)
   - åœºæ™¯ 3: åº“å­˜ä¸è¶³ - è¶…å¤§è®¢å• (9999æ¯)
   - åœºæ™¯ 4: è®¢å•å–æ¶ˆ - é‡Šæ”¾åº“å­˜
   - åœºæ™¯ 5: è¾¹ç•Œå€¼ - åˆšå¥½ç”¨å®Œåº“å­˜ (100æ¯)

3. **Teardown é˜¶æ®µ** (æ¸…ç†æµ‹è¯•æ•°æ®)
   - åˆ é™¤æ‰€æœ‰åˆ›å»ºçš„èµ„æº
   - æ¸…ç©ºç¯å¢ƒå˜é‡

#### Postman Desktop App æ‰§è¡Œ

1. **æ‰§è¡Œå®Œæ•´æµç¨‹**
   - é€‰æ‹© Collection: `T009-e2e-postman-flow-test`
   - ç‚¹å‡»å³ä¾§ `Run` æŒ‰é’® (æˆ–ç‚¹å‡» `...` â†’ `Run collection`)
   - ç¡®è®¤ç¯å¢ƒä¸º `T009-local`
   - ç‚¹å‡» `Run T009-e2e-postman-flow-test`
   - æŸ¥çœ‹æµ‹è¯•ç»“æœ

2. **æ‰§è¡Œå•ä¸ªæ–‡ä»¶å¤¹**
   - å±•å¼€ Collection
   - é€‰æ‹©æ–‡ä»¶å¤¹ (å¦‚ `Setup`)
   - ç‚¹å‡»æ–‡ä»¶å¤¹å³ä¾§ `...` â†’ `Run folder`
   - æŸ¥çœ‹æ‰§è¡Œç»“æœ

3. **æ‰§è¡Œå•ä¸ªè¯·æ±‚**
   - é€‰æ‹©è¯·æ±‚ (å¦‚ `Setup/01-Create-SPU`)
   - ç‚¹å‡» `Send` æŒ‰é’®
   - æŸ¥çœ‹å“åº”å’Œæµ‹è¯•ç»“æœ

#### Newman CLI æ‰§è¡Œ

```bash
# å®Œæ•´æµç¨‹
newman run T009-e2e-postman-flow-test.postman_collection.json \
  -e T009-local.postman_environment.json

# ä»…è¿è¡Œ Setup
newman run T009-e2e-postman-flow-test.postman_collection.json \
  -e T009-local.postman_environment.json \
  --folder "Setup"

# ä»…è¿è¡Œ Test Scenarios
newman run T009-e2e-postman-flow-test.postman_collection.json \
  -e T009-local.postman_environment.json \
  --folder "Test Scenarios"

# è¾“å‡º HTML æŠ¥å‘Š
newman run T009-e2e-postman-flow-test.postman_collection.json \
  -e T009-local.postman_environment.json \
  --reporters cli,html \
  --reporter-html-export report.html
```

---

## ğŸ§ª æµ‹è¯•æ•°æ®è¯´æ˜

### æµ‹è¯•å•†å“: è«å‰æ‰˜ (Mojito)

| èµ„æºç±»å‹ | åç§° | è§„æ ¼ | æ•°é‡/æˆæœ¬ |
|---------|------|------|----------|
| **SPU** | æµ‹è¯•é¥®å“ SPU - Mojito | é¸¡å°¾é…’åˆ†ç±» | 1ä¸ª |
| **åŸæ–™ SKU** | æœ—å§†é…’ | raw_material, ml | 0.15å…ƒ/ml |
| **åŸæ–™ SKU** | è–„è·å¶ | raw_material, g | 0.05å…ƒ/g |
| **åŸæ–™ SKU** | è‹æ‰“æ°´ | raw_material, ml | 0.01å…ƒ/ml |
| **æˆå“ SKU** | è«å‰æ‰˜ | finished_product, æ¯ | 35å…ƒ/æ¯ |
| **BOM é…æ–¹** | è«å‰æ‰˜é…æ–¹ | 45mlæœ—å§†é…’ + 5gè–„è·å¶ + 200mlè‹æ‰“æ°´ | 5%æŸè€—ç‡ |
| **åˆå§‹åº“å­˜** | æœ—å§†é…’ | 5000ml | å¯ç”¨: 5000ml |
| **åˆå§‹åº“å­˜** | è–„è·å¶ | 500g (çº¦100æ¯) | å¯ç”¨: 500g |
| **åˆå§‹åº“å­˜** | è‹æ‰“æ°´ | 20000ml | å¯ç”¨: 20000ml |

**ç†è®ºæœ€å¤§åˆ¶ä½œé‡**: 100æ¯è«å‰æ‰˜ (å—è–„è·å¶åº“å­˜é™åˆ¶)

### æµ‹è¯•åœºæ™¯è¯´æ˜

#### åœºæ™¯ 1: æ­£å¸¸ä¸‹å• - å•å“è®¢å•
- **è®¢å•å†…å®¹**: 2æ¯è«å‰æ‰˜
- **é¢„æœŸç»“æœ**: âœ… è®¢å•åˆ›å»ºæˆåŠŸï¼Œåº“å­˜é¢„å æˆåŠŸ
- **åº“å­˜æ‰£å‡**:
  - æœ—å§†é…’: -90ml (45ml Ã— 2)
  - è–„è·å¶: -10g (5g Ã— 2)
  - è‹æ‰“æ°´: -400ml (200ml Ã— 2)

#### åœºæ™¯ 3: åº“å­˜ä¸è¶³ - è¶…å¤§æ•°é‡è®¢å•
- **è®¢å•å†…å®¹**: 9999æ¯è«å‰æ‰˜
- **é¢„æœŸç»“æœ**: âŒ è®¢å•åˆ›å»ºå¤±è´¥ï¼Œè¿”å› 409 é”™è¯¯
- **é”™è¯¯ä¿¡æ¯**:
  - é”™è¯¯ç : `ORD_BIZ_002`
  - é”™è¯¯ä¿¡æ¯: "åº“å­˜ä¸è¶³"
  - ç¼ºè´§æ¸…å•: è–„è·å¶ (æ‰€éœ€ 49995gï¼Œå¯ç”¨ 500g)

#### åœºæ™¯ 4: è®¢å•å–æ¶ˆ - é‡Šæ”¾åº“å­˜
- **å‰ç½®æ¡ä»¶**: å·²åˆ›å»º 1 ä¸ªè«å‰æ‰˜è®¢å• (åœºæ™¯ 1)
- **æ“ä½œ**: å–æ¶ˆè¯¥è®¢å•
- **é¢„æœŸç»“æœ**: âœ… è®¢å•å–æ¶ˆæˆåŠŸï¼Œåº“å­˜æ¢å¤

#### åœºæ™¯ 5: è¾¹ç•Œå€¼æµ‹è¯• - åˆšå¥½ç”¨å®Œåº“å­˜
- **è®¢å•å†…å®¹**: 100æ¯è«å‰æ‰˜ (éœ€è¦ 500g è–„è·å¶)
- **é¢„æœŸç»“æœ**: âœ… è®¢å•åˆ›å»ºæˆåŠŸ
- **åº“å­˜çŠ¶æ€**: è–„è·å¶å¯ç”¨åº“å­˜ = 0g

---

## ğŸ” éªŒè¯ç‚¹è¯´æ˜

### è‡ªåŠ¨åŒ–éªŒè¯ (Test Scripts)

æ¯ä¸ªè¯·æ±‚éƒ½åŒ…å«è‡ªåŠ¨åŒ–éªŒè¯è„šæœ¬ï¼ŒéªŒè¯å†…å®¹åŒ…æ‹¬ï¼š

1. **HTTP çŠ¶æ€ç éªŒè¯**
   - Setup è¯·æ±‚: 201 Created
   - Order è¯·æ±‚: 201 (æˆåŠŸ) æˆ– 409 (åº“å­˜ä¸è¶³)
   - Cancel è¯·æ±‚: 200 OK
   - Delete è¯·æ±‚: 200/204

2. **å“åº”ä½“ç»“æ„éªŒè¯**
   - `success` å­—æ®µ: true/false
   - `data` å­—æ®µ: åŒ…å«èµ„æº ID å’Œè¯¦æƒ…
   - `error` å­—æ®µ: é”™è¯¯ç  (å¦‚ `ORD_BIZ_002`)

3. **ä¸šåŠ¡é€»è¾‘éªŒè¯**
   - è®¢å•çŠ¶æ€: `PENDING_PAYMENT`
   - é¢„å çŠ¶æ€: `RESERVED`
   - BOM ç»„ä»¶æ•°é‡: 3 ä¸ª
   - åº“å­˜æ•°é‡: ç¬¦åˆé¢„æœŸ

4. **ç¯å¢ƒå˜é‡è‡ªåŠ¨ä¿å­˜**
   - Setup é˜¶æ®µè‡ªåŠ¨ä¿å­˜æ‰€æœ‰èµ„æº ID
   - Test é˜¶æ®µä½¿ç”¨ç¯å¢ƒå˜é‡å¼•ç”¨èµ„æº
   - Teardown é˜¶æ®µä½¿ç”¨ç¯å¢ƒå˜é‡åˆ é™¤èµ„æº

### æŸ¥çœ‹æµ‹è¯•ç»“æœ

#### Postman Desktop App
- æ‰§è¡Œè¯·æ±‚åï¼Œåˆ‡æ¢åˆ° `Test Results` æ ‡ç­¾
- æŸ¥çœ‹æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹çš„é€šè¿‡/å¤±è´¥çŠ¶æ€
- æŸ¥çœ‹ Console (View â†’ Show Postman Console) æŸ¥çœ‹æ—¥å¿—

#### Newman CLI
- æŸ¥çœ‹ç»ˆç«¯è¾“å‡ºçš„æµ‹è¯•æŠ¥å‘Š
- æ£€æŸ¥ JSON æŠ¥å‘Šæ–‡ä»¶ (`results.json`)
- æ£€æŸ¥ HTML æŠ¥å‘Šæ–‡ä»¶ (`report.html`)

---

## ğŸ› ï¸ å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: åç«¯æœåŠ¡æœªå¯åŠ¨

**ç—‡çŠ¶**: æ‰€æœ‰è¯·æ±‚è¿”å› `Error: connect ECONNREFUSED`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ
curl http://localhost:8080/actuator/health

# å¦‚æœæœªè¿è¡Œï¼Œå¯åŠ¨åç«¯æœåŠ¡
cd backend
./mvnw spring-boot:run
```

### é—®é¢˜ 2: Supabase è¿æ¥å¤±è´¥

**ç—‡çŠ¶**: åº“å­˜åˆå§‹åŒ–è¯·æ±‚è¿”å› `401 Unauthorized` æˆ– `403 Forbidden`

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ `supabase_url` æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥ `supabase_anon_key` æ˜¯å¦æ­£ç¡®
3. éªŒè¯ Supabase é¡¹ç›®æ˜¯å¦æ¿€æ´»

```bash
# æµ‹è¯• Supabase è¿æ¥
curl -H "apikey: YOUR_SUPABASE_ANON_KEY" \
  https://YOUR_PROJECT.supabase.co/rest/v1/
```

### é—®é¢˜ 3: æµ‹è¯•é—¨åº—æˆ–åˆ†ç±»ä¸å­˜åœ¨

**ç—‡çŠ¶**: SPU åˆ›å»ºè¯·æ±‚è¿”å› `400 Bad Request` æˆ– `404 Not Found`

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤æµ‹è¯•é—¨åº— ID å·²å­˜åœ¨äºæ•°æ®åº“:
   ```sql
   SELECT * FROM stores WHERE id = '00000000-0000-0000-0000-000000000099';
   ```

2. ç¡®è®¤é¥®å“åˆ†ç±» ID å·²å­˜åœ¨:
   ```sql
   SELECT * FROM categories WHERE id = '550e8400-e29b-41d4-a716-446655440003';
   ```

3. å¦‚æœä¸å­˜åœ¨ï¼Œéœ€è¦å…ˆåˆ›å»ºæµ‹è¯•é—¨åº—å’Œåˆ†ç±»

### é—®é¢˜ 4: BOM åˆ›å»ºå¤±è´¥ (null é”™è¯¯)

**ç—‡çŠ¶**: BOM åˆ›å»ºè¯·æ±‚è¿”å› `400 Bad Request`ï¼Œé”™è¯¯ä¿¡æ¯åŒ…å« "null"

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®è®¤ä½¿ç”¨æ­£ç¡®çš„ BOM æ ¼å¼ï¼š`componentType: "MATERIAL"` + `materialId`
- ä¸è¦ä½¿ç”¨ `componentId` å­—æ®µ
- å‚è€ƒ Setup/06-Create-BOM-Mojito çš„è¯·æ±‚ä½“æ ¼å¼

### é—®é¢˜ 5: ç¯å¢ƒå˜é‡æœªä¿å­˜

**ç—‡çŠ¶**: åç»­è¯·æ±‚æ‰¾ä¸åˆ°èµ„æº IDï¼Œè¿”å› `404 Not Found`

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤ Environment å·²é€‰æ‹© (`T009-local`)
2. æŸ¥çœ‹ Environment å˜é‡æ˜¯å¦å·²ä¿å­˜
3. æ£€æŸ¥ Test Scripts æ˜¯å¦æ­£ç¡®æ‰§è¡Œ (`pm.environment.set(...)`)
4. æŸ¥çœ‹ Postman Console çš„æ—¥å¿—è¾“å‡º

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

### é¡¹ç›®æ–‡æ¡£
- [åŠŸèƒ½è§„æ ¼](../spec.md) - å®Œæ•´çš„åŠŸèƒ½éœ€æ±‚å’ŒéªŒæ”¶æ ‡å‡†
- [å®æ–½è®¡åˆ’](../plan.md) - æŠ€æœ¯æ ˆå’Œå®æ–½ç­–ç•¥
- [æ•°æ®æ¨¡å‹](../data-model.md) - å®ä½“æ¨¡å‹å’Œæ•°æ®ç»“æ„
- [API å¥‘çº¦](../contracts/api-endpoints.md) - API ç«¯ç‚¹è¯¦ç»†æ–‡æ¡£
- [å¿«é€ŸæŒ‡å—](../quickstart.md) - å¿«é€Ÿå¼€å§‹å’Œé›†æˆåœºæ™¯

### API æ–‡æ¡£
- P001 SKU ä¸»æ•°æ®ç®¡ç†: `docs/api/P001-sku-master-data.md`
- P005 BOM åº“å­˜æ‰£å‡: `docs/api/P005-bom-inventory-deduction.md`
- O012 è®¢å•åº“å­˜é¢„å : `docs/api/O012-order-inventory-reservation.md`

### Postman æ–‡æ¡£
- [Postman Learning Center](https://learning.postman.com/)
- [Test Scripts Examples](https://learning.postman.com/docs/writing-scripts/test-scripts/)
- [Newman CLI Documentation](https://www.npmjs.com/package/newman)

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

### ä¿®æ”¹æµ‹è¯•æ•°æ®

å¦‚éœ€ä¿®æ”¹æµ‹è¯•æ•°æ®ï¼ˆå¦‚å¢åŠ åŸæ–™ã€è°ƒæ•´é…æ–¹ï¼‰ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

1. **ä¿®æ”¹ Environment æ–‡ä»¶**: æ›´æ–°å›ºå®šå˜é‡ï¼ˆå¦‚é—¨åº— IDï¼‰
2. **ä¿®æ”¹ Setup è¯·æ±‚**: æ›´æ–° SPUã€SKUã€BOM çš„è¯·æ±‚ä½“
3. **æ›´æ–°æµ‹è¯•åœºæ™¯**: æ ¹æ®æ–°é…æ–¹è°ƒæ•´è®¢å•æ•°é‡å’ŒéªŒè¯ç‚¹
4. **æ›´æ–°æ–‡æ¡£**: åŒæ­¥æ›´æ–°æœ¬ README å’Œ spec.md

### æ·»åŠ æ–°æµ‹è¯•åœºæ™¯

1. åœ¨ `Test Scenarios` æ–‡ä»¶å¤¹ä¸­æ·»åŠ æ–°è¯·æ±‚
2. ç¼–å†™ Test Scripts è¿›è¡Œè‡ªåŠ¨åŒ–éªŒè¯
3. åœ¨ README ä¸­æ·»åŠ åœºæ™¯è¯´æ˜
4. æ›´æ–° tasks.md æ·»åŠ æ–°ä»»åŠ¡é¡¹

### æäº¤å˜æ›´

```bash
# æäº¤ Collection å’Œ Environment å˜æ›´
git add specs/T009-e2e-postman-flow-test/postman/
git commit -m "feat(T009): update E2E test scenarios"

# æäº¤æ–‡æ¡£å˜æ›´
git add specs/T009-e2e-postman-flow-test/*.md
git commit -m "docs(T009): update E2E test documentation"
```

---

## ğŸ“ ç‰ˆæœ¬å†å²

### v1.0.0 (2026-01-14)
- âœ… åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ… Setupã€Test Scenariosã€Teardown ä¸‰é˜¶æ®µå®Œæ•´å®ç°
- âœ… 5 ä¸ªæ ¸å¿ƒæµ‹è¯•åœºæ™¯
- âœ… å®Œæ•´çš„ Test Scripts è‡ªåŠ¨åŒ–éªŒè¯
- âœ… ç¯å¢ƒå˜é‡è‡ªåŠ¨ç®¡ç†
- âœ… å®Œæ•´çš„ä½¿ç”¨æ–‡æ¡£

---

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»ï¼š
- **å›¢é˜Ÿ**: Cinema Business Center Platform Team
- **é‚®ç®±**: (å›¢é˜Ÿé‚®ç®±)
- **é¡¹ç›®ä»“åº“**: (Git ä»“åº“åœ°å€)

---

**Happy Testing! ğŸ‰**
