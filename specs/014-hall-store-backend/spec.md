# Feature Specification: 影厅资源后端建模（Store-Hall 一致性）

**Feature Branch**: `014-hall-store-backend`  
**Created**: 2025-12-16  
**Status**: Draft  
**Input**: User description: "基于影厅资源管理 构建后端应用 建模影厅资源表 & 门店-影厅关系（store, hall 基础表及字段设计）,考虑前后端的api 调用 与模型一致性"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 运营配置影厅主数据 (Priority: P1)

作为影厅/资源运营人员，我可以在统一的后台系统中为每个门店维护影厅主数据，
包括影厅名称、类型、容量、状态和标签等信息；保存后，前端“影厅资源管理”
页面可以按门店拉取最新的影厅列表，保证不同模块看到的影厅信息一致。

**Why this priority**: 没有稳定的影厅主数据，就无法开展任何排期、包场或资源
预约管理，这是整个资源管理域的基础能力。

**Independent Test**: 只实现本故事时，运营可以为指定门店创建/编辑/停用影厅；
前端通过对应 API 拉取门店下所有影厅并展示，数据字段与实体模型完全一致。

**Acceptance Scenarios**:

1. **Given** 系统中已存在门店 A，**When** 运营在后台为门店 A 新建一个影厅，
   填写名称、类型、容量和标签并保存，**Then** 数据被写入影厅主数据表，且
   前端通过查询门店 A 的影厅列表 API 能看到该新建影厅。
2. **Given** 影厅已存在并处于启用状态，**When** 运营将其状态修改为停用并保
   存，**Then** 影厅主数据表中状态更新为“停用”，前端影厅列表默认不再展示
   已停用影厅（除非显式选择包含停用状态）。

---

### User Story 2 - 建模门店-影厅关系 (Priority: P1)

作为系统架构/数据管理员，我希望后端有清晰的门店（Store）与影厅（Hall）
关系建模，支持一个门店下配置多个影厅，并能通过门店维度查询相应的影厅资
源；同时保留未来扩展（如影厅跨门店共享或复制模板）的空间。

**Why this priority**: 门店-影厅关系是排期、资源利用率统计和跨门店运营分析的
基础，必须在数据模型层面设计清晰，避免后续频繁变更表结构。

**Independent Test**: 只实现本故事时，可以在数据库中通过 Store 与 Hall 之间的
关系准确查询出某一门店下的所有影厅，并在前端按门店维度展示；删除或停用门
店时，对应影厅关系得到合理处理。

**Acceptance Scenarios**:

1. **Given** 门店表中存在门店 A 和 B，且为门店 A 配置了 3 个影厅，为门店 B
   配置了 1 个影厅，**When** 按门店 A 查询影厅列表，**Then** 只返回门店 A 拥
   有的 3 个影厅，不包含门店 B 的影厅。
2. **Given** 门店 A 下存在多个影厅，**When** 门店 A 被标记为“停用”或“关
   闭”，**Then** 影厅与门店的关系仍然保留以供历史查询，但前端默认不再在新
   建排期界面中展示该门店及其影厅。

---

### User Story 3 - 前后端 API 与模型一致性 (Priority: P2)

作为前端开发者，我希望用于“影厅资源管理”和“排期甘特图”的后端 API 在数
据结构上与统一的 Hall/Store 模型保持一致，不同页面调用的是同一套实体字段
和标识，避免因字段不一致导致的转换、拼接或重复维护。

**Why this priority**: API 与模型不一致会导致前端重复映射字段、难以复用组件，
并容易产生数据同步错误，降低整体开发效率和可维护性。

**Independent Test**: 只实现本故事时，前端影厅资源管理页和排期甘特图页都可
以调用统一的“查询门店列表”“查询门店影厅列表”等接口，返回结构与 Hall/
Store 模型一致，无需额外字段映射即可驱动现有 UI 组件。

**Acceptance Scenarios**:

1. **Given** 后端提供了“按门店查询影厅列表”的接口，**When** 影厅资源管理页
   和排期页分别调用该接口，**Then** 两边收到的 Hall 结构字段完全一致（id、
   name、capacity、type、tags、status 等），且可直接用于现有前端类型定义。
2. **Given** 后端为门店提供了统一的 storeId 和名称字段，**When** 前端在不同
   页面（下拉选择门店、按门店筛选影厅、按门店统计资源占用）使用相关接口，
   **Then** 所有页面使用相同的标识和名称，无需手工转换或临时拼接字段。

---

### Edge Cases

- 门店被删除或长期关闭时，其历史影厅与排期记录如何保留和查询？
- 同一物理影厅是否允许跨门店迁移或复用名称？如何避免主键/编码冲突？
- 影厅被标记为停用后，是否允许仍然出现在历史报表和查询结果中？

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须提供维护影厅主数据的能力，包括创建、编辑、查看和停用
  影厅；每个影厅至少包含：唯一标识、名称、所属门店、类型、容量、状态、
  标签和创建/更新时间。
- **FR-002**: 系统必须提供维护门店主数据的能力，包括创建、编辑、查看和停用
  门店；门店实体至少包含：唯一标识、名称、城市/区域、状态和创建/更新时间。
- **FR-003**: 系统必须建模门店与影厅的关系，保证一个门店可以关联多个影厅；
  查询门店时可以联动查询该门店下全部影厅。
- **FR-004**: 系统必须提供按门店查询影厅列表的 API，支持通过门店标识过滤，
  并可选按照影厅状态和类型进行筛选，返回结构需与前端 Hall 类型保持字段一
  致（如 id、name、capacity、type、tags、status、createdAt、updatedAt）。
- **FR-005**: 系统必须提供查询门店列表的 API，用于前端选择门店和按门店筛选
  影厅，返回的门店标识和名称在所有前端页面中保持一致。
- **FR-006**: 当门店或影厅被停用时，系统必须阻止在新建排期和新建预约场景中
  使用对应门店/影厅，但仍允许在历史查询和报表中按条件查看其数据。
- **FR-007**: 系统必须在接口层进行必要的输入校验（例如容量为正整数、名称非
  空、类型在允许枚举值内），并在校验失败时返回明确的错误信息。

### Key Entities *(include if feature involves data)*

- **Store（门店）**: 表示影院业务中的一个物理门店或场地集合，关键属性包括：
  - storeId（系统内部唯一标识）
  - name（门店名称）
  - region / city（所属区域/城市）
  - status（启用/停用等枚举）
  - createdAt, updatedAt（时间戳）
  Store 与 Hall 之间存在一对多关系（一个 Store 下有多个 Hall）。

- **Hall（影厅）**: 表示可用于放映、包场或活动的具体空间，关键属性包括：
  - hallId（系统内部唯一标识）
  - storeId（所属门店标识）
  - name（影厅名称）
  - type（影厅类型，如 VIP/CP/Party/Public 等）
  - capacity（可容纳人数）
  - tags（标签列表，用于描述配套设施或特点）
  - status（启用/停用/维护等）
  - createdAt, updatedAt（时间戳）

- **StoreHall Relationship（门店-影厅关系）**: 在当前阶段可通过 Hall 中的 storeId
  表达一对多关系，未来如需支持影厅跨门店共享，可演进为单独的关联实体；在
  本规格中不强制要求多对多，仅需为未来扩展预留可能性并在数据模型设计中考
  虑到主键与唯一约束策略。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 运营人员可以在 5 分钟内为一个新门店完成所有影厅主数据的配置，
  包括创建至少 2 个影厅并在前端影厅资源管理页正确看到它们。
- **SC-002**: 前端影厅资源管理页和排期甘特图页在同一环境下对同一门店发起查
  询时，返回的影厅数量和关键信息（名称、类型、容量、状态）在 100% 情况下保
  持一致，无需手工字段映射。
- **SC-003**: 对于已停用门店或影厅，前端新建排期/预约界面中不会再展示它们，
  但运维/报表查询界面仍可通过筛选条件查看历史记录，验证率 100%。
- **SC-004**: 任意一次对影厅或门店主数据的修改，都可以通过后端日志或审计数
  据追踪到操作时间与影响对象，审计抽查通过率 100%。 
