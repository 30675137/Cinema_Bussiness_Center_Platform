# 采购入库模块操作手册

**@spec N001-purchase-inbound**
**版本**: 1.0.0
**适用角色**: 采购管理员、仓库管理员、审批人
**最后更新**: 2026-01-11

---

## 目录

1. [模块概述](#1-模块概述)
2. [角色与权限](#2-角色与权限)
3. [采购订单管理](#3-采购订单管理)
4. [订单审批流程](#4-订单审批流程)
5. [收货入库操作](#5-收货入库操作)
6. [订单跟踪与查询](#6-订单跟踪与查询)
7. [常见问题与解决方案](#7-常见问题与解决方案)

---

## 1. 模块概述

### 1.1 功能简介

采购入库模块用于管理影院商品的采购全流程，包括：

- **采购订单**: 向供应商采购商品的订单管理
- **订单审批**: 采购订单的审核流程
- **收货入库**: 商品到货后的验收与入库
- **库存更新**: 收货后自动更新门店库存

### 1.2 业务流程图

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  创建订单   │ ──→ │  提交审核   │ ──→ │  审批通过   │ ──→ │  收货入库   │
│  (草稿)    │     │  (待审核)   │     │  (已审核)   │     │  (更新库存) │
└─────────────┘     └─────────────┘     └─────────────┘     └─────────────┘
       │                   │                                       │
       │                   │ 审批拒绝                               │ 部分收货
       │                   ↓                                       ↓
       │            ┌─────────────┐                        ┌─────────────┐
       │            │   已拒绝    │                        │  部分收货   │
       │            │  (可修改)   │                        │  (继续收)  │
       │            └─────────────┘                        └─────────────┘
       │
       └──→ 删除订单 (仅草稿可删)
```

### 1.3 订单状态说明

| 状态 | 英文标识 | 说明 | 可执行操作 |
|------|---------|------|-----------|
| 草稿 | DRAFT | 订单已创建，未提交 | 编辑、删除、提交审核 |
| 待审核 | PENDING_APPROVAL | 已提交，等待审批 | 审批通过、审批拒绝 |
| 已审核 | APPROVED | 审批通过，可收货 | 创建收货单 |
| 已拒绝 | REJECTED | 审批未通过 | 修改后重新提交 |
| 部分收货 | PARTIAL_RECEIVED | 已部分收货 | 继续收货 |
| 全部收货 | FULLY_RECEIVED | 全部商品已收货 | 关闭订单 |
| 已关闭 | CLOSED | 订单已完结 | 无 |

---

## 2. 角色与权限

### 2.1 角色定义

| 角色 | 职责 | 主要操作 |
|------|------|---------|
| **采购管理员** | 创建和管理采购订单 | 新建订单、提交审核、跟踪订单 |
| **仓库管理员** | 负责收货入库 | 创建收货单、确认收货、质检 |
| **审批人** | 审核采购订单 | 审批通过、审批拒绝 |
| **门店管理员** | 查看本门店订单 | 查询订单、查看库存 |

### 2.2 权限矩阵

| 功能 | 采购管理员 | 仓库管理员 | 审批人 | 门店管理员 |
|------|:--------:|:--------:|:-----:|:--------:|
| 创建采购订单 | ✅ | ❌ | ❌ | ❌ |
| 编辑采购订单 | ✅ | ❌ | ❌ | ❌ |
| 删除采购订单 | ✅ | ❌ | ❌ | ❌ |
| 提交审核 | ✅ | ❌ | ❌ | ❌ |
| 审批通过/拒绝 | ❌ | ❌ | ✅ | ❌ |
| 创建收货单 | ❌ | ✅ | ❌ | ❌ |
| 确认收货 | ❌ | ✅ | ❌ | ❌ |
| 查看订单列表 | ✅ | ✅ | ✅ | ✅ |
| 查看订单详情 | ✅ | ✅ | ✅ | ✅ |
| 查看统计数据 | ✅ | ✅ | ✅ | ❌ |

---

## 3. 采购订单管理

### 3.1 新建采购订单

**操作路径**: 采购管理 → 采购订单 → 新建订单

**操作步骤**:

1. **点击"新建订单"按钮**

2. **填写订单基本信息**:
   | 字段 | 必填 | 说明 |
   |------|:----:|------|
   | 供应商 | ✅ | 从供应商列表选择 |
   | 目标门店 | ✅ | 收货门店 |
   | 计划到货日期 | ❌ | 预计到货时间 |
   | 备注 | ❌ | 订单备注信息 |

3. **添加采购明细**:
   - 点击"添加商品"按钮
   - 搜索并选择 SKU
   - 输入采购数量
   - 输入采购单价
   - 系统自动计算行小计

4. **核对信息**:
   - 检查商品明细
   - 核对总金额
   - 确认供应商和门店

5. **保存或提交**:
   - 点击"保存草稿": 订单状态为"草稿"
   - 点击"提交审核": 订单状态变为"待审核"

**示例**:
```
订单号: PO202601110001 (系统自动生成)
供应商: 百事可乐华南分公司
目标门店: 北京朝阳万达店
计划到货日期: 2026-01-20

采购明细:
┌────────────────┬────────┬────────┬──────────┐
│ 商品名称        │ 数量   │ 单价   │ 小计     │
├────────────────┼────────┼────────┼──────────┤
│ 百事可乐 500ml  │ 100 瓶 │ ¥2.50  │ ¥250.00  │
│ 七喜 500ml     │ 50 瓶  │ ¥2.30  │ ¥115.00  │
│ 美年达 500ml   │ 80 瓶  │ ¥2.40  │ ¥192.00  │
└────────────────┴────────┴────────┴──────────┘
                              订单总金额: ¥557.00
```

### 3.2 编辑采购订单

**前提条件**: 订单状态为"草稿"或"已拒绝"

**操作路径**: 采购订单列表 → 点击订单 → 编辑

**可修改内容**:
- 供应商
- 计划到货日期
- 备注
- 采购明细（增删改商品、数量、单价）

**注意事项**:
- ⚠️ 已提交审核的订单无法编辑
- ⚠️ 已审核通过的订单无法编辑
- ✅ 被拒绝的订单可以修改后重新提交

### 3.3 删除采购订单

**前提条件**: 订单状态为"草稿"

**操作路径**: 采购订单列表 → 选择订单 → 删除

**操作步骤**:
1. 在订单列表中找到要删除的订单
2. 点击"删除"按钮
3. 确认删除对话框中点击"确定"

**注意事项**:
- ⚠️ 只有"草稿"状态的订单可以删除
- ⚠️ 删除操作不可恢复
- ❌ 已提交、已审核的订单不能删除

### 3.4 提交审核

**前提条件**: 订单状态为"草稿"，订单明细不为空

**操作路径**: 订单详情页 → 提交审核

**操作步骤**:
1. 打开采购订单详情
2. 核对订单信息无误
3. 点击"提交审核"按钮
4. 确认提交

**提交后**:
- 订单状态变为"待审核"
- 系统通知审批人有新订单待审批
- 订单进入只读状态，无法编辑

---

## 4. 订单审批流程

### 4.1 查看待审批订单

**操作路径**: 采购管理 → 待审批订单

**待审批列表显示**:
- 订单号
- 供应商名称
- 目标门店
- 订单金额
- 提交人
- 提交时间

### 4.2 审批通过

**操作步骤**:
1. 打开待审批订单详情
2. 审核订单内容：
   - 检查供应商是否正确
   - 核对采购商品和数量
   - 确认采购单价合理
   - 查看总金额
3. 点击"审批通过"按钮
4. 确认审批

**审批后**:
- 订单状态变为"已审核"
- 系统记录审批人和审批时间
- 订单可以进行收货入库

### 4.3 审批拒绝

**操作步骤**:
1. 打开待审批订单详情
2. 审核发现问题
3. 点击"审批拒绝"按钮
4. **填写拒绝原因**（必填）:
   - 如："采购单价高于市场价"
   - 如："采购数量超出本月预算"
   - 如："供应商资质待确认"
5. 确认拒绝

**拒绝后**:
- 订单状态变为"已拒绝"
- 系统记录拒绝原因
- 通知订单创建人
- 创建人可修改后重新提交

### 4.4 重新提交

**前提条件**: 订单状态为"已拒绝"

**操作步骤**:
1. 打开被拒绝的订单
2. 查看拒绝原因
3. 点击"编辑"修改订单内容
4. 修正问题后点击"重新提交"

---

## 5. 收货入库操作

### 5.1 创建收货单

**前提条件**: 采购订单状态为"已审核"或"部分收货"

**操作路径**: 采购管理 → 收货入库 → 新建收货单

**操作步骤**:

1. **选择采购订单**:
   - 从已审核订单列表中选择
   - 或通过订单号搜索

2. **填写收货信息**:
   | 字段 | 必填 | 说明 |
   |------|:----:|------|
   | 采购订单 | ✅ | 关联的采购订单 |
   | 备注 | ❌ | 收货备注 |

3. **录入收货明细**:
   - 系统自动带出订单明细
   - 输入本次实际收货数量
   - 选择质检状态

4. **质检状态选择**:
   | 状态 | 说明 | 后续处理 |
   |------|------|---------|
   | 合格 | 商品质量合格 | 正常入库 |
   | 不合格 | 商品质量不合格 | 需填写原因，不入库 |
   | 待检验 | 需进一步检验 | 暂不入库 |

5. **保存收货单**:
   - 点击"保存"按钮
   - 收货单状态为"待确认"

**示例**:
```
收货单号: GR202601150001 (系统自动生成)
关联采购订单: PO202601110001
收货门店: 北京朝阳万达店

收货明细:
┌────────────────┬──────────┬──────────┬──────────┬────────────┐
│ 商品名称        │ 订购数量  │ 本次收货  │ 质检状态  │ 备注       │
├────────────────┼──────────┼──────────┼──────────┼────────────┤
│ 百事可乐 500ml  │ 100 瓶   │ 100 瓶   │ ✅ 合格   │            │
│ 七喜 500ml     │ 50 瓶    │ 50 瓶    │ ✅ 合格   │            │
│ 美年达 500ml   │ 80 瓶    │ 70 瓶    │ ✅ 合格   │ 差10瓶待补 │
└────────────────┴──────────┴──────────┴──────────┴────────────┘
```

### 5.2 确认收货

**前提条件**: 收货单状态为"待确认"

**操作路径**: 收货单详情 → 确认收货

**操作步骤**:
1. 核对收货单信息
2. 确认实物已清点
3. 点击"确认收货"按钮
4. 系统自动处理：
   - 更新库存数量
   - 更新采购订单状态
   - 记录收货时间

**确认后系统自动执行**:

```
库存更新:
┌────────────────┬────────────┬────────────┬────────────┐
│ 商品           │ 收货前库存  │ 本次入库   │ 收货后库存  │
├────────────────┼────────────┼────────────┼────────────┤
│ 百事可乐 500ml │ 50 瓶      │ +100 瓶    │ 150 瓶     │
│ 七喜 500ml    │ 0 瓶       │ +50 瓶     │ 50 瓶      │
│ 美年达 500ml  │ 20 瓶      │ +70 瓶     │ 90 瓶      │
└────────────────┴────────────┴────────────┴────────────┘

采购订单状态更新:
- 原状态: 已审核
- 新状态: 部分收货 (美年达还差10瓶)
```

### 5.3 部分收货

当实际收货数量少于订购数量时：

1. **创建收货单时**:
   - 填写实际收到的数量
   - 可在备注说明原因

2. **确认收货后**:
   - 采购订单状态变为"部分收货"
   - 订单明细显示已收数量和待收数量

3. **后续收货**:
   - 可针对同一采购订单创建多次收货单
   - 直到全部商品收齐

**示例**:
```
采购订单 PO202601110001 收货进度:

┌────────────────┬──────────┬──────────┬──────────┬────────────────┐
│ 商品名称        │ 订购数量  │ 已收数量  │ 待收数量  │ 状态           │
├────────────────┼──────────┼──────────┼──────────┼────────────────┤
│ 百事可乐 500ml  │ 100 瓶   │ 100 瓶   │ 0 瓶     │ ✅ 已全部收货   │
│ 七喜 500ml     │ 50 瓶    │ 50 瓶    │ 0 瓶     │ ✅ 已全部收货   │
│ 美年达 500ml   │ 80 瓶    │ 70 瓶    │ 10 瓶    │ ⏳ 待继续收货   │
└────────────────┴──────────┴──────────┴──────────┴────────────────┘

订单状态: 部分收货
```

### 5.4 取消收货单

**前提条件**: 收货单状态为"待确认"

**操作路径**: 收货单详情 → 取消

**使用场景**:
- 收货信息录入错误
- 供应商临时撤回发货
- 其他需要取消的情况

**注意事项**:
- ⚠️ 已确认的收货单无法取消
- ⚠️ 取消后库存不会变化

---

## 6. 订单跟踪与查询

### 6.1 订单列表查询

**操作路径**: 采购管理 → 采购订单

**筛选条件**:
| 条件 | 说明 |
|------|------|
| 订单状态 | 草稿/待审核/已审核/已拒绝/部分收货/全部收货/已关闭 |
| 目标门店 | 按门店筛选 |
| 供应商 | 按供应商筛选 |
| 日期范围 | 创建时间范围 |
| 订单号 | 精确搜索 |

**列表展示**:
```
┌──────────────────┬────────────────┬──────────────┬──────────┬──────────┬────────────┐
│ 订单号           │ 供应商         │ 目标门店     │ 总金额   │ 状态     │ 创建时间   │
├──────────────────┼────────────────┼──────────────┼──────────┼──────────┼────────────┤
│ PO202601110001   │ 百事可乐华南   │ 北京朝阳万达 │ ¥557.00  │ 部分收货 │ 01-11 09:30│
│ PO202601110002   │ 可口可乐北京   │ 北京朝阳万达 │ ¥1,200   │ 待审核   │ 01-11 10:15│
│ PO202601100001   │ 统一集团       │ 上海徐汇店   │ ¥890.00  │ 已审核   │ 01-10 14:20│
└──────────────────┴────────────────┴──────────────┴──────────┴──────────┴────────────┘
```

### 6.2 订单详情查看

**操作路径**: 点击订单号进入详情页

**详情页内容**:

1. **基本信息**:
   - 订单号、状态
   - 供应商、目标门店
   - 计划到货日期
   - 创建人、创建时间
   - 审批人、审批时间（如有）

2. **订单明细**:
   - SKU 信息
   - 订购数量、单价、小计
   - 已收数量、待收数量

3. **状态变更历史**:
   ```
   时间线:
   ├─ 2026-01-11 09:30 创建订单 (张三)
   ├─ 2026-01-11 09:45 提交审核 (张三)
   ├─ 2026-01-11 10:00 审批通过 (李四)
   └─ 2026-01-15 14:30 部分收货 (王五)
   ```

4. **收货记录**:
   - 关联的收货单列表
   - 每次收货的数量和时间

### 6.3 订单统计摘要

**操作路径**: 采购管理 → 概览/仪表板

**统计卡片**:
```
┌─────────────┬─────────────┬─────────────┬─────────────┐
│   草稿      │   待审核    │   已审核     │  部分收货   │
│    5        │     3       │     10       │     2       │
│   订单      │    订单     │    订单      │    订单     │
└─────────────┴─────────────┴─────────────┴─────────────┘
```

**支持筛选**:
- 按门店查看各状态订单数量
- 按时间范围统计

---

## 7. 常见问题与解决方案

### 7.1 订单无法编辑

**问题**: 点击编辑按钮无反应或提示无权限

**原因**:
1. 订单不是"草稿"或"已拒绝"状态
2. 当前用户不是订单创建人
3. 没有编辑权限

**解决方案**:
- 检查订单状态，只有草稿和已拒绝状态可编辑
- 联系管理员确认权限

### 7.2 订单无法删除

**问题**: 删除按钮灰色或提示无法删除

**原因**: 订单状态不是"草稿"

**解决方案**:
- 只有草稿状态的订单可以删除
- 已提交的订单如需取消，请联系审批人拒绝

### 7.3 无法创建收货单

**问题**: "新建收货单"时找不到采购订单

**原因**:
1. 采购订单未审批通过
2. 采购订单已全部收货完成
3. 采购订单已关闭

**解决方案**:
- 确认采购订单状态为"已审核"或"部分收货"
- 联系审批人尽快审批

### 7.4 确认收货后库存未更新

**问题**: 收货确认成功，但库存查询显示数量未变

**原因**:
1. 页面缓存未刷新
2. 查询的门店不正确
3. 系统延迟

**解决方案**:
- 刷新页面或清除缓存
- 确认查询的是正确的门店
- 等待几秒后重新查询

### 7.5 审批拒绝后无法重新提交

**问题**: 修改被拒绝的订单后，找不到"重新提交"按钮

**原因**: 订单状态可能已变更

**解决方案**:
- 确认订单状态仍为"已拒绝"
- 保存修改后，页面会显示"重新提交"按钮
- 如问题持续，联系系统管理员

### 7.6 并发操作冲突

**问题**: 提交时提示"数据已被修改，请刷新后重试"

**原因**: 其他用户同时修改了该订单

**解决方案**:
1. 点击"刷新"获取最新数据
2. 核对修改内容
3. 重新提交

---

## 附录

### A. 快捷键

| 快捷键 | 功能 |
|--------|------|
| `Ctrl + S` | 保存当前表单 |
| `Ctrl + Enter` | 提交表单 |
| `Esc` | 取消/关闭弹窗 |

### B. 字段说明

| 字段 | 说明 | 格式要求 |
|------|------|---------|
| 订单号 | 系统自动生成 | PO + 日期 + 4位序号 |
| 收货单号 | 系统自动生成 | GR + 日期 + 4位序号 |
| 采购数量 | 需要采购的数量 | 正数，最多3位小数 |
| 采购单价 | 单个商品价格 | 正数，最多2位小数 |
| 计划到货日期 | 预计到货时间 | YYYY-MM-DD 格式 |

### C. 联系支持

如遇到本手册未涵盖的问题，请联系：

- **系统管理员**: admin@cinema.com
- **技术支持热线**: 400-xxx-xxxx
- **工作时间**: 周一至周五 9:00-18:00

---

**文档版本历史**:

| 版本 | 日期 | 修改人 | 修改内容 |
|------|------|--------|---------|
| 1.0.0 | 2026-01-11 | Claude Code | 初始版本 |
