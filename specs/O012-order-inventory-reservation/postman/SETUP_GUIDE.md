# O012 æµ‹è¯•æ•°æ®å¿«é€Ÿå‡†å¤‡æŒ‡å—

## ğŸ¯ ç›®æ ‡

æœ¬æŒ‡å—å¸®åŠ©ä½ å¿«é€Ÿå‡†å¤‡ O012 è®¢å•åº“å­˜é¢„å æµ‹è¯•æ‰€éœ€çš„å®Œæ•´æµ‹è¯•æ•°æ®ã€‚

## ğŸ“¦ å‡†å¤‡å·¥ä½œ

### 1. ç¡®ä¿åç«¯æœåŠ¡è¿è¡Œ

```bash
cd backend
mvn spring-boot:run
```

æœåŠ¡åº”è¯¥è¿è¡Œåœ¨ `http://localhost:8080`

### 2. å¯¼å…¥ Postman Collection å’Œ Environment

1. æ‰“å¼€ Postman
2. Import â†’ é€‰æ‹©ä»¥ä¸‹æ–‡ä»¶ï¼š
   - `O012-setup-teardown.postman_collection.json`
   - `O012-local.postman_environment.json`
3. åœ¨å³ä¸Šè§’é€‰æ‹© Environment: **O012-Local**

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤1: è¿è¡Œ Setupï¼ˆé¦–æ¬¡å¿…éœ€ï¼‰

1. åœ¨ Postman å·¦ä¾§æ‰¾åˆ° Collection: **O012 - Setup & Teardown**
2. å±•å¼€ "Setup - å‡†å¤‡æµ‹è¯•æ•°æ®" æ–‡ä»¶å¤¹
3. ç‚¹å‡»æ–‡ä»¶å¤¹å³ä¾§çš„ **"Run"** æŒ‰é’®
4. åœ¨ Runner ç•Œé¢ï¼Œç¡®è®¤11ä¸ªè¯·æ±‚å…¨éƒ¨é€‰ä¸­
5. ç‚¹å‡» **"Run O012..."** å¼€å§‹æ‰§è¡Œ
6. ç­‰å¾…çº¦15-20ç§’ï¼Œæ‰€æœ‰è¯·æ±‚å®Œæˆ

**æˆåŠŸæ ‡å¿—**:
- æ‰€æœ‰ Tests æ˜¾ç¤ºç»¿è‰² âœ…
- Console æ˜¾ç¤º "æµ‹è¯•æ•°æ®å‡†å¤‡å®Œæˆ"
- ç¯å¢ƒå˜é‡ä¸­ä¿å­˜äº†æ‰€æœ‰åˆ›å»ºçš„ ID

### æ­¥éª¤2: ä½¿ç”¨åˆ›å»ºçš„æµ‹è¯•æ•°æ®

ç°åœ¨ä½ å¯ä»¥è¿è¡Œä¸»æµ‹è¯•äº†ï¼š

**æ–¹å¼A: æ‰‹åŠ¨æµ‹è¯•**
- å¯¼å…¥ `O012-order-reservation.postman_collection.json`
- ä½¿ç”¨ç¯å¢ƒå˜é‡ `{{test_sku_id_1}}` å’Œ `{{test_sku_id_2}}`

**æ–¹å¼B: æ•°æ®é©±åŠ¨æµ‹è¯•**
- å¯¼å…¥ `O012-data-driven.postman_collection.json`
- é€‰æ‹© CSV æ–‡ä»¶: `O012-test-data.csv`
- è¿è¡Œæµ‹è¯•

### æ­¥éª¤3: æ¸…ç†æµ‹è¯•æ•°æ®ï¼ˆå¯é€‰ï¼‰

æµ‹è¯•å®Œæˆåï¼Œæ¸…ç†ä¸´æ—¶æ•°æ®ï¼š

1. åœ¨åŒä¸€ä¸ª Collection ä¸­ï¼Œå±•å¼€ "Teardown - æ¸…ç†æµ‹è¯•æ•°æ®" æ–‡ä»¶å¤¹
2. ç‚¹å‡» **"Run"** æŒ‰é’®
3. è¿è¡Œ3ä¸ªæ¸…ç†è¯·æ±‚

**æ³¨æ„**: Teardown åªæ¸…ç†è®¢å•å’Œé¢„å è®°å½•ï¼ŒSKU å’Œåº“å­˜æ•°æ®ä¼šä¿ç•™ï¼Œå¯ä»¥ç»§ç»­ä½¿ç”¨ã€‚

## ğŸ“Š Setup åˆ›å»ºçš„æµ‹è¯•æ•°æ®

| èµ„æºç±»å‹ | åç§° | è§„æ ¼ | ç¯å¢ƒå˜é‡ |
|---------|------|------|---------|
| SPU | æµ‹è¯•é¥®å“SPU - Mojito | é¥®å“åˆ†ç±» | `test_spu_id` |
| åŸæ–™SKU | æœ—å§†é…’ | 0.15å…ƒ/ml | `test_material_rum_id` |
| åŸæ–™SKU | è–„è·å¶ | 0.05å…ƒ/g | `test_material_mint_id` |
| åŸæ–™SKU | è‹æ‰“æ°´ | 0.01å…ƒ/ml | `test_material_soda_id` |
| æˆå“SKU | è«å‰æ‰˜ | finished_product | `test_sku_id_1` |
| æˆå“SKU | è‰è“è«å‰æ‰˜ | finished_product | `test_sku_id_2` |
| BOMé…æ–¹ | è«å‰æ‰˜é…æ–¹ | 45mlæœ—å§†é…’ + 5gè–„è·å¶ + 200mlè‹æ‰“æ°´ | - |
| é—¨åº—åº“å­˜ | æœ—å§†é…’ | 5000mlï¼ˆçº¦110æ¯ï¼‰ | - |
| é—¨åº—åº“å­˜ | è–„è·å¶ | 500gï¼ˆçº¦100æ¯ï¼‰ | - |
| é—¨åº—åº“å­˜ | è‹æ‰“æ°´ | 20000mlï¼ˆçº¦100æ¯ï¼‰ | - |

**ç†è®ºæœ€å¤§åˆ¶ä½œé‡**: 100æ¯è«å‰æ‰˜ï¼ˆå—è–„è·å¶åº“å­˜é™åˆ¶ï¼‰

## ğŸ”§ å…³é”®æŠ€æœ¯ç‚¹

### BOM é…æ–¹ä½¿ç”¨ MATERIAL ç±»å‹

æœ¬ Setup ä½¿ç”¨äº†æ­£ç¡®çš„ BOM ç»„ä»¶ç±»å‹é…ç½®ï¼š

```json
{
  "finishedProductId": "{{test_sku_id_1}}",
  "components": [
    {
      "componentType": "MATERIAL",     // å…³é”®ï¼šä½¿ç”¨ MATERIAL ç±»å‹
      "materialId": "{{test_material_rum_id}}",  // å…³é”®ï¼šä½¿ç”¨ materialId
      "quantity": 45,
      "unit": "ml"
    }
  ],
  "wasteRate": 5.0
}
```

**åŸå› **: BOM ç»„ä»¶æ”¯æŒä¸¤ç§ç±»å‹ï¼š
- `MATERIAL` - ç‰©æ–™ç±»å‹ï¼Œä½¿ç”¨ `materialId`ï¼Œç›´æ¥ä½œä¸ºå¶å­èŠ‚ç‚¹
- `SKU` - SKU ç±»å‹ï¼Œä½¿ç”¨ `componentId`ï¼Œéœ€è¦é€’å½’å±•å¼€

### åº“å­˜åˆå§‹åŒ–ä½¿ç”¨ Supabase REST API

ç›´æ¥è°ƒç”¨ Supabase REST API åˆ›å»ºåº“å­˜è®°å½•ï¼š

```bash
POST {{supabase_url}}/rest/v1/store_inventory
Header: apikey: {{supabase_anon_key}}
Header: Prefer: return=representation

Body:
{
  "store_id": "00000000-0000-0000-0000-000000000099",
  "sku_id": "{{test_material_rum_id}}",
  "on_hand_qty": 5000,
  "available_qty": 5000,
  "reserved_qty": 0,
  "safety_stock": 500
}
```

## âš ï¸ å¸¸è§é—®é¢˜

### é—®é¢˜1: Setup æ‰§è¡Œå¤±è´¥

**ç—‡çŠ¶**: æŸä¸ªè¯·æ±‚è¿”å› 400 æˆ– 500 é”™è¯¯

**è§£å†³**:
1. æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ (`http://localhost:8080`)
2. æ£€æŸ¥ Supabase è¿æ¥é…ç½®ï¼ˆEnvironment ä¸­çš„ `supabase_url` å’Œ `supabase_anon_key`ï¼‰
3. æ£€æŸ¥æµ‹è¯•é—¨åº—æ˜¯å¦å­˜åœ¨ï¼ˆ`00000000-0000-0000-0000-000000000099`ï¼‰
4. æŸ¥çœ‹ Console é”™è¯¯æ—¥å¿—ï¼Œå®šä½å…·ä½“å¤±è´¥åŸå› 

### é—®é¢˜2: ç¯å¢ƒå˜é‡æœªä¿å­˜

**ç—‡çŠ¶**: åç»­è¯·æ±‚æ‰¾ä¸åˆ° `{{test_sku_id_1}}` ç­‰å˜é‡

**è§£å†³**:
1. ç¡®è®¤é€‰æ‹©äº†æ­£ç¡®çš„ Environment (`O012-Local`)
2. é‡æ–°è¿è¡Œ Setupï¼ŒæŸ¥çœ‹ Test Scripts æ˜¯å¦æ‰§è¡ŒæˆåŠŸ
3. æ‰‹åŠ¨æ£€æŸ¥ Environment å˜é‡åˆ—è¡¨

### é—®é¢˜3: åº“å­˜è®°å½•åˆ›å»ºå¤±è´¥

**ç—‡çŠ¶**: æ­¥éª¤8-10è¿”å› 409 Conflict é”™è¯¯

**åŸå› **: åº“å­˜è®°å½•å·²å­˜åœ¨ï¼ˆ`store_id + sku_id` å”¯ä¸€çº¦æŸï¼‰

**è§£å†³**:
1. å…ˆè¿è¡Œ Teardown æ¸…ç†æ•°æ®
2. æˆ–æ‰‹åŠ¨åˆ é™¤ Supabase ä¸­çš„ `store_inventory` è®°å½•
3. é‡æ–°è¿è¡Œ Setup

### é—®é¢˜4: BOM é…ç½®å¤±è´¥

**ç—‡çŠ¶**: æ­¥éª¤7è¿”å› 400 é”™è¯¯ï¼Œæç¤º "componentId is null"

**åŸå› **: ä½¿ç”¨äº†é”™è¯¯çš„ç»„ä»¶ç±»å‹é…ç½®

**è§£å†³**: ç¡®è®¤ä½¿ç”¨ `componentType: "MATERIAL"` å’Œ `materialId`ï¼Œè€Œä¸æ˜¯ `componentId`

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [CSV æ•°æ®é©±åŠ¨æµ‹è¯•æŒ‡å—](./CSV_USAGE_GUIDE.md) - è¯¦ç»†æµ‹è¯•æµç¨‹è¯´æ˜
- [O012 åŠŸèƒ½è§„èŒƒ](../spec.md) - åŠŸèƒ½éœ€æ±‚å’Œä¸šåŠ¡è§„åˆ™
- [O012 API æ–‡æ¡£](../api.yaml) - API æ¥å£å®šä¹‰
- [BOM å±•å¼€å®ç°](../../../backend/src/main/java/com/cinema/inventory/service/BomExpansionService.java) - BOM é€’å½’å±•å¼€é€»è¾‘

## ğŸ’¡ æœ€ä½³å®è·µ

1. **é¦–æ¬¡ä½¿ç”¨**: å®Œæ•´è¿è¡Œ Setup â†’ ä¸»æµ‹è¯• â†’ Teardown æµç¨‹ï¼Œç†Ÿæ‚‰æ•´ä¸ªæµ‹è¯•è¿‡ç¨‹
2. **æ—¥å¸¸æµ‹è¯•**: Setup åªéœ€è¿è¡Œä¸€æ¬¡ï¼Œåç»­å¯ä»¥é‡å¤ä½¿ç”¨ç›¸åŒçš„æµ‹è¯•æ•°æ®
3. **æ•°æ®éš”ç¦»**: å¦‚éœ€å¤šå¥—æµ‹è¯•æ•°æ®ï¼Œå¯ä»¥ä¿®æ”¹ Setup Collection ä¸­çš„é—¨åº—ID
4. **ç¯å¢ƒç®¡ç†**: ä¸ºä¸åŒç¯å¢ƒï¼ˆLocalã€Devã€Stagingï¼‰åˆ›å»ºç‹¬ç«‹çš„ Environment æ–‡ä»¶
5. **ç‰ˆæœ¬æ§åˆ¶**: å°† Collection å’Œ Environment æ–‡ä»¶æäº¤åˆ° Gitï¼Œæ–¹ä¾¿å›¢é˜Ÿå…±äº«

---

**æœ€åæ›´æ–°**: 2026-01-14  
**ç»´æŠ¤è€…**: Cinema Platform Team
