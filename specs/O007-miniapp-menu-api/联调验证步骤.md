# O007 小程序菜单与商品API 前后端联调验证步骤

**验证日期**: 2026-01-05
**验证人员**: [填写姓名]
**规格**: O007-miniapp-menu-api

---

## 📋 前置准备

### 1. 确认环境
- [ ] 后端服务正常运行（端口 8080）
- [ ] 数据库有测试数据（至少 2 个可见分类，每个分类有 3+ 商品）
- [ ] 前端小程序项目已安装依赖

### 2. 启动服务

**终端 1 - 后端服务**：
```bash
cd backend
./mvnw spring-boot:run

# 等待看到以下日志，确认启动成功：
# Started HallStoreBackendApplication in X.XXX seconds
```

**终端 2 - 小程序 H5**：
```bash
cd miniapp-ordering-taro
npm run dev:h5

# 等待看到：
# Listening at http://localhost:10086
```

---

## ✅ 验证步骤

### 步骤 1: 验证分类列表 API（后端）

**测试命令**：
```bash
curl http://localhost:8080/api/client/menu-categories
```

**预期结果**：
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid-xxx",
      "code": "COFFEE",
      "displayName": "精品咖啡",
      "sortOrder": 10,
      "isVisible": true
    },
    {
      "id": "uuid-yyy",
      "code": "ALCOHOL",
      "displayName": "经典特调",
      "sortOrder": 20,
      "isVisible": true
    }
    // ... 更多分类
  ]
}
```

**验收标准**：
- [ ] 返回状态码 200
- [ ] `success` 字段为 `true`
- [ ] `data` 数组不为空
- [ ] 每个分类包含 `id`, `code`, `displayName`, `sortOrder`, `isVisible` 字段
- [ ] 分类按 `sortOrder` 升序排列
- [ ] 只返回 `isVisible: true` 的分类

---

### 步骤 2: 验证商品列表 API（后端）

**测试命令 1 - 获取所有商品**：
```bash
curl http://localhost:8080/api/client/channel-products/mini-program
```

**测试命令 2 - 按分类筛选**（需要替换 `{categoryId}` 为实际 ID）：
```bash
# 从步骤 1 的结果中复制一个分类的 id
curl "http://localhost:8080/api/client/channel-products/mini-program?categoryId={categoryId}"
```

**预期结果**：
```json
{
  "success": true,
  "data": [
    {
      "id": "product-uuid-1",
      "skuId": "sku-uuid-1",
      "displayName": "美式咖啡",
      "basePrice": 2800,
      "mainImage": "https://supabase-url/image.jpg",
      "category": {
        "id": "uuid-xxx",
        "code": "COFFEE",
        "displayName": "精品咖啡"
      },
      "isRecommended": true,
      "status": "ACTIVE"
    }
    // ... 更多商品
  ],
  "total": 10
}
```

**验收标准**：
- [ ] 返回状态码 200
- [ ] `success` 字段为 `true`
- [ ] `data` 数组包含商品
- [ ] 每个商品包含 `id`, `displayName`, `basePrice`, `mainImage`, `category` 字段
- [ ] `category` 对象包含 `id`, `code`, `displayName`
- [ ] 使用 `categoryId` 参数时，只返回该分类下的商品
- [ ] 所有商品的 `status` 为 `ACTIVE`

---

### 步骤 3: 验证小程序前端集成

**操作步骤**：

1. **打开小程序 H5 页面**：
   - 浏览器访问：http://localhost:10086
   - 进入菜单/点餐页面

2. **验证分类菜单显示**：
   - [ ] 页面顶部显示分类标签栏
   - [ ] 分类标签包含"全部"选项 + 后端返回的所有分类
   - [ ] 分类名称使用后端返回的 `displayName`（如"精品咖啡"、"经典特调"）
   - [ ] 默认选中"全部"分类

3. **验证商品列表显示**：
   - [ ] 商品以卡片形式展示
   - [ ] 每个商品卡片显示：
     - 商品图片（`mainImage`）
     - 商品名称（`displayName`）
     - 价格（`basePrice` 从分转元，如 2800 → ¥28.00）
   - [ ] 推荐商品显示"推荐"角标（`isRecommended: true`）

4. **验证分类切换功能**：
   - [ ] 点击"精品咖啡"分类标签
   - [ ] 列表只显示咖啡类商品
   - [ ] 选中的分类标签高亮显示
   - [ ] 点击"全部"分类，显示所有商品

5. **验证加载状态**：
   - [ ] 首次加载时显示加载动画或骨架屏
   - [ ] 数据加载完成后显示商品列表
   - [ ] 切换分类时有加载状态反馈

---

### 步骤 4: 验证错误处理（可选）

**测试场景 1 - 网络异常**：
1. 停止后端服务：在终端 1 按 `Ctrl+C`
2. 刷新小程序页面
3. **预期**：显示"加载失败，请重试"提示和重试按钮

**测试场景 2 - 空分类**：
1. 后端确保某个分类下无商品
2. 小程序选择该分类
3. **预期**：显示"暂无该分类商品"空状态提示

---

## 📊 验收结果记录

### 后端 API 验证

| 验证项 | 通过 | 备注 |
|--------|------|------|
| 分类列表 API 返回正确 | ☐ |  |
| 商品列表 API 返回正确 | ☐ |  |
| 分类筛选功能正常 | ☐ |  |
| 数据格式符合规范 | ☐ |  |

### 前端集成验证

| 验证项 | 通过 | 备注 |
|--------|------|------|
| 分类菜单正确显示 | ☐ |  |
| 商品列表正确显示 | ☐ |  |
| 分类切换功能正常 | ☐ |  |
| 价格格式化正确（分→元） | ☐ |  |
| 推荐角标显示正确 | ☐ |  |
| 加载状态显示正常 | ☐ |  |
| 错误提示显示正常 | ☐ |  |

---

## 🐛 问题记录

如发现问题，请记录：

| 问题描述 | 严重程度 | 影响范围 | 状态 |
|---------|---------|---------|------|
| 示例：商品图片加载失败 | 中 | 前端显示 | 待修复 |
|  |  |  |  |
|  |  |  |  |

---

## ✅ 验收结论

- [ ] **通过验收** - 所有核心功能正常，可进入下一阶段
- [ ] **部分通过** - 存在次要问题，不影响主流程
- [ ] **未通过** - 存在严重问题，需要修复后重新验证

**签字确认**：
验证人：_____________  日期：_____________
审核人：_____________  日期：_____________

---

## 📝 备注

- 本验证步骤基于 O007-miniapp-menu-api 规格
- 相关文档：`specs/O007-miniapp-menu-api/spec.md`
- API 文档：`specs/O007-miniapp-menu-api/contracts/api.yaml`
