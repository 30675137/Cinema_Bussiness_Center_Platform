# Feature Specification: 门店预约设置

**Feature Branch**: `015-store-reservation-settings`  
**Created**: 2025-12-17  
**Status**: Draft  
**Input**: User description: "开发「门店预约设置」页面（门店维度：是否开放预约、可预约天数）,基于门店管理功能 开发"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 查看门店预约设置 (Priority: P1)

作为运营人员，我可以在门店管理页面或预约设置页面查看每个门店的预约配置信息（是否开放预约、可预约天数），这样我可以快速了解哪些门店支持预约以及预约规则。

**Why this priority**: 这是基础功能，运营人员需要先了解当前配置才能进行管理，这是所有后续操作的前提。

**Independent Test**: 只实现本故事时，运营人员可以打开门店预约设置页面，看到所有门店的预约配置列表，包括门店名称、是否开放预约、可预约天数等信息，数据与后端存储一致。

**Acceptance Scenarios**:

1. **Given** 系统中存在多个门店（部分开放预约，部分未开放），**When** 运营人员打开门店预约设置页面，**Then** 页面显示所有门店的预约配置信息，包括门店名称、是否开放预约状态、可预约天数
2. **Given** 门店预约设置页面已打开，**When** 运营人员查看某个门店的预约配置，**Then** 可以清楚看到该门店是否允许预约以及允许预约未来多少天
3. **Given** 某个门店尚未配置预约设置，**When** 运营人员查看该门店，**Then** 显示默认值（如：未开放预约、可预约天数为 0 或显示为"未设置"）

---

### User Story 2 - 配置门店预约设置 (Priority: P1)

作为运营人员，我可以为每个门店独立配置预约设置（开启/关闭预约功能、设置可预约天数），这样不同门店可以根据自身情况灵活设置预约规则。

**Why this priority**: 这是核心功能，允许运营人员根据门店实际情况灵活配置预约规则，满足不同门店的运营需求。

**Independent Test**: 只实现本故事时，运营人员可以选择一个门店，修改其预约设置（开启预约、设置可预约天数为 7 天），保存后该门店的预约配置被更新，其他门店的配置不受影响。

**Acceptance Scenarios**:

1. **Given** 运营人员打开门店预约设置页面，**When** 选择某个门店并点击"编辑"或"设置"，**Then** 显示预约设置表单，包含"是否开放预约"开关和"可预约天数"输入框
2. **Given** 运营人员正在编辑门店 A 的预约设置，**When** 将"是否开放预约"设置为"开启"，"可预约天数"设置为 7，并保存，**Then** 门店 A 的预约配置被更新为"开放预约，可预约 7 天"，其他门店配置不变
3. **Given** 运营人员正在编辑门店 B 的预约设置，**When** 将"是否开放预约"设置为"关闭"并保存，**Then** 门店 B 的预约配置被更新为"未开放预约"，可预约天数字段被禁用或隐藏
4. **Given** 运营人员输入可预约天数为负数或超过合理范围（如 1000），**When** 尝试保存，**Then** 系统显示验证错误，提示可预约天数必须在合理范围内（如 1-365 天）

---

### User Story 3 - 批量配置门店预约设置 (Priority: P2)

作为运营人员，我可以批量选择多个门店并统一设置预约配置，这样我可以快速为多个门店应用相同的预约规则，提高配置效率。

**Why this priority**: 提高运营效率，当需要为多个门店设置相同规则时，避免逐个配置的重复操作。

**Independent Test**: 只实现本故事时，运营人员可以选择多个门店（如 3 个门店），批量设置"开放预约，可预约 7 天"，保存后这 3 个门店的预约配置都被更新为相同值。

**Acceptance Scenarios**:

1. **Given** 门店预约设置页面显示多个门店，**When** 运营人员勾选多个门店（至少 2 个），**Then** 显示批量操作工具栏，包含"批量设置"按钮
2. **Given** 运营人员已选择 3 个门店，**When** 点击"批量设置"并配置"开放预约，可预约 7 天"，**Then** 这 3 个门店的预约配置都被更新为相同值
3. **Given** 运营人员批量设置后，**When** 查看被批量设置的门店，**Then** 所有门店显示相同的预约配置值

---

### Edge Cases

- 门店被停用后，预约设置是否仍然可见和可编辑？还是应该禁用编辑功能？
- 可预约天数的合理范围是什么？是否有最小值和最大值限制？
- 如果门店已有关联的预约记录，修改预约设置（如从开放改为关闭）是否影响已有预约？
- 批量设置时，如果部分门店设置失败，如何处理？是全部回滚还是部分成功？
- 可预约天数是否允许为 0？如果为 0 且开放预约，是否意味着"允许预约但只能预约当天"？

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须提供门店预约设置查看功能，运营人员可以查看所有门店的预约配置信息（是否开放预约、可预约天数）
- **FR-002**: 系统必须支持为每个门店独立配置预约设置，包括"是否开放预约"（布尔值）和"可预约天数"（正整数）
- **FR-003**: 系统必须在保存预约设置时进行数据验证：可预约天数必须为正整数，范围在合理区间内（如 1-365 天）
- **FR-004**: 系统必须支持批量配置功能，允许运营人员选择多个门店并统一设置预约配置
- **FR-005**: 系统必须在门店预约设置页面显示门店基本信息（门店名称、状态等），以便运营人员识别门店
- **FR-006**: 系统必须提供预约设置的搜索和筛选功能，允许运营人员按门店名称、预约状态（开放/未开放）进行筛选
- **FR-007**: 系统必须保存预约设置的修改历史或时间戳，记录最后修改时间和操作人（如果支持审计）
- **FR-008**: 系统必须确保预约设置数据与门店主数据关联，每个门店的预约设置与门店 ID 一一对应
- **FR-009**: 系统必须在预约设置页面提供清晰的视觉反馈，区分已开放预约和未开放预约的门店
- **FR-010**: 系统必须支持预约设置的默认值：新建门店时，预约设置应使用系统默认值（如：未开放预约、可预约天数 0）

### Key Entities *(include if feature involves data)*

- **StoreReservationSettings（门店预约设置）**: 表示门店维度的预约配置，关键属性包括：
  - storeId（门店 ID，关联到 Store 实体）
  - isReservationEnabled（是否开放预约，布尔值）
  - maxReservationDays（可预约天数，正整数，表示允许预约未来多少天）
  - createdAt（创建时间）
  - updatedAt（最后更新时间）
  - updatedBy（最后更新人，如果支持用户追踪）

- **Store（门店）**: 来自现有门店管理功能，关键属性包括：
  - id（门店 ID）
  - name（门店名称）
  - status（门店状态：active/disabled）
  - 其他门店基本信息

- **StoreReservationSettings 与 Store 关系**: 一对一关系，每个门店有且仅有一个预约设置记录。如果门店被删除，对应的预约设置也应被删除或标记为已删除。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 运营人员可以在 30 秒内找到并查看任意门店的预约设置信息，查看成功率 100%
- **SC-002**: 运营人员可以在 1 分钟内完成单个门店的预约设置配置（包括打开页面、修改设置、保存），操作成功率 95% 以上
- **SC-003**: 运营人员可以批量配置 10 个门店的预约设置，在 2 分钟内完成，批量操作成功率 90% 以上
- **SC-004**: 预约设置数据与门店主数据保持一致性，门店 ID 关联准确率 100%，无孤立或重复的预约设置记录
- **SC-005**: 系统正确验证可预约天数输入，拒绝无效输入（负数、0、超出范围）的成功率 100%
- **SC-006**: 预约设置页面加载时间不超过 2 秒（门店数量 < 100），页面响应流畅，无明显卡顿

## Assumptions

- 预约设置是基于门店维度的，每个门店独立配置，不涉及影厅级别的预约设置
- 可预约天数表示"允许预约未来 N 天"，例如设置为 7 表示可以预约今天起未来 7 天内的时段
- 预约设置页面可以基于现有门店管理页面扩展，或作为独立页面但复用门店列表组件
- 门店预约设置数据需要持久化存储，建议存储在数据库中与门店表关联
- 系统支持用户身份识别，可以记录预约设置的修改人（如果支持审计功能）
- 可预约天数的合理范围默认为 1-365 天，可根据业务需求调整
- 当门店被停用时，预约设置仍然保留但可能影响实际预约功能（由预约模块处理）

## Out of Scope (一期不包含的功能)

- 影厅级别的预约设置（本功能仅支持门店维度）
- 预约设置的审批流程
- 预约设置的版本历史查看和回滚
- 预约设置的定时生效/失效功能
- 预约设置与具体预约订单的联动验证（由预约模块负责）
- 预约设置的权限细分（如：只读、编辑权限）
