# 商品工作台（列表 + 创建/编辑合并）

> **业务优先级**: 高
> **预计用户价值**: 显著提升运营效率，减少页面跳转50%以上
> **复杂度**: 中等 - 涉及复杂的UI状态管理和权限控制

---

## 1. 业务概述

### 1.1 问题背景
当前商品管理流程存在严重的效率问题：
- 运营人员需要在「商品列表」和「商品创建/编辑」页面间频繁跳转
- 上下文丢失导致重复操作和错误
- 新建商品流程冗长，平均耗时超过2分钟
- 缺乏统一的工作台体验，无法快速定位和处理商品

### 1.2 解决方案
将「商品列表」与「商品创建/编辑」合并到同一页面，采用单页双区布局：
- **左侧主区**：筛选区 + 数据表格，支持持续的检索和定位
- **右侧辅区**：抽屉面板，承载商品创建/编辑/查看操作
- **顶部工具条**：页面标题 + 全局操作按钮

### 1.3 业务价值
- **效率提升**：30秒内完成商品草稿创建
- **体验优化**：减少50%页面跳转，保持上下文连续性
- **数据治理**：强校验机制，状态驱动操作，变更可追踪

### 1.4 核心业务决策
- **已发布商品编辑策略**：采用强治理模式，已发布商品不可直接编辑，需创建草稿版本并审核后替换
- **权限模型**：已发布商品可编辑但必须走审核流程，支持批量操作和导出功能
- **数据完整性**：渐进式要求，草稿状态只需基础信息，已发布商品允许部分字段为空
- **批量操作**：单次处理上限50个商品，预期耗时控制在15秒内
- **变更追踪**：全字段变更记录，保留1年以满足审计要求

## Clarifications

### Session 2025-12-10

- Q: 商品状态流转策略 → A: 强治理策略，已发布商品不可直接编辑，需创建草稿版本并审核后替换
- Q: 商品状态与操作权限映射 → B: 已发布商品可编辑但必须走审核流程，支持批量操作和导出功能
- Q: 商品数据完整性要求 → B: 草稿状态基础信息，待审核状态完整信息，已发布状态基础信息（允许部分字段为空）
- Q: 批量操作限制 → B: 单次批量上限50个商品，仅导出和状态变更，预期耗时<15秒
- Q: 数据变更追踪 → B: 全字段变更记录，保留时间1年以满足审计要求

---

## 2. 用户故事

### 2.1 主要用户故事

**US-1: 快速创建商品**
> 作为运营人员，我希望能在一个页面内完成商品从搜索到创建的全流程，以便在30秒内创建商品草稿

**US-2: 就地编辑商品**
> 作为运营人员，我希望能在查看商品列表的同时编辑商品信息，避免页面跳转和上下文丢失

**US-3: 批量操作商品**
> 作为运营人员，我希望能够批量处理多个商品（如批量提交审核、批量导出），提高工作效率

**US-4: 状态驱动操作**
> 作为运营人员，我希望系统能根据商品状态智能显示相关操作按钮，避免无效操作

**US-5: 简化运营体验**
> 作为运营人员，我希望系统界面简洁高效，只显示我需要的核心功能，避免信息过载

### 2.2 用户旅程

**新建商品流程**（目标: 30秒）
1. 进入商品工作台 → 点击「+新建商品」→ 右侧面板打开
2. 焦点自动落在「类目」字段 → 选择类目 → 系统自动带出物料类型
3. 填写最小必填项（类目、SKU名称、基础价）→ 点击「保存草稿」
4. 系统保存成功 → 左侧列表新增行并高亮定位3-5秒 → 右侧面板自动打开编辑模式

**编辑商品流程**
1. 在列表中找到目标商品 → 点击行 → 右侧面板打开显示商品详情
2. 根据商品状态和权限，面板显示为查看/编辑模式
3. 修改商品信息 → 点击「保存草稿」或「提交审核」
4. 系统保存成功 → 左侧对应行数据更新 → 面板保持打开状态

---

## 3. 功能需求

### 3.1 页面布局与结构

**FR-1: 单页双区布局**
- 左侧主区：包含筛选区（顶部）和数据表格（主体）
- 右侧辅区：可折叠的抽屉面板，承载商品编辑/查看
- 顶部工具条：页面标题 + 全局操作按钮
- 响应式设计：移动端右侧面板以全屏覆盖方式打开

**FR-2: 顶部工具条**
- 页面标题：商品工作台
- 全局操作按钮（按权限显示）：
  - `+ 新建商品`（Primary按钮）
  - `批量导入`
  - `导出`
  - `刷新`
- 帮助入口（可选）：状态说明、字段说明、操作指引

### 3.2 筛选区功能

**FR-3: 基础筛选字段**
- 商品名称：模糊查询，支持实时搜索
- SKU ID：精确查询，支持扫码输入
- 类目：多选树形选择器，支持父级类目批量选择
- 状态：多选（草稿、待审核、已发布、驳回、异常）
- 物料类型：下拉选择（成品、原材料、耗材）

**FR-4: 高级筛选字段**
- 品牌：下拉选择器
- 更新时间范围：日期区间选择器
- 创建人：下拉选择器

**FR-5: 筛选交互**
- 一键清空所有筛选条件
- 回车键触发搜索
- 筛选条件变更支持防抖刷新（300ms延迟）
- 支持保存常用筛选方案（最多5个）

### 3.3 数据表格功能

**FR-6: 表格列配置**
- 商品名称：支持高亮搜索关键词
- SKU ID：支持扫码识别
- 类目：显示完整类目路径
- 物料类型：标签式显示
- 状态：统一颜色标签（草稿-灰色、待审核-橙色、已发布-绿色、驳回-红色、异常-紫色）
- 基础价：显示货币格式
- 实时库存：高对比度显示，低于阈值时标红
- 更新时间：相对时间显示，悬停显示绝对时间

**FR-7: 表格能力**
- 分页：默认每页20条，支持10/20/50/100条切换
- 排序：支持更新时间、库存、价格、创建时间排序
- 行选择：支持单选/多选，全选功能
- 行点击：单击打开右侧面板，双击触发编辑

**FR-8: 行内快速信息**
- 待审核商品显示橙色角标
- 驳回商品显示红色徽章，悬停显示驳回原因
- 异常商品显示警告图标，悬停显示异常详情

### 3.4 行操作功能

**FR-9: 状态驱动行操作**
根据商品状态动态显示操作按钮：
- **查看**：所有状态可用，打开只读面板
- **编辑**：草稿、驳回状态可用；已发布商品可编辑但会创建草稿版本
- **提交审核**：草稿、驳回状态可用
- **发布**：管理员权限可用，直接发布已审核通过的草稿
- **复制创建**：所有状态可用，基于当前商品创建草稿
- **更多操作**：下架、归档、删除等管理操作

**FR-10: 批量操作**
- 选择多行后显示批量操作条，单次处理上限50个商品
- 批量提交审核
- 批量导出（导出勾选项或当前筛选结果）
- 批量状态变更（草稿→审核，审核→草稿等）
- 批量操作预期耗时：≤15秒

### 3.5 右侧面板功能

**FR-11: 面板模式**
- **创建模式**：新建商品，默认草稿状态
- **编辑模式**：编辑草稿或驳回状态商品
- **查看模式**：只读查看待审核商品，已发布商品需通过草稿版本编辑
- **已发布编辑模式**：点击编辑会创建新草稿版本，审核后替换原商品

**FR-12: 核心信息区块**
- 类目：必填，树形选择器
- 物料类型：类目联动自动带出，首次保存后锁定
- SPU/SKU名称：必填，支持实时验证重复
- 条码：支持手动输入或扫码
- 品牌：下拉选择器，支持快速搜索
- 单位：下拉选择器，根据类目自动过滤

**FR-13: 高级信息区块**
- 内容管理：图片、视频、富文本编辑器
- 规格与属性：动态规格矩阵，支持SKU扩展
- BOM/配方：仅成品显示，物料清单管理
- 定价入口：跳转定价中心并带入SKU参数

**FR-14: 底部操作区**
- 固定在面板底部，始终可见
- 操作按钮：
  - `保存草稿`：保存当前编辑但不提交审核
  - `提交审核`：保存并提交审核流程
  - `发布`：直接发布（需管理员权限）
  - `取消/关闭`：关闭面板，未保存时显示确认

### 3.6 数据验证与反馈

**FR-15: 数据校验**
- 实时字段验证（SKU重复、必填项检查）
- 保存前完整性校验
- 提交审核前强制数据完整性检查

**FR-16: 用户反馈**
- 未保存离开时显示二次确认对话框
- 保存成功显示Toast提示 + 列表自动刷新
- 校验失败时滚动定位到错误字段 + 高亮显示错误信息
- 操作耗时超过3秒时显示加载状态

---

## 4. 非功能需求

### 4.1 性能要求
- 页面加载时间：首次加载 < 3秒，后续加载 < 1秒
- 搜索响应时间：模糊查询 < 500ms，精确查询 < 200ms
- 切换操作：面板打开/关闭 < 300ms
- 批量操作：单次处理50个商品，完成时间 < 15秒

### 4.2 可用性要求
- 新建商品平均完成时间：30秒内完成草稿创建
- 学习成本：新用户15分钟内掌握基本操作
- 错误率：误操作率 < 1%，提供防呆设计
- 无障碍访问：支持键盘导航，符合WCAG 2.1标准

### 4.3 权限与安全
- 基于角色的权限控制（RBAC），仅支持运营人员角色
- 操作日志记录：全字段变更记录，保留1年满足审计要求
- 数据保护：敏感信息（成本、库存）按运营权限显示
- 会话管理：长时间无操作自动保存草稿
- 已发布商品编辑：通过草稿版本机制，确保数据安全

---

## 5. 成功标准

### 5.1 效率指标
- **创建效率**：新建商品平均耗时 ≤ 30秒
- **编辑效率**：商品编辑操作完成率 ≥ 95%
- **操作流畅度**：页面跳转次数减少 ≥ 50%
- **批量处理**：批量操作成功率 ≥ 98%，单次处理≤50个商品

### 5.2 用户体验指标
- **学习曲线**：新用户15分钟内完成首个商品创建
- **任务完成率**：商品管理任务完成率 ≥ 90%
- **用户满意度**：操作满意度评分 ≥ 4.5/5
- **错误率**：操作错误率 ≤ 1%

### 5.3 业务影响指标
- **工作效率**：运营人员日均处理商品数量提升 ≥ 30%
- **数据质量**：商品信息完整率 ≥ 95%
- **审核效率**：商品审核通过时间减少 ≥ 40%
- **系统稳定性**：功能可用性 ≥ 99.5%

---

## 6. 关键实体

### 6.1 商品实体 (Product)
```typescript
interface Product {
  id: string                    // 商品唯一标识
  sku: string                   // 商品SKU
  name: string                  // 商品名称
  category: Category            // 商品类目
  materialType: MaterialType    // 物料类型
  status: ProductStatus         // 商品状态
  basePrice: number             // 基础价格
  stock: number                 // 库存数量
  barcode?: string              // 条码
  brand?: Brand                 // 品牌
  unit?: Unit                   // 单位
  content?: ProductContent      // 内容信息
  specifications?: Spec[]       // 规格属性
  bom?: BOM                    // 物料清单
  createdAt: Date               // 创建时间
  updatedAt: Date               // 更新时间
  createdBy: User               // 创建人
  updatedBy: User               // 更新人
}
```

### 6.2 类目实体 (Category)
```typescript
interface Category {
  id: string
  name: string
  parentId?: string
  level: number
  children?: Category[]
  allowedMaterialTypes: MaterialType[]
}
```

### 6.3 审核记录实体 (AuditRecord)
```typescript
interface AuditRecord {
  id: string
  productId: string
  action: 'CREATE' | 'UPDATE' | 'DELETE' | 'STATUS_CHANGE'
  beforeState?: Product
  afterState?: Product
  reason?: string
  operator: User
  timestamp: Date
}
```

---

## 7. 假设与约束

### 7.1 业务假设
- [NEEDS CLARIFICATION: 商品状态流转策略] 当前文档提到策略A（强治理）和策略B（弱治理）两种已发布商品的编辑方式，需要确定采用哪种策略
- [NEEDS CLARIFICATION: 权限粒度设计] 需要明确不同角色（运营/店长/审核员/管理员）的具体操作权限边界
- 用户已有商品管理基础经验，无需从零开始学习
- 类目和物料类型关联关系已建立完整的数据字典
- 后端系统支持RESTful API和实时数据更新

### 7.2 技术约束
- 必须兼容现有用户权限系统
- 需要与现有定价、库存系统集成
- 移动端支持最低兼容iOS 12、Android 8
- 浏览器兼容性：Chrome 90+、Safari 14+、Edge 90+

### 7.3 业务约束
- 商品审核流程必须符合公司合规要求
- 数据变更必须可追溯，支持审计
- 不允许删除已发布商品，只能下架或归档
- 成本和库存数据对不同角色有访问权限控制

---

## 8. 风险与依赖

### 8.1 技术风险
- **性能风险**：大规模数据加载可能影响响应速度
  - 缓解措施：虚拟滚动、分页加载、数据懒加载
- **兼容性风险**：与现有系统集成可能存在接口不匹配
  - 缓解措施：API版本控制、向后兼容设计

### 8.2 业务风险
- **权限风险**：复杂的权限控制可能导致误操作
  - 缓解措施：二次确认机制、操作日志记录
- **数据质量风险**：批量操作可能产生大量数据错误
  - 缓解措施：批量预校验、分批处理、回滚机制

### 8.3 依赖关系
- **内部依赖**：用户权限系统、定价中心、库存管理系统
- **外部依赖**：条码扫描SDK、文件上传服务
- **关键路径**：权限系统完成才能进行用户角色功能开发