# E2E 测试用例文档: O011-order-checkout

**Feature**: 小程序订单确认与支付
**Spec ID**: O011-order-checkout
**版本**: 1.0.0
**创建日期**: 2026-01-06
**测试环境**: H5 开发环境 (localhost:10086)

---

## 测试概览

| 指标 | 数量 |
|------|------|
| 测试场景 | 4 |
| 测试用例 | 12 |
| 优先级 P0 | 6 |
| 优先级 P1 | 4 |
| 优先级 P2 | 2 |

---

## 测试场景 1: 购物车到订单确认页跳转

### TC-O011-001: 正常跳转到订单确认页

| 属性 | 值 |
|------|-----|
| 用例ID | TC-O011-001 |
| 优先级 | P0 |
| 前置条件 | 购物车中有至少1件商品 |
| 测试类型 | UI |

**测试步骤**:

| 步骤 | 操作 | 预期结果 | 实际结果 | 通过状态 |
|------|------|----------|----------|----------|
| 1 | 在菜单页添加商品到购物车 | 购物车图标显示数量角标 | | [ ] |
| 2 | 点击购物车图标打开购物车抽屉 | 抽屉从底部滑出，显示商品列表 | | [ ] |
| 3 | 点击"立即支付"按钮 | 抽屉关闭，页面跳转到 /pages/order-confirm/index | | [ ] |
| 4 | 检查订单确认页内容 | 显示商品清单、备注输入、金额汇总 | | [ ] |

---

### TC-O011-002: 空购物车阻止跳转

| 属性 | 值 |
|------|-----|
| 用例ID | TC-O011-002 |
| 优先级 | P0 |
| 前置条件 | 购物车为空 |
| 测试类型 | UI |

**测试步骤**:

| 步骤 | 操作 | 预期结果 | 实际结果 | 通过状态 |
|------|------|----------|----------|----------|
| 1 | 打开空购物车抽屉 | 显示"空空如也"提示 | | [ ] |
| 2 | 点击"立即支付"按钮 | 显示 Toast "购物车为空"，不跳转 | | [ ] |

---

### TC-O011-003: 商品信息正确展示

| 属性 | 值 |
|------|-----|
| 用例ID | TC-O011-003 |
| 优先级 | P1 |
| 前置条件 | 购物车有多件商品（含规格选项） |
| 测试类型 | UI |

**测试步骤**:

| 步骤 | 操作 | 预期结果 | 实际结果 | 通过状态 |
|------|------|----------|----------|----------|
| 1 | 添加"冰美式"选择"少冰+半糖" | 购物车显示商品和规格 | | [ ] |
| 2 | 添加"爆米花(大)" | 购物车显示第二件商品 | | [ ] |
| 3 | 跳转到订单确认页 | 商品清单显示2件商品 | | [ ] |
| 4 | 检查商品规格显示 | 冰美式显示"少冰 · 半糖" | | [ ] |
| 5 | 检查金额计算 | 小计 = 商品1价格×数量 + 商品2价格×数量 | | [ ] |

---

## 测试场景 2: 订单备注输入

### TC-O011-004: 正常输入备注

| 属性 | 值 |
|------|-----|
| 用例ID | TC-O011-004 |
| 优先级 | P2 |
| 前置条件 | 已进入订单确认页 |
| 测试类型 | UI |

**测试步骤**:

| 步骤 | 操作 | 预期结果 | 实际结果 | 通过状态 |
|------|------|----------|----------|----------|
| 1 | 点击备注输入区域 | 输入框获得焦点 | | [ ] |
| 2 | 输入"不要辣，少放盐" | 文字正常显示 | | [ ] |
| 3 | 检查字数统计 | 显示 "8/100" | | [ ] |

---

### TC-O011-005: 备注字数限制

| 属性 | 值 |
|------|-----|
| 用例ID | TC-O011-005 |
| 优先级 | P2 |
| 前置条件 | 已进入订单确认页 |
| 测试类型 | UI |

**测试步骤**:

| 步骤 | 操作 | 预期结果 | 实际结果 | 通过状态 |
|------|------|----------|----------|----------|
| 1 | 输入超过100字的内容 | 内容被截断在100字 | | [ ] |
| 2 | 检查字数统计 | 显示 "100/100" | | [ ] |

---

## 测试场景 3: Mock 支付流程

### TC-O011-006: 支付方式选择抽屉

| 属性 | 值 |
|------|-----|
| 用例ID | TC-O011-006 |
| 优先级 | P0 |
| 前置条件 | 已进入订单确认页，购物车非空 |
| 测试类型 | UI |

**测试步骤**:

| 步骤 | 操作 | 预期结果 | 实际结果 | 通过状态 |
|------|------|----------|----------|----------|
| 1 | 点击"确认支付"按钮 | PaymentSheet 从底部弹出 | | [ ] |
| 2 | 检查支付方式列表 | 显示微信支付、支付宝、Apple Pay | | [ ] |
| 3 | 点击遮罩层 | 抽屉关闭 | | [ ] |
| 4 | 再次点击"确认支付" | 抽屉再次弹出 | | [ ] |
| 5 | 点击"取消"按钮 | 抽屉关闭 | | [ ] |

---

### TC-O011-007: 选择支付方式并完成支付

| 属性 | 值 |
|------|-----|
| 用例ID | TC-O011-007 |
| 优先级 | P0 |
| 前置条件 | PaymentSheet 已打开 |
| 测试类型 | UI |

**测试步骤**:

| 步骤 | 操作 | 预期结果 | 实际结果 | 通过状态 |
|------|------|----------|----------|----------|
| 1 | 点击"微信支付"选项 | 抽屉关闭，显示加载遮罩 | | [ ] |
| 2 | 等待加载动画 | 显示"支付中..."文字和旋转图标 | | [ ] |
| 3 | 等待1.5秒 | 加载遮罩消失 | | [ ] |
| 4 | 检查页面跳转 | 跳转到 /pages/order-success/index | | [ ] |

---

### TC-O011-008: 支付过程防重复点击

| 属性 | 值 |
|------|-----|
| 用例ID | TC-O011-008 |
| 优先级 | P1 |
| 前置条件 | PaymentSheet 已打开 |
| 测试类型 | UI |

**测试步骤**:

| 步骤 | 操作 | 预期结果 | 实际结果 | 通过状态 |
|------|------|----------|----------|----------|
| 1 | 点击"支付宝"选项 | 显示加载遮罩 | | [ ] |
| 2 | 在加载期间尝试点击页面 | 点击被遮罩层阻挡，无响应 | | [ ] |

---

## 测试场景 4: 支付成功页

### TC-O011-009: 成功页信息展示

| 属性 | 值 |
|------|-----|
| 用例ID | TC-O011-009 |
| 优先级 | P0 |
| 前置条件 | 完成支付跳转到成功页 |
| 测试类型 | UI |

**测试步骤**:

| 步骤 | 操作 | 预期结果 | 实际结果 | 通过状态 |
|------|------|----------|----------|----------|
| 1 | 检查成功图标 | 显示绿色圆形勾选图标，有动画效果 | | [ ] |
| 2 | 检查成功标题 | 显示"支付成功" | | [ ] |
| 3 | 检查取餐号 | 显示大号橙色取餐编号（如 A001） | | [ ] |
| 4 | 检查订单编号 | 显示订单号（格式：ORD + 日期 + 6位随机） | | [ ] |
| 5 | 检查支付金额 | 显示支付金额（与订单确认页一致） | | [ ] |
| 6 | 检查预计等待 | 显示"10-15 分钟" | | [ ] |

---

### TC-O011-010: 取餐编号格式验证

| 属性 | 值 |
|------|-----|
| 用例ID | TC-O011-010 |
| 优先级 | P0 |
| 前置条件 | 完成多次支付 |
| 测试类型 | 功能 |

**测试步骤**:

| 步骤 | 操作 | 预期结果 | 实际结果 | 通过状态 |
|------|------|----------|----------|----------|
| 1 | 完成第一次支付 | 取餐号为 A001 | | [ ] |
| 2 | 返回首页，再次下单支付 | 取餐号为 A002 | | [ ] |
| 3 | 清除本地存储，再次支付 | 取餐号重置为 A001 | | [ ] |

---

### TC-O011-011: 返回首页功能

| 属性 | 值 |
|------|-----|
| 用例ID | TC-O011-011 |
| 优先级 | P1 |
| 前置条件 | 在支付成功页 |
| 测试类型 | UI |

**测试步骤**:

| 步骤 | 操作 | 预期结果 | 实际结果 | 通过状态 |
|------|------|----------|----------|----------|
| 1 | 点击"返回首页"按钮 | 页面跳转到 /pages/menu/index | | [ ] |
| 2 | 检查购物车状态 | 购物车已清空，数量角标消失 | | [ ] |
| 3 | 检查页面栈 | 使用 reLaunch，无法返回成功页 | | [ ] |

---

### TC-O011-012: 查看订单功能（预留）

| 属性 | 值 |
|------|-----|
| 用例ID | TC-O011-012 |
| 优先级 | P1 |
| 前置条件 | 在支付成功页 |
| 测试类型 | UI |

**测试步骤**:

| 步骤 | 操作 | 预期结果 | 实际结果 | 通过状态 |
|------|------|----------|----------|----------|
| 1 | 点击"查看订单"按钮 | 显示 Toast "订单功能开发中" | | [ ] |

---

## 数据验证

### DV-001: 本地订单存储验证

| 属性 | 值 |
|------|-----|
| 验证ID | DV-001 |
| 优先级 | P1 |
| 验证时机 | 支付成功后 |

**验证步骤**:

```javascript
// 在浏览器控制台或小程序开发工具中执行
const orders = Taro.getStorageSync('orders')
console.log('订单列表:', orders)

// 验证点:
// 1. orders 是数组
// 2. 最新订单在数组头部
// 3. 订单包含所有必要字段
```

**期望数据结构**:

```json
{
  "id": "uuid",
  "orderNumber": "ORD20260106XXXXXX",
  "userId": "mock-user-001",
  "status": "PAID",
  "productTotal": 39.00,
  "shippingFee": 0,
  "discountAmount": 0,
  "totalAmount": 39.00,
  "paymentMethod": "WECHAT_PAY",
  "paymentTime": "2026-01-06T10:30:00.000Z",
  "pickupNumber": "A001",
  "remark": "不要辣",
  "items": [
    {
      "id": "uuid",
      "productId": "prod-001",
      "productName": "冰美式",
      "productSpec": "冰量: 少冰, 甜度: 半糖",
      "quantity": 1,
      "unitPrice": 18.00,
      "subtotal": 18.00
    }
  ]
}
```

---

### DV-002: 取餐号计数器验证

| 属性 | 值 |
|------|-----|
| 验证ID | DV-002 |
| 优先级 | P1 |
| 验证时机 | 每次支付后 |

**验证步骤**:

```javascript
const counter = Taro.getStorageSync('pickupNumberCounter')
console.log('取餐号计数器:', counter)

// 验证点:
// 1. date 为当天日期 (YYYYMMDD)
// 2. letter 为当前字母 (A-Z)
// 3. number 为当前序号 (1-999)
```

---

## 缺陷记录

| 缺陷ID | 严重程度 | 关联用例 | 描述 | 状态 | 备注 |
|--------|----------|----------|------|------|------|
| - | - | - | - | - | - |

---

## 测试环境配置

### 开发环境

```bash
# 启动 H5 开发服务器
cd miniapp-ordering-taro
npm run dev:h5

# 访问地址
http://localhost:10086
```

### 测试数据准备

1. 确保菜单页有可用商品
2. 清除本地存储以重置状态：
   ```javascript
   Taro.clearStorageSync()
   ```

---

## 执行记录

| 执行日期 | 执行人 | 通过率 | 备注 |
|----------|--------|--------|------|
| - | - | - | - |

---

## 相关文档

- [spec.md](./spec.md) - 功能规格
- [plan.md](./plan.md) - 实施计划
- [tasks.md](./tasks.md) - 任务清单
- [data-model.md](./data-model.md) - 数据模型
