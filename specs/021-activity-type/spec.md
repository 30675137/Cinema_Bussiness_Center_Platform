# Feature Specification: 活动类型管理

**Feature Branch**: `016-activity-type`  
**Created**: 2025-12-18  
**Status**: Draft  
**Input**: User description: "作为运营人员，我希望在后台可以配置"活动类型"（企业团建 / 订婚 / 生日 Party 等），以便小程序端用户在预约时选择，方便后续服务与统计。"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 运营人员查看活动类型列表 (Priority: P1)

作为运营人员，我希望能够查看所有已配置的活动类型列表，包括启用和停用的类型，以便了解当前可用的活动类型配置情况。

**Why this priority**: 这是最基础的功能，运营人员需要先看到现有配置才能进行后续的维护操作。这是独立可测试的最小功能单元。

**Independent Test**: 运营人员登录后台，访问活动类型管理页面，可以看到所有活动类型的列表，包括名称、描述、状态、排序等信息。即使没有其他功能，这个列表也能提供价值。

**Acceptance Scenarios**:

1. **Given** 运营人员已登录后台系统，**When** 访问活动类型管理页面，**Then** 系统显示所有活动类型的列表，包括启用和停用的类型
2. **Given** 活动类型列表页面已打开，**When** 运营人员查看列表，**Then** 每个活动类型显示：名称、描述、状态（启用/停用）、排序号、创建时间
3. **Given** 活动类型列表包含多个类型，**When** 运营人员查看列表，**Then** 列表按排序号升序排列显示

---

### User Story 2 - 运营人员创建新活动类型 (Priority: P1)

作为运营人员，我希望能够创建新的活动类型（如"企业团建"、"订婚"、"生日Party"等），以便扩展小程序端用户可选择的预约类型。

**Why this priority**: 创建功能是核心功能之一，与查看功能同等重要，因为需要先有数据才能进行其他操作。可以独立测试和交付价值。

**Independent Test**: 运营人员点击"新建"按钮，填写活动类型信息（名称、描述、排序号），保存后可以在列表中看到新创建的活动类型。即使没有编辑和删除功能，创建功能也能独立提供价值。

**Acceptance Scenarios**:

1. **Given** 运营人员在活动类型列表页面，**When** 点击"新建"按钮，**Then** 系统弹出新建活动类型的表单弹窗
2. **Given** 新建活动类型表单已打开，**When** 运营人员填写名称、描述、排序号并保存，**Then** 系统创建新的活动类型，默认状态为"启用"，并在列表中显示
3. **Given** 运营人员填写活动类型信息，**When** 名称为空或已存在，**Then** 系统显示验证错误，不允许保存
4. **Given** 运营人员创建活动类型，**When** 保存成功，**Then** 系统记录创建时间和创建人信息

---

### User Story 3 - 运营人员编辑活动类型 (Priority: P2)

作为运营人员，我希望能够编辑已存在的活动类型信息（名称、描述、排序号），以便更新活动类型的配置。

**Why this priority**: 编辑功能是维护功能，虽然重要但优先级略低于创建，因为可以先创建新的来替代旧的。但编辑功能能提供更好的用户体验。

**Independent Test**: 运营人员在列表中选择一个活动类型，点击"编辑"，修改信息后保存，列表中显示更新后的信息。可以独立测试编辑功能是否正常工作。

**Acceptance Scenarios**:

1. **Given** 运营人员在活动类型列表页面，**When** 点击某个活动类型的"编辑"按钮，**Then** 系统弹出编辑表单，预填充该活动类型的当前信息
2. **Given** 编辑表单已打开，**When** 运营人员修改名称、描述或排序号并保存，**Then** 系统更新活动类型信息，并在列表中显示更新后的内容
3. **Given** 运营人员编辑活动类型，**When** 修改后的名称与其他活动类型重复，**Then** 系统显示验证错误，不允许保存
4. **Given** 运营人员编辑活动类型，**When** 保存成功，**Then** 系统记录更新时间

---

### User Story 4 - 运营人员启用/停用活动类型 (Priority: P1)

作为运营人员，我希望能够启用或停用活动类型，以便控制小程序端用户可以看到哪些活动类型。停用的类型不应在小程序端显示，但仍保留在后台用于统计和历史数据。

**Why this priority**: 启用/停用功能是核心业务需求，直接影响小程序端的用户体验。这是独立可测试的功能，可以独立交付价值。

**Independent Test**: 运营人员在列表中选择一个活动类型，点击"停用"，系统显示确认提示，确认后该活动类型状态变为"停用"，小程序端不再显示。可以独立测试状态切换功能。

**Acceptance Scenarios**:

1. **Given** 运营人员在活动类型列表页面，**When** 点击某个启用状态的活动类型的"停用"按钮，**Then** 系统弹出确认提示："确定要停用此活动类型吗？停用后小程序端将不再显示此类型"
2. **Given** 停用确认提示已显示，**When** 运营人员点击"确认"，**Then** 系统将该活动类型状态更新为"停用"，列表中状态显示更新
3. **Given** 运营人员在活动类型列表页面，**When** 点击某个停用状态的活动类型的"启用"按钮，**Then** 系统将该活动类型状态更新为"启用"，无需确认提示
4. **Given** 活动类型状态已更新，**When** 小程序端用户查看活动类型列表，**Then** 仅显示状态为"启用"的活动类型

---

### User Story 5 - 运营人员删除活动类型 (Priority: P3)

作为运营人员，我希望能够删除不再需要的活动类型，以便清理无效或过时的配置。删除操作采用软删除（逻辑删除），数据保留在数据库中，确保历史预约记录可以正常关联和显示活动类型信息。

**Why this priority**: 删除功能是维护功能，优先级较低，因为可以通过停用来达到类似效果。但删除功能可以彻底清理不再使用的配置，提供更好的数据管理体验。

**Independent Test**: 运营人员在列表中选择一个活动类型，点击"删除"，系统显示确认提示，确认后该活动类型状态变为"已删除"，不再在任何列表中显示。可以独立测试删除功能是否正常工作。

**Acceptance Scenarios**:

1. **Given** 运营人员在活动类型列表页面，**When** 点击某个活动类型的"删除"按钮，**Then** 系统弹出确认提示："确定要删除此活动类型吗？删除后该类型将不再显示，但历史预约记录仍可正常关联"
2. **Given** 删除确认提示已显示，**When** 运营人员点击"确认"，**Then** 系统将该活动类型状态更新为"已删除"，列表中不再显示该活动类型
3. **Given** 活动类型已被删除，**When** 运营人员查看活动类型列表，**Then** 已删除的活动类型不在列表中显示
4. **Given** 活动类型已被删除，**When** 小程序端用户查看活动类型列表，**Then** 已删除的活动类型不在列表中显示
5. **Given** 历史预约记录使用了已删除的活动类型，**When** 查看该预约记录，**Then** 系统仍可正常显示该活动类型的信息（名称、描述等）

---

### User Story 6 - 小程序端用户选择活动类型 (Priority: P1)

作为小程序端用户，我希望在预约时能够从可用的活动类型列表中选择合适的类型（如"企业团建"、"订婚"、"生日Party"等），以便准确描述我的预约需求。

**Why this priority**: 这是功能的最终价值体现，用户需要通过这个功能来完成预约。虽然这是前端功能，但依赖于后端提供启用状态的活动类型列表。

**Independent Test**: 小程序端用户打开预约页面，系统从后端获取状态为"启用"的活动类型列表，用户可以从下拉列表或选择器中选择活动类型。可以独立测试小程序端是否正确过滤和显示启用状态的活动类型。

**Acceptance Scenarios**:

1. **Given** 小程序端用户打开预约页面，**When** 系统加载活动类型列表，**Then** 仅显示状态为"启用"的活动类型，按排序号升序排列（不显示停用和已删除状态）
2. **Given** 活动类型选择器已显示，**When** 用户查看可选类型，**Then** 显示活动类型的名称和描述（如有）
3. **Given** 小程序端用户选择活动类型，**When** 用户提交预约，**Then** 系统记录用户选择的活动类型ID，用于后续统计和服务

---

### Edge Cases

- 当所有活动类型都被停用时，小程序端如何处理？应显示友好提示："暂无可用的活动类型，请联系客服"
- 当活动类型名称重复时如何处理？系统应验证名称唯一性，不允许创建重复名称
- 当删除活动类型时，如何处理？系统仅支持软删除（逻辑删除），删除操作将状态标记为"已删除"，数据仍保留在数据库中。已删除的活动类型不在任何列表中显示（包括运营后台和小程序端），但历史预约记录仍可正常关联和显示该活动类型的信息。
- 当活动类型排序号相同时，如何排序？按创建时间或ID作为次要排序依据
- 当活动类型数量很多时（如超过100个），列表如何展示？支持分页或搜索功能
- 当运营人员没有权限时，如何提示？显示"无权限访问"提示，不显示管理功能入口

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须提供活动类型数据表，包含字段：id（唯一标识）、name（名称，必填，唯一）、description（描述，可选）、status（状态：启用/停用/已删除，必填，默认启用）、sort（排序号，必填，用于控制显示顺序）、created_at（创建时间）、updated_at（更新时间）、deleted_at（删除时间，可选，用于软删除）
- **FR-002**: 系统必须提供活动类型的完整CRUD接口（创建、读取、更新、删除），供运营后台调用。删除操作采用软删除（逻辑删除），将状态标记为"已删除"，数据保留在数据库中
- **FR-003**: 系统必须实现权限控制，仅运营人员和管理员可以访问活动类型的维护接口，其他角色无法访问
- **FR-004**: 系统必须提供查询接口，返回状态为"启用"的活动类型列表，供小程序端调用
- **FR-005**: 系统必须验证活动类型名称的唯一性，不允许创建或更新为重复名称
- **FR-006**: 系统必须验证必填字段（名称、状态、排序号），缺少必填字段时返回验证错误
- **FR-007**: 运营后台必须提供活动类型管理列表页面，显示所有活动类型（包括启用和停用状态，但不包括已删除状态）
- **FR-015**: 系统必须支持活动类型的软删除功能，删除时将状态标记为"已删除"，数据保留在数据库中用于历史记录关联
- **FR-016**: 已删除的活动类型不在任何列表中显示（包括运营后台列表和小程序端列表），但历史预约记录仍可正常关联和显示该活动类型的信息（与软删除规则保持一致）
- **FR-008**: 运营后台必须提供新建活动类型的弹窗表单，包含名称、描述、排序号字段
- **FR-009**: 运营后台必须提供编辑活动类型的弹窗表单，可以修改名称、描述、排序号
- **FR-010**: 运营后台在停用活动类型时，必须显示确认提示："确定要停用此活动类型吗？停用后小程序端将不再显示此类型"
- **FR-011**: 运营后台在启用活动类型时，无需确认提示，直接更新状态
- **FR-012**: 小程序端必须仅显示状态为"启用"的活动类型，停用和已删除状态的活动类型不应显示
- **FR-017**: 运营后台必须提供删除活动类型的功能，删除时显示确认提示："确定要删除此活动类型吗？删除后该类型将不再显示，但历史预约记录仍可正常关联"
- **FR-013**: 活动类型列表必须按排序号升序排列，排序号相同时按创建时间排序
- **FR-014**: 系统必须记录活动类型的创建时间和更新时间，用于审计和追踪
- **FR-019**: 系统必须在活动类型上增加“业务分类”字段（如：私人订制、商务团建、派对策划），用于运营后台筛选和小程序端场景卡片展示；业务分类为可选字段，但在 Scenario Editor 中必须可配置。
- **FR-020**: 系统必须在活动类型上增加“背景图”字段（如 background_image_url），用于运营后台卡片预览和小程序端场景卡片背景展示；前端在列表和表单中提供上传/URL 填写与预览能力。
- **FR-021**: 系统必须支持为每个活动类型配置一个或多个“套餐”（Package），每个套餐至少包含：id、name（套餐名称）、current_price（现价）、original_price（原价，可选）、sort（排序号）；套餐数据通过独立表与活动类型建立一对多关系，并在后台表单中支持添加、编辑、删除套餐行。
- **FR-022**: 系统必须支持为每个活动类型关联一个或多个物理资源（门店/影厅），通过关系表维护 activity_type 与 store/hall 的多对多关系（如 activity_type_halls：activity_type_id, store_id, hall_id），在后台表单中支持选择所属门店和具体影厅，用于后续预约/排片时的资源限定。

### Key Entities

- **ActivityType（活动类型）**: 表示一种预约活动类型，包含以下属性：
  - id: 唯一标识符
  - name: 活动类型名称（如"企业团建"、"订婚"、"生日Party"），必填，唯一
  - description: 活动类型描述，可选，用于说明该类型的用途或特点
  - status: 状态（启用/停用/已删除），必填，默认启用，控制是否在小程序端显示。已删除状态用于软删除，数据保留但不在任何列表中显示
  - sort: 排序号，必填，用于控制在小程序端和后台列表中的显示顺序
  - business_category: 业务分类（如：私人订制、商务团建、派对策划），可选，用于前后端统一分组和筛选
  - background_image_url: 场景背景图 URL，可选，用于后台和小程序端场景卡片视觉展示
  - created_at: 创建时间，自动记录
  - updated_at: 更新时间，自动记录
  - deleted_at: 删除时间（软删除时记录），可选
  - created_by: 创建人（如果支持用户追踪），可选
  - updated_by: 更新人（如果支持用户追踪），可选
  - packages: 关联的套餐列表（逻辑属性，通过关联表维护），用于定价展示与选择
  - resources: 关联的物理资源列表（门店/影厅），用于预约/排片时限定可用范围

- **ActivityTypePackage（活动类型套餐）**: 表示某个活动类型下的一个套餐选项：
  - id: 唯一标识符
  - activity_type_id: 所属活动类型ID（外键）
  - name: 套餐名称（如“基础套餐”、“豪华套餐”），必填
  - current_price: 当前售价，必填
  - original_price: 原价，可选，用于展示优惠信息
  - sort: 排序号，用于控制同一活动类型下套餐显示顺序
  - created_at / updated_at: 创建/更新时间

- **ActivityTypeHallLink（活动类型资源关联）**: 表示活动类型与门店/影厅的关联关系：
  - id: 唯一标识符
  - activity_type_id: 活动类型ID（外键）
  - store_id: 门店ID（外键，引用 stores）
  - hall_id: 影厅ID（外键，引用 halls）
  - created_at / updated_at: 创建/更新时间

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 运营人员可以在2分钟内完成创建新活动类型的操作（从打开列表页到保存成功）
- **SC-002**: 运营人员可以在1分钟内完成启用/停用活动类型的操作（包括确认提示）
- **SC-003**: 小程序端加载活动类型列表的响应时间不超过1秒（在正常网络条件下）
- **SC-004**: 系统支持至少50个活动类型的配置和管理，列表加载和操作响应时间无明显延迟
- **SC-005**: 100%的启用状态活动类型在小程序端正确显示，0%的停用状态活动类型在小程序端显示
- **SC-006**: 权限控制有效性达到100%，非授权用户无法访问活动类型维护接口
- **SC-007**: 活动类型名称唯一性验证准确率达到100%，系统拒绝所有重复名称的创建或更新请求

## Assumptions

- 活动类型在基础上仍作为字典数据管理，但本期会在活动类型上直接扩展视觉与业务配置（背景图、业务分类、套餐、影城/影厅关联），不单独拆出新的场景实体
- 活动类型一旦创建，主要用于统计和历史数据追踪，因此删除操作采用软删除（逻辑删除），数据保留在数据库中，确保历史预约记录可以正常关联和显示活动类型信息
- 小程序端和运营后台使用相同的后端API，通过权限控制区分访问权限
- 活动类型的描述字段为可选，主要用于帮助用户理解活动类型的含义
- 排序号用于控制显示顺序，运营人员可以手动设置，系统不自动生成
- 活动类型的启用/停用操作是频繁操作，因此启用操作不需要确认提示以提升效率
- 系统支持基本的用户追踪（创建人、更新人），但如果当前系统不支持，这些字段可以为空

## Dependencies

- 需要用户认证和权限管理系统，以支持运营人员和管理员的权限控制
- 需要小程序端预约功能已实现或正在开发，以便集成活动类型选择功能
- 需要数据库支持基本的CRUD操作和时间戳字段

## Out of Scope

- 活动类型的复杂分类或多级层级管理（如多级目录树），本期仅支持简单的“业务分类”字段
- 除场景背景图以外的其他图标或图片上传能力（如图标库、相册管理等）
- 活动类型的多语言支持
- 活动类型的使用统计和分析报表（仅记录数据，不提供分析功能）
- 活动类型的批量导入/导出功能
- 活动类型的版本历史记录

## Clarifications

### Session 2025-12-18

- Q: “活动类型管理 (Scenario Editor)” 中的可视化场景卡片、背景图、业务分类、套餐定价以及影城/影厅关联，数据建模上是单独引入新场景实体，还是直接在现有活动类型上扩展字段和关联？ → A: 直接在现有活动类型上扩展字段及关联（选项 A）

